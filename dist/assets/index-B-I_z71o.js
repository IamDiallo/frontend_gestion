import{a as e,j as t,T as r,L as n,b as i,S as s,d as a,e as o,f as l,B as c,g as d,s as u,u as h,h as p,D as m,C as f,I as g,M as x,i as y,k as w,l as b,m as v,n as C,o as _,p as E,q as A,A as S,G as j,r as I,t as T,v as R,w as N,x as D,y as O,z as P,E as M,F as k,H as B,J as L,K as F,N as z,O as W,Q as U,R as V,U as H,V as G,W as q,X as $,Y as X,Z as Y,_ as Z,$ as K,a0 as Q,a1 as J,a2 as ee,a3 as te,a4 as re,a5 as ne,a6 as ie,a7 as se,a8 as ae,a9 as oe,aa as le,ab as ce,ac as de,ad as ue,ae as he,af as pe,ag as me,ah as fe,ai as ge,aj as xe,ak as ye,al as we,am as be,an as ve,ao as Ce,ap as _e,aq as Ee,ar as Ae,as as Se,at as je,au as Ie,av as Te,aw as Re,ax as Ne,ay as De,az as Oe,aA as Pe,aB as Me,aC as ke,aD as Be,aE as Le,aF as Fe,aG as ze,aH as We,aI as Ue,aJ as Ve,aK as He,aL as Ge,aM as qe,aN as $e,aO as Xe,aP as Ye,aQ as Ze,aR as Ke,aS as Qe,aT as Je,aU as et,aV as tt,aW as rt,aX as nt,aY as it,aZ as st,a_ as at,a$ as ot,b0 as lt,b1 as ct,b2 as dt}from"./mui-DFOHU3NI.js";import{d as ut,r as ht,u as pt,N as mt,f as ft,O as gt,b as xt,a as yt,e as wt,g as bt,h as vt,B as Ct,i as _t,j as Et}from"./vendor-Crl5LYj9.js";import{R as At,L as St,C as jt,X as It,Y as Tt,T as Rt,a as Nt,b as Dt,P as Ot,c as Pt,d as Mt,B as kt,e as Bt,A as Lt,f as Ft}from"./charts-B1M01W80.js";function zt(e,t){for(var r=0;r<t.length;r++){const n=t[r];if("string"!=typeof n&&!Array.isArray(n))for(const t in n)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Wt={},Ut=ut;Wt.createRoot=Ut.createRoot,Wt.hydrateRoot=Ut.hydrateRoot;const Vt=ht.createContext({themeMode:"light",toggleColorMode:()=>{},darkMode:!1,theme:e()}),Ht=({children:n})=>{const i=localStorage.getItem("theme-mode"),[s,a]=ht.useState(i||"light"),o="dark"===s,l=ht.useMemo((()=>{return e({palette:{mode:t=o?"dark":"light",..."light"===t?{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"},background:{default:"#f5f5f5",paper:"#ffffff"},text:{primary:"#212121",secondary:"#757575"}}:{primary:{main:"#90caf9",light:"#e3f2fd",dark:"#42a5f5"},secondary:{main:"#ce93d8",light:"#f3e5f5",dark:"#ab47bc"},background:{default:"#121212",paper:"#1e1e1e"},text:{primary:"#e0e0e0",secondary:"#9e9e9e"}}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700},h2:{fontWeight:600},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:500},h6:{fontWeight:500},button:{fontWeight:600,textTransform:"none"}},shape:{borderRadius:8},components:{MuiButton:{styleOverrides:{root:{fontWeight:600,borderRadius:8,padding:"8px 16px",boxShadow:"light"===t?"0 4px 6px rgba(0,0,0,0.08)":"0 4px 6px rgba(0,0,0,0.25)"}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"light"===t?"0 2px 10px rgba(0,0,0,0.05)":"0 2px 10px rgba(0,0,0,0.3)"}}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}}}});var t}),[o]);ht.useEffect((()=>{localStorage.setItem("theme-mode",s)}),[s]);const c={themeMode:s,toggleColorMode:()=>{a((e=>"light"===e?"dark":"light"))},darkMode:o,theme:l};return t.jsx(Vt.Provider,{value:c,children:t.jsx(r,{theme:l,children:n})})};function Gt(e,t){return function(){return e.apply(t,arguments)}}const{toString:qt}=Object.prototype,{getPrototypeOf:$t}=Object,Xt=(e=>t=>{const r=qt.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Yt=e=>(e=e.toLowerCase(),t=>Xt(t)===e),Zt=e=>t=>typeof t===e,{isArray:Kt}=Array,Qt=Zt("undefined");const Jt=Yt("ArrayBuffer");const er=Zt("string"),tr=Zt("function"),rr=Zt("number"),nr=e=>null!==e&&"object"==typeof e,ir=e=>{if("object"!==Xt(e))return!1;const t=$t(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},sr=Yt("Date"),ar=Yt("File"),or=Yt("Blob"),lr=Yt("FileList"),cr=Yt("URLSearchParams"),[dr,ur,hr,pr]=["ReadableStream","Request","Response","Headers"].map(Yt);function mr(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),Kt(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(n=0;n<s;n++)a=i[n],t.call(null,e[a],a,e)}}function fr(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const gr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,xr=e=>!Qt(e)&&e!==gr;const yr=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&$t(Uint8Array)),wr=Yt("HTMLFormElement"),br=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),vr=Yt("RegExp"),Cr=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};mr(r,((r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)})),Object.defineProperties(e,n)};const _r=Yt("AsyncFunction"),Er=(Ar="function"==typeof setImmediate,Sr=tr(gr.postMessage),Ar?setImmediate:Sr?(jr=`axios@${Math.random()}`,Ir=[],gr.addEventListener("message",(({source:e,data:t})=>{e===gr&&t===jr&&Ir.length&&Ir.shift()()}),!1),e=>{Ir.push(e),gr.postMessage(jr,"*")}):e=>setTimeout(e));var Ar,Sr,jr,Ir;const Tr="undefined"!=typeof queueMicrotask?queueMicrotask.bind(gr):"undefined"!=typeof process&&process.nextTick||Er,Rr={isArray:Kt,isArrayBuffer:Jt,isBuffer:function(e){return null!==e&&!Qt(e)&&null!==e.constructor&&!Qt(e.constructor)&&tr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||tr(e.append)&&("formdata"===(t=Xt(e))||"object"===t&&tr(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Jt(e.buffer),t},isString:er,isNumber:rr,isBoolean:e=>!0===e||!1===e,isObject:nr,isPlainObject:ir,isReadableStream:dr,isRequest:ur,isResponse:hr,isHeaders:pr,isUndefined:Qt,isDate:sr,isFile:ar,isBlob:or,isRegExp:vr,isFunction:tr,isStream:e=>nr(e)&&tr(e.pipe),isURLSearchParams:cr,isTypedArray:yr,isFileList:lr,forEach:mr,merge:function e(){const{caseless:t}=xr(this)&&this||{},r={},n=(n,i)=>{const s=t&&fr(r,i)||i;ir(r[s])&&ir(n)?r[s]=e(r[s],n):ir(n)?r[s]=e({},n):Kt(n)?r[s]=n.slice():r[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&mr(arguments[i],n);return r},extend:(e,t,r,{allOwnKeys:n}={})=>(mr(t,((t,n)=>{r&&tr(t)?e[n]=Gt(t,r):e[n]=t}),{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],n&&!n(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==r&&$t(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:Xt,kindOfTest:Yt,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(Kt(e))return e;let t=e.length;if(!rr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:wr,hasOwnProperty:br,hasOwnProp:br,reduceDescriptors:Cr,freezeMethods:e=>{Cr(e,((t,r)=>{if(tr(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];tr(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach((e=>{r[e]=!0}))};return Kt(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:fr,global:gr,isContextDefined:xr,isSpecCompliantForm:function(e){return!!(e&&tr(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(nr(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=Kt(e)?[]:{};return mr(e,((e,t)=>{const s=r(e,n+1);!Qt(s)&&(i[t]=s)})),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:_r,isThenable:e=>e&&(nr(e)||tr(e))&&tr(e.then)&&tr(e.catch),setImmediate:Er,asap:Tr};function Nr(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Rr.inherits(Nr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Rr.toJSONObject(this.config),code:this.code,status:this.status}}});const Dr=Nr.prototype,Or={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Or[e]={value:e}})),Object.defineProperties(Nr,Or),Object.defineProperty(Dr,"isAxiosError",{value:!0}),Nr.from=(e,t,r,n,i,s)=>{const a=Object.create(Dr);return Rr.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Nr.call(a,e.message,t,r,n,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};function Pr(e){return Rr.isPlainObject(e)||Rr.isArray(e)}function Mr(e){return Rr.endsWith(e,"[]")?e.slice(0,-2):e}function kr(e,t,r){return e?e.concat(t).map((function(e,t){return e=Mr(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}const Br=Rr.toFlatObject(Rr,{},null,(function(e){return/^is[A-Z]/.test(e)}));function Lr(e,t,r){if(!Rr.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=Rr.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Rr.isUndefined(t[e])}))).metaTokens,i=r.visitor||c,s=r.dots,a=r.indexes,o=(r.Blob||"undefined"!=typeof Blob&&Blob)&&Rr.isSpecCompliantForm(t);if(!Rr.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Rr.isDate(e))return e.toISOString();if(!o&&Rr.isBlob(e))throw new Nr("Blob is not supported. Use a Buffer instead.");return Rr.isArrayBuffer(e)||Rr.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,i){let o=e;if(e&&!i&&"object"==typeof e)if(Rr.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(Rr.isArray(e)&&function(e){return Rr.isArray(e)&&!e.some(Pr)}(e)||(Rr.isFileList(e)||Rr.endsWith(r,"[]"))&&(o=Rr.toArray(e)))return r=Mr(r),o.forEach((function(e,n){!Rr.isUndefined(e)&&null!==e&&t.append(!0===a?kr([r],n,s):null===a?r:r+"[]",l(e))})),!1;return!!Pr(e)||(t.append(kr(i,r,s),l(e)),!1)}const d=[],u=Object.assign(Br,{defaultVisitor:c,convertValue:l,isVisitable:Pr});if(!Rr.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!Rr.isUndefined(r)){if(-1!==d.indexOf(r))throw Error("Circular reference detected in "+n.join("."));d.push(r),Rr.forEach(r,(function(r,s){!0===(!(Rr.isUndefined(r)||null===r)&&i.call(t,r,Rr.isString(s)?s.trim():s,n,u))&&e(r,n?n.concat(s):[s])})),d.pop()}}(e),t}function Fr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function zr(e,t){this._pairs=[],e&&Lr(e,this,t)}const Wr=zr.prototype;function Ur(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Vr(e,t,r){if(!t)return e;const n=r&&r.encode||Ur;Rr.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let s;if(s=i?i(t,r):Rr.isURLSearchParams(t)?t.toString():new zr(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}Wr.append=function(e,t){this._pairs.push([e,t])},Wr.toString=function(e){const t=e?function(t){return e.call(this,t,Fr)}:Fr;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class Hr{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Rr.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}const Gr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qr={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:zr,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},$r="undefined"!=typeof window&&"undefined"!=typeof document,Xr="object"==typeof navigator&&navigator||void 0,Yr=$r&&(!Xr||["ReactNative","NativeScript","NS"].indexOf(Xr.product)<0),Zr="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Kr=$r&&window.location.href||"http://localhost",Qr={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:$r,hasStandardBrowserEnv:Yr,hasStandardBrowserWebWorkerEnv:Zr,navigator:Xr,origin:Kr},Symbol.toStringTag,{value:"Module"})),...qr};function Jr(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=i>=e.length;if(s=!s&&Rr.isArray(n)?n.length:s,o)return Rr.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!a;n[s]&&Rr.isObject(n[s])||(n[s]=[]);return t(e,r,n[s],i)&&Rr.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}(n[s])),!a}if(Rr.isFormData(e)&&Rr.isFunction(e.entries)){const r={};return Rr.forEachEntry(e,((e,n)=>{t(function(e){return Rr.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,r,0)})),r}return null}const en={transitional:Gr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=Rr.isObject(e);i&&Rr.isHTMLForm(e)&&(e=new FormData(e));if(Rr.isFormData(e))return n?JSON.stringify(Jr(e)):e;if(Rr.isArrayBuffer(e)||Rr.isBuffer(e)||Rr.isStream(e)||Rr.isFile(e)||Rr.isBlob(e)||Rr.isReadableStream(e))return e;if(Rr.isArrayBufferView(e))return e.buffer;if(Rr.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Lr(e,new Qr.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return Qr.isNode&&Rr.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Rr.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Lr(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(Rr.isString(e))try{return(t||JSON.parse)(e),Rr.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||en.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Rr.isResponse(e)||Rr.isReadableStream(e))return e;if(e&&Rr.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(r){if("SyntaxError"===i.name)throw Nr.from(i,Nr.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qr.classes.FormData,Blob:Qr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Rr.forEach(["delete","get","head","post","put","patch"],(e=>{en.headers[e]={}}));const tn=Rr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rn=Symbol("internals");function nn(e){return e&&String(e).trim().toLowerCase()}function sn(e){return!1===e||null==e?e:Rr.isArray(e)?e.map(sn):String(e)}function an(e,t,r,n,i){return Rr.isFunction(n)?n.call(this,t,r):(i&&(t=r),Rr.isString(t)?Rr.isString(n)?-1!==t.indexOf(n):Rr.isRegExp(n)?n.test(t):void 0:void 0)}let on=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=nn(t);if(!i)throw new Error("header name must be a non-empty string");const s=Rr.findKey(n,i);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=sn(e))}const s=(e,t)=>Rr.forEach(e,((e,r)=>i(e,r,t)));if(Rr.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Rr.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!r||t[r]&&tn[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)})),t})(e),t);else if(Rr.isHeaders(e))for(const[a,o]of e.entries())i(o,a,r);else null!=e&&i(t,e,r);return this}get(e,t){if(e=nn(e)){const r=Rr.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(Rr.isFunction(t))return t.call(this,e,r);if(Rr.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=nn(e)){const r=Rr.findKey(this,e);return!(!r||void 0===this[r]||t&&!an(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=nn(e)){const i=Rr.findKey(r,e);!i||t&&!an(0,r[i],i,t)||(delete r[i],n=!0)}}return Rr.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];e&&!an(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return Rr.forEach(this,((n,i)=>{const s=Rr.findKey(r,i);if(s)return t[s]=sn(n),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(i):String(i).trim();a!==i&&delete t[i],t[a]=sn(n),r[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Rr.forEach(this,((r,n)=>{null!=r&&!1!==r&&(t[n]=e&&Rr.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=(this[rn]=this[rn]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=nn(e);t[n]||(!function(e,t){const r=Rr.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return Rr.isArray(e)?e.forEach(n):n(e),this}};function ln(e,t){const r=this||en,n=t||r,i=on.from(n.headers);let s=n.data;return Rr.forEach(e,(function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function cn(e){return!(!e||!e.__CANCEL__)}function dn(e,t,r){Nr.call(this,null==e?"canceled":e,Nr.ERR_CANCELED,t,r),this.name="CanceledError"}function un(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Nr("Request failed with status code "+r.status,[Nr.ERR_BAD_REQUEST,Nr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}on.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Rr.reduceDescriptors(on.prototype,(({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}})),Rr.freezeMethods(on),Rr.inherits(dn,Nr,{__CANCEL__:!0});const hn=(e,t,r=3)=>{let n=0;const i=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=n[a];i||(i=l),r[s]=o,n[s]=l;let d=a,u=0;for(;d!==s;)u+=r[d++],d%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let r,n,i=0,s=1e3/t;const a=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),o=t-i;o>=s?a(e,t):(r=e,n||(n=setTimeout((()=>{n=null,a(r)}),s-o)))},()=>r&&a(r)]}((r=>{const s=r.loaded,a=r.lengthComputable?r.total:void 0,o=s-n,l=i(o);n=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:r,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),r)},pn=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},mn=e=>(...t)=>Rr.asap((()=>e(...t))),fn=Qr.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,Qr.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(Qr.origin),Qr.navigator&&/(msie|trident)/i.test(Qr.navigator.userAgent)):()=>!0,gn=Qr.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const a=[e+"="+encodeURIComponent(t)];Rr.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),Rr.isString(n)&&a.push("path="+n),Rr.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function xn(e,t,r){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&n||0==r?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const yn=e=>e instanceof on?{...e}:e;function wn(e,t){t=t||{};const r={};function n(e,t,r,n){return Rr.isPlainObject(e)&&Rr.isPlainObject(t)?Rr.merge.call({caseless:n},e,t):Rr.isPlainObject(t)?Rr.merge({},t):Rr.isArray(t)?t.slice():t}function i(e,t,r,i){return Rr.isUndefined(t)?Rr.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Rr.isUndefined(t))return n(void 0,t)}function a(e,t){return Rr.isUndefined(t)?Rr.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,r)=>i(yn(e),yn(t),0,!0)};return Rr.forEach(Object.keys(Object.assign({},e,t)),(function(n){const s=l[n]||i,a=s(e[n],t[n],n);Rr.isUndefined(a)&&s!==o||(r[n]=a)})),r}const bn=e=>{const t=wn({},e);let r,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:l}=t;if(t.headers=o=on.from(o),t.url=Vr(xn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Rr.isFormData(n))if(Qr.hasStandardBrowserEnv||Qr.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(r=o.getContentType())){const[e,...t]=r?r.split(";").map((e=>e.trim())).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(Qr.hasStandardBrowserEnv&&(i&&Rr.isFunction(i)&&(i=i(t)),i||!1!==i&&fn(t.url))){const e=s&&a&&gn.read(a);e&&o.set(s,e)}return t},vn="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){const n=bn(e);let i=n.data;const s=on.from(n.headers).normalize();let a,o,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=on.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());un((function(e){t(e),m()}),(function(e){r(e),m()}),{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(r(new Nr("Request aborted",Nr.ECONNABORTED,e,f)),f=null)},f.onerror=function(){r(new Nr("Network Error",Nr.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||Gr;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new Nr(t,i.clarifyTimeoutError?Nr.ETIMEDOUT:Nr.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Rr.forEach(s.toJSON(),(function(e,t){f.setRequestHeader(t,e)})),Rr.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=hn(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([o,c]=hn(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{f&&(r(!t||t.type?new dn(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const x=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);x&&-1===Qr.protocols.indexOf(x)?r(new Nr("Unsupported protocol "+x+":",Nr.ERR_BAD_REQUEST,e)):f.send(i||null)}))},Cn=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const i=function(e){if(!r){r=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Nr?t:new dn(t instanceof Error?t.message:t))}};let s=t&&setTimeout((()=>{s=null,i(new Nr(`timeout ${t} of ms exceeded`,Nr.ETIMEDOUT))}),t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:o}=n;return o.unsubscribe=()=>Rr.asap(a),o}},_n=function*(e,t){let r=e.byteLength;if(r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},En=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},An=(e,t,r,n)=>{const i=async function*(e,t){for await(const r of En(e))yield*_n(r,t)}(e,t);let s,a=0,o=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return o(),void e.close();let s=n.byteLength;if(r){let e=a+=s;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw o(t),t}},cancel:e=>(o(e),i.return())},{highWaterMark:2})},Sn="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,jn=Sn&&"function"==typeof ReadableStream,In=Sn&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Tn=(e,...t)=>{try{return!!e(...t)}catch(r){return!1}},Rn=jn&&Tn((()=>{let e=!1;const t=new Request(Qr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Nn=jn&&Tn((()=>Rr.isReadableStream(new Response("").body))),Dn={stream:Nn&&(e=>e.body)};var On;Sn&&(On=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Dn[e]&&(Dn[e]=Rr.isFunction(On[e])?t=>t[e]():(t,r)=>{throw new Nr(`Response type '${e}' is not supported`,Nr.ERR_NOT_SUPPORT,r)})})));const Pn=async(e,t)=>{const r=Rr.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Rr.isBlob(e))return e.size;if(Rr.isSpecCompliantForm(e)){const t=new Request(Qr.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Rr.isArrayBufferView(e)||Rr.isArrayBuffer(e)?e.byteLength:(Rr.isURLSearchParams(e)&&(e+=""),Rr.isString(e)?(await In(e)).byteLength:void 0)})(t):r},Mn={http:null,xhr:vn,fetch:Sn&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=bn(e);c=c?(c+"").toLowerCase():"text";let p,m=Cn([i,s&&s.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Rn&&"get"!==r&&"head"!==r&&0!==(g=await Pn(d,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(Rr.isFormData(n)&&(e=r.headers.get("content-type"))&&d.setContentType(e),r.body){const[e,t]=pn(g,hn(mn(l)));n=An(r.body,65536,e,t)}}Rr.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const a=Nn&&("stream"===c||"response"===c);if(Nn&&(o||a&&f)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=s[t]}));const t=Rr.toFiniteNumber(s.headers.get("content-length")),[r,n]=o&&pn(t,hn(mn(o),!0))||[];s=new Response(An(s.body,65536,r,(()=>{n&&n(),f&&f()})),e)}c=c||"text";let x=await Dn[Rr.findKey(Dn,c)||"text"](s,e);return!a&&f&&f(),await new Promise(((t,r)=>{un(t,r,{data:x,headers:on.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})}))}catch(x){if(f&&f(),x&&"TypeError"===x.name&&/fetch/i.test(x.message))throw Object.assign(new Nr("Network Error",Nr.ERR_NETWORK,e,p),{cause:x.cause||x});throw Nr.from(x,x&&x.code,e,p)}})};Rr.forEach(Mn,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(r){}Object.defineProperty(e,"adapterName",{value:t})}}));const kn=e=>`- ${e}`,Bn=e=>Rr.isFunction(e)||null===e||!1===e,Ln=e=>{e=Rr.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){let t;if(r=e[s],n=r,!Bn(r)&&(n=Mn[(t=String(r)).toLowerCase()],void 0===n))throw new Nr(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new Nr("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(kn).join("\n"):" "+kn(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function Fn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new dn(null,e)}function zn(e){Fn(e),e.headers=on.from(e.headers),e.data=ln.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Ln(e.adapter||en.adapter)(e).then((function(t){return Fn(e),t.data=ln.call(e,e.transformResponse,t),t.headers=on.from(t.headers),t}),(function(t){return cn(t)||(Fn(e),t&&t.response&&(t.response.data=ln.call(e,e.transformResponse,t.response),t.response.headers=on.from(t.response.headers))),Promise.reject(t)}))}const Wn="1.8.3",Un={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Un[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const Vn={};Un.transitional=function(e,t,r){function n(e,t){return"[Axios v1.8.3] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new Nr(n(i," has been removed"+(t?" in "+t:"")),Nr.ERR_DEPRECATED);return t&&!Vn[i]&&(Vn[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},Un.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};const Hn={assertOptions:function(e,t,r){if("object"!=typeof e)throw new Nr("options must be an object",Nr.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const t=e[s],r=void 0===t||a(t,s,e);if(!0!==r)throw new Nr("option "+s+" must be "+r,Nr.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Nr("Unknown option "+s,Nr.ERR_BAD_OPTION)}},validators:Un},Gn=Hn.validators;let qn=class{constructor(e){this.defaults=e,this.interceptors={request:new Hr,response:new Hr}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(n){}}throw r}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=wn(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;void 0!==r&&Hn.assertOptions(r,{silentJSONParsing:Gn.transitional(Gn.boolean),forcedJSONParsing:Gn.transitional(Gn.boolean),clarifyTimeoutError:Gn.transitional(Gn.boolean)},!1),null!=n&&(Rr.isFunction(n)?t.paramsSerializer={serialize:n}:Hn.assertOptions(n,{encode:Gn.function,serialize:Gn.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Hn.assertOptions(t,{baseUrl:Gn.spelling("baseURL"),withXsrfToken:Gn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Rr.merge(i.common,i[t.method]);i&&Rr.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=on.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let d,u=0;if(!o){const e=[zn.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=a.length;let h=t;for(u=0;u<d;){const e=a[u++],t=a[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=zn.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return Vr(xn((e=wn(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Rr.forEach(["delete","get","head","options"],(function(e){qn.prototype[e]=function(t,r){return this.request(wn(r||{},{method:e,url:t,data:(r||{}).data}))}})),Rr.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(wn(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}qn.prototype[e]=t(),qn.prototype[e+"Form"]=t(!0)}));const $n={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($n).forEach((([e,t])=>{$n[t]=e}));const Xn=function e(t){const r=new qn(t),n=Gt(qn.prototype.request,r);return Rr.extend(n,qn.prototype,r,{allOwnKeys:!0}),Rr.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(wn(t,r))},n}(en);Xn.Axios=qn,Xn.CanceledError=dn,Xn.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e,n,i){r.reason||(r.reason=new dn(e,n,i),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e((function(e){t=e})),cancel:t}}},Xn.isCancel=cn,Xn.VERSION=Wn,Xn.toFormData=Lr,Xn.AxiosError=Nr,Xn.Cancel=Xn.CanceledError,Xn.all=function(e){return Promise.all(e)},Xn.spread=function(e){return function(t){return e.apply(null,t)}},Xn.isAxiosError=function(e){return Rr.isObject(e)&&!0===e.isAxiosError},Xn.mergeConfig=wn,Xn.AxiosHeaders=on,Xn.formToJSON=e=>Jr(Rr.isHTMLForm(e)?new FormData(e):e),Xn.getAdapter=Ln,Xn.HttpStatusCode=$n,Xn.default=Xn;const{Axios:Yn,AxiosError:Zn,CanceledError:Kn,isCancel:Qn,CancelToken:Jn,VERSION:ei,all:ti,Cancel:ri,isAxiosError:ni,spread:ii,toFormData:si,AxiosHeaders:ai,HttpStatusCode:oi,formToJSON:li,getAdapter:ci,mergeConfig:di}=Xn,ui=ht.createContext({userPermissions:[],isAdmin:!1,userRole:null,userGroups:[],loading:!0,error:null,hasPermission:()=>!1,refreshPermissions:async()=>{}}),hi=({children:e})=>{const[r,n]=ht.useState([]),[i,s]=ht.useState(!1),[a,o]=ht.useState(null),[l,c]=ht.useState([]),[d,u]=ht.useState(!0),[h,p]=ht.useState(null),m=async()=>{var e,t,r;try{u(!0),p(null);const e=localStorage.getItem("access_token");if(!e)return n([]),s(!1),o(null),void c([]);const t=await Xn.get("http://ec2-35-170-248-140.compute-1.amazonaws.com/api/users/user_permissions/",{headers:{Authorization:`Bearer ${e}`}}),{permissions:r,is_admin:i,role:a,groups:l}=t.data;n(r||[]),s(i||!1),o(a||null),c(l||[]),localStorage.setItem("user_permissions",JSON.stringify(r||[])),localStorage.setItem("is_admin",JSON.stringify(i||!1)),localStorage.setItem("user_role",a||""),localStorage.setItem("user_groups",JSON.stringify(l||[]))}catch(i){console.error("Error fetching permissions:",i);try{const i=localStorage.getItem("access_token");if(!i)throw new Error("No token available");const a=await Xn.get("http://ec2-35-170-248-140.compute-1.amazonaws.com/api/users/me/",{headers:{Authorization:`Bearer ${i}`}});if(null==(e=a.data)?void 0:e.permissions){const e=a.data.permissions.map((e=>e.includes(".")?e.split(".")[1]:e));return n(e),s(a.data.is_superuser||!1),o((null==(t=a.data.profile_data)?void 0:t.role)||null),c(a.data.groups||[]),localStorage.setItem("user_permissions",JSON.stringify(e)),localStorage.setItem("is_admin",JSON.stringify(a.data.is_superuser||!1)),localStorage.setItem("user_role",(null==(r=a.data.profile_data)?void 0:r.role)||""),void localStorage.setItem("user_groups",JSON.stringify(a.data.groups||[]))}}catch(a){console.error("Fallback to /me endpoint also failed:",a)}const l=localStorage.getItem("user_permissions"),d=localStorage.getItem("is_admin"),u=localStorage.getItem("user_role"),h=localStorage.getItem("user_groups");l?(n(JSON.parse(l)),s("true"===d),o(u||null),c(h?JSON.parse(h):[])):p("Failed to load permissions")}finally{u(!1)}};ht.useEffect((()=>{m()}),[]);return t.jsx(ui.Provider,{value:{userPermissions:r,isAdmin:i,userRole:a,userGroups:l,loading:d,error:h,hasPermission:e=>{if(i)return!0;let t=e;e.includes(".")&&(t=e.split(".")[1]);const n=r.includes(t);return["view_sale","view_client","view_product","view_stock","view_cashflow","change_user"].includes(t)&&console.log("ðŸ” Permission Check:",{requested:e,checking:t,userPermissions:r.slice(0,15),hasAccess:n,isAdmin:i}),n},refreshPermissions:async()=>{await m()}},children:e})},pi=()=>ht.useContext(ui),mi=({to:e,icon:r,text:c,requiredPermission:d,open:u,forceShow:h=!1})=>{const p=pt(),{hasPermission:m,loading:f}=pi();if(f||h){const d=t.jsxs(n,{component:mt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),f&&u?t.jsx(s,{variant:"text",width:"80%",height:24}):t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?d:t.jsx(l,{title:c,placement:"right",children:d})})}if(null===d){const s=t.jsxs(n,{component:mt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?s:t.jsx(l,{title:c,placement:"right",children:s})})}if(!(!d||m(d)))return null;const g=t.jsxs(n,{component:mt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?g:t.jsx(l,{title:c,placement:"right",children:g})})},fi=({size:e="medium",variant:r="full",sx:n={}})=>{const i=e=>{switch(e){case"small":return"1.25rem";case"large":return"2.5rem";default:return"1.75rem"}},s=e=>{switch(e){case"small":return 32;case"large":return 56;default:return 40}};return t.jsxs(c,{sx:{display:"flex",alignItems:"center",...n},children:[t.jsx(c,{sx:{width:s(e),height:s(e),bgcolor:"primary.main",borderRadius:"8px",display:"flex",justifyContent:"center",alignItems:"center",color:"white",fontWeight:"bold",fontSize:i(e),mr:"full"===r?1:0},children:"G"}),"full"===r&&t.jsx(d,{variant:"h6",component:"div",sx:{fontWeight:"bold",fontSize:i(e),color:"primary.main"},children:"Gestion"})]})},gi=u("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"}))),xi=({open:e,onClose:r,variant:n,width:i})=>{const a=h();p(a.breakpoints.down("md"));const{isAdmin:o,loading:l,refreshPermissions:u}=pi(),[T,R]=ht.useState(!0),[N,D]=ht.useState(null);ht.useEffect((()=>{!l&&T&&R(!1)}),[l,T]),ht.useEffect((()=>{const e=localStorage.getItem("current_user");e!==N&&(D(e),e&&u())}),[N,u]);const O=[{to:"/",icon:t.jsx(b,{}),text:"Tableau de bord",requiredPermission:null},{to:"/sales",icon:t.jsx(v,{}),text:"Ventes",requiredPermission:"view_sale"},{to:"/clients",icon:t.jsx(C,{}),text:"Clients",requiredPermission:"view_client"},{to:"/suppliers",icon:t.jsx(_,{}),text:"Fournisseurs",requiredPermission:"view_supplier"},{to:"/products",icon:t.jsx(E,{}),text:"Produits",requiredPermission:"view_product"},{to:"/production",icon:t.jsx(A,{}),text:"Production",requiredPermission:"view_production"},{to:"/inventory",icon:t.jsx(E,{}),text:"Inventaire",requiredPermission:"view_stock"},{divider:!0},{to:"/treasury",icon:t.jsx(S,{}),text:"TrÃ©sorerie",requiredPermission:"view_cashflow"},{divider:!0},{to:"/users",icon:t.jsx(j,{}),text:"Utilisateurs",requiredPermission:"view_user"},{to:"/settings",icon:t.jsx(I,{}),text:"ParamÃ¨tres",requiredPermission:"change_user"}];if(T&&l)return t.jsx(m,{sx:{width:i,flexShrink:0,"& .MuiDrawer-paper":{width:i,boxSizing:"border-box",backgroundColor:a.palette.background.paper}},variant:n,anchor:"left",open:e,onClose:r,children:t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",p:2},children:[t.jsx(f,{size:40}),t.jsx(d,{variant:"body2",sx:{mt:2},children:"Chargement..."})]})});return t.jsxs(m,{sx:{width:i,flexShrink:0,"& .MuiDrawer-paper":{width:i,boxSizing:"border-box",backgroundColor:a.palette.background.paper,borderRight:`1px solid ${a.palette.divider}`,boxShadow:a.shadows[1],borderRadius:0}},variant:n,anchor:"left",open:e,onClose:r,children:[t.jsxs(gi,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2,py:1.5,borderRadius:0},children:[t.jsx(fi,{variant:"full",size:"medium"}),t.jsx(g,{onClick:r,sx:{bgcolor:"transparent",color:a.palette.primary.main,"&:hover":{bgcolor:a.palette.action.hover}},children:t.jsx(x,{fontSize:"large"})})]}),t.jsx(y,{}),t.jsx(c,{sx:{p:1},children:t.jsx(w,{component:"nav","aria-label":"main navigation",sx:{p:.5},children:l?t.jsx(t.Fragment,{children:[1,2,3,4].map((r=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",px:2,py:1},children:[t.jsx(s,{variant:"circular",width:24,height:24,sx:{mr:e?3:0}}),e&&t.jsx(s,{variant:"text",width:120,height:24})]},`loading-${r}`)))}):O.map(((r,n)=>{if("divider"in r)return t.jsx(y,{sx:{my:1}},`divider-${n}`);const i=r;return i.adminOnly&&!o?null:t.jsx(mi,{to:i.to,icon:i.icon,text:i.text,requiredPermission:i.requiredPermission,open:e},i.to)}))})})]})},yi="http://ec2-35-170-248-140.compute-1.amazonaws.com/api";console.log("Using API URL:",yi);const wi=Xn.create({baseURL:yi,headers:{"Content-Type":"application/json"},withCredentials:!0});wi.interceptors.request.use((async e=>{console.log("Request configuration:",{url:e.url,method:e.method,headers:e.headers,baseURL:e.baseURL,withCredentials:e.withCredentials});const t=localStorage.getItem("access_token"),r=localStorage.getItem("token_expiration");if(t&&r){const t=parseInt(r,10)-(new Date).getTime();if(t<6e4&&t>0){console.log("Token expiring soon, refreshing proactively");try{const t=localStorage.getItem("refresh_token");if(t){const r=await Xn.post(`${yi}/token/refresh/`,{refresh:t});if(r.data&&r.data.access){const t=r.data.access;localStorage.setItem("access_token",t);const n=(new Date).getTime()+9e5;return localStorage.setItem("token_expiration",n.toString()),e.headers.Authorization=`Bearer ${t}`,e}}}catch(n){console.error("Failed to refresh token proactively:",n)}}}return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>(console.error("Request error:",e),Promise.reject(e)))),wi.interceptors.response.use((e=>(console.log("Response successful:",{status:e.status,statusText:e.statusText,headers:e.headers,url:e.config.url}),e)),(async e=>{var t;console.error("Response error:",{message:e.message,response:e.response?{status:e.response.status,statusText:e.response.statusText,data:e.response.data}:null,request:e.config?{url:e.config.url,method:e.config.method,headers:e.config.headers}:null});const r=e.config;if(401===(null==(t=e.response)?void 0:t.status)&&r&&!r._retry){r._retry=!0;try{const e=localStorage.getItem("refresh_token");if(!e)throw new Error("No refresh token available");const t=(await wi.post("/token/refresh/",{refresh:e})).data.access;return localStorage.setItem("access_token",t),wi.defaults.headers.common.Authorization=`Bearer ${t}`,wi(r)}catch(n){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",Promise.reject(n)}}return Promise.reject(e)}));const bi=(e,t,r)=>{console.log(`%cAPI Request: ${t.toUpperCase()} ${e}`,"background: #ded; color: #080; font-weight: bold"),r&&console.log("Request data:",r),console.log("Request headers:",wi.defaults.headers),console.log("Auth token:",localStorage.getItem("access_token")?"Present":"Missing")},vi=(e,t)=>{console.log(`%cAPI Response from ${e}:`,"background: #dde; color: #008; font-weight: bold");const r=t;console.log("Status:",r.status),console.log("Data:",r.data),console.log("Is array?",Array.isArray(r.data)),console.log("Length:",Array.isArray(r.data)?r.data.length:"N/A")},Ci=(e,t)=>{console.error(`%cAPI Error from ${e}:`,"background: #edd; color: #800; font-weight: bold",t);const r=t;r.response?(console.error("Response data:",r.response.data),console.error("Response status:",r.response.status),console.error("Response headers:",r.response.headers)):r.request?console.error("Request was made but no response received",r.request):console.error("Error during request setup:",r.message),console.error("Error config:",r.config)},_i=async e=>{bi(`/${e}/`,"GET");try{const t=performance.now(),r=await wi.get(`/${e}/`),n=performance.now();return console.log(`Request to /${e}/ took ${n-t}ms`),Array.isArray(r.data)&&0===r.data.length?console.warn(`Empty array returned from /${e}/`):null!==r.data&&void 0!==r.data||console.warn(`Null/undefined response from /${e}/`),vi(`/${e}/`,r),r.data}catch(t){throw Ci(`/${e}/`,t),t}},Ei=async(e,t)=>{try{return(await wi.post(`/${e}/`,t)).data}catch(r){throw console.error(`Error creating ${e}:`,r),r}},Ai=async(e,t,r)=>{try{return(await wi.put(`/${e}/${t}/`,r)).data}catch(n){throw console.error(`Error updating ${e}:`,n),n}},Si=async(e,t)=>{try{return await wi.delete(`/${e}/${t}/`),!0}catch(r){throw console.error(`Error deleting ${e}:`,r),r}},ji=async()=>{try{bi("/clients/","GET");const e=await wi.get("/clients/");return vi("/clients/",e),e.data.results||e.data}catch(e){throw Ci("/clients/",e),e}},Ii=async e=>{try{bi(`/clients/${e}/`,"GET");const t=await wi.get(`/clients/${e}/`);return vi(`/clients/${e}/`,t),t.data}catch(t){throw Ci(`/clients/${e}/`,t),t}},Ti=async e=>{try{bi("/clients/","POST",e);const t=await wi.post("/clients/",e);return vi("/clients/",t),t.data}catch(t){throw Ci("/clients/",t),t}},Ri=async(e,t)=>{try{bi(`/clients/${e}/`,"PUT",t);const r=await wi.put(`/clients/${e}/`,t);return vi(`/clients/${e}/`,r),r.data}catch(r){throw Ci(`/clients/${e}/`,r),r}},Ni=async e=>{try{bi(`/clients/${e}/`,"DELETE");const t=await wi.delete(`/clients/${e}/`);return vi(`/clients/${e}/`,t),t.data}catch(t){throw Ci(`/clients/${e}/`,t),t}},Di=async()=>{try{bi("/zones/","GET");const e=await wi.get("/zones/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/zones/",{...e,data:t}),t}catch(e){throw Ci("/zones/",e),e}},Oi=async()=>{try{bi("/product-categories/","GET");const e=await wi.get("/product-categories/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/product-categories/",{...e,data:t}),t}catch(e){throw Ci("/product-categories/",e),e}},Pi=async()=>{try{bi("/units-of-measure/","GET");const e=await wi.get("/units-of-measure/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/units-of-measure/",{...e,data:t}),t}catch(e){throw Ci("/units-of-measure/",e),e}},Mi=async()=>{try{bi("/products/","GET");const e=await wi.get("/products/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/products/",{...e,data:t}),t}catch(e){throw Ci("/products/",e),e}},ki=e=>_i(`products/${e}`),Bi=e=>Ei("products",e),Li=(e,t)=>Ai("products",e,t),Fi=e=>Si("products",e),zi=async()=>{try{bi("/suppliers/","GET");const e=await wi.get("/suppliers/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/suppliers/",{...e,data:t}),t}catch(e){throw Ci("/suppliers/",e),e}},Wi=e=>Ei("suppliers",e),Ui=(e,t)=>Ai("suppliers",e,t),Vi=async()=>{try{bi("/stocks/","GET");const e=await wi.get("/stocks/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/stocks/",{...e,data:t}),t}catch(e){throw Ci("/stocks/",e),e}},Hi=async e=>{try{bi(`/stocks/by_zone/${e}/`,"GET");const t=await wi.get(`/stocks/by_zone/${e}/`),r=Array.isArray(t.data)?t.data:t.data&&t.data.results?t.data.results:[];return vi(`/stocks/by_zone/${e}/`,{...t,data:r}),r}catch(t){throw Ci(`/stocks/by_zone/${e}/`,t),t}},Gi=async()=>{try{bi("/stock-cards/","GET");const e=await wi.get("/stock-cards/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/stock-cards/",{...e,data:t}),t}catch(e){throw Ci("/stock-cards/",e),e}},qi=async e=>{try{bi("/stock-supplies/","POST",e);const t=await wi.post("/stock-supplies/",e);return vi("/stock-supplies/",t),t.data}catch(t){throw Ci("/stock-supplies/",t),t}},$i=async()=>{try{bi("/stock-supplies/","GET");const e=await wi.get("/stock-supplies/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/stock-supplies/",{...e,data:t}),t}catch(e){throw Ci("/stock-supplies/",e),e}},Xi=async e=>{try{bi(`/stock-supplies/${e}/`,"GET");const t=await wi.get(`/stock-supplies/${e}/`);return vi(`/stock-supplies/${e}/`,t),t.data}catch(t){throw Ci(`/stock-supplies/${e}/`,t),t}},Yi=async(e,t)=>{try{bi(`/stock-supplies/${e}/`,"PUT",t);const r=await wi.put(`/stock-supplies/${e}/`,t);return vi(`/stock-supplies/${e}/`,r),r.data}catch(r){throw Ci(`/stock-supplies/${e}/`,r),r}},Zi=async e=>{try{bi("/stock-transfers/","POST",e);const t=await wi.post("/stock-transfers/",e);return vi("/stock-transfers/",t),t.data}catch(t){throw Ci("/stock-transfers/",t),t}},Ki=async()=>{try{bi("/stock-transfers/","GET");const e=await wi.get("/stock-transfers/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/stock-transfers/",{...e,data:t}),t}catch(e){throw Ci("/stock-transfers/",e),e}},Qi=async e=>{try{bi(`/stock-transfers/${e}/`,"GET");const t=await wi.get(`/stock-transfers/${e}/`);return vi(`/stock-transfers/${e}/`,t),t.data}catch(t){throw Ci(`/stock-transfers/${e}/`,t),t}},Ji=async(e,t)=>{try{bi(`/stock-transfers/${e}/`,"PUT",t);const r=await wi.put(`/stock-transfers/${e}/`,t);return vi(`/stock-transfers/${e}/`,r),r.data}catch(r){throw Ci(`/stock-transfers/${e}/`,r),r}},es=async e=>{try{bi("/inventories/","POST",e);const t=await wi.post("/inventories/",e);return vi("/inventories/",t),t.data}catch(t){throw Ci("/inventories/",t),t}},ts=async()=>{try{bi("/inventories/","GET");const e=await wi.get("/inventories/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/inventories/",{...e,data:t}),t}catch(e){throw Ci("/inventories/",e),e}},rs=async e=>{try{bi(`/inventories/${e}/`,"GET");const t=await wi.get(`/inventories/${e}/`);return vi(`/inventories/${e}/`,t),t.data}catch(t){throw Ci(`/inventories/${e}/`,t),t}},ns=async(e,t)=>{try{bi(`/inventories/${e}/`,"PUT",t);const r=await wi.put(`/inventories/${e}/`,t);return vi(`/inventories/${e}/`,r),r.data}catch(r){throw Ci(`/inventories/${e}/`,r),r}},is=async e=>{try{return bi(`/stock-supplies/${e}/`,"DELETE"),await wi.delete(`/stock-supplies/${e}/`),!0}catch(t){throw Ci(`/stock-supplies/${e}/`,t),t}},ss=async e=>{try{return bi(`/stock-transfers/${e}/`,"DELETE"),await wi.delete(`/stock-transfers/${e}/`),!0}catch(t){throw Ci(`/stock-transfers/${e}/`,t),t}},as=async e=>{try{return bi(`/inventories/${e}/`,"DELETE"),await wi.delete(`/inventories/${e}/`),!0}catch(t){throw Ci(`/inventories/${e}/`,t),t}},os=async(e,t,r)=>{try{bi(`/stocks/check_availability/?product_id=${e}&zone_id=${t}&quantity=${r}`,"GET");const n=await wi.get(`/stocks/check_availability/?product_id=${e}&zone_id=${t}&quantity=${r}`);return vi("/stocks/check_availability/",n),n.data}catch(n){throw Ci("/stocks/check_availability/",n),n}},ls=async()=>{try{bi("/sales/","GET");const e=await wi.get("/sales/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/sales/",{...e,data:t}),t}catch(e){throw Ci("/sales/",e),e}},cs=async e=>{try{bi(`/sales/${e}/`,"GET");const t=await wi.get(`/sales/${e}/`);return vi(`/sales/${e}/`,t),t.data}catch(t){throw Ci(`/sales/${e}/`,t),t}},ds=async e=>{try{bi("/sales/","POST",e);const t=await wi.post("/sales/",e);return vi("/sales/",t),t.data}catch(t){throw Ci("/sales/",t),t}},us=async(e,t)=>{try{bi(`/sales/${e}/`,"PUT",t);const r=await wi.put(`/sales/${e}/`,t);return vi(`/sales/${e}/`,r),r.data}catch(r){throw Ci(`/sales/${e}/`,r),r}},hs=async e=>{try{bi(`/sales/${e}/`,"DELETE");return(await wi.delete(`/sales/${e}/`)).data}catch(t){throw Ci(`/sales/${e}/`,t),t}},ps=async(e,t)=>{var r;try{bi(`/sales/${e}/pay_from_account/`,"POST",t);const n=await wi.post(`/sales/${e}/pay_from_account/`,t);if(vi(`/sales/${e}/pay_from_account/`,n),"paid"===(null==(r=n.data.sale)?void 0:r.payment_status)){const t=await wi.get(`/sales/${e}/`);"payment_pending"!==t.data.status&&"confirmed"!==t.data.status||(await wi.patch(`/sales/${e}/`,{status:"paid"}),n.data.sale.status="paid")}return n.data}catch(n){throw Ci(`/sales/${e}/pay_from_account/`,n),n}},ms=async()=>{try{bi("/invoices/","GET");const e=await wi.get("/invoices/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/invoices/",{...e,data:t}),t}catch(e){throw Ci("/invoices/",e),e}},fs=async e=>(await wi.get(`/invoices/${e}/`)).data,gs=async e=>(await wi.post("/invoices/",e)).data,xs=async(e,t)=>(await wi.put(`/invoices/${e}/`,t)).data,ys=async e=>(await wi.delete(`/invoices/${e}/`),!0),ws=async()=>{try{bi("/quotes/","GET");const e=await wi.get("/quotes/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/quotes/",{...e,data:t}),t}catch(e){throw Ci("/quotes/",e),e}},bs=async e=>(await wi.get(`/quotes/${e}/`)).data,vs=async e=>(await wi.post("/quotes/",e)).data,Cs=async(e,t)=>(await wi.put(`/quotes/${e}/`,t)).data,_s=async e=>(await wi.delete(`/quotes/${e}/`),!0),Es=async(e,t)=>(await wi.post(`/quotes/${e}/convert_to_sale/`,{zone:t})).data,As=async()=>{try{bi("/users/","GET");const e=await wi.get("/users/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/users/",{...e,data:t}),t}catch(e){throw Ci("/users/",e),e}},Ss=async e=>{try{bi(`/users/${e}/`,"GET");const t=await wi.get(`/users/${e}/`);return vi(`/users/${e}/`,t),t.data}catch(t){throw Ci(`/users/${e}/`,t),t}},js=async e=>{try{bi("/users/","POST",e);const t=await wi.post("/users/",e);return vi("/users/",t),t.data}catch(t){throw Ci("/users/",t),t}},Is=async(e,t)=>{try{bi(`/users/${e}/`,"PUT",t);const r=await wi.put(`/users/${e}/`,t);return vi(`/users/${e}/`,r),r.data}catch(r){throw Ci(`/users/${e}/`,r),r}},Ts=async e=>{try{return bi(`/users/${e}/`,"DELETE"),await wi.delete(`/users/${e}/`),!0}catch(t){throw Ci(`/users/${e}/`,t),t}},Rs=async()=>{try{bi("/groups/","GET");const e=await wi.get("/groups/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/groups/",{...e,data:t}),t}catch(e){throw Ci("/groups/",e),e}},Ns=async e=>{try{bi("/groups/","POST",e);const t=await wi.post("/groups/",e);return vi("/groups/",t),t.data}catch(t){throw Ci("/groups/",t),t}},Ds=async(e,t)=>{try{bi(`/groups/${e}/`,"PUT",t);const r=await wi.put(`/groups/${e}/`,t);return vi(`/groups/${e}/`,r),r.data}catch(r){throw Ci(`/groups/${e}/`,r),r}},Os=async e=>{try{return bi(`/groups/${e}/`,"DELETE"),await wi.delete(`/groups/${e}/`),!0}catch(t){throw Ci(`/groups/${e}/`,t),t}},Ps=async()=>{try{bi("/permissions/categorized/","GET");const e=await wi.get("/permissions/categorized/");return vi("/permissions/categorized/",e),e.data}catch(e){throw Ci("/permissions/categorized/",e),e}},Ms=async()=>{try{bi("/productions/","GET");const e=await wi.get("/productions/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/productions/",{...e,data:t}),t}catch(e){throw Ci("/productions/",e),e}},ks=async e=>{try{bi("/productions/","POST",e);const t=await wi.post("/productions/",e);return vi("/productions/",t),t.data}catch(t){throw Ci("/productions/",t),t}},Bs=async(e,t)=>{try{bi(`/productions/${e}/`,"PUT",t);const r=await wi.put(`/productions/${e}/`,t);return vi(`/productions/${e}/`,r),r.data}catch(r){throw Ci(`/productions/${e}/`,r),r}},Ls=async e=>{try{return bi(`/productions/${e}/`,"DELETE"),await wi.delete(`/productions/${e}/`),!0}catch(t){throw Ci(`/productions/${e}/`,t),t}},Fs=async e=>{try{bi(`/${e}/`,"GET");const t=await wi.get(`/${e}/`),r=Array.isArray(t.data)?t.data:t.data&&t.data.results?t.data.results:[];return vi(`/${e}/`,{...t,data:r}),r}catch(t){throw Ci(`/${e}/`,t),t}},zs=async(e,t)=>{try{bi(`/${e}/`,"POST",t);const r=await wi.post(`/${e}/`,t);return vi(`/${e}/`,r),r.data}catch(r){throw Ci(`/${e}/`,r),r}},Ws=async(e,t,r)=>{try{bi(`/${e}/${t}/`,"PUT",r);const n=await wi.put(`/${e}/${t}/`,r);return vi(`/${e}/${t}/`,n),n.data}catch(n){throw Ci(`/${e}/${t}/`,n),n}},Us=async(e,t)=>{try{return bi(`/${e}/${t}/`,"DELETE"),await wi.delete(`/${e}/${t}/`),!0}catch(r){throw Ci(`/${e}/${t}/`,r),r}},Vs=async()=>{try{bi("/accounts/","GET");const e=await wi.get("/accounts/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/accounts/",{...e,data:t}),t}catch(e){throw Ci("/accounts/",e),e}},Hs=async e=>{try{bi(`/accounts/by_type/?type=${e}`,"GET");const t=await wi.get(`/accounts/by_type/?type=${e}`),r=Array.isArray(t.data)?t.data:t.data&&t.data.results?t.data.results:[];return vi(`/accounts/by_type/?type=${e}`,{...t,data:r}),r}catch(t){throw Ci(`/accounts/by_type/?type=${e}`,t),t}},Gs={getClientPayments:async()=>{try{bi("/client-payments/","GET");const e=await wi.get("/client-payments/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/client-payments/",{...e,data:t}),t}catch(e){throw Ci("/client-payments/",e),e}},createClientPayment:async e=>{try{bi("/client-payments/","POST",e);const t=await wi.post("/client-payments/",e);return vi("/client-payments/",t),t.data}catch(t){throw Ci("/client-payments/",t),t}},getSupplierPayments:async()=>{try{bi("/supplier-payments/","GET");const e=await wi.get("/supplier-payments/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/supplier-payments/",{...e,data:t}),t}catch(e){throw Ci("/supplier-payments/",e),e}},createSupplierPayment:async e=>{try{bi("/supplier-payments/","POST",e);const t=await wi.post("/supplier-payments/",e);return vi("/supplier-payments/",t),t.data}catch(t){throw Ci("/supplier-payments/",t),t}},getExpenses:async()=>{try{bi("/expenses/","GET");const e=await wi.get("/expenses/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/expenses/",{...e,data:t}),t}catch(e){throw Ci("/expenses/",e),e}},createExpense:async e=>{try{bi("/expenses/","POST",e);const t=await wi.post("/expenses/",e);return vi("/expenses/",t),t.data}catch(t){throw Ci("/expenses/",t),t}},getCashReceipts:async()=>{try{bi("/cash-receipts/","GET");const e=await wi.get("/cash-receipts/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/cash-receipts/",{...e,data:t}),t}catch(e){throw Ci("/cash-receipts/",e),e}},getCashReceiptsBySale:async e=>{try{bi(`/cash-receipts/?sale=${e}`,"GET");const t=await wi.get(`/cash-receipts/?sale=${e}`),r=Array.isArray(t.data)?t.data:t.data&&t.data.results?t.data.results:[];return vi(`/cash-receipts/?sale=${e}`,t),r}catch(t){throw Ci(`/cash-receipts/?sale=${e}`,t),t}},createCashReceipt:async e=>{try{bi("/cash-receipts/","POST",e);const t=await wi.post("/cash-receipts/",e);return vi("/cash-receipts/",t),t.data}catch(t){throw Ci("/cash-receipts/",t),t}},createCashReceiptFromSale:async(e,t)=>{try{bi("/cash-receipts/from_sale/","POST",{sale_id:e,...t});const r=await wi.post("/cash-receipts/from_sale/",{sale_id:e,...t});return vi("/cash-receipts/from_sale/",r),r.data}catch(r){throw Ci("/cash-receipts/from_sale/",r),r}},getCashPayments:async()=>{try{bi("/cash-payments/","GET");const e=await wi.get("/cash-payments/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/cash-payments/",{...e,data:t}),t}catch(e){throw Ci("/cash-payments/",e),e}},createCashPayment:async e=>{try{bi("/cash-payments/","POST",e);const t=await wi.post("/cash-payments/",e);return vi("/cash-payments/",t),t.data}catch(t){throw Ci("/cash-payments/",t),t}},getAccountTransfers:async()=>{try{bi("/account-transfers/","GET");const e=await wi.get("/account-transfers/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/account-transfers/",{...e,data:t}),t}catch(e){throw Ci("/account-transfers/",e),e}},createAccountTransfer:async e=>{try{bi("/account-transfers/","POST",e);const t=await wi.post("/account-transfers/",e);return vi("/account-transfers/",t),t.data}catch(t){throw Ci("/account-transfers/",t),t}},getAccounts:async()=>{try{bi("/accounts/","GET");const e=await wi.get("/accounts/"),t=Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[];return vi("/accounts/",{...e,data:t}),t}catch(e){throw Ci("/accounts/",e),e}},getAccountById:async e=>{try{bi(`/accounts/${e}/`,"GET");const t=await wi.get(`/accounts/${e}/`);return vi(`/accounts/${e}/`,t),t.data}catch(t){throw Ci(`/accounts/${e}/`,t),t}},getAccountsByType:async e=>{try{bi(`/accounts/by_type/?type=${e}`,"GET");const t=await wi.get(`/accounts/by_type/?type=${e}`),r=Array.isArray(t.data)?t.data:t.data&&t.data.results?t.data.results:[];return vi(`/accounts/by_type/?type=${e}`,{...t,data:r}),r}catch(t){throw Ci(`/accounts/by_type/?type=${e}`,t),t}},getClientBalance:async e=>{try{const t=`/account-statements/client_balance/?client_id=${e}`;bi(t,"GET");const r=await wi.get(t);return vi(t,r),r.data}catch(t){throw Ci(`/account-statements/client_balance/?client_id=${e}`,t),t}},getAccountStatements:async e=>{try{let t="/account-statements/";e&&(t+=`?account=${e}`),bi(t,"GET");const r=await wi.get(t),n=Array.isArray(r.data)?r.data:r.data&&r.data.results?r.data.results:[];return vi(t,{...r,data:n}),n}catch(t){throw Ci("/account-statements/",t),t}}},qs=async e=>{try{bi(`/products/${e}/qr-code/`,"GET");const t=await wi.get(`/products/${e}/qr-code/`,{responseType:"blob"});return vi(`/products/${e}/qr-code/`,{status:t.status,data:"Blob data (not shown)"}),t.data}catch(t){throw Ci(`/products/${e}/qr-code/`,t),t}},$s=async(e="year",t,r)=>{try{const n=new URLSearchParams;n.append("period",e),"custom"===e&&t&&r&&(n.append("start_date",t),n.append("end_date",r)),bi(`/dashboard/stats/?${n.toString()}`,"GET");const i=await wi.get(`/dashboard/stats/?${n.toString()}`);return vi("/dashboard/stats/",i),i.data}catch(n){throw Ci("/dashboard/stats/",n),n}},Xs=async(e="year",t,r)=>{try{const n=new URLSearchParams;n.append("period",e),"custom"===e&&t&&r&&(n.append("start_date",t),n.append("end_date",r)),bi(`/dashboard/inventory/?${n.toString()}`,"GET");const i=await wi.get(`/dashboard/inventory/?${n.toString()}`);return vi("/dashboard/inventory/",i),i.data}catch(n){throw Ci("/dashboard/inventory/",n),n}},Ys=async()=>{try{bi("/dashboard/low-stock/","GET");const e=await wi.get("/dashboard/low-stock/");return vi("/dashboard/low-stock/",e),e.data}catch(e){throw Ci("/dashboard/low-stock/",e),e}},Zs=async(e="year",t,r)=>{try{const n=new URLSearchParams;n.append("period",e),"custom"===e&&t&&r&&(n.append("start_date",t),n.append("end_date",r)),bi(`/reports/sales/?${n.toString()}`,"GET");const i=await wi.get(`/reports/sales/?${n.toString()}`);return vi("/reports/sales/",i),i.data}catch(n){throw Ci("/reports/sales/",n),n}},Ks=async e=>{try{const t=e?`/account-statements/client_balance/?client_id=${e}`:"/account-statements/client_balance/";bi(t,"GET");const r=await wi.get(t);return vi(t,r),r.data}catch(t){throw Ci("/account-statements/client_balance/",t),t}},Qs=async(e,t)=>{try{const n=await wi.post("/token/",{username:e,password:t});if(n.data&&n.data.access){localStorage.setItem("access_token",n.data.access),localStorage.setItem("refresh_token",n.data.refresh);const e=9e5,t=(new Date).getTime()+e;localStorage.setItem("token_expiration",t.toString());try{const e=await wi.get("/users/me/");return localStorage.setItem("current_user",JSON.stringify(e.data)),{...n.data,user:e.data}}catch(r){return console.error("Error fetching user data after login:",r),n.data}}return n.data}catch(r){throw console.error("Login error:",r),r}},Js=async()=>{try{if(!localStorage.getItem("access_token"))throw new Error("No access token found");return(await wi.get("/users/me/")).data}catch(e){throw console.error("Error fetching current user:",e),e}},ea=240,ta=u("main",{shouldForwardProp:e=>"open"!==e})((({theme:e,open:t})=>({flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:"-240px",...t&&{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}))),ra=u(T,{shouldForwardProp:e=>"open"!==e})((({theme:e,open:t})=>({transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),...t&&{width:"calc(100% - 240px)",marginLeft:"240px",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})}}))),na=u("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"}))),ia=()=>{const e=h(),{toggleColorMode:r,darkMode:n}=ht.useContext(Vt),i=p(e.breakpoints.down("md")),[s,a]=ht.useState(!i),[o,u]=ht.useState(null),m=ft(),{userRole:f}=pi(),[x,w]=ht.useState({username:"",role:""});ht.useEffect((()=>{(async()=>{var e;try{const t=await Js();w({username:t.username||"Utilisateur",role:(null==(e=t.profile_data)?void 0:e.role)||f||""})}catch(t){console.error("Error fetching user info:",t),w({username:"Utilisateur",role:f||""})}})()}),[f]),ht.useEffect((()=>{a(!i)}),[i]);const b=()=>{u(null)};return t.jsxs(c,{sx:{display:"flex"},children:[t.jsx(R,{}),t.jsx(ra,{position:"fixed",open:s,sx:{boxShadow:"0 0 10px rgba(0,0,0,0.1)",borderRadius:"0"},children:t.jsxs(N,{children:[t.jsx(g,{color:"inherit","aria-label":"open drawer",onClick:()=>{a(!0)},edge:"start",sx:{mr:2,...s&&{display:"none"}},children:t.jsx(D,{})}),t.jsx(fi,{variant:"full",sx:{flexGrow:1}}),t.jsx(l,{title:n?"Mode clair":"Mode sombre",children:t.jsx(g,{onClick:r,color:"inherit",children:n?t.jsx(O,{}):t.jsx(P,{})})}),t.jsx(M,{onClick:e=>{u(e.currentTarget)},color:"inherit",startIcon:t.jsx(k,{}),sx:{textTransform:"none",ml:1},children:x.username||"Utilisateur"}),t.jsxs(B,{anchorEl:o,open:Boolean(o),onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsx(L,{disableRipple:!0,sx:{pointerEvents:"none",opacity:.7},children:t.jsx(d,{variant:"caption",children:(e=>{switch(e){case"admin":return"Administrateur";case"consultant":return"Consultant";case"supervisor":return"Superviseur";case"commercial":return"Commercial";case"cashier":return"Chef de Caisse";default:return e||"Utilisateur"}})(x.role)})}),t.jsx(y,{}),t.jsxs(L,{onClick:()=>{b(),m("/profile")},children:[t.jsx(k,{fontSize:"small",sx:{mr:1}}),"Mon profil"]}),t.jsx(y,{}),t.jsxs(L,{onClick:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),m("/login")},children:[t.jsx(F,{fontSize:"small",sx:{mr:1}}),"DÃ©connexion"]})]})]})}),t.jsx(xi,{open:s,onClose:()=>{a(!1)},variant:i?"temporary":"persistent",width:ea}),t.jsxs(ta,{open:s,sx:{flexGrow:1,p:{xs:2,sm:3},marginLeft:i||s?0:"-240px",width:i?"100%":"auto",overflow:"auto"},children:[t.jsx(na,{}),t.jsx(c,{children:t.jsx(gt,{})})]})]})},sa=()=>{const e=ft(),r=pt(),[n,i]=ht.useState(""),[s,a]=ht.useState(""),[o,l]=ht.useState(!1),[u,h]=ht.useState(null),[p,m]=ht.useState(!1);ht.useEffect((()=>{var t,n;if(localStorage.getItem("access_token")){const i=(null==(n=null==(t=r.state)?void 0:t.from)?void 0:n.pathname)||"/";e(i)}}),[r,e]);return t.jsx(z,{maxWidth:"sm",children:t.jsx(c,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:t.jsxs(W,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",borderRadius:2,width:"100%"},children:[t.jsx(fi,{size:"large",sx:{mb:3}}),t.jsx(d,{component:"h2",variant:"h5",sx:{mb:3},children:"Connexion"}),u&&t.jsx(U,{severity:"error",sx:{mb:3,width:"100%"},children:u}),t.jsxs(c,{component:"form",onSubmit:async t=>{var i,a,o,l;if(t.preventDefault(),n.trim())if(s){m(!0),h(null);try{if(localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),await Qs(n,s),!localStorage.getItem("access_token"))throw console.error("Login successful but access token not stored"),new Error("Erreur d'authentification: token non reÃ§u");const t=(null==(a=null==(i=r.state)?void 0:i.from)?void 0:a.pathname)||"/";setTimeout((()=>{e(t)}),100)}catch(c){console.error("Login error:",c);const e=c instanceof Error?c.message:"Une erreur est survenue lors de la connexion. Veuillez rÃ©essayer.";if(c&&"object"==typeof c&&"response"in c){h((null==(l=null==(o=c.response)?void 0:o.data)?void 0:l.detail)||e)}else h(e)}finally{m(!1)}}else h("Veuillez entrer votre mot de passe");else h("Veuillez entrer votre nom d'utilisateur")},sx:{width:"100%"},children:[t.jsx(V,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Nom d'utilisateur",name:"username",autoComplete:"username",autoFocus:!0,value:n,onChange:e=>i(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(G,{color:"action"})})},sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:1}}}),t.jsx(V,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Mot de passe",type:o?"text":"password",id:"password",autoComplete:"current-password",value:s,onChange:e=>a(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(X,{color:"action"})}),endAdornment:t.jsx(H,{position:"end",children:t.jsx(g,{"aria-label":"toggle password visibility",onClick:()=>l(!o),edge:"end",children:o?t.jsx(q,{}):t.jsx($,{})})})},sx:{mb:3,"& .MuiOutlinedInput-root":{borderRadius:1}}}),t.jsx(M,{type:"submit",fullWidth:!0,variant:"contained",disabled:p,sx:{py:1.5,borderRadius:1,fontWeight:"bold",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0, 0, 0, 0.15)",transform:"translateY(-1px)"},transition:"all 0.2s ease"},children:p?t.jsx(f,{size:24,color:"inherit"}):"Se connecter"})]})]})})})},aa=(e,t)=>({pageSize:t,page:e}),oa=[5,10,25,50],la=e=>{const t={active:{color:"success.main",bgcolor:"success.lighter"},inactive:{color:"error.main",bgcolor:"error.lighter"},pending:{color:"warning.main",bgcolor:"warning.lighter"},draft:{color:"grey.600",bgcolor:"grey.100"},confirmed:{color:"success.main",bgcolor:"success.lighter"},cancelled:{color:"error.main",bgcolor:"error.lighter"},quote:{color:"info.main",bgcolor:"info.lighter"},order:{color:"primary.main",bgcolor:"primary.lighter"},invoice:{color:"success.main",bgcolor:"success.lighter"},paid:{color:"success.main",bgcolor:"success.lighter"},unpaid:{color:"error.main",bgcolor:"error.lighter"},partial:{color:"warning.main",bgcolor:"warning.lighter"},in_stock:{color:"success.main",bgcolor:"success.lighter"},low_stock:{color:"warning.main",bgcolor:"warning.lighter"},out_of_stock:{color:"error.main",bgcolor:"error.lighter"}}[e.toLowerCase()]||{color:"text.secondary",bgcolor:"grey.100"};return{fontWeight:600,borderRadius:2,color:t.color,bgcolor:t.bgcolor,border:`1px solid ${t.color}`,"&:hover":{bgcolor:t.color,color:"white"},transition:"all 0.2s ease-in-out"}},ca=({standardVariant:e="primary",variant:r="contained",sx:n,children:i,...s})=>t.jsx(M,{variant:"secondary"===e?"outlined":"action"===e||"icon"===e?"text":r,sx:[(()=>{switch(e){case"primary":default:return{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"};case"secondary":return{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"};case"action":return{borderRadius:1.5,minWidth:"auto",p:1,"&:hover":{transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"};case"icon":return{borderRadius:2,p:1,"&:hover":{backgroundColor:"action.hover",transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"}}})(),...Array.isArray(n)?n:[n]],...s,children:i}),da={add:"Ajouter",edit:"Modifier",update:"Mettre Ã  jour",delete:"Supprimer",save:"Enregistrer",cancel:"Annuler",confirm:"Confirmer",close:"Fermer",refresh:"Actualiser",search:"Rechercher",filter:"Filtrer",view:"Voir",download:"TÃ©lÃ©charger",upload:"TÃ©lÃ©verser",import:"Importer",export:"Exporter",print:"Imprimer",scan:"Scanner",actions:"Actions",previous:"PrÃ©cÃ©dent",next:"Suivant",back:"Retour",home:"Accueil",dashboard:"Tableau de bord",loading:"Chargement...",saving:"Sauvegarde...",success:"SuccÃ¨s",error:"Erreur",warning:"Attention",info:"Information",name:"Nom",company:"Entreprise",description:"Description",date:"Date",time:"Heure",status:"Statut",type:"Type",category:"CatÃ©gorie",reference:"RÃ©fÃ©rence",quantity:"QuantitÃ©",price:"Prix",total:"Total",subtotal:"Sous-total",tax:"Taxe",client:"Client",clients:"Clients",totalAmount:"Montant Total",paidAmount:"Montant PayÃ©",remainingAmount:"Reste Ã  Payer",payment:"Paiement",viewDetails:"Voir dÃ©tails",overduePayment:"Paiement en retard",safeDeletable:"Cette vente peut Ãªtre supprimÃ©e en toute sÃ©curitÃ©",contact:"Contact",contactPerson:"Personne de contact",email:"Email",phone:"TÃ©lÃ©phone",address:"Adresse",priceGroup:"Groupe de prix",account:"Compte",coordinates:"CoordonnÃ©es",supplier:"Fournisseur",suppliers:"Fournisseurs",noData:"Aucune donnÃ©e disponible",noResults:"Aucun rÃ©sultat trouvÃ©",confirmDelete:"ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ©ment ?",unsavedChanges:"Vous avez des modifications non sauvegardÃ©es",required:"Ce champ est requis",invalid:"Valeur invalide",tooShort:"Trop court",tooLong:"Trop long",mustBePositive:"Doit Ãªtre positif",mustBeGreaterThanZero:"Doit Ãªtre supÃ©rieur Ã  zÃ©ro"},ua={active:"Actif",inactive:"Inactif",pending:"En attente",approved:"ApprouvÃ©",rejected:"RejetÃ©",draft:"Brouillon",published:"PubliÃ©",archived:"ArchivÃ©",cancelled:"AnnulÃ©",completed:"TerminÃ©",confirmed:"ConfirmÃ©",in_stock:"En stock",low_stock:"Stock faible",out_of_stock:"Rupture de stock",quote:"Devis",order:"Commande",invoice:"Facture",delivered:"LivrÃ©",shipped:"ExpÃ©diÃ©",payment_pending:"Paiement en attente",partially_paid:"Partiellement payÃ©",paid:"PayÃ©",unpaid:"Non payÃ©",partial:"Partiel",overdue:"En retard",unknown:"Inconnu",sent:"EnvoyÃ©",accepted:"AcceptÃ©",expired:"ExpirÃ©",raw_material:"MatiÃ¨re premiÃ¨re",finished_product:"Produit fini"},ha={dashboard:"Tableau de bord",sales:"Ventes",inventory:"Inventaire",products:"Produits",clients:"Clients",suppliers:"Fournisseurs",treasury:"TrÃ©sorerie",production:"Production",userManagement:"Gestion des utilisateurs",settings:"ParamÃ¨tres",currentStock:"Stock actuel",stockSupplies:"Approvisionnements",stockTransfers:"Transferts",inventoryCount:"Inventaires",stockHistory:"Historique",quotes:"Devis",orders:"Commandes",invoices:"Factures",accounts:"Comptes",transactions:"Transactions",reports:"Rapports"},pa={stock:"Stock",currentStock:"Stock actuel",warehouse:"EntrepÃ´t",location:"Emplacement",zone:"Zone",product:"Produit",products:"Produits",quantity:"QuantitÃ©",supply:"Approvisionnement",supplies:"Approvisionnements",transfer:"Transfert",transfers:"Transferts",inventory:"Inventaire",inventories:"Inventaires",movement:"Mouvement",movements:"Mouvements",expectedQuantity:"QuantitÃ© attendue",actualQuantity:"QuantitÃ© rÃ©elle",difference:"DiffÃ©rence",unitPrice:"Prix unitaire",totalPrice:"Prix total",stockValue:"Valeur du stock",totalQuantity:"QuantitÃ© Total",merchandiseValue:"Valeur de la marchandise",receive:"RÃ©ceptionner",count:"Compter",adjust:"Ajuster",addProduct:"Ajouter un produit",selectProduct:"SÃ©lectionner un produit",selectSupplier:"SÃ©lectionner un fournisseur",selectLocation:"SÃ©lectionner un emplacement",selectSourceLocation:"SÃ©lectionner l'emplacement source",selectTargetLocation:"SÃ©lectionner l'emplacement cible",noProductSelected:"Aucun produit sÃ©lectionnÃ©",noSupplierSelected:"Aucun fournisseur sÃ©lectionnÃ©",noLocationSelected:"Aucun emplacement sÃ©lectionnÃ©",invalidQuantity:"QuantitÃ© invalide",invalidPrice:"Prix invalide",sameSourceTarget:"L'emplacement source et cible doivent Ãªtre diffÃ©rents"},ma={quote:"Devis",quotes:"Devis",order:"Commande",orders:"Commandes",invoice:"Facture",invoices:"Factures",client:"Client",clients:"Clients",amount:"Montant",discount:"Remise",convertToOrder:"Convertir en commande",convertToInvoice:"Convertir en facture",generateInvoice:"GÃ©nÃ©rer la facture",selectClient:"SÃ©lectionner un client",addItem:"Ajouter un article"},fa={product:"Produit",products:"Produits",category:"CatÃ©gorie",categories:"CatÃ©gories",unit:"UnitÃ©",units:"UnitÃ©s",unitOfMeasure:"UnitÃ© de mesure",barcode:"Code-barres",qrCode:"Code QR",productName:"Nom du produit",productCode:"Code produit",purchasePrice:"Prix d'achat",salePrice:"Prix de vente",minStock:"Stock minimum",selectCategory:"SÃ©lectionner une catÃ©gorie",selectUnit:"SÃ©lectionner une unitÃ©"},ga={client:"Client",clients:"Clients",supplier:"Fournisseur",suppliers:"Fournisseurs",addClient:"Ajouter un client",addSupplier:"Ajouter un fournisseur",companyName:"Nom de l'entreprise",contactPerson:"Personne de contact",email:"Email",phone:"TÃ©lÃ©phone",address:"Adresse",city:"Ville",postalCode:"Code postal",country:"Pays",selectClient:"SÃ©lectionner un client",selectSupplier:"SÃ©lectionner un fournisseur"},xa="Filtrer par statut",ya="Filtrer par emplacement",wa="Filtrer par fournisseur",ba="Rechercher un produit",va="Rechercher par nom",Ca="Lignes par page",_a="sur",Ea={fieldRequired:"Ce champ est requis",invalidEmail:"Adresse email invalide",invalidPhone:"NumÃ©ro de tÃ©lÃ©phone invalide",invalidNumber:"Nombre invalide",mustBePositive:"Doit Ãªtre un nombre positif",mustBeGreaterThanZero:"Doit Ãªtre supÃ©rieur Ã  zÃ©ro",tooShort:"Trop court",tooLong:"Trop long",saveSuccess:"Sauvegarde rÃ©ussie",deleteSuccess:"Suppression rÃ©ussie",createSuccess:"CrÃ©ation rÃ©ussie",updateSuccess:"Mise Ã  jour rÃ©ussie",saveError:"Erreur lors de la sauvegarde",deleteError:"Erreur lors de la suppression",createError:"Erreur lors de la crÃ©ation",updateError:"Erreur lors de la mise Ã  jour",loadError:"Erreur lors du chargement",unknownError:"Erreur inconnue"},Aa={today:"Aujourd'hui",yesterday:"Hier",tomorrow:"Demain",thisWeek:"Cette semaine",thisMonth:"Ce mois",thisYear:"Cette annÃ©e",monday:"Lundi",tuesday:"Mardi",wednesday:"Mercredi",thursday:"Jeudi",friday:"Vendredi",saturday:"Samedi",sunday:"Dimanche",january:"Janvier",february:"FÃ©vrier",march:"Mars",april:"Avril",may:"Mai",june:"Juin",july:"Juillet",august:"AoÃ»t",september:"Septembre",october:"Octobre",november:"Novembre",december:"DÃ©cembre"},Sa=e=>da[e]?da[e]:ua[e]?ua[e]:ha[e]?ha[e]:pa[e]?pa[e]:ma[e]?ma[e]:fa[e]?fa[e]:ga[e]?ga[e]:Ea[e]?Ea[e]:Aa[e]?Aa[e]:e,ja=({title:e,loading:r=!1,noDataMessage:n=da.noData,page:i=0,rowsPerPage:s=10,onPaginationChange:a,showToolbar:o=!1,sx:l,rows:u,columns:h,...p})=>{const m={toolbarDensity:"DensitÃ©",toolbarDensityLabel:"DensitÃ©",toolbarDensityCompact:"Compact",toolbarDensityStandard:"Standard",toolbarDensityComfortable:"Confortable",toolbarColumns:"Colonnes",toolbarColumnsLabel:"SÃ©lectionner les colonnes",toolbarFilters:"Filtres",toolbarFiltersLabel:"Afficher les filtres",toolbarFiltersTooltipHide:"Masquer les filtres",toolbarFiltersTooltipShow:"Afficher les filtres",toolbarFiltersTooltipActive:e=>1!==e?`${e} filtres actifs`:`${e} filtre actif`,toolbarExport:"Exporter",toolbarExportLabel:"Exporter",toolbarExportCSV:"TÃ©lÃ©charger en CSV",toolbarExportPrint:"Imprimer",MuiTablePagination:{labelRowsPerPage:Ca,labelDisplayedRows:({from:e,to:t,count:r})=>`${e}â€“${t} ${_a} ${-1!==r?r:`plus de ${t}`}`},columnMenuLabel:"Menu",columnMenuShowColumns:"Afficher les colonnes",columnMenuFilter:"Filtrer",columnMenuHideColumn:"Masquer",columnMenuUnsort:"Annuler le tri",columnMenuSortAsc:"Tri croissant",columnMenuSortDesc:"Tri dÃ©croissant",filterPanelAddFilter:"Ajouter un filtre",filterPanelDeleteIconLabel:"Supprimer",filterPanelOperators:"OpÃ©rateur",filterPanelOperatorAnd:"Et",filterPanelOperatorOr:"Ou",filterPanelColumns:"Colonnes",filterPanelInputLabel:"Valeur",filterPanelInputPlaceholder:"Valeur du filtre",filterOperatorContains:"contient",filterOperatorEquals:"Ã©gale",filterOperatorStartsWith:"commence par",filterOperatorEndsWith:"finit par",filterOperatorIs:"est",filterOperatorNot:"n'est pas",filterOperatorAfter:"postÃ©rieur Ã ",filterOperatorOnOrAfter:"postÃ©rieur ou Ã©gal Ã ",filterOperatorBefore:"antÃ©rieur Ã ",filterOperatorOnOrBefore:"antÃ©rieur ou Ã©gal Ã ",filterOperatorIsEmpty:"est vide",filterOperatorIsNotEmpty:"n'est pas vide",filterOperatorIsAnyOf:"est n'importe lequel",noRowsLabel:n,noResultsOverlayLabel:da.noResults,errorOverlayDefaultLabel:"Une erreur est survenue.",checkboxSelectionHeaderName:"SÃ©lection",sortedAscending:"triÃ© par ordre croissant",sortedDescending:"triÃ© par ordre dÃ©croissant",columnHeaderFiltersTooltipActive:e=>1!==e?`${e} filtres actifs`:`${e} filtre actif`,columnHeaderFiltersLabel:"Afficher les filtres",columnHeaderSortIconLabel:"Trier"};return t.jsxs(c,{children:[e&&t.jsx(d,{variant:"h6",component:"h2",gutterBottom:!0,children:e}),t.jsx(c,{sx:[{height:500,width:"100%",boxShadow:2,borderRadius:2,overflow:"hidden",bgcolor:"background.paper",border:"none","& .MuiDataGrid-columnHeaders":{backgroundColor:e=>"dark"===e.palette.mode?"background.paper":"primary.lighter",color:e=>e.palette.text.primary,fontWeight:"bold",fontSize:"0.875rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid",borderColor:"divider",fontSize:"0.875rem",display:"flex",alignItems:"center"},"& .MuiDataGrid-row:hover":{backgroundColor:e=>"dark"===e.palette.mode?"action.hover":"primary.lightest",cursor:"pointer"},"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader:focus":{outline:"none"}},...Array.isArray(l)?l:[l]],children:r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:200},children:t.jsx(f,{size:40})}):t.jsx(Y,{rows:u,columns:h,loading:r,pagination:!0,paginationModel:aa(i,s),onPaginationModelChange:e=>{a&&a(e.page,e.pageSize)},pageSizeOptions:oa,checkboxSelection:!1,disableRowSelectionOnClick:!p.onRowClick,slots:o?{toolbar:Z}:void 0,localeText:m,getRowId:e=>e.id||Math.random(),...p})})]})},Ia=xt.memo((({title:e,value:r,icon:n,color:i="primary"})=>{const s=h();return t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",transition:"all 0.3s ease",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-5px)",boxShadow:"0 8px 25px rgba(0,0,0,0.1)"},"&::after":{content:'""',position:"absolute",top:0,left:0,width:"6px",height:"100%",backgroundColor:s.palette[i].main}},children:t.jsx(Q,{sx:{p:3},children:t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:e}),t.jsx(d,{variant:"h4",fontWeight:700,sx:{mb:1},children:r})]}),t.jsx(J,{sx:{bgcolor:`${s.palette[i].main}15`,color:`${i}.main`,width:56,height:56},children:n})]})})})}));Ia.displayName="StatsCard";var Ta={},Ra={};const Na=yt(ee);var Da;function Oa(){return Da||(Da=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=Na}(Ra)),Ra}var Pa=te;Object.defineProperty(Ta,"__esModule",{value:!0});var Ma=Ta.default=void 0,ka=Pa(Oa()),Ba=t;Ma=Ta.default=(0,ka.default)((0,Ba.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");const La=({open:e,onClose:r,onConfirm:n,loading:i=!1,title:s="Confirmation de suppression",type:a="sale",item:o,confirmationInfo:l})=>t.jsxs(re,{open:e,onClose:r,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:"background.paper"}},children:[t.jsx(ne,{sx:{backgroundColor:"error.main",color:"#fff",fontWeight:"bold"},children:s}),t.jsxs(ie,{children:[t.jsxs(d,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer ","invoice"===a?"cette facture":"quote"===a?"ce devis":"cette vente"," ?"]}),(null==o?void 0:o.reference)&&t.jsxs(d,{sx:{mt:2},children:[t.jsx("strong",{children:"RÃ©fÃ©rence :"})," ",o.reference]}),l&&t.jsxs(d,{sx:{mt:2,color:"warning.main"},children:[l.willRestoreStock&&"Le stock sera restaurÃ©.",l.willRefundAmount>0&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),"Montant remboursÃ© : ",l.willRefundAmount]})]})]}),t.jsxs(se,{sx:{p:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:r,disabled:i,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",color:"error",onClick:n,disabled:i,startIcon:i?t.jsx(f,{size:20}):t.jsx(Ma,{}),sx:{borderRadius:"20px",boxShadow:"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"0 4px 10px rgba(0,0,0,0.1)"}},children:i?"Suppression...":"Supprimer"})]})]}),Fa=({sx:e,size:r="small",variant:n="outlined",...i})=>t.jsx(V,{size:r,variant:n,sx:[{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:2}},"& .MuiInputLabel-root":{fontWeight:500}},...Array.isArray(e)?e:[e]],...i}),za=({label:e,children:r,sx:n,size:i="small",...s})=>t.jsxs(ae,{size:i,sx:[{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:2}},"& .MuiInputLabel-root":{fontWeight:500}},...Array.isArray(n)?n:[n]],fullWidth:s.fullWidth,children:[e&&t.jsx(oe,{children:e}),t.jsx(le,{label:e,...s,children:r})]}),Wa=({status:e,translateStatus:r=!0,size:n="small",sx:i,...s})=>{const a=r?(e=>ua[e]||e)(e):e;return t.jsx(ce,{label:a,size:n,sx:[la(e),...Array.isArray(i)?i:[i]],...s})},Ua=({open:e,editMode:r,contactType:n,formData:i,availableAccounts:s,loadingAccounts:a,priceGroups:o,onClose:l,onSubmit:c,onFormDataChange:u,onAccountChange:p,onPriceGroupChange:m})=>{const f=h(),g="client"===n,x=e=>t=>{u({...i,[e]:t.target.value})};return t.jsxs(re,{open:e,onClose:l,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",minHeight:"400px"}},children:[t.jsx(ne,{sx:{backgroundColor:f.palette.primary.main,color:"white",fontWeight:"bold",py:2,px:3},children:r?g?"Modifier le client":"Modifier le fournisseur":g?"Ajouter un client":"Ajouter un fournisseur"}),t.jsx(ie,{sx:{p:3,mt:1},children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(Fa,{label:"Entreprise",value:i.name,onChange:x("name"),required:!0,fullWidth:!0})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(Fa,{label:"Nom Prenom",value:i.contact_person,onChange:x("contact_person"),fullWidth:!0})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(Fa,{label:"Email",value:i.email,onChange:x("email"),type:"email",fullWidth:!0})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(Fa,{label:"TÃ©lÃ©phone",value:i.phone,onChange:x("phone"),fullWidth:!0})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(Fa,{label:"Adresse",value:i.address,onChange:x("address"),multiline:!0,rows:2,fullWidth:!0})}),g&&o&&m&&t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(za,{label:"Groupe de prix",value:i.price_group||"",onChange:e=>m(Number(e.target.value)),fullWidth:!0,children:o.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})}),t.jsx(de,{item:!0,xs:12,sm:g&&o?6:12,children:t.jsxs(za,{label:g?"Compte client":"Compte fournisseur",value:i.account??"",onChange:e=>p(""===e.target.value?"":Number(e.target.value)),fullWidth:!0,children:[t.jsx(L,{value:"",children:"SÃ©lectionner un compte"}),a?t.jsx(L,{disabled:!0,children:"Chargement des comptes..."}):s&&Array.isArray(s)&&0===s.length?t.jsx(L,{disabled:!0,children:g?"Aucun compte client disponible":"Aucun compte fournisseur disponible"}):s&&Array.isArray(s)&&s.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})}),s&&Array.isArray(s)&&0===s.length&&!a&&t.jsx(de,{item:!0,xs:12,children:t.jsx(d,{variant:"caption",color:"error",sx:{mt:1},children:g?"Aucun compte client disponible. Veuillez d'abord crÃ©er un compte de type client dans la section TrÃ©sorerie.":"Aucun compte fournisseur disponible. Veuillez d'abord crÃ©er un compte de type fournisseur dans la section TrÃ©sorerie."})})]})}),t.jsxs(se,{sx:{p:2,pt:0},children:[t.jsx(ca,{onClick:l,children:Sa("cancel")}),t.jsx(ca,{onClick:c,variant:"contained",disabled:!i.name,children:Sa(r?"update":"add")})]})]})},Va=(e,t)=>{if(""===e)return 0;if(/^(0|[1-9]\d*)$/.test(e)){const t=parseInt(e,10);if(!isNaN(t)&&t>=0)return t}return t??0},Ha=(e,t)=>{if(""===e||/^\d*\.?\d*$/.test(e)){const t=""===e?0:parseFloat(e);if(!isNaN(t)&&t>=0)return t}return t??0},Ga=e=>null==e||0===e?"":e.toString(),qa=(e,t)=>{const r=e??0;switch(t){case"quantity":return r<1&&0!==r?"La quantitÃ© doit Ãªtre supÃ©rieure Ã  0":"";case"price":return r<0?"Le prix doit Ãªtre positif":"";case"amount":return r<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":"";case"stock":return r<0?"Le niveau doit Ãªtre positif ou zÃ©ro":"";default:return""}},$a=e=>null==e||isNaN(e)?"0 GNF":new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Xa=({open:e,operationType:r,editMode:n,formData:i,products:s,zones:a,suppliers:o=[],loading:l,quantityError:u,priceError:p,onClose:m,onSubmit:x,onFormDataChange:y,onAddItem:w,onRemoveItem:b,onOpenScanner:v,getProductName:C})=>{const _=h(),E=!!(()=>{if(0===i.items.length)return"Veuillez ajouter au moins un produit";switch(r){case"supply":if(!i.supplier)return"Veuillez sÃ©lectionner un fournisseur";if(!i.zone)return"Veuillez sÃ©lectionner un emplacement";break;case"transfer":if(!i.sourceZone)return"Veuillez sÃ©lectionner un emplacement source";if(!i.targetZone)return"Veuillez sÃ©lectionner un emplacement cible";if(i.sourceZone===i.targetZone)return"Les emplacements source et cible doivent Ãªtre diffÃ©rents";break;case"inventory":if(!i.inventoryZone)return"Veuillez sÃ©lectionner un emplacement"}return null})()||l,A=!i.currentProduct||(i.currentQuantity??0)<=0||(i.currentUnitPrice??0)<0||!!u||!!p;return t.jsxs(re,{open:e,onClose:m,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{padding:_.spacing(1),borderRadius:_.spacing(1)}},children:[t.jsx(ne,{sx:{pb:_.spacing(1),fontSize:"1.25rem",fontWeight:600},children:(()=>{const e=n?"Modifier":"Nouveau";switch(r){case"supply":return`${e} Approvisionnement`;case"transfer":return`${e} Transfert de Stock`;case"inventory":return`${e} Inventaire`;default:return e}})()}),t.jsx(ie,{sx:{padding:_.spacing(2),paddingTop:`${_.spacing(1)} !important`},children:t.jsxs(de,{container:!0,spacing:2,children:["supply"===r&&t.jsxs(t.Fragment,{children:[t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Fournisseur"}),t.jsxs(le,{label:"Fournisseur",value:i.supplier||"",onChange:e=>y({supplier:e.target.value}),children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"SÃ©lectionner un fournisseur"})}),o.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Emplacement"}),t.jsx(le,{label:"Emplacement",value:i.zone||"",onChange:e=>y({zone:e.target.value}),children:a.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})})]}),"transfer"===r&&t.jsxs(t.Fragment,{children:[t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Emplacement Source"}),t.jsxs(le,{label:"Emplacement Source",value:i.sourceZone||"",onChange:e=>y({sourceZone:e.target.value}),children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"SÃ©lectionner l'emplacement source"})}),a.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Emplacement Cible"}),t.jsxs(le,{label:"Emplacement Cible",value:i.targetZone||"",onChange:e=>y({targetZone:e.target.value}),children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"SÃ©lectionner l'emplacement cible"})}),a.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]})})]}),"inventory"===r&&t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Emplacement"}),t.jsxs(le,{label:"Emplacement",value:i.inventoryZone||"",onChange:e=>y({inventoryZone:e.target.value}),children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"SÃ©lectionner un emplacement"})}),a.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Statut"}),t.jsx(le,{label:"Statut",value:i.status,onChange:e=>y({status:e.target.value}),children:(()=>{switch(r){case"supply":return[{value:"pending",label:"En attente"},{value:"received",label:"ReÃ§u"},{value:"partial",label:"Partiel"},{value:"cancelled",label:"AnnulÃ©"}];case"transfer":return[{value:"pending",label:"En attente"},{value:"partial",label:"Partiel"},{value:"completed",label:"TerminÃ©"},{value:"cancelled",label:"AnnulÃ©"}];case"inventory":return[{value:"draft",label:"Brouillon"},{value:"in_progress",label:"En cours"},{value:"completed",label:"TerminÃ©"},{value:"cancelled",label:"AnnulÃ©"}];default:return[]}})().map((e=>t.jsx(L,{value:e.value,children:e.label},e.value)))})]})}),t.jsxs(de,{item:!0,xs:12,children:[t.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:t.jsx(d,{variant:"subtitle1",children:"inventory"===r?"Produits et QuantitÃ©s":"Produits"})}),t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[t.jsx(ue,{options:s,getOptionLabel:e=>e.name,value:i.currentProduct,onChange:(e,t)=>{const r=i.items.find((e=>e.product===(null==t?void 0:t.id)));y({currentProduct:t,currentUnitPrice:(null==r?void 0:r.unit_price)??(null==t?void 0:t.purchase_price)??0,currentQuantity:(null==r?void 0:r.quantity)??1})},renderInput:e=>t.jsx(V,{...e,label:"Produit",variant:"outlined",fullWidth:!0}),renderOption:(e,n)=>ht.createElement("li",{...e,key:`product-${n.id}`},t.jsxs(c,{sx:{width:"100%"},children:[t.jsx(d,{variant:"body1",children:n.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["RÃ©f: ",n.reference," â€¢ Prix: ",$a("supply"===r?n.purchase_price:n.selling_price)]})]})),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"text",value:Ga(i.currentQuantity),onChange:e=>(e=>{const t=Va(e,i.currentQuantity);y({currentQuantity:t})})(e.target.value),sx:{width:120},error:!!u,helperText:u,size:"small"}),t.jsx(V,{label:"Prix Unitaire",type:"text",value:Ga(i.currentUnitPrice),onChange:e=>(e=>{const t=Ha(e,i.currentUnitPrice);y({currentUnitPrice:t})})(e.target.value),sx:{width:120},error:!!p,helperText:p,size:"small"}),t.jsx(ca,{variant:"contained",onClick:w,disabled:A,sx:{height:"fit-content",px:3},children:"Ajouter"}),t.jsx(ca,{variant:"outlined",startIcon:t.jsx(he,{}),onClick:v,sx:{height:"fit-content"},children:"Scanner"})]}),i.items.length>0?t.jsx(pe,{component:W,variant:"outlined",children:t.jsxs(me,{size:"small",children:[t.jsx(fe,{children:t.jsxs(ge,{children:[t.jsx(xe,{children:"Produit"}),t.jsx(xe,{align:"right",children:"inventory"===r?"QuantitÃ© comptÃ©e":"QuantitÃ©"}),t.jsx(xe,{align:"right",children:"Prix Unitaire"}),t.jsx(xe,{align:"right",children:"Prix Total"}),t.jsx(xe,{align:"right",children:"Actions"})]})}),t.jsxs(ye,{children:[i.items.map(((e,r)=>t.jsxs(ge,{children:[t.jsx(xe,{children:C(e.product)}),t.jsx(xe,{align:"right",children:Number(e.quantity)||0}),t.jsx(xe,{align:"right",children:$a(Number(e.unit_price)||0)}),t.jsx(xe,{align:"right",children:$a(Number(e.total_price)||0)}),t.jsx(xe,{align:"right",children:t.jsx(g,{size:"small",color:"error",onClick:()=>b(r),children:t.jsx(we,{fontSize:"small"})})})]},r))),t.jsxs(ge,{children:[t.jsx(xe,{sx:{fontWeight:"bold"},children:"Total"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold"},children:i.items.reduce(((e,t)=>e+(Number(t.quantity)||0)),0)}),t.jsx(xe,{align:"right"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold"},children:$a(i.items.reduce(((e,t)=>e+(Number(t.total_price)||0)),0))}),t.jsx(xe,{align:"right"})]})]})]})}):t.jsxs(U,{severity:"info",sx:{mt:2},children:["Aucun produit ajoutÃ©. Utilisez le formulaire ci-dessus pour ajouter des produits Ã ","supply"===r&&" cet approvisionnement","transfer"===r&&" ce transfert","inventory"===r&&" cet inventaire","."]}),t.jsx(c,{sx:{mt:2},children:t.jsx(ca,{variant:"outlined",startIcon:t.jsx(he,{}),onClick:v,children:"Scanner un Produit"})}),"inventory"===r&&t.jsx(c,{sx:{mt:2},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Note : Pour les produits non trouvÃ©s lors du scan, vous pouvez les ajouter manuellement. Les articles avec une quantitÃ© de 0 seront enregistrÃ©s comme Ã©tant en rupture de stock."})})]})]})}),t.jsxs(se,{sx:{padding:_.spacing(2),paddingTop:_.spacing(1),gap:_.spacing(1)},children:[t.jsx(ca,{onClick:m,children:da.cancel}),t.jsx(ca,{variant:"contained",onClick:x,disabled:E,sx:{minWidth:120},children:l?t.jsx(f,{size:24}):`${n?"Mettre Ã  jour":"CrÃ©er"} ${"supply"===r?"l'Approvisionnement":"transfer"===r?"le Transfert":"l'Inventaire"}`})]})]})},Ya=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"],Za=()=>{var e,r,n,i,s,a,o;const u=h(),[p,m]=ht.useState("sales"),[x,y]=ht.useState("year"),[w,b]=ht.useState("2025-01-01"),[C,_]=ht.useState("2025-12-31"),[A,S]=ht.useState(0),[j,I]=ht.useState(!1),[T,R]=ht.useState(null),[N,D]=ht.useState({monthly_data:[],category_data:[],top_products:[]}),[O,P]=ht.useState(0),[k,B]=ht.useState(null),[F,z]=ht.useState([]),[W,H]=ht.useState(null),[G,q]=ht.useState([]),[$,X]=ht.useState([]),[Y,Z]=ht.useState([]),[ee,te]=ht.useState(""),[re,ne]=ht.useState(""),[ie,se]=ht.useState({page:0,pageSize:10}),ue=ht.useCallback((async()=>{try{const e=await $s(x,w,C);B(e)}catch(e){throw console.error("Error fetching dashboard stats:",e),e}}),[x,w,C]),he=ht.useCallback((async()=>{try{const e=await Zs(x,w,C);D(e)}catch(e){throw console.error("Error fetching sales report:",e),e}}),[x,w,C]),pe=ht.useCallback((async()=>{try{const e=await Xs(x,w,C);if(H(e),console.log("Inventory Stats received:",e),console.log("Product stock values:",e.product_stock_values),console.log("Zone data:",e.zone_data),console.log("historical_value:",e.historical_value),e&&e.historical_value)Z(e.historical_value);else{const t=(e=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=(new Date).getMonth();return Array.from({length:7},((n,i)=>{const s=.85+.05*i;return{name:t[(r-6+i+12)%12],value:Math.round(e*s)}}))})((null==e?void 0:e.inventory_value)||0);Z(t)}}catch(e){throw console.error("Error fetching inventory stats:",e),e}}),[x,w,C]),me=ht.useCallback((async()=>{try{const e=await Ys();z(e)}catch(e){throw console.error("Error fetching low stock products:",e),e}}),[]),fe=ht.useCallback((async()=>{try{console.log("Starting to fetch client account statements...");const t=await ji();console.log("Clients API Response:",t);const r=Array.isArray(t)?t:t.results?t.results:[];console.log("Processed response data:",r);const n=r.map(((e,t)=>{const r=e.account_balance??1e6+5e5*t+2e6*Math.random();return{id:e.id,name:e.name,balance:r,account:e.account??t+1,account_balance:r,last_transaction_date:void 0}})).filter((e=>e.account_balance>0));if(console.log("Clients with accounts:",n),X(n),n.length>0){const t=n[0].id;console.log("Attempting to fetch statements for client:",t);try{const e=await Ks(t),r=e.statements?e.statements:Array.isArray(e)?e:[];console.log("Account statements received:",r),q(r)}catch(e){console.error("Error fetching client statements, creating mock data:",e);q([{id:1,date:"2025-01-15",description:"Vente produits divers",transaction_type:"sale",transaction_type_display:"Vente",reference:"VTE-001",debit:0,credit:85e4,amount:85e4,balance:85e4,client_id:t},{id:2,date:"2025-01-20",description:"Paiement partiel",transaction_type:"payment",transaction_type_display:"Paiement",reference:"PAY-001",debit:35e4,credit:0,amount:-35e4,balance:5e5,client_id:t},{id:3,date:"2025-01-25",description:"Nouvelle commande",transaction_type:"sale",transaction_type_display:"Vente",reference:"VTE-002",debit:0,credit:12e5,amount:12e5,balance:17e5,client_id:t},{id:4,date:"2025-01-28",description:"Paiement",transaction_type:"payment",transaction_type_display:"Paiement",reference:"PAY-002",debit:7e5,credit:0,amount:-7e5,balance:1e6,client_id:t}])}}else console.log("No clients with accounts found"),q([])}catch(t){console.error("Error fetching account statements:",t);const e=t instanceof Error?t.message:"Unknown error";console.error("Detailed error:",e),console.log("Creating mock client data for demonstration...");const r=[{id:1,date:"2025-01-15",description:"Vente produits divers",transaction_type:"sale",transaction_type_display:"Vente",reference:"VTE-001",debit:0,credit:85e4,amount:85e4,balance:85e4,client_id:1},{id:2,date:"2025-01-20",description:"Paiement partiel",transaction_type:"payment",transaction_type_display:"Paiement",reference:"PAY-001",debit:35e4,credit:0,amount:-35e4,balance:5e5,client_id:1},{id:3,date:"2025-01-25",description:"Nouvelle commande",transaction_type:"sale",transaction_type_display:"Vente",reference:"VTE-002",debit:0,credit:12e5,amount:12e5,balance:17e5,client_id:1},{id:4,date:"2025-01-28",description:"Paiement",transaction_type:"payment",transaction_type_display:"Paiement",reference:"PAY-002",debit:7e5,credit:0,amount:-7e5,balance:1e6,client_id:1},{id:5,date:"2025-02-01",description:"Achat en gros",transaction_type:"sale",transaction_type_display:"Vente",reference:"VTE-003",debit:0,credit:18e5,amount:18e5,balance:28e5,client_id:1},{id:6,date:"2025-02-05",description:"RÃ¨glement facture",transaction_type:"payment",transaction_type_display:"Paiement",reference:"PAY-003",debit:13e5,credit:0,amount:-13e5,balance:15e5,client_id:1}];X([{id:1,name:"Entreprise Alpha SARL",balance:25e5,account:1,account_balance:25e5,last_transaction_date:void 0},{id:2,name:"SociÃ©tÃ© Beta & Cie",balance:18e5,account:2,account_balance:18e5,last_transaction_date:void 0},{id:3,name:"Commerce Gamma",balance:95e4,account:3,account_balance:95e4,last_transaction_date:void 0},{id:4,name:"Distribution Delta",balance:32e5,account:4,account_balance:32e5,last_transaction_date:void 0},{id:5,name:"Import Export Epsilon",balance:165e4,account:5,account_balance:165e4,last_transaction_date:void 0}]),q(r)}}),[]),ge=ht.useCallback((async()=>{I(!0),R(null);try{switch(await ue(),p){case"sales":await he();break;case"products":await me();break;case"inventory":await pe();break;case"accounts":await fe()}}catch(e){console.error("Error loading dashboard data:",e),R("Une erreur est survenue lors du chargement des donnÃ©es du tableau de bord")}finally{I(!1)}}),[p,pe,he,ue,me,fe]),xe=ht.useRef(!0);ht.useEffect((()=>{xe.current?(xe.current=!1,ge(),console.log("Initial load for report type:",p,"Tab value:",O)):(ge(),console.log("Report type changed to:",p,"Tab value:",O))}),[p,O,ge]);const ye=ht.useRef({period:x,startDate:w,endDate:C});ht.useEffect((()=>{ye.current.period===x&&ye.current.startDate===w&&ye.current.endDate===C||(ye.current={period:x,startDate:w,endDate:C},console.log("Filters changed, reloading data for period:",x),ue(),"sales"===p?he():"inventory"===p&&pe())}),[x,w,C,p,ue,he,pe]);const we=()=>{ge()},De=e=>isNaN(e)?"0 GNF":new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return t.jsxs(c,{sx:{p:{xs:1,sm:2,md:3}},children:[t.jsxs(be,{value:O,onChange:(e,t)=>{console.log("Tab clicked, changing to index:",t),P(t);const r=["sales","products","inventory","accounts"][t];console.log("Setting report type to:",r),m(r)},variant:"scrollable",scrollButtons:"auto",sx:{mb:3,"& .MuiTabs-indicator":{height:3,borderRadius:3},"& .MuiTab-root":{minHeight:54,borderRadius:2,mr:1,transition:"all 0.2s ease","&:hover":{bgcolor:"rgba(0, 0, 0, 0.04)"}},"& .Mui-selected":{bgcolor:`${u.palette.primary.main}10`}},children:[t.jsx(ve,{icon:t.jsx(v,{sx:{mr:1}}),label:"Ventes",iconPosition:"start"}),t.jsx(ve,{icon:t.jsx(Ce,{sx:{mr:1}}),label:"Produits",iconPosition:"start"}),"        ",t.jsx(ve,{icon:t.jsx(E,{sx:{mr:1}}),label:"Inventaire",iconPosition:"start"}),t.jsx(ve,{icon:t.jsx(_e,{sx:{mr:1}}),label:"Comptes Clients",iconPosition:"start"}),t.jsxs(c,{sx:{display:"flex",alignItems:"center",ml:"auto",mr:2},children:[t.jsx(l,{title:"Exporter",children:t.jsx(g,{color:"primary",children:t.jsx(Ee,{})})}),t.jsx(l,{title:"Actualiser",children:t.jsx(g,{color:"primary",onClick:we,disabled:j,children:j?t.jsx(f,{size:24}):t.jsx(Ae,{})})})]})]}),t.jsx(K,{sx:{p:2,mb:4,borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsx(Q,{sx:{p:1},children:t.jsxs(de,{container:!0,spacing:3,alignItems:"center",children:[t.jsx(de,{item:!0,xs:12,md:3,children:t.jsxs(ae,{fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},children:[t.jsx(oe,{id:"period-label",children:"PÃ©riode"}),t.jsxs(le,{labelId:"period-label",id:"period",value:x,label:"PÃ©riode",onChange:e=>{y(e.target.value)},startAdornment:t.jsx(Se,{sx:{color:"action.active",mr:1,ml:-.5}}),children:[t.jsx(L,{value:"month",children:"Mois en cours"}),t.jsx(L,{value:"quarter",children:"Trimestre en cours"}),t.jsx(L,{value:"semester",children:"Semestre en cours"}),t.jsx(L,{value:"year",children:"AnnÃ©e en cours"}),t.jsx(L,{value:"custom",children:"PersonnalisÃ©e"})]})]})}),t.jsx(de,{item:!0,xs:12,md:3,children:t.jsx(V,{label:"Date de dÃ©but",type:"date",fullWidth:!0,value:w,onChange:e=>{b(e.target.value)},disabled:"custom"!==x,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),t.jsx(de,{item:!0,xs:12,md:3,children:t.jsx(V,{label:"Date de fin",type:"date",fullWidth:!0,value:C,onChange:e=>{_(e.target.value)},disabled:"custom"!==x,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),t.jsx(de,{item:!0,xs:12,md:3,children:t.jsx(M,{variant:"contained",fullWidth:!0,startIcon:j?t.jsx(f,{size:20,color:"inherit"}):t.jsx(je,{}),sx:{py:1.5,borderRadius:2,boxShadow:"0 4px 10px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 15px rgba(0,0,0,0.15)"}},onClick:we,disabled:j,children:j?"GÃ©nÃ©ration...":"GÃ©nÃ©rer le rapport"})})]})})}),T&&t.jsx(U,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 2px 10px rgba(0,0,0,0.08)"},children:T}),j&&t.jsx(c,{sx:{width:"100%",mb:3},children:t.jsx(Ie,{sx:{borderRadius:1,height:6}})}),"sales"===p&&!j&&t.jsxs(t.Fragment,{children:[t.jsxs(de,{container:!0,spacing:3,sx:{mb:4},children:[t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Nombre de ventes",value:(null==k?void 0:k.total_sales)||0,icon:t.jsx(Te,{}),color:"primary"})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Nombre de clients",value:(null==k?void 0:k.total_clients)||0,icon:t.jsx(v,{}),color:"success"})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Nombre de produits",value:(null==k?void 0:k.total_products)||0,icon:t.jsx(Re,{}),color:"warning"})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Nombre de fournisseurs",value:(null==k?void 0:k.total_suppliers)||0,icon:t.jsx(Ne,{}),color:"secondary"})})]}),t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,lg:8,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",height:{xs:"auto",lg:"500px"}},children:t.jsxs(Q,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:t.jsx(d,{variant:"h6",fontWeight:600,children:"Ã‰volution des ventes"})}),t.jsx(c,{sx:{flexGrow:1,minHeight:{xs:300,lg:400}},children:t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(St,{data:N.monthly_data,margin:{top:10,right:30,left:20,bottom:10},children:[t.jsx(jt,{strokeDasharray:"3 3",stroke:u.palette.divider}),t.jsx(It,{dataKey:"month",tick:{fill:u.palette.text.secondary},axisLine:{stroke:u.palette.divider}}),t.jsx(Tt,{tickFormatter:e=>`${e} GNF`,tick:{fill:u.palette.text.secondary},axisLine:{stroke:u.palette.divider}}),"                      ",t.jsx(Rt,{formatter:e=>[De(e),"Ventes"],contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Nt,{wrapperStyle:{paddingTop:15}}),t.jsx(Dt,{type:"monotone",dataKey:"amount",name:"Ventes mensuelles",stroke:u.palette.primary.main,strokeWidth:3,dot:{r:6,strokeWidth:2},activeDot:{r:8,strokeWidth:0}})]})})})]})})}),t.jsx(de,{item:!0,xs:12,lg:4,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",height:{xs:"auto",lg:"500px"},overflow:"hidden"},children:t.jsxs(Q,{sx:{p:2,height:"100%"},children:[t.jsx(d,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Ventes par catÃ©gorie"}),N.category_data.length>0?t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{height:280,mb:2},children:t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(Ot,{children:[t.jsx(Pt,{data:N.category_data,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"amount",children:N.category_data.map(((e,r)=>t.jsx(Mt,{fill:Ya[r%Ya.length]},`cell-${r}`)))}),t.jsx(Rt,{formatter:(e,t)=>[De(e),t],contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}})]})})}),t.jsxs(c,{sx:{flexGrow:1,overflow:"hidden"},children:[t.jsx(d,{variant:"subtitle2",fontWeight:600,sx:{mb:1.5},children:"DÃ©tail par catÃ©gorie"}),t.jsx(c,{sx:{maxHeight:{xs:200,lg:140},overflowY:"auto",pr:.5},children:N.category_data.map(((e,r)=>{const n=N.category_data.reduce(((e,t)=>e+t.amount),0),i=n>0?(e.amount/n*100).toFixed(1):"0";return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",py:1,borderBottom:r<N.category_data.length-1?`1px solid ${u.palette.divider}20`:"none"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",minWidth:0,flex:1},children:[t.jsx(c,{sx:{width:10,height:10,borderRadius:"50%",backgroundColor:Ya[r%Ya.length],mr:1,flexShrink:0}}),t.jsx(d,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.875rem"},children:e.category})]}),t.jsxs(c,{sx:{textAlign:"right",ml:1,flexShrink:0},children:[t.jsx(d,{variant:"body2",fontWeight:600,sx:{fontSize:"0.875rem"},children:De(e.amount)}),t.jsxs(d,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[i,"%"]})]})]},r)}))}),t.jsx(c,{sx:{mt:2,p:1.5,bgcolor:`${u.palette.primary.main}08`,borderRadius:1,textAlign:"center"},children:t.jsxs(d,{variant:"body2",fontWeight:600,color:"primary",children:["Total: ",De(N.category_data.reduce(((e,t)=>e+t.amount),0))]})})]})]}):t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",color:"text.secondary"},children:[t.jsx(Ce,{sx:{fontSize:48,mb:2,opacity:.5}}),t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Aucune donnÃ©e disponible"}),t.jsx(d,{variant:"body2",children:"Les donnÃ©es de ventes par catÃ©gorie apparaÃ®tront ici une fois qu'il y aura des ventes enregistrÃ©es."})]})]})})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Produits les plus vendus"}),t.jsx(ja,{rows:N.top_products||[],columns:[{field:"name",headerName:"Produit",flex:1,minWidth:200},{field:"quantity",headerName:"QuantitÃ© vendue",flex:.8,minWidth:140,align:"right",headerAlign:"right"},{field:"revenue",headerName:"Chiffre d'affaires",flex:1,minWidth:160,align:"right",headerAlign:"right",valueFormatter:e=>De(e)}],loading:j,sx:{height:400},noDataMessage:"Aucun produit vendu",showToolbar:!1})]})})})]})]}),"products"===p&&!j&&t.jsx(t.Fragment,{children:t.jsxs(de,{container:!0,spacing:3,sx:{mb:4},children:[t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",height:"100%"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Produits en stock faible"}),t.jsx(ja,{rows:F||[],columns:[{field:"name",headerName:"Produit",flex:1,minWidth:180},{field:"quantity",headerName:"Stock actuel",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:(e,t)=>`${e} ${t.unit}`},{field:"threshold",headerName:"Stock minimum",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:(e,t)=>`${e} ${t.unit}`},{field:"status",headerName:"Statut",flex:.6,minWidth:100,align:"center",headerAlign:"center",renderCell:e=>t.jsx(ce,{label:e.row.quantity<=.5*e.row.threshold?"Critique":"Faible",size:"small",color:e.row.quantity<=.5*e.row.threshold?"error":"warning"})}],loading:j,sx:{height:400},noDataMessage:"Aucun produit en stock faible",showToolbar:!1})]})})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",height:"100%"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Produits les plus rentables"}),t.jsx(ja,{rows:N.top_products.length>0?N.top_products.slice(0,3).map((e=>({...e,margin:Math.floor(30+20*Math.random()),profit:.4*e.revenue,trend:(e.id%2==0?1:-1)*(3*e.id%15)}))):[],columns:[{field:"name",headerName:"Produit",flex:1,minWidth:150},{field:"margin",headerName:"Marge (%)",flex:.7,minWidth:100,align:"right",headerAlign:"right",valueFormatter:e=>`${e}%`},{field:"profit",headerName:"Profit",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:e=>De(e)}],loading:j,sx:{height:300},noDataMessage:"Aucune donnÃ©e disponible",showToolbar:!1})]})})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:3},children:"Performance des produits"}),t.jsx(At,{width:"100%",height:360,children:t.jsxs(kt,{data:N.top_products.length>0?N.top_products.map((e=>({name:e.name,ventes:e.quantity,profit:Math.round(.4*e.revenue),marge:Math.floor(30+15*Math.random())}))):[],margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(jt,{strokeDasharray:"3 3",stroke:u.palette.divider}),t.jsx(It,{dataKey:"name",tick:{fill:u.palette.text.secondary}}),t.jsx(Tt,{yAxisId:"left",tick:{fill:u.palette.text.secondary}}),t.jsx(Tt,{yAxisId:"right",orientation:"right",tick:{fill:u.palette.text.secondary}}),t.jsx(Rt,{contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Nt,{}),t.jsx(Bt,{yAxisId:"left",dataKey:"ventes",name:"Nombre de ventes",fill:"#1976d2",radius:[4,4,0,0]}),t.jsx(Bt,{yAxisId:"left",dataKey:"profit",name:"Profit (GNF)",fill:"#2e7d32",radius:[4,4,0,0]}),t.jsx(Bt,{yAxisId:"right",dataKey:"marge",name:"Marge (%)",fill:"#ed6c02",radius:[4,4,0,0]})]})})]})})})]})}),"inventory"===p&&!j&&t.jsxs(t.Fragment,{children:[t.jsx(de,{container:!0,spacing:3,sx:{mb:3},children:t.jsx(de,{item:!0,xs:12,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Statistiques d'inventaire"}),t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,sm:12,md:6,children:t.jsxs(c,{sx:{p:4,bgcolor:`${u.palette.primary.main}15`,borderRadius:2,textAlign:"center",border:`2px solid ${u.palette.primary.main}20`},children:[t.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,fontWeight:500,children:"Valeur totale de l'inventaire"}),t.jsx(d,{variant:"h3",fontWeight:700,color:"primary.main",sx:{mb:1},children:De((null==W?void 0:W.inventory_value)||0)}),t.jsx(d,{variant:"body2",color:"text.secondary",children:"Valeur marchande actuelle"})]})}),t.jsx(de,{item:!0,xs:12,sm:4,md:2,children:t.jsxs(c,{sx:{p:3,bgcolor:`${u.palette.warning.main}15`,borderRadius:2,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"EntrÃ©es (30j)"}),t.jsx(d,{variant:"h4",fontWeight:700,color:"warning.main",children:((null==W?void 0:W.inflow)||0).toFixed(0)})]})}),t.jsx(de,{item:!0,xs:12,sm:4,md:2,children:t.jsxs(c,{sx:{p:3,bgcolor:`${u.palette.success.main}15`,borderRadius:2,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Sorties (30j)"}),t.jsx(d,{variant:"h4",fontWeight:700,color:"success.main",children:((null==W?void 0:W.outflow)||0).toFixed(0)})]})}),t.jsx(de,{item:!0,xs:12,sm:4,md:2,children:t.jsxs(c,{sx:{p:3,bgcolor:`${u.palette.error.main}15`,borderRadius:2,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Articles en alerte"}),t.jsx(d,{variant:"h4",fontWeight:700,color:"error.main",children:(null==(e=null==W?void 0:W.low_stock_products)?void 0:e.length)||0})]})})]})]})})})}),t.jsxs(de,{container:!0,spacing:3,children:[t.jsxs(de,{item:!0,xs:12,md:8,children:[t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",mb:3},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Ã‰volution de la valeur d'inventaire"}),t.jsx(c,{sx:{height:340},children:t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(Lt,{data:Y,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorValue",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:u.palette.primary.main,stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:u.palette.primary.main,stopOpacity:.1})]})}),t.jsx(jt,{strokeDasharray:"3 3",stroke:u.palette.divider}),t.jsx(It,{dataKey:"name",tick:{fill:u.palette.text.secondary}}),t.jsx(Tt,{tickFormatter:e=>`${e} GNF`,tick:{fill:u.palette.text.secondary}}),"                        ",t.jsx(Rt,{formatter:e=>[De(e),"Valeur"],contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Ft,{type:"monotone",dataKey:"value",stroke:u.palette.primary.main,fillOpacity:1,fill:"url(#colorValue)"})]})})})]})}),t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Valeur de l'inventaire par catÃ©gorie"}),t.jsx(ja,{rows:(null==(r=null==W?void 0:W.category_data)?void 0:r.map(((e,t)=>({id:t,category:e.category,value:e.value,percentage:W.inventory_value>0?e.value/W.inventory_value*100:0}))))||[],columns:[{field:"category",headerName:"CatÃ©gorie",flex:1,minWidth:150},{field:"value",headerName:"Valeur totale",flex:1,minWidth:160,align:"right",headerAlign:"right",valueFormatter:e=>De(e),renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:600,children:De(e.value)})},{field:"percentage",headerName:"Proportion",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:e=>`${e.toFixed(1)}%`}],loading:j,sx:{height:400},noDataMessage:"Aucune donnÃ©e disponible",showToolbar:!1})]})})]}),t.jsxs(de,{item:!0,xs:12,md:4,children:[t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",mb:3},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"RÃ©partition de l'inventaire"}),t.jsx(c,{sx:{height:280},children:t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(Ot,{children:[t.jsxs(Pt,{data:(null==W?void 0:W.category_data)&&W.category_data.length>0?W.category_data.map((e=>({name:e.category,value:e.value}))):[],cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,fill:"#8884d8",paddingAngle:5,dataKey:"value",children:[((null==W?void 0:W.category_data)||[]).map(((e,r)=>t.jsx(Mt,{fill:Ya[r%Ya.length]},`cell-${r}`))),"                        "]}),t.jsx(Rt,{formatter:(e,t)=>[De(e),t],contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Nt,{})]})})})]})}),t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"RÃ©partition par zone"}),t.jsx(ja,{rows:(null==(n=null==W?void 0:W.zone_data)?void 0:n.map(((e,t)=>({id:t,zone:e.zone,value:e.value,percentage:W.inventory_value>0?e.value/W.inventory_value*100:0}))))||[],columns:[{field:"zone",headerName:"Zone",flex:1,minWidth:120},{field:"value",headerName:"Valeur",flex:1,minWidth:140,align:"right",headerAlign:"right",valueFormatter:e=>De(e)},{field:"percentage",headerName:"%",flex:.6,minWidth:80,align:"right",headerAlign:"right",valueFormatter:e=>`${e.toFixed(1)}%`}],loading:j,sx:{height:300},noDataMessage:"Aucune donnÃ©e disponible",showToolbar:!1})]})})]})]}),t.jsx(de,{container:!0,spacing:3,sx:{mt:2},children:t.jsx(de,{item:!0,xs:12,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Valeur de stock par produit"}),t.jsxs(c,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(V,{label:"Filtrer par produit",variant:"outlined",size:"small",value:re,onChange:e=>ne(e.target.value),sx:{minWidth:200}}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[t.jsx(oe,{children:"Zone"}),t.jsxs(le,{value:ee,onChange:e=>te(e.target.value),label:"Zone",children:[t.jsx(L,{value:"",children:"Toutes les zones"}),(null==(i=null==W?void 0:W.zone_data)?void 0:i.length)>0?W.zone_data.map((e=>t.jsx(L,{value:e.zone,children:e.zone},e.zone))):(null==(s=null==W?void 0:W.product_stock_values)?void 0:s.length)>0&&[...new Set(W.product_stock_values.map((e=>e.zone_name)))].filter(Boolean).map((e=>t.jsx(L,{value:e,children:e},e)))]})]}),t.jsx(M,{variant:"outlined",size:"small",onClick:()=>{ne(""),te("")},disabled:!re&&!ee,children:"RÃ©initialiser"})]}),t.jsx(ja,{rows:(null==(o=null==(a=null==W?void 0:W.product_stock_values)?void 0:a.filter((e=>{const t=!re||e.product_name&&e.product_name.toLowerCase().includes(re.toLowerCase()),r=!ee||e.zone_name&&e.zone_name===ee;return t&&r})))?void 0:o.map((e=>({id:`${e.product_id}-${e.zone_name}`,product_name:e.product_name||"",zone_name:e.zone_name||"",quantity:e.quantity||0,unit_price:e.unit_price||0,stock_value:e.stock_value||0,unit_symbol:e.unit_symbol||"",percentage:W.inventory_value>0?e.stock_value/W.inventory_value*100:0}))))||[],columns:[{field:"product_name",headerName:"Produit",flex:1,minWidth:150},{field:"zone_name",headerName:"Zone",flex:.7,minWidth:100},{field:"quantity",headerName:"QuantitÃ©",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:(e,t)=>`${e.toLocaleString()} ${t.unit_symbol}`},{field:"unit_price",headerName:"Prix unitaire",flex:.8,minWidth:120,align:"right",headerAlign:"right",valueFormatter:e=>De(e)},{field:"stock_value",headerName:"Valeur de stock",flex:1,minWidth:140,align:"right",headerAlign:"right",valueFormatter:e=>De(e),renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:600,children:De(e.value)})},{field:"percentage",headerName:"% du stock total",flex:.8,minWidth:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(ce,{label:`${e.value.toFixed(1)}%`,size:"small",color:e.value>10?"primary":e.value>5?"warning":"default"})}],loading:j,page:ie.page,rowsPerPage:ie.pageSize,onPaginationChange:(e,t)=>se({page:e,pageSize:t}),sx:{height:500},noDataMessage:"Aucune donnÃ©e de stock disponible"})]})})})})]}),"accounts"===p&&!j&&t.jsx(t.Fragment,{children:t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,md:8,children:t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:t.jsxs(Q,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsx(d,{variant:"h6",fontWeight:600,children:"Comptes clients"}),t.jsxs(c,{children:[t.jsx(M,{variant:"outlined",size:"small",startIcon:t.jsx(Ee,{}),sx:{mr:1},children:"Exporter"}),t.jsx(M,{variant:"contained",size:"small",startIcon:t.jsx(Ae,{}),onClick:we,disabled:j,children:"Actualiser"})]})]}),t.jsxs(c,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:["                    ",t.jsxs(be,{value:A,onChange:(e,t)=>{S(t)},"aria-label":"transactions tabs",indicatorColor:"primary",children:[t.jsx(ve,{label:"AperÃ§u"}),t.jsx(ve,{label:"Tableau dÃ©taillÃ©"}),t.jsx(ve,{label:"Graphique"})]})]}),t.jsxs(c,{sx:{height:400,width:"100%"},children:[0===A&&t.jsxs(de,{container:!0,spacing:2,sx:{pt:2},children:[t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(K,{sx:{height:"100%",bgcolor:`${u.palette.primary.main}08`},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"RÃ©sumÃ© des comptes"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsx(de,{item:!0,xs:6,children:t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Total clients"}),t.jsx(d,{variant:"h4",fontWeight:700,children:$.length})]})}),t.jsx(de,{item:!0,xs:6,children:t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Clients actifs"}),t.jsx(d,{variant:"h4",fontWeight:700,color:"success.main",children:$.filter((e=>e.account_balance>0)).length})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Solde total"}),t.jsx(d,{variant:"h3",fontWeight:700,color:"primary",sx:{fontSize:{xs:"1.8rem",sm:"2.2rem"},wordBreak:"break-all",lineHeight:1.2},children:De($.reduce(((e,t)=>e+(t.account_balance||0)),0))})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Solde moyen par client"}),t.jsx(d,{variant:"h4",fontWeight:700,sx:{fontSize:{xs:"1.3rem",sm:"1.6rem"},wordBreak:"break-all"},children:$.length>0?De($.reduce(((e,t)=>e+(t.account_balance||0)),0)/$.length):De(0)})]})})]})]})})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(K,{sx:{height:"100%"},children:t.jsxs(Q,{children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Top 5 clients par solde"}),t.jsxs(c,{sx:{maxHeight:280,overflowY:"auto"},children:[$.sort(((e,t)=>(t.account_balance||0)-(e.account_balance||0))).slice(0,5).map(((e,r)=>t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1.5,borderBottom:r<4?"1px solid":"none",borderColor:"divider"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",flex:1,minWidth:0,mr:2},children:[t.jsx(J,{sx:{width:32,height:32,mr:2,bgcolor:`${u.palette.primary.main}15`,color:"primary.main",flexShrink:0},children:e.name.charAt(0).toUpperCase()}),t.jsx(d,{variant:"body2",fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:e.name})]}),t.jsx(d,{variant:"body2",fontWeight:600,color:e.account_balance>0?"success.main":"text.secondary",sx:{whiteSpace:"nowrap",fontSize:{xs:"0.75rem",sm:"0.875rem"},flexShrink:0},children:De(e.account_balance||0)})]},e.id))),0===$.length&&t.jsx(d,{variant:"body2",color:"text.secondary",textAlign:"center",sx:{py:4},children:"Aucun client avec compte"})]})]})})})]}),1===A&&G.length>0&&t.jsx(ja,{rows:G.map(((e,t)=>({id:e.id||t,date:new Date(e.date).toLocaleDateString("fr-FR"),type:e.transaction_type_display,reference:e.reference,description:e.description,debit:e.debit,credit:e.credit,balance:e.balance}))),columns:[{field:"date",headerName:"Date",width:120},{field:"type",headerName:"Type",width:180},{field:"reference",headerName:"RÃ©fÃ©rence",width:150},{field:"description",headerName:"Description",flex:1,minWidth:200},{field:"debit",headerName:"DÃ©bit",width:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{color:e.value>0?"error.main":"inherit"},children:e.value>0?De(e.value):"-"})},{field:"credit",headerName:"CrÃ©dit",width:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{color:e.value>0?"success.main":"inherit"},children:e.value>0?De(e.value):"-"})},{field:"balance",headerName:"Solde",width:150,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:600,children:De(e.value)})}],autoHeight:!1,density:"standard",disableRowSelectionOnClick:!0,initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},pageSizeOptions:[5,10,25],getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",sx:{"& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},border:"none","& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:1}}}),2===A&&t.jsx(c,{sx:{height:"100%",pt:2},children:G.length>0?t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(kt,{data:Object.entries(G.reduce(((e,t)=>{const r=t.transaction_type_display;return e[r]||(e[r]=0),e[r]+=t.debit+t.credit,e}),{})).map((([e,t])=>({type:e,amount:t}))),margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(jt,{strokeDasharray:"3 3",stroke:u.palette.divider}),t.jsx(It,{dataKey:"type",tick:{fill:u.palette.text.secondary}}),t.jsx(Tt,{tick:{fill:u.palette.text.secondary}}),t.jsx(Rt,{formatter:e=>[De(e),"Montant"],contentStyle:{backgroundColor:u.palette.background.paper,border:`1px solid ${u.palette.divider}`,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Bt,{dataKey:"amount",fill:u.palette.primary.main,radius:[4,4,0,0]})]})}):t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"text.secondary"},children:[t.jsx(_e,{sx:{fontSize:64,mb:2,opacity:.5}}),t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Aucune donnÃ©e de transaction"}),t.jsx(d,{variant:"body2",children:"Les graphiques apparaÃ®tront ici une fois que des transactions seront enregistrÃ©es."})]})}),1===A&&0===G.length&&t.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",border:"1px dashed",borderColor:"divider",borderRadius:1},children:t.jsx(d,{color:"text.secondary",children:"Aucune transaction disponible"})})]})]})})}),t.jsxs(de,{item:!0,xs:12,md:4,children:[t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",mb:4},children:t.jsxs(Q,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(d,{variant:"h6",fontWeight:600,children:"Ã‰volution du solde client"}),t.jsxs(ae,{size:"small",sx:{minWidth:120},children:[t.jsx(oe,{children:"Client"}),t.jsxs(le,{value:"",label:"Client",onChange:()=>{},children:[t.jsx(L,{value:"",children:"Tous les clients"}),$.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]})]}),t.jsx(c,{sx:{height:320},children:G.length>0?t.jsx(At,{width:"100%",height:"100%",children:t.jsxs(St,{data:G.map((e=>({date:new Date(e.date).toLocaleDateString("fr-FR"),balance:e.balance}))).reverse(),margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(jt,{strokeDasharray:"3 3",stroke:u.palette.divider}),t.jsx(It,{dataKey:"date",tick:{fill:u.palette.text.secondary}}),t.jsx(Tt,{tickFormatter:e=>De(e),tick:{fill:u.palette.text.secondary}}),t.jsx(Rt,{formatter:e=>[De(e),"Solde"],labelFormatter:e=>`Date: ${e}`,contentStyle:{backgroundColor:u.palette.background.paper,borderRadius:8,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}),t.jsx(Dt,{type:"monotone",dataKey:"balance",name:"Solde",stroke:u.palette.primary.main,strokeWidth:3,dot:{r:4,strokeWidth:2},activeDot:{r:6,strokeWidth:0}})]})}):t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"text.secondary"},children:[t.jsx(Ne,{sx:{fontSize:64,mb:2,opacity:.5}}),t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Aucune donnÃ©e d'Ã©volution"}),t.jsx(d,{variant:"body2",textAlign:"center",children:"L'Ã©volution du solde apparaÃ®tra ici une fois que des transactions seront enregistrÃ©es."})]})})]})}),t.jsx(K,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"}})]})]})})]})},Ka=()=>{const{hasPermission:e,isAdmin:t}=pi();return{canPerform:r=>!!t||e(r),canView:r=>!!t||e(r),canEdit:r=>!!t||e(r),canDelete:r=>!!t||e(r)}};var Qa,Ja;(Ja=Qa||(Qa={}))[Ja.QR_CODE=0]="QR_CODE",Ja[Ja.AZTEC=1]="AZTEC",Ja[Ja.CODABAR=2]="CODABAR",Ja[Ja.CODE_39=3]="CODE_39",Ja[Ja.CODE_93=4]="CODE_93",Ja[Ja.CODE_128=5]="CODE_128",Ja[Ja.DATA_MATRIX=6]="DATA_MATRIX",Ja[Ja.MAXICODE=7]="MAXICODE",Ja[Ja.ITF=8]="ITF",Ja[Ja.EAN_13=9]="EAN_13",Ja[Ja.EAN_8=10]="EAN_8",Ja[Ja.PDF_417=11]="PDF_417",Ja[Ja.RSS_14=12]="RSS_14",Ja[Ja.RSS_EXPANDED=13]="RSS_EXPANDED",Ja[Ja.UPC_A=14]="UPC_A",Ja[Ja.UPC_E=15]="UPC_E",Ja[Ja.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var eo,to,ro,no,io=new Map([[Qa.QR_CODE,"QR_CODE"],[Qa.AZTEC,"AZTEC"],[Qa.CODABAR,"CODABAR"],[Qa.CODE_39,"CODE_39"],[Qa.CODE_93,"CODE_93"],[Qa.CODE_128,"CODE_128"],[Qa.DATA_MATRIX,"DATA_MATRIX"],[Qa.MAXICODE,"MAXICODE"],[Qa.ITF,"ITF"],[Qa.EAN_13,"EAN_13"],[Qa.EAN_8,"EAN_8"],[Qa.PDF_417,"PDF_417"],[Qa.RSS_14,"RSS_14"],[Qa.RSS_EXPANDED,"RSS_EXPANDED"],[Qa.UPC_A,"UPC_A"],[Qa.UPC_E,"UPC_E"],[Qa.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function so(e){return Object.values(Qa).includes(e)}(to=eo||(eo={}))[to.UNKNOWN=0]="UNKNOWN",to[to.URL=1]="URL",(no=ro||(ro={}))[no.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",no[no.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE";var ao,oo,lo=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[ro.SCAN_TYPE_CAMERA,ro.SCAN_TYPE_FILE],e}(),co=function(){function e(e,t){this.format=e,this.formatName=t}return e.prototype.toString=function(){return this.formatName},e.create=function(t){if(!io.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new e(t,io.get(t))},e}(),uo=function(){function e(){}return e.createFromText=function(e){return{decodedText:e,result:{text:e}}},e.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},e}();(oo=ao||(ao={}))[oo.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",oo[oo.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",oo[oo.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR";var ho=function(){function e(){}return e.createFrom=function(e){return{errorMessage:e,type:ao.UNKWOWN_ERROR}},e}(),po=function(){function e(e){this.verbose=e}return e.prototype.log=function(e){this.verbose&&console.log(e)},e.prototype.warn=function(e){this.verbose&&console.warn(e)},e.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},e.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},e}();function mo(e){return null==e}var fo=function(){function e(){}return e.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},e.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),go=function(){function e(){}return e.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e){var r=typeof e;return t.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(r,"."),!0),!1}for(var n=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),i=0,s=Object.keys(e);i<s.length;i++){var a=s[i];if(n.has(a))return t.logError("".concat(a," is not supported videoConstaints."),!0),!1}return!0},e}(),xo={exports:{}};!function(e){function t(e){return null==e}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var r=Object.setPrototypeOf;r?r(e,t):e.__proto__=t}function s(e,t){void 0===t&&(t=e.constructor);var r=Error.captureStackTrace;r&&r(e,t)}var a,o,l=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this;return Object.defineProperty(n,"name",{value:r.name,enumerable:!1}),i(n,r.prototype),s(n),n}return n(t,e),t}(Error);class c extends l{constructor(e=void 0){super(e),this.message=e}getKind(){return this.constructor.kind}}c.kind="Exception";class d extends c{}d.kind="ArgumentException";class u extends c{}u.kind="IllegalArgumentException";class h{constructor(e){if(this.binarizer=e,null===e)throw new u("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,r,n){const i=this.binarizer.getLuminanceSource().crop(e,t,r,n);return new h(this.binarizer.createBinarizer(i))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new h(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new h(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch(e){return""}}}class p extends c{static getChecksumInstance(){return new p}}p.kind="ChecksumException";class m{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class f{static arraycopy(e,t,r,n,i){for(;i--;)r[n++]=e[t++]}static currentTimeMillis(){return Date.now()}}class g extends c{}g.kind="IndexOutOfBoundsException";class x extends g{constructor(e=void 0,t=void 0){super(t),this.index=e,this.message=t}}x.kind="ArrayIndexOutOfBoundsException";class y{static fill(e,t){for(let r=0,n=e.length;r<n;r++)e[r]=t}static fillWithin(e,t,r,n){y.rangeCheck(e.length,t,r);for(let i=t;i<r;i++)e[i]=n}static rangeCheck(e,t,r){if(t>r)throw new u("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new x(t);if(r>e)throw new x(r)}static asList(...e){return e}static create(e,t,r){return Array.from({length:e}).map((e=>Array.from({length:t}).fill(r)))}static createInt32Array(e,t,r){return Array.from({length:e}).map((e=>Int32Array.from({length:t}).fill(r)))}static equals(e,t){if(!e)return!1;if(!t)return!1;if(!e.length)return!1;if(!t.length)return!1;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}static hashCode(e){if(null===e)return 0;let t=1;for(const r of e)t=31*t+r;return t}static fillUint8Array(e,t){for(let r=0;r!==e.length;r++)e[r]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)}static copyOfRange(e,t,r){const n=r-t,i=new Int32Array(n);return f.arraycopy(e,t,i,0,n),i}static binarySearch(e,t,r){void 0===r&&(r=y.numberComparator);let n=0,i=e.length-1;for(;n<=i;){const s=i+n>>1,a=r(t,e[s]);if(a>0)n=s+1;else{if(!(a<0))return s;i=s-1}}return-n-1}static numberComparator(e,t){return e-t}}class w{static numberOfTrailingZeros(e){let t;if(0===e)return 32;let r=31;return t=e<<16,0!==t&&(r-=16,e=t),t=e<<8,0!==t&&(r-=8,e=t),t=e<<4,0!==t&&(r-=4,e=t),t=e<<2,0!==t&&(r-=2,e=t),r-(e<<1>>>31)}static numberOfLeadingZeros(e){if(0===e)return 32;let t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,e+=e>>>8,63&(e+=e>>>16)}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t=void 0){return parseInt(e,t)}}w.MIN_VALUE_32_BITS=-2147483648,w.MAX_VALUE=Number.MAX_SAFE_INTEGER;class b{constructor(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=null==t?b.makeArray(e):t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>32*this.bits.length){const t=b.makeArray(e);f.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return!!(this.bits[Math.floor(e/32)]&1<<(31&e))}set(e){this.bits[Math.floor(e/32)]|=1<<(31&e)}flip(e){this.bits[Math.floor(e/32)]^=1<<(31&e)}getNextSet(e){const t=this.size;if(e>=t)return t;const r=this.bits;let n=Math.floor(e/32),i=r[n];i&=~((1<<(31&e))-1);const s=r.length;for(;0===i;){if(++n===s)return t;i=r[n]}const a=32*n+w.numberOfTrailingZeros(i);return a>t?t:a}getNextUnset(e){const t=this.size;if(e>=t)return t;const r=this.bits;let n=Math.floor(e/32),i=~r[n];i&=~((1<<(31&e))-1);const s=r.length;for(;0===i;){if(++n===s)return t;i=~r[n]}const a=32*n+w.numberOfTrailingZeros(i);return a>t?t:a}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new u;if(t===e)return;t--;const r=Math.floor(e/32),n=Math.floor(t/32),i=this.bits;for(let s=r;s<=n;s++){const a=(2<<(s<n?31:31&t))-(1<<(s>r?0:31&e));i[s]|=a}}clear(){const e=this.bits.length,t=this.bits;for(let r=0;r<e;r++)t[r]=0}isRange(e,t,r){if(t<e||e<0||t>this.size)throw new u;if(t===e)return!0;t--;const n=Math.floor(e/32),i=Math.floor(t/32),s=this.bits;for(let a=n;a<=i;a++){const o=(2<<(a<i?31:31&t))-(1<<(a>n?0:31&e))&4294967295;if((s[a]&o)!==(r?o:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(e,t){if(t<0||t>32)throw new u("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let r=t;r>0;r--)this.appendBit(1==(e>>r-1&1))}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let r=0;r<t;r++)this.appendBit(e.get(r))}xor(e){if(this.size!==e.size)throw new u("Sizes don't match");const t=this.bits;for(let r=0,n=t.length;r<n;r++)t[r]^=e.bits[r]}toBytes(e,t,r,n){for(let i=0;i<n;i++){let n=0;for(let t=0;t<8;t++)this.get(e)&&(n|=1<<7-t),e++;t[r+i]=n}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,n=this.bits;for(let i=0;i<r;i++){let r=n[i];r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16&65535|(65535&r)<<16,e[t-i]=r}if(this.size!==32*r){const t=32*r-this.size;let n=e[0]>>>t;for(let i=1;i<r;i++){const r=e[i];n|=r<<32-t,e[i-1]=n,n=r>>>t}e[r-1]=n}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof b))return!1;const t=e;return this.size===t.size&&y.equals(this.bits,t.bits)}hashCode(){return 31*this.size+y.hashCode(this.bits)}toString(){let e="";for(let t=0,r=this.size;t<r;t++)7&t||(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new b(this.size,this.bits.slice())}}(o=a||(a={}))[o.OTHER=0]="OTHER",o[o.PURE_BARCODE=1]="PURE_BARCODE",o[o.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",o[o.TRY_HARDER=3]="TRY_HARDER",o[o.CHARACTER_SET=4]="CHARACTER_SET",o[o.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",o[o.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",o[o.ASSUME_GS1=7]="ASSUME_GS1",o[o.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",o[o.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",o[o.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS";var v,C,_=a;class E extends c{static getFormatInstance(){return new E}}E.kind="FormatException",(C=v||(v={}))[C.Cp437=0]="Cp437",C[C.ISO8859_1=1]="ISO8859_1",C[C.ISO8859_2=2]="ISO8859_2",C[C.ISO8859_3=3]="ISO8859_3",C[C.ISO8859_4=4]="ISO8859_4",C[C.ISO8859_5=5]="ISO8859_5",C[C.ISO8859_6=6]="ISO8859_6",C[C.ISO8859_7=7]="ISO8859_7",C[C.ISO8859_8=8]="ISO8859_8",C[C.ISO8859_9=9]="ISO8859_9",C[C.ISO8859_10=10]="ISO8859_10",C[C.ISO8859_11=11]="ISO8859_11",C[C.ISO8859_13=12]="ISO8859_13",C[C.ISO8859_14=13]="ISO8859_14",C[C.ISO8859_15=14]="ISO8859_15",C[C.ISO8859_16=15]="ISO8859_16",C[C.SJIS=16]="SJIS",C[C.Cp1250=17]="Cp1250",C[C.Cp1251=18]="Cp1251",C[C.Cp1252=19]="Cp1252",C[C.Cp1256=20]="Cp1256",C[C.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",C[C.UTF8=22]="UTF8",C[C.ASCII=23]="ASCII",C[C.Big5=24]="Big5",C[C.GB18030=25]="GB18030",C[C.EUC_KR=26]="EUC_KR";class A{constructor(e,t,r,...n){this.valueIdentifier=e,this.name=r,this.values="number"==typeof t?Int32Array.from([t]):t,this.otherEncodingNames=n,A.VALUE_IDENTIFIER_TO_ECI.set(e,this),A.NAME_TO_ECI.set(r,this);const i=this.values;for(let s=0,a=i.length;s!==a;s++){const e=i[s];A.VALUES_TO_ECI.set(e,this)}for(const s of n)A.NAME_TO_ECI.set(s,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new E("incorect value");const t=A.VALUES_TO_ECI.get(e);if(void 0===t)throw new E("incorect value");return t}static getCharacterSetECIByName(e){const t=A.NAME_TO_ECI.get(e);if(void 0===t)throw new E("incorect value");return t}equals(e){if(!(e instanceof A))return!1;const t=e;return this.getName()===t.getName()}}A.VALUE_IDENTIFIER_TO_ECI=new Map,A.VALUES_TO_ECI=new Map,A.NAME_TO_ECI=new Map,A.Cp437=new A(v.Cp437,Int32Array.from([0,2]),"Cp437"),A.ISO8859_1=new A(v.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),A.ISO8859_2=new A(v.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),A.ISO8859_3=new A(v.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),A.ISO8859_4=new A(v.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),A.ISO8859_5=new A(v.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),A.ISO8859_6=new A(v.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),A.ISO8859_7=new A(v.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),A.ISO8859_8=new A(v.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),A.ISO8859_9=new A(v.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),A.ISO8859_10=new A(v.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),A.ISO8859_11=new A(v.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),A.ISO8859_13=new A(v.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),A.ISO8859_14=new A(v.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),A.ISO8859_15=new A(v.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),A.ISO8859_16=new A(v.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),A.SJIS=new A(v.SJIS,20,"SJIS","Shift_JIS"),A.Cp1250=new A(v.Cp1250,21,"Cp1250","windows-1250"),A.Cp1251=new A(v.Cp1251,22,"Cp1251","windows-1251"),A.Cp1252=new A(v.Cp1252,23,"Cp1252","windows-1252"),A.Cp1256=new A(v.Cp1256,24,"Cp1256","windows-1256"),A.UnicodeBigUnmarked=new A(v.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),A.UTF8=new A(v.UTF8,26,"UTF8","UTF-8"),A.ASCII=new A(v.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),A.Big5=new A(v.Big5,28,"Big5"),A.GB18030=new A(v.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),A.EUC_KR=new A(v.EUC_KR,30,"EUC_KR","EUC-KR");class S extends c{}S.kind="UnsupportedOperationException";class j{static decode(e,t){const r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)}static shouldDecodeOnFallback(e){return!j.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){const r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):"undefined"==typeof TextEncoder?this.encodeFallback(e):(new TextEncoder).encode(e)}static isBrowser(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(e){return"string"==typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof A?e:A.getCharacterSetECIByName(e)}static decodeFallback(e,t){const r=this.encodingCharacterSet(t);if(j.isDecodeFallbackSupported(r)){let t="";for(let r=0,n=e.length;r<n;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+="%"+n}return decodeURIComponent(t)}if(r.equals(A.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new S(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(A.UTF8)||e.equals(A.ISO8859_1)||e.equals(A.ASCII)}static encodeFallback(e){const t=btoa(unescape(encodeURIComponent(e))).split(""),r=[];for(let n=0;n<t.length;n++)r.push(t[n].charCodeAt(0));return new Uint8Array(r)}}class I{static castAsNonUtf8Char(e,t=null){const r=t?t.getName():this.ISO88591;return j.decode(new Uint8Array([e]),r)}static guessEncoding(e,t){if(null!=t&&void 0!==t.get(_.CHARACTER_SET))return t.get(_.CHARACTER_SET).toString();const r=e.length;let n=!0,i=!0,s=!0,a=0,o=0,l=0,c=0,d=0,u=0,h=0,p=0,m=0,f=0,g=0;const x=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let y=0;y<r&&(n||i||s);y++){const t=255&e[y];s&&(a>0?128&t?a--:s=!1:128&t&&(64&t?(a++,32&t?(a++,16&t?(a++,8&t?s=!1:c++):l++):o++):s=!1)),n&&(t>127&&t<160?n=!1:t>159&&(t<192||215===t||247===t)&&g++),i&&(d>0?t<64||127===t||t>252?i=!1:d--:128===t||160===t||t>239?i=!1:t>160&&t<224?(u++,p=0,h++,h>m&&(m=h)):t>127?(d++,h=0,p++,p>f&&(f=p)):(h=0,p=0))}return s&&a>0&&(s=!1),i&&d>0&&(i=!1),s&&(x||o+l+c>0)?I.UTF8:i&&(I.ASSUME_SHIFT_JIS||m>=3||f>=3)?I.SHIFT_JIS:n&&i?2===m&&2===u||10*g>=r?I.SHIFT_JIS:I.ISO88591:n?I.ISO88591:i?I.SHIFT_JIS:s?I.UTF8:I.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let r=-1;function n(e,n,i,s,a,o){if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[r],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(i),u=i&&i[0]+""=="0"?"0":" ";for(;l.length<d;)l=void 0!==n?l+u:u+l;return l}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,n)}static getBytes(e,t){return j.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}I.SHIFT_JIS=A.SJIS.getName(),I.GB2312="GB2312",I.ISO88591=A.ISO8859_1.getName(),I.EUC_JP="EUC_JP",I.UTF8=A.UTF8.getName(),I.PLATFORM_DEFAULT_ENCODING=I.UTF8,I.ASSUME_SHIFT_JIS=!1;class T{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return"string"==typeof e?this.value+=e.toString():this.encoding?this.value+=I.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,r){for(let n=t;t<t+r;n++)this.append(e[n]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class R{constructor(e,t,r,n){if(this.width=e,this.height=t,this.rowSize=r,this.bits=n,null==t&&(t=e),this.height=t,e<1||t<1)throw new u("Both dimensions must be greater than 0");null==r&&(r=Math.floor((e+31)/32)),this.rowSize=r,null==n&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,r=e[0].length,n=new R(r,t);for(let i=0;i<t;i++){const t=e[i];for(let e=0;e<r;e++)t[e]&&n.set(e,i)}return n}static parseFromString(e,t,r){if(null===e)throw new u("stringRepresentation cannot be null");const n=new Array(e.length);let i=0,s=0,a=-1,o=0,l=0;for(;l<e.length;)if("\n"===e.charAt(l)||"\r"===e.charAt(l)){if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new u("row lengths do not match");s=i,o++}l++}else if(e.substring(l,l+t.length)===t)l+=t.length,n[i]=!0,i++;else{if(e.substring(l,l+r.length)!==r)throw new u("illegal character encountered: "+e.substring(l));l+=r.length,n[i]=!1,i++}if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new u("row lengths do not match");o++}const c=new R(a,o);for(let d=0;d<i;d++)n[d]&&c.set(Math.floor(d%a),Math.floor(d/a));return c}get(e,t){const r=t*this.rowSize+Math.floor(e/32);return!!(this.bits[r]>>>(31&e)&1)}set(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(31&e)&4294967295}unset(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(31&e)&4294967295)}flip(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(31&e)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new u("input matrix dimensions do not match");const t=new b(Math.floor(this.width/32)+1),r=this.rowSize,n=this.bits;for(let i=0,s=this.height;i<s;i++){const s=i*r,a=e.getRow(i,t).getBitArray();for(let e=0;e<r;e++)n[s+e]^=a[e]}}clear(){const e=this.bits,t=e.length;for(let r=0;r<t;r++)e[r]=0}setRegion(e,t,r,n){if(t<0||e<0)throw new u("Left and top must be nonnegative");if(n<1||r<1)throw new u("Height and width must be at least 1");const i=e+r,s=t+n;if(s>this.height||i>this.width)throw new u("The region must fit inside the matrix");const a=this.rowSize,o=this.bits;for(let l=t;l<s;l++){const t=l*a;for(let r=e;r<i;r++)o[t+Math.floor(r/32)]|=1<<(31&r)&4294967295}}getRow(e,t){null==t||t.getSize()<this.width?t=new b(this.width):t.clear();const r=this.rowSize,n=this.bits,i=e*r;for(let s=0;s<r;s++)t.setBulk(32*s,n[i+s]);return t}setRow(e,t){f.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let r=new b(e),n=new b(e);for(let i=0,s=Math.floor((t+1)/2);i<s;i++)r=this.getRow(i,r),n=this.getRow(t-1-i,n),r.reverse(),n.reverse(),this.setRow(i,n),this.setRow(t-1-i,r)}getEnclosingRectangle(){const e=this.width,t=this.height,r=this.rowSize,n=this.bits;let i=e,s=t,a=-1,o=-1;for(let l=0;l<t;l++)for(let e=0;e<r;e++){const t=n[l*r+e];if(0!==t){if(l<s&&(s=l),l>o&&(o=l),32*e<i){let r=0;for(;!(t<<31-r&4294967295);)r++;32*e+r<i&&(i=32*e+r)}if(32*e+31>a){let r=31;for(;t>>>r===0;)r--;32*e+r>a&&(a=32*e+r)}}}return a<i||o<s?null:Int32Array.from([i,s,a-i+1,o-s+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let r=0;for(;r<t.length&&0===t[r];)r++;if(r===t.length)return null;const n=r/e;let i=r%e*32;const s=t[r];let a=0;for(;!(s<<31-a&4294967295);)a++;return i+=a,Int32Array.from([i,n])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let r=t.length-1;for(;r>=0&&0===t[r];)r--;if(r<0)return null;const n=Math.floor(r/e);let i=32*Math.floor(r%e);const s=t[r];let a=31;for(;s>>>a===0;)a--;return i+=a,Int32Array.from([i,n])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof R))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&y.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+y.hashCode(this.bits),e}toString(e="X ",t="  ",r="\n"){return this.buildToString(e,t,r)}buildToString(e,t,r){let n=new T;for(let i=0,s=this.height;i<s;i++){for(let r=0,s=this.width;r<s;r++)n.append(this.get(r,i)?e:t);n.append(r)}return n.toString()}clone(){return new R(this.width,this.height,this.rowSize,this.bits.slice())}}class N extends c{static getNotFoundInstance(){return new N}}N.kind="NotFoundException";class D extends m{constructor(e){super(e),this.luminances=D.EMPTY,this.buckets=new Int32Array(D.LUMINANCE_BUCKETS)}getBlackRow(e,t){const r=this.getLuminanceSource(),n=r.getWidth();null==t||t.getSize()<n?t=new b(n):t.clear(),this.initArrays(n);const i=r.getRow(e,this.luminances),s=this.buckets;for(let o=0;o<n;o++)s[(255&i[o])>>D.LUMINANCE_SHIFT]++;const a=D.estimateBlackPoint(s);if(n<3)for(let o=0;o<n;o++)(255&i[o])<a&&t.set(o);else{let e=255&i[0],r=255&i[1];for(let s=1;s<n-1;s++){const n=255&i[s+1];(4*r-e-n)/2<a&&t.set(s),e=r,r=n}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight(),n=new R(t,r);this.initArrays(t);const i=this.buckets;for(let o=1;o<5;o++){const n=Math.floor(r*o/5),s=e.getRow(n,this.luminances),a=Math.floor(4*t/5);for(let e=Math.floor(t/5);e<a;e++)i[(255&s[e])>>D.LUMINANCE_SHIFT]++}const s=D.estimateBlackPoint(i),a=e.getMatrix();for(let o=0;o<r;o++){const e=o*t;for(let r=0;r<t;r++)(255&a[e+r])<s&&n.set(r,o)}return n}createBinarizer(e){return new D(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let r=0;r<D.LUMINANCE_BUCKETS;r++)t[r]=0}static estimateBlackPoint(e){const t=e.length;let r=0,n=0,i=0;for(let c=0;c<t;c++)e[c]>i&&(n=c,i=e[c]),e[c]>r&&(r=e[c]);let s=0,a=0;for(let c=0;c<t;c++){const t=c-n,r=e[c]*t*t;r>a&&(s=c,a=r)}if(n>s){const e=n;n=s,s=e}if(s-n<=t/16)throw new N;let o=s-1,l=-1;for(let c=s-1;c>n;c--){const t=c-n,i=t*t*(s-c)*(r-e[c]);i>l&&(o=c,l=i)}return o<<D.LUMINANCE_SHIFT}}D.LUMINANCE_BITS=5,D.LUMINANCE_SHIFT=8-D.LUMINANCE_BITS,D.LUMINANCE_BUCKETS=1<<D.LUMINANCE_BITS,D.EMPTY=Uint8ClampedArray.from([0]);class O extends D{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight();if(t>=O.MINIMUM_DIMENSION&&r>=O.MINIMUM_DIMENSION){const n=e.getMatrix();let i=t>>O.BLOCK_SIZE_POWER;0!==(t&O.BLOCK_SIZE_MASK)&&i++;let s=r>>O.BLOCK_SIZE_POWER;0!==(r&O.BLOCK_SIZE_MASK)&&s++;const a=O.calculateBlackPoints(n,i,s,t,r),o=new R(t,r);O.calculateThresholdForBlock(n,i,s,t,r,a,o),this.matrix=o}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new O(e)}static calculateThresholdForBlock(e,t,r,n,i,s,a){const o=i-O.BLOCK_SIZE,l=n-O.BLOCK_SIZE;for(let c=0;c<r;c++){let i=c<<O.BLOCK_SIZE_POWER;i>o&&(i=o);const d=O.cap(c,2,r-3);for(let r=0;r<t;r++){let o=r<<O.BLOCK_SIZE_POWER;o>l&&(o=l);const c=O.cap(r,2,t-3);let u=0;for(let e=-2;e<=2;e++){const t=s[d+e];u+=t[c-2]+t[c-1]+t[c]+t[c+1]+t[c+2]}const h=u/25;O.thresholdBlock(e,o,i,h,n,a)}}}static cap(e,t,r){return e<t?t:e>r?r:e}static thresholdBlock(e,t,r,n,i,s){for(let a=0,o=r*i+t;a<O.BLOCK_SIZE;a++,o+=i)for(let i=0;i<O.BLOCK_SIZE;i++)(255&e[o+i])<=n&&s.set(t+i,r+a)}static calculateBlackPoints(e,t,r,n,i){const s=i-O.BLOCK_SIZE,a=n-O.BLOCK_SIZE,o=new Array(r);for(let l=0;l<r;l++){o[l]=new Int32Array(t);let r=l<<O.BLOCK_SIZE_POWER;r>s&&(r=s);for(let i=0;i<t;i++){let t=i<<O.BLOCK_SIZE_POWER;t>a&&(t=a);let s=0,c=255,d=0;for(let i=0,a=r*n+t;i<O.BLOCK_SIZE;i++,a+=n){for(let t=0;t<O.BLOCK_SIZE;t++){const r=255&e[a+t];s+=r,r<c&&(c=r),r>d&&(d=r)}if(d-c>O.MIN_DYNAMIC_RANGE)for(i++,a+=n;i<O.BLOCK_SIZE;i++,a+=n)for(let t=0;t<O.BLOCK_SIZE;t++)s+=255&e[a+t]}let u=s>>2*O.BLOCK_SIZE_POWER;if(d-c<=O.MIN_DYNAMIC_RANGE&&(u=c/2,l>0&&i>0)){const e=(o[l-1][i]+2*o[l][i-1]+o[l-1][i-1])/4;c<e&&(u=e)}o[l][i]=u}}return o}}O.BLOCK_SIZE_POWER=3,O.BLOCK_SIZE=1<<O.BLOCK_SIZE_POWER,O.BLOCK_SIZE_MASK=O.BLOCK_SIZE-1,O.MINIMUM_DIMENSION=5*O.BLOCK_SIZE,O.MIN_DYNAMIC_RANGE=24;class P{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,r,n){throw new S("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new S("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new S("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new T;for(let r=0;r<this.height;r++){const n=this.getRow(r,e);for(let e=0;e<this.width;e++){const r=255&n[e];let i;i=r<64?"#":r<128?"+":r<192?".":" ",t.append(i)}t.append("\n")}return t.toString()}}class M extends P{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const r=this.delegate.getRow(e,t),n=this.getWidth();for(let i=0;i<n;i++)r[i]=255-(255&r[i]);return r}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(t);for(let n=0;n<t;n++)r[n]=255-(255&e[n]);return r}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,r,n){return new M(this.delegate.crop(e,t,r,n))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new M(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new M(this.delegate.rotateCounterClockwise45())}}class k extends P{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=k.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return k.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,r){const n=new Uint8ClampedArray(t*r);for(let i=0,s=0,a=e.length;i<a;i+=4,s++){let t;t=0===e[i+3]?255:306*e[i]+601*e[i+1]+117*e[i+2]+512>>10,n[s]=t}return n}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth(),n=e*r;return null===t?t=this.buffer.slice(n,n+r):(t.length<r&&(t=new Uint8ClampedArray(r)),t.set(this.buffer.slice(n,n+r))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,r,n){return super.crop(e,t,r,n),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),r=t.getContext("2d"),n=e*k.DEGREE_TO_RADIANS,i=this.canvas.width,s=this.canvas.height,a=Math.ceil(Math.abs(Math.cos(n))*i+Math.abs(Math.sin(n))*s),o=Math.ceil(Math.abs(Math.sin(n))*i+Math.abs(Math.cos(n))*s);return t.width=a,t.height=o,r.translate(a/2,o/2),r.rotate(n),r.drawImage(this.canvas,i/-2,s/-2),this.buffer=k.makeBufferFromCanvasImageData(t),this}invert(){return new M(this)}}k.DEGREE_TO_RADIANS=Math.PI/180;class B{constructor(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var L,F,z=(globalThis||wt||self||window?(globalThis||wt||self||window||void 0).__awaiter:void 0)||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):i(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())}))};class W{constructor(e,t=500,r){this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!=typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return z(this,void 0,void 0,(function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const r of e){const e="video"===r.kind?"videoinput":r.kind;if("videoinput"!==e)continue;const n={deviceId:r.deviceId||r.id,label:r.label||`Video device ${t.length+1}`,kind:e,groupId:r.groupId};t.push(n)}return t}))}getVideoInputDevices(){return z(this,void 0,void 0,(function*(){return(yield this.listVideoInputDevices()).map((e=>new B(e.deviceId,e.label)))}))}findDeviceById(e){return z(this,void 0,void 0,(function*(){const t=yield this.listVideoInputDevices();return t?t.find((t=>t.deviceId===e)):null}))}decodeFromInputVideoDevice(e,t){return z(this,void 0,void 0,(function*(){return yield this.decodeOnceFromVideoDevice(e,t)}))}decodeOnceFromVideoDevice(e,t){return z(this,void 0,void 0,(function*(){let r;this.reset(),r=e?{deviceId:{exact:e}}:{facingMode:"environment"};const n={video:r};return yield this.decodeOnceFromConstraints(n,t)}))}decodeOnceFromConstraints(e,t){return z(this,void 0,void 0,(function*(){const r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(r,t)}))}decodeOnceFromStream(e,t){return z(this,void 0,void 0,(function*(){this.reset();const r=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(r)}))}decodeFromInputVideoDeviceContinuously(e,t,r){return z(this,void 0,void 0,(function*(){return yield this.decodeFromVideoDevice(e,t,r)}))}decodeFromVideoDevice(e,t,r){return z(this,void 0,void 0,(function*(){let n;n=e?{deviceId:{exact:e}}:{facingMode:"environment"};const i={video:n};return yield this.decodeFromConstraints(i,t,r)}))}decodeFromConstraints(e,t,r){return z(this,void 0,void 0,(function*(){const n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(n,t,r)}))}decodeFromStream(e,t,r){return z(this,void 0,void 0,(function*(){this.reset();const n=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(n,r)}))}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return z(this,void 0,void 0,(function*(){const r=this.prepareVideoElement(t);return this.addVideoSource(r,e),this.videoElement=r,this.stream=e,yield this.playVideoOnLoadAsync(r),r}))}playVideoOnLoadAsync(e){return new Promise(((t,r)=>this.playVideoOnLoad(e,(()=>t()))))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return z(this,void 0,void 0,(function*(){if(this.isVideoPlaying(e))console.warn("Trying to play video that is already playing.");else try{yield e.play()}catch(t){console.warn("It was not possible to play the video.")}}))}getMediaElement(e,t){const r=document.getElementById(e);if(!r)throw new d(`element with id '${e}' not found`);if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new d(`element with id '${e}' must be an ${t} element`);return r}decodeFromImage(e,t){if(!e&&!t)throw new d("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,r){if(void 0===e&&void 0===t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)}decodeFromImageElement(e){if(!e)throw new d("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);let r;return this.imageElement=t,r=this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t),r}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)}_decodeFromVideoElementSetup(e){if(!e)throw new d("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const r=this._decodeOnLoadImage(t);return t.src=e,r}decodeFromVideoUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r}decodeFromVideoUrlContinuously(e,t){if(!e)throw new d("An URL must be provided.");this.reset();const r=this.prepareVideoElement(),n=this.decodeFromVideoElementContinuously(r,t);return r.src=e,n}_decodeOnLoadImage(e){return new Promise(((t,r)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,r),e.addEventListener("load",this.imageLoadedListener)}))}_decodeOnLoadVideo(e){return z(this,void 0,void 0,(function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)}))}_decodeOnLoadVideoContinuously(e,t){return z(this,void 0,void 0,(function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)}))}isImageLoaded(e){return!!e.complete&&0!==e.naturalWidth}prepareImageElement(e){let t;return void 0===e&&(t=document.createElement("img"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return e||"undefined"==typeof document||(t=document.createElement("video"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,r=!0){this._stopAsyncDecode=!1;const n=(i,s)=>{if(this._stopAsyncDecode)return s(new N("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{i(this.decode(e))}catch(a){if(t&&a instanceof N||(a instanceof p||a instanceof E)&&r)return setTimeout(n,this._timeBetweenDecodingAttempts,i,s);s(a)}};return new Promise(((e,t)=>n(e,t)))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const r=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const n=this.decode(e);t(n,null),setTimeout(r,this.timeBetweenScansMillis)}catch(n){t(null,n),(n instanceof p||n instanceof E||n instanceof N)&&setTimeout(r,this._timeBetweenDecodingAttempts)}};r()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return 0!==e.videoWidth}drawFrameOnCanvas(e,t,r){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,r=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),r=new k(t),n=new O(r);return new h(n)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const t=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=t}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let r,n;return void 0!==e&&(e instanceof HTMLVideoElement?(r=e.videoWidth,n=e.videoHeight):e instanceof HTMLImageElement&&(r=e.naturalWidth||e.width,n=e.naturalHeight||e.height)),t.style.width=r+"px",t.style.height=n+"px",t.width=r,t.height=n,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach((e=>e.stop())),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch(r){e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")}}class U{constructor(e,t,r=(null==t?0:8*t.length),n,i,s=f.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=n,this.format=i,this.timestamp=s,this.text=e,this.rawBytes=t,this.numBits=null==r?null==t?0:8*t.length:r,this.resultPoints=n,this.format=i,this.resultMetadata=null,this.timestamp=null==s?f.currentTimeMillis():s}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){const r=new Array(t.length+e.length);f.arraycopy(t,0,r,0,t.length),f.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}}getTimestamp(){return this.timestamp}toString(){return this.text}}(F=L||(L={}))[F.AZTEC=0]="AZTEC",F[F.CODABAR=1]="CODABAR",F[F.CODE_39=2]="CODE_39",F[F.CODE_93=3]="CODE_93",F[F.CODE_128=4]="CODE_128",F[F.DATA_MATRIX=5]="DATA_MATRIX",F[F.EAN_8=6]="EAN_8",F[F.EAN_13=7]="EAN_13",F[F.ITF=8]="ITF",F[F.MAXICODE=9]="MAXICODE",F[F.PDF_417=10]="PDF_417",F[F.QR_CODE=11]="QR_CODE",F[F.RSS_14=12]="RSS_14",F[F.RSS_EXPANDED=13]="RSS_EXPANDED",F[F.UPC_A=14]="UPC_A",F[F.UPC_E=15]="UPC_E",F[F.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var V,H,G=L;(H=V||(V={}))[H.OTHER=0]="OTHER",H[H.ORIENTATION=1]="ORIENTATION",H[H.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",H[H.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",H[H.ISSUE_NUMBER=4]="ISSUE_NUMBER",H[H.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",H[H.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",H[H.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",H[H.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",H[H.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",H[H.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY";var q,$,X,Y,Z,K,Q,J,ee,te,re,ne=V;class ie{constructor(e,t,r,n,i=-1,s=-1){this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=n,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=s,this.numBits=null==e?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class se{exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class ae{constructor(e,t){if(0===t.length)throw new u;this.field=e;const r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-e),f.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);const t=this.coefficients;let r;if(1===e){r=0;for(let e=0,n=t.length;e!==n;e++){const n=t[e];r=se.addOrSubtract(r,n)}return r}r=t[0];const n=t.length,i=this.field;for(let s=1;s<n;s++)r=se.addOrSubtract(i.multiply(e,r),t[s]);return r}addOrSubtract(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){const e=t;t=r,r=e}let n=new Int32Array(r.length);const i=r.length-t.length;f.arraycopy(r,0,n,0,i);for(let s=i;s<r.length;s++)n[s]=se.addOrSubtract(t[s-i],r[s]);return new ae(this.field,n)}multiply(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1),a=this.field;for(let o=0;o<r;o++){const e=t[o];for(let t=0;t<i;t++)s[o+t]=se.addOrSubtract(s[o+t],a.multiply(e,n[t]))}return new ae(a,s)}multiplyScalar(e){if(0===e)return this.field.getZero();if(1===e)return this;const t=this.coefficients.length,r=this.field,n=new Int32Array(t),i=this.coefficients;for(let s=0;s<t;s++)n[s]=r.multiply(i[s],e);return new ae(r,n)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return this.field.getZero();const r=this.coefficients,n=r.length,i=new Int32Array(n+e),s=this.field;for(let a=0;a<n;a++)i[a]=s.multiply(r[a],t);return new ae(s,i)}divide(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new u("Divide by 0");const t=this.field;let r=t.getZero(),n=this;const i=e.getCoefficient(e.getDegree()),s=t.inverse(i);for(;n.getDegree()>=e.getDegree()&&!n.isZero();){const i=n.getDegree()-e.getDegree(),a=t.multiply(n.getCoefficient(n.getDegree()),s),o=e.multiplyByMonomial(i,a),l=t.buildMonomial(i,a);r=r.addOrSubtract(l),n=n.addOrSubtract(o)}return[r,n]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);if(0!==r){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),0===t||1!==r){const t=this.field.log(r);0===t?e+="1":1===t?e+="a":(e+="a^",e+=t)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e}}class oe extends c{}oe.kind="ArithmeticException";class le extends se{constructor(e,t,r){super(),this.primitive=e,this.size=t,this.generatorBase=r;const n=new Int32Array(t);let i=1;for(let a=0;a<t;a++)n[a]=i,i*=2,i>=t&&(i^=e,i&=t-1);this.expTable=n;const s=new Int32Array(t);for(let a=0;a<t-1;a++)s[n[a]]=a;this.logTable=s,this.zero=new ae(this,Int32Array.from([0])),this.one=new ae(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;const r=new Int32Array(e+1);return r[0]=t,new ae(this,r)}inverse(e){if(0===e)throw new oe;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+w.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}le.AZTEC_DATA_12=new le(4201,4096,1),le.AZTEC_DATA_10=new le(1033,1024,1),le.AZTEC_DATA_6=new le(67,64,1),le.AZTEC_PARAM=new le(19,16,1),le.QR_CODE_FIELD_256=new le(285,256,0),le.DATA_MATRIX_FIELD_256=new le(301,256,1),le.AZTEC_DATA_8=le.DATA_MATRIX_FIELD_256,le.MAXICODE_FIELD_64=le.AZTEC_DATA_6;class ce extends c{}ce.kind="ReedSolomonException";class de extends c{}de.kind="IllegalStateException";class ue{constructor(e){this.field=e}decode(e,t){const r=this.field,n=new ae(r,e),i=new Int32Array(t);let s=!0;for(let h=0;h<t;h++){const e=n.evaluateAt(r.exp(h+r.getGeneratorBase()));i[i.length-1-h]=e,0!==e&&(s=!1)}if(s)return;const a=new ae(r,i),o=this.runEuclideanAlgorithm(r.buildMonomial(t,1),a,t),l=o[0],c=o[1],d=this.findErrorLocations(l),u=this.findErrorMagnitudes(c,d);for(let h=0;h<d.length;h++){const t=e.length-1-r.log(d[h]);if(t<0)throw new ce("Bad error location");e[t]=le.addOrSubtract(e[t],u[h])}}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){const r=e;e=t,t=r}const n=this.field;let i=e,s=t,a=n.getZero(),o=n.getOne();for(;s.getDegree()>=(r/2|0);){let e=i,t=a;if(i=s,a=o,i.isZero())throw new ce("r_{i-1} was zero");s=e;let r=n.getZero();const l=i.getCoefficient(i.getDegree()),c=n.inverse(l);for(;s.getDegree()>=i.getDegree()&&!s.isZero();){const e=s.getDegree()-i.getDegree(),t=n.multiply(s.getCoefficient(s.getDegree()),c);r=r.addOrSubtract(n.buildMonomial(e,t)),s=s.addOrSubtract(i.multiplyByMonomial(e,t))}if(o=r.multiply(a).addOrSubtract(t),s.getDegree()>=i.getDegree())throw new de("Division algorithm failed to reduce polynomial?")}const l=o.getCoefficient(0);if(0===l)throw new ce("sigmaTilde(0) was zero");const c=n.inverse(l);return[o.multiplyScalar(c),s.multiplyScalar(c)]}findErrorLocations(e){const t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);const r=new Int32Array(t);let n=0;const i=this.field;for(let s=1;s<i.getSize()&&n<t;s++)0===e.evaluateAt(s)&&(r[n]=i.inverse(s),n++);if(n!==t)throw new ce("Error locator degree does not match number of roots");return r}findErrorMagnitudes(e,t){const r=t.length,n=new Int32Array(r),i=this.field;for(let s=0;s<r;s++){const a=i.inverse(t[s]);let o=1;for(let e=0;e<r;e++)if(s!==e){const r=i.multiply(t[e],a),n=1&r?-2&r:1|r;o=i.multiply(o,n)}n[s]=i.multiply(e.evaluateAt(a),i.inverse(o)),0!==i.getGeneratorBase()&&(n[s]=i.multiply(n[s],a))}return n}}(Q=q||(q={}))[Q.UPPER=0]="UPPER",Q[Q.LOWER=1]="LOWER",Q[Q.MIXED=2]="MIXED",Q[Q.DIGIT=3]="DIGIT",Q[Q.PUNCT=4]="PUNCT",Q[Q.BINARY=5]="BINARY";class he{decode(e){this.ddata=e;let t=e.getBits(),r=this.extractBits(t),n=this.correctBits(r),i=he.convertBoolArrayToByteArray(n),s=he.getEncodedData(n),a=new ie(i,s,null,null);return a.setNumBits(n.length),a}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,r=q.UPPER,n=q.UPPER,i="",s=0;for(;s<t;)if(n===q.BINARY){if(t-s<5)break;let a=he.readCode(e,s,5);if(s+=5,0===a){if(t-s<11)break;a=he.readCode(e,s,11)+31,s+=11}for(let r=0;r<a;r++){if(t-s<8){s=t;break}const r=he.readCode(e,s,8);i+=I.castAsNonUtf8Char(r),s+=8}n=r}else{let a=n===q.DIGIT?4:5;if(t-s<a)break;let o=he.readCode(e,s,a);s+=a;let l=he.getCharacter(n,o);l.startsWith("CTRL_")?(r=n,n=he.getTable(l.charAt(5)),"L"===l.charAt(6)&&(r=n)):(i+=l,n=r)}return i}static getTable(e){switch(e){case"L":return q.LOWER;case"P":return q.PUNCT;case"M":return q.MIXED;case"D":return q.DIGIT;case"B":return q.BINARY;default:return q.UPPER}}static getCharacter(e,t){switch(e){case q.UPPER:return he.UPPER_TABLE[t];case q.LOWER:return he.LOWER_TABLE[t];case q.MIXED:return he.MIXED_TABLE[t];case q.PUNCT:return he.PUNCT_TABLE[t];case q.DIGIT:return he.DIGIT_TABLE[t];default:throw new de("Bad table")}}correctBits(e){let t,r;this.ddata.getNbLayers()<=2?(r=6,t=le.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(r=8,t=le.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(r=10,t=le.AZTEC_DATA_10):(r=12,t=le.AZTEC_DATA_12);let n=this.ddata.getNbDatablocks(),i=e.length/r;if(i<n)throw new E;let s=e.length%r,a=new Int32Array(i);for(let h=0;h<i;h++,s+=r)a[h]=he.readCode(e,s,r);try{new ue(t).decode(a,i-n)}catch(u){throw new E(u)}let o=(1<<r)-1,l=0;for(let h=0;h<n;h++){let e=a[h];if(0===e||e===o)throw new E;1!==e&&e!==o-1||l++}let c=new Array(n*r-l),d=0;for(let h=0;h<n;h++){let e=a[h];if(1===e||e===o-1)c.fill(e>1,d,d+r-1),d+=r-1;else for(let t=r-1;t>=0;--t)c[d++]=!!(e&1<<t)}return c}extractBits(e){let t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),n=(t?11:14)+4*r,i=new Int32Array(n),s=new Array(this.totalBitsInLayer(r,t));if(t)for(let a=0;a<i.length;a++)i[a]=a;else{let e=n+1+2*w.truncDivision(w.truncDivision(n,2)-1,15),t=n/2,r=w.truncDivision(e,2);for(let n=0;n<t;n++){let e=n+w.truncDivision(n,15);i[t-n-1]=r-e-1,i[t+n]=r+e+1}}for(let a=0,o=0;a<r;a++){let l=4*(r-a)+(t?9:12),c=2*a,d=n-1-c;for(let t=0;t<l;t++){let r=2*t;for(let n=0;n<2;n++)s[o+r+n]=e.get(i[c+n],i[c+t]),s[o+2*l+r+n]=e.get(i[c+t],i[d-n]),s[o+4*l+r+n]=e.get(i[d-n],i[d-t]),s[o+6*l+r+n]=e.get(i[d-t],i[c+n])}o+=8*l}return s}static readCode(e,t,r){let n=0;for(let i=t;i<t+r;i++)n<<=1,e[i]&&(n|=1);return n}static readByte(e,t){let r=e.length-t;return r>=8?he.readCode(e,t,8):he.readCode(e,t,r)<<8-r}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let r=0;r<t.length;r++)t[r]=he.readByte(e,8*r);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}he.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],he.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],he.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],he.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],he.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class pe{constructor(){}static round(e){return NaN===e?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,r,n){const i=e-r,s=t-n;return Math.sqrt(i*i+s*s)}static sum(e){let t=0;for(let r=0,n=e.length;r!==n;r++)t+=e[r];return t}}class me{static floatToIntBits(e){return e}}me.MAX_VALUE=Number.MAX_SAFE_INTEGER;class fe{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof fe){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*me.floatToIntBits(this.x)+me.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),r=this.distance(e[1],e[2]),n=this.distance(e[0],e[2]);let i,s,a;if(r>=t&&r>=n?(s=e[0],i=e[1],a=e[2]):n>=r&&n>=t?(s=e[1],i=e[0],a=e[2]):(s=e[2],i=e[0],a=e[1]),this.crossProductZ(i,s,a)<0){const e=i;i=a,a=e}e[0]=i,e[1]=s,e[2]=a}static distance(e,t){return pe.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,r){const n=t.x,i=t.y;return(r.x-n)*(e.y-i)-(r.y-i)*(e.x-n)}}class ge{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class xe extends ge{constructor(e,t,r,n,i){super(e,t),this.compact=r,this.nbDatablocks=n,this.nbLayers=i}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class ye{constructor(e,t,r,n){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==t&&(t=ye.INIT_SIZE),null==r&&(r=e.getWidth()/2|0),null==n&&(n=e.getHeight()/2|0);const i=t/2|0;if(this.leftInit=r-i,this.rightInit=r+i,this.upInit=n-i,this.downInit=n+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new N}detect(){let e=this.leftInit,t=this.rightInit,r=this.upInit,n=this.downInit,i=!1,s=!0,a=!1,o=!1,l=!1,c=!1,d=!1;const u=this.width,h=this.height;for(;s;){s=!1;let p=!0;for(;(p||!o)&&t<u;)p=this.containsBlackPoint(r,n,t,!1),p?(t++,s=!0,o=!0):o||t++;if(t>=u){i=!0;break}let m=!0;for(;(m||!l)&&n<h;)m=this.containsBlackPoint(e,t,n,!0),m?(n++,s=!0,l=!0):l||n++;if(n>=h){i=!0;break}let f=!0;for(;(f||!c)&&e>=0;)f=this.containsBlackPoint(r,n,e,!1),f?(e--,s=!0,c=!0):c||e--;if(e<0){i=!0;break}let g=!0;for(;(g||!d)&&r>=0;)g=this.containsBlackPoint(e,t,r,!0),g?(r--,s=!0,d=!0):d||r--;if(r<0){i=!0;break}s&&(a=!0)}if(!i&&a){const i=t-e;let s=null;for(let t=1;null===s&&t<i;t++)s=this.getBlackPointOnSegment(e,n-t,e+t,n);if(null==s)throw new N;let a=null;for(let t=1;null===a&&t<i;t++)a=this.getBlackPointOnSegment(e,r+t,e+t,r);if(null==a)throw new N;let o=null;for(let e=1;null===o&&e<i;e++)o=this.getBlackPointOnSegment(t,r+e,t-e,r);if(null==o)throw new N;let l=null;for(let e=1;null===l&&e<i;e++)l=this.getBlackPointOnSegment(t,n-e,t-e,n);if(null==l)throw new N;return this.centerEdges(l,s,o,a)}throw new N}getBlackPointOnSegment(e,t,r,n){const i=pe.round(pe.distance(e,t,r,n)),s=(r-e)/i,a=(n-t)/i,o=this.image;for(let l=0;l<i;l++){const r=pe.round(e+l*s),n=pe.round(t+l*a);if(o.get(r,n))return new fe(r,n)}return null}centerEdges(e,t,r,n){const i=e.getX(),s=e.getY(),a=t.getX(),o=t.getY(),l=r.getX(),c=r.getY(),d=n.getX(),u=n.getY(),h=ye.CORR;return i<this.width/2?[new fe(d-h,u+h),new fe(a+h,o+h),new fe(l-h,c-h),new fe(i+h,s-h)]:[new fe(d+h,u+h),new fe(a+h,o-h),new fe(l-h,c+h),new fe(i-h,s-h)]}containsBlackPoint(e,t,r,n){const i=this.image;if(n){for(let s=e;s<=t;s++)if(i.get(s,r))return!0}else for(let s=e;s<=t;s++)if(i.get(r,s))return!0;return!1}}ye.INIT_SIZE=10,ye.CORR=1;class we{static checkAndNudgePoints(e,t){const r=e.getWidth(),n=e.getHeight();let i=!0;for(let s=0;s<t.length&&i;s+=2){const e=Math.floor(t[s]),a=Math.floor(t[s+1]);if(e<-1||e>r||a<-1||a>n)throw new N;i=!1,-1===e?(t[s]=0,i=!0):e===r&&(t[s]=r-1,i=!0),-1===a?(t[s+1]=0,i=!0):a===n&&(t[s+1]=n-1,i=!0)}i=!0;for(let s=t.length-2;s>=0&&i;s-=2){const e=Math.floor(t[s]),a=Math.floor(t[s+1]);if(e<-1||e>r||a<-1||a>n)throw new N;i=!1,-1===e?(t[s]=0,i=!0):e===r&&(t[s]=r-1,i=!0),-1===a?(t[s+1]=0,i=!0):a===n&&(t[s+1]=n-1,i=!0)}}}class be{constructor(e,t,r,n,i,s,a,o,l){this.a11=e,this.a21=t,this.a31=r,this.a12=n,this.a22=i,this.a32=s,this.a13=a,this.a23=o,this.a33=l}static quadrilateralToQuadrilateral(e,t,r,n,i,s,a,o,l,c,d,u,h,p,m,f){const g=be.quadrilateralToSquare(e,t,r,n,i,s,a,o);return be.squareToQuadrilateral(l,c,d,u,h,p,m,f).times(g)}transformPoints(e){const t=e.length,r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33;for(let u=0;u<t;u+=2){const t=e[u],h=e[u+1],p=i*t+o*h+d;e[u]=(r*t+s*h+l)/p,e[u+1]=(n*t+a*h+c)/p}}transformPointsWithValues(e,t){const r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33,u=e.length;for(let h=0;h<u;h++){const u=e[h],p=t[h],m=i*u+o*p+d;e[h]=(r*u+s*p+l)/m,t[h]=(n*u+a*p+c)/m}}static squareToQuadrilateral(e,t,r,n,i,s,a,o){const l=e-r+i-a,c=t-n+s-o;if(0===l&&0===c)return new be(r-e,i-r,e,n-t,s-n,t,0,0,1);{const d=r-i,u=a-i,h=n-s,p=o-s,m=d*p-u*h,f=(l*p-u*c)/m,g=(d*c-l*h)/m;return new be(r-e+f*r,a-e+g*a,e,n-t+f*n,o-t+g*o,t,f,g,1)}}static quadrilateralToSquare(e,t,r,n,i,s,a,o){return be.squareToQuadrilateral(e,t,r,n,i,s,a,o).buildAdjoint()}buildAdjoint(){return new be(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new be(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class ve extends we{sampleGrid(e,t,r,n,i,s,a,o,l,c,d,u,h,p,m,f,g,x,y){const w=be.quadrilateralToQuadrilateral(n,i,s,a,o,l,c,d,u,h,p,m,f,g,x,y);return this.sampleGridWithTransform(e,t,r,w)}sampleGridWithTransform(e,t,r,n){if(t<=0||r<=0)throw new N;const i=new R(t,r),s=new Float32Array(2*t);for(let o=0;o<r;o++){const t=s.length,r=o+.5;for(let e=0;e<t;e+=2)s[e]=e/2+.5,s[e+1]=r;n.transformPoints(s),we.checkAndNudgePoints(e,s);try{for(let r=0;r<t;r+=2)e.get(Math.floor(s[r]),Math.floor(s[r+1]))&&i.set(r/2,o)}catch(a){throw new N}}return i}}class Ce{static setGridSampler(e){Ce.gridSampler=e}static getInstance(){return Ce.gridSampler}}Ce.gridSampler=new ve;class _e{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new fe(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Ee{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){let e=r[0];r[0]=r[2],r[2]=e}this.extractParameters(r);let n=this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),i=this.getMatrixCornerPoints(r);return new xe(n,i,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new N;let t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);let n=0;for(let s=0;s<4;s++){let e=r[(this.shift+s)%4];this.compact?(n<<=7,n+=e>>1&127):(n<<=10,n+=(e>>2&992)+(e>>1&31))}let i=this.getCorrectedParameterData(n,this.compact);this.compact?(this.nbLayers=1+(i>>6),this.nbDataBlocks=1+(63&i)):(this.nbLayers=1+(i>>11),this.nbDataBlocks=1+(2047&i))}getRotation(e,t){let r=0;e.forEach(((e,n,i)=>{r=(e>>t-2<<1)+(1&e)+(r<<3)})),r=((1&r)<<11)+(r>>1);for(let n=0;n<4;n++)if(w.bitCount(r^this.EXPECTED_CORNER_BITS[n])<=2)return n;throw new N}getCorrectedParameterData(e,t){let r,n;t?(r=7,n=2):(r=10,n=4);let i=r-n,s=new Int32Array(r);for(let l=r-1;l>=0;--l)s[l]=15&e,e>>=4;try{new ue(le.AZTEC_PARAM).decode(s,i)}catch(o){throw new N}let a=0;for(let l=0;l<n;l++)a=(a<<4)+s[l];return a}getBullsEyeCorners(e){let t=e,r=e,n=e,i=e,s=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let e=this.getFirstDifferent(t,s,1,-1),a=this.getFirstDifferent(r,s,1,1),o=this.getFirstDifferent(n,s,-1,1),l=this.getFirstDifferent(i,s,-1,-1);if(this.nbCenterLayers>2){let r=this.distancePoint(l,e)*this.nbCenterLayers/(this.distancePoint(i,t)*(this.nbCenterLayers+2));if(r<.75||r>1.25||!this.isWhiteOrBlackRectangle(e,a,o,l))break}t=e,r=a,n=o,i=l,s=!s}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new N;this.compact=5===this.nbCenterLayers;let a=new fe(t.getX()+.5,t.getY()-.5),o=new fe(r.getX()+.5,r.getY()+.5),l=new fe(n.getX()-.5,n.getY()+.5),c=new fe(i.getX()-.5,i.getY()-.5);return this.expandSquare([a,o,l,c],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,r,n;try{let i=new ye(this.image).detect();e=i[0],t=i[1],r=i[2],n=i[3]}catch(a){let i=this.image.getWidth()/2,s=this.image.getHeight()/2;e=this.getFirstDifferent(new _e(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new _e(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new _e(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new _e(i-7,s-7),!1,-1,-1).toResultPoint()}let i=pe.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=pe.round((e.getY()+n.getY()+t.getY()+r.getY())/4);try{let a=new ye(this.image,15,i,s).detect();e=a[0],t=a[1],r=a[2],n=a[3]}catch(a){e=this.getFirstDifferent(new _e(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new _e(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new _e(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new _e(i-7,s-7),!1,-1,-1).toResultPoint()}return i=pe.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=pe.round((e.getY()+n.getY()+t.getY()+r.getY())/4),new _e(i,s)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,r,n,i){let s=Ce.getInstance(),a=this.getDimension(),o=a/2-this.nbCenterLayers,l=a/2+this.nbCenterLayers;return s.sampleGrid(e,a,a,o,o,l,o,l,l,o,l,t.getX(),t.getY(),r.getX(),r.getY(),n.getX(),n.getY(),i.getX(),i.getY())}sampleLine(e,t,r){let n=0,i=this.distanceResultPoint(e,t),s=i/r,a=e.getX(),o=e.getY(),l=s*(t.getX()-e.getX())/i,c=s*(t.getY()-e.getY())/i;for(let d=0;d<r;d++)this.image.get(pe.round(a+d*l),pe.round(o+d*c))&&(n|=1<<r-d-1);return n}isWhiteOrBlackRectangle(e,t,r,n){let i=3;e=new _e(e.getX()-i,e.getY()+i),t=new _e(t.getX()-i,t.getY()-i),r=new _e(r.getX()+i,r.getY()-i),n=new _e(n.getX()+i,n.getY()+i);let s=this.getColor(n,e);if(0===s)return!1;let a=this.getColor(e,t);return a===s&&(a=this.getColor(t,r),a===s&&(a=this.getColor(r,n),a===s))}getColor(e,t){let r=this.distancePoint(e,t),n=(t.getX()-e.getX())/r,i=(t.getY()-e.getY())/r,s=0,a=e.getX(),o=e.getY(),l=this.image.get(e.getX(),e.getY()),c=Math.ceil(r);for(let u=0;u<c;u++)a+=n,o+=i,this.image.get(pe.round(a),pe.round(o))!==l&&s++;let d=s/r;return d>.1&&d<.9?0:d<=.1===l?1:-1}getFirstDifferent(e,t,r,n){let i=e.getX()+r,s=e.getY()+n;for(;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r,s+=n;for(i-=r,s-=n;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r;for(i-=r;this.isValid(i,s)&&this.image.get(i,s)===t;)s+=n;return s-=n,new _e(i,s)}expandSquare(e,t,r){let n=r/(2*t),i=e[0].getX()-e[2].getX(),s=e[0].getY()-e[2].getY(),a=(e[0].getX()+e[2].getX())/2,o=(e[0].getY()+e[2].getY())/2,l=new fe(a+n*i,o+n*s),c=new fe(a-n*i,o-n*s);return i=e[1].getX()-e[3].getX(),s=e[1].getY()-e[3].getY(),a=(e[1].getX()+e[3].getX())/2,o=(e[1].getY()+e[3].getY())/2,[l,new fe(a+n*i,o+n*s),c,new fe(a-n*i,o-n*s)]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=pe.round(e.getX()),r=pe.round(e.getY());return this.isValid(t,r)}distancePoint(e,t){return pe.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return pe.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(w.truncDivision(this.nbLayers-4,8)+1)+15}}class Ae{decode(e,t=null){let r=null,n=new Ee(e.getBlackMatrix()),i=null,s=null;try{let e=n.detectMirror(!1);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=(new he).decode(e)}catch(c){r=c}if(null==s)try{let e=n.detectMirror(!0);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=(new he).decode(e)}catch(c){if(null!=r)throw r;throw c}let a=new U(s.getText(),s.getRawBytes(),s.getNumBits(),i,G.AZTEC,f.currentTimeMillis()),o=s.getByteSegments();null!=o&&a.putMetadata(ne.BYTE_SEGMENTS,o);let l=s.getECLevel();return null!=l&&a.putMetadata(ne.ERROR_CORRECTION_LEVEL,l),a}reportFoundResultPoints(e,t){if(null!=e){let r=e.get(_.NEED_RESULT_POINT_CALLBACK);null!=r&&t.forEach(((e,t,n)=>{r.foundPossibleResultPoint(e)}))}}reset(){}}class Se extends W{constructor(e=500){super(new Ae,e)}}class je{decode(e,t){try{return this.doDecode(e,t)}catch(r){if(t&&!0===t.get(_.TRY_HARDER)&&e.isRotateSupported()){const r=e.rotateCounterClockwise(),n=this.doDecode(r,t),i=n.getResultMetadata();let s=270;null!==i&&!0===i.get(ne.ORIENTATION)&&(s+=i.get(ne.ORIENTATION)%360),n.putMetadata(ne.ORIENTATION,s);const a=n.getResultPoints();if(null!==a){const e=r.getHeight();for(let t=0;t<a.length;t++)a[t]=new fe(e-a[t].getY()-1,a[t].getX())}return n}throw new N}}reset(){}doDecode(e,t){const r=e.getWidth(),n=e.getHeight();let i=new b(r);const s=t&&!0===t.get(_.TRY_HARDER),a=Math.max(1,n>>(s?8:5));let o;o=s?n:15;const l=Math.trunc(n/2);for(let u=0;u<o;u++){const s=Math.trunc((u+1)/2),o=l+a*(1&u?-s:s);if(o<0||o>=n)break;try{i=e.getBlackRow(o,i)}catch(c){continue}for(let e=0;e<2;e++){if(1===e&&(i.reverse(),t&&!0===t.get(_.NEED_RESULT_POINT_CALLBACK))){const e=new Map;t.forEach(((t,r)=>e.set(r,t))),e.delete(_.NEED_RESULT_POINT_CALLBACK),t=e}try{const n=this.decodeRow(o,i,t);if(1===e){n.putMetadata(ne.ORIENTATION,180);const e=n.getResultPoints();null!==e&&(e[0]=new fe(r-e[0].getX()-1,e[0].getY()),e[1]=new fe(r-e[1].getX()-1,e[1].getY()))}return n}catch(d){}}}throw new N}static recordPattern(e,t,r){const n=r.length;for(let l=0;l<n;l++)r[l]=0;const i=e.getSize();if(t>=i)throw new N;let s=!e.get(t),a=0,o=t;for(;o<i;){if(e.get(o)!==s)r[a]++;else{if(++a===n)break;r[a]=1,s=!s}o++}if(a!==n&&(a!==n-1||o!==i))throw new N}static recordPatternInReverse(e,t,r){let n=r.length,i=e.get(t);for(;t>0&&n>=0;)e.get(--t)!==i&&(n--,i=!i);if(n>=0)throw new N;je.recordPattern(e,t+1,r)}static patternMatchVariance(e,t,r){const n=e.length;let i=0,s=0;for(let l=0;l<n;l++)i+=e[l],s+=t[l];if(i<s)return Number.POSITIVE_INFINITY;const a=i/s;r*=a;let o=0;for(let l=0;l<n;l++){const n=e[l],i=t[l]*a,s=n>i?n-i:i-n;if(s>r)return Number.POSITIVE_INFINITY;o+=s}return o/i}}class Ie extends je{static findStartPattern(e){const t=e.getSize(),r=e.getNextSet(0);let n=0,i=Int32Array.from([0,0,0,0,0,0]),s=r,a=!1;const o=6;for(let l=r;l<t;l++)if(e.get(l)!==a)i[n]++;else{if(n===o-1){let t=Ie.MAX_AVG_VARIANCE,r=-1;for(let e=Ie.CODE_START_A;e<=Ie.CODE_START_C;e++){const n=je.patternMatchVariance(i,Ie.CODE_PATTERNS[e],Ie.MAX_INDIVIDUAL_VARIANCE);n<t&&(t=n,r=e)}if(r>=0&&e.isRange(Math.max(0,s-(l-s)/2),s,!1))return Int32Array.from([s,l,r]);s+=i[0]+i[1],i=i.slice(2,i.length-1),i[n-1]=0,i[n]=0,n--}else n++;i[n]=1,a=!a}throw new N}static decodeCode(e,t,r){je.recordPattern(e,r,t);let n=Ie.MAX_AVG_VARIANCE,i=-1;for(let s=0;s<Ie.CODE_PATTERNS.length;s++){const e=Ie.CODE_PATTERNS[s],r=this.patternMatchVariance(t,e,Ie.MAX_INDIVIDUAL_VARIANCE);r<n&&(n=r,i=s)}if(i>=0)return i;throw new N}decodeRow(e,t,r){const n=r&&!0===r.get(_.ASSUME_GS1),i=Ie.findStartPattern(t),s=i[2];let a=0;const o=new Uint8Array(20);let l;switch(o[a++]=s,s){case Ie.CODE_START_A:l=Ie.CODE_CODE_A;break;case Ie.CODE_START_B:l=Ie.CODE_CODE_B;break;case Ie.CODE_START_C:l=Ie.CODE_CODE_C;break;default:throw new E}let c=!1,d=!1,u="",h=i[0],m=i[1];const f=Int32Array.from([0,0,0,0,0,0]);let g=0,x=0,y=s,w=0,b=!0,v=!1,C=!1;for(;!c;){const e=d;switch(d=!1,g=x,x=Ie.decodeCode(t,f,m),o[a++]=x,x!==Ie.CODE_STOP&&(b=!0),x!==Ie.CODE_STOP&&(w++,y+=w*x),h=m,m+=f.reduce(((e,t)=>e+t),0),x){case Ie.CODE_START_A:case Ie.CODE_START_B:case Ie.CODE_START_C:throw new E}switch(l){case Ie.CODE_CODE_A:if(x<64)u+=C===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),C=!1;else if(x<96)u+=C===v?String.fromCharCode(x-64):String.fromCharCode(x+64),C=!1;else switch(x!==Ie.CODE_STOP&&(b=!1),x){case Ie.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case Ie.CODE_FNC_2:case Ie.CODE_FNC_3:break;case Ie.CODE_FNC_4_A:!v&&C?(v=!0,C=!1):v&&C?(v=!1,C=!1):C=!0;break;case Ie.CODE_SHIFT:d=!0,l=Ie.CODE_CODE_B;break;case Ie.CODE_CODE_B:l=Ie.CODE_CODE_B;break;case Ie.CODE_CODE_C:l=Ie.CODE_CODE_C;break;case Ie.CODE_STOP:c=!0}break;case Ie.CODE_CODE_B:if(x<96)u+=C===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),C=!1;else switch(x!==Ie.CODE_STOP&&(b=!1),x){case Ie.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case Ie.CODE_FNC_2:case Ie.CODE_FNC_3:break;case Ie.CODE_FNC_4_B:!v&&C?(v=!0,C=!1):v&&C?(v=!1,C=!1):C=!0;break;case Ie.CODE_SHIFT:d=!0,l=Ie.CODE_CODE_A;break;case Ie.CODE_CODE_A:l=Ie.CODE_CODE_A;break;case Ie.CODE_CODE_C:l=Ie.CODE_CODE_C;break;case Ie.CODE_STOP:c=!0}break;case Ie.CODE_CODE_C:if(x<100)x<10&&(u+="0"),u+=x;else switch(x!==Ie.CODE_STOP&&(b=!1),x){case Ie.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case Ie.CODE_CODE_A:l=Ie.CODE_CODE_A;break;case Ie.CODE_CODE_B:l=Ie.CODE_CODE_B;break;case Ie.CODE_STOP:c=!0}}e&&(l=l===Ie.CODE_CODE_A?Ie.CODE_CODE_B:Ie.CODE_CODE_A)}const A=m-h;if(m=t.getNextUnset(m),!t.isRange(m,Math.min(t.getSize(),m+(m-h)/2),!1))throw new N;if(y-=w*g,y%103!==g)throw new p;const S=u.length;if(0===S)throw new N;S>0&&b&&(u=l===Ie.CODE_CODE_C?u.substring(0,S-2):u.substring(0,S-1));const j=(i[1]+i[0])/2,I=h+A/2,T=o.length,R=new Uint8Array(T);for(let p=0;p<T;p++)R[p]=o[p];const D=[new fe(j,e),new fe(I,e)];return new U(u,R,0,D,G.CODE_128,(new Date).getTime())}}Ie.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Ie.MAX_AVG_VARIANCE=.25,Ie.MAX_INDIVIDUAL_VARIANCE=.7,Ie.CODE_SHIFT=98,Ie.CODE_CODE_C=99,Ie.CODE_CODE_B=100,Ie.CODE_CODE_A=101,Ie.CODE_FNC_1=102,Ie.CODE_FNC_2=97,Ie.CODE_FNC_3=96,Ie.CODE_FNC_4_A=101,Ie.CODE_FNC_4_B=100,Ie.CODE_START_A=103,Ie.CODE_START_B=104,Ie.CODE_START_C=105,Ie.CODE_STOP=106;class Te extends je{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,r){let n=this.counters;n.fill(0),this.decodeRowResult="";let i,s,a=Te.findAsteriskPattern(t,n),o=t.getNextSet(a[1]),l=t.getSize();do{Te.recordPattern(t,o,n);let e=Te.toNarrowWidePattern(n);if(e<0)throw new N;i=Te.patternToChar(e),this.decodeRowResult+=i,s=o;for(let t of n)o+=t;o=t.getNextSet(o)}while("*"!==i);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let c,d=0;for(let p of n)d+=p;if(o!==l&&2*(o-s-d)<d)throw new N;if(this.usingCheckDigit){let e=this.decodeRowResult.length-1,t=0;for(let r=0;r<e;r++)t+=Te.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(r));if(this.decodeRowResult.charAt(e)!==Te.ALPHABET_STRING.charAt(t%43))throw new p;this.decodeRowResult=this.decodeRowResult.substring(0,e)}if(0===this.decodeRowResult.length)throw new N;c=this.extendedMode?Te.decodeExtended(this.decodeRowResult):this.decodeRowResult;let u=(a[1]+a[0])/2,h=s+d/2;return new U(c,null,0,[new fe(u,e),new fe(h,e)],G.CODE_39,(new Date).getTime())}static findAsteriskPattern(e,t){let r=e.getSize(),n=e.getNextSet(0),i=0,s=n,a=!1,o=t.length;for(let l=n;l<r;l++)if(e.get(l)!==a)t[i]++;else{if(i===o-1){if(this.toNarrowWidePattern(t)===Te.ASTERISK_ENCODING&&e.isRange(Math.max(0,s-Math.floor((l-s)/2)),s,!1))return[s,l];s+=t[0]+t[1],t.copyWithin(0,2,2+i-1),t[i-1]=0,t[i]=0,i--}else i++;t[i]=1,a=!a}throw new N}static toNarrowWidePattern(e){let t,r=e.length,n=0;do{let i=2147483647;for(let t of e)t<i&&t>n&&(i=t);n=i,t=0;let s=0,a=0;for(let o=0;o<r;o++){let i=e[o];i>n&&(a|=1<<r-1-o,t++,s+=i)}if(3===t){for(let i=0;i<r&&t>0;i++){let r=e[i];if(r>n&&(t--,2*r>=s))return-1}return a}}while(t>3);return-1}static patternToChar(e){for(let t=0;t<Te.CHARACTER_ENCODINGS.length;t++)if(Te.CHARACTER_ENCODINGS[t]===e)return Te.ALPHABET_STRING.charAt(t);if(e===Te.ASTERISK_ENCODING)return"*";throw new N}static decodeExtended(e){let t=e.length,r="";for(let n=0;n<t;n++){let t=e.charAt(n);if("+"===t||"$"===t||"%"===t||"/"===t){let i=e.charAt(n+1),s="\0";switch(t){case"+":if(!(i>="A"&&i<="Z"))throw new E;s=String.fromCharCode(i.charCodeAt(0)+32);break;case"$":if(!(i>="A"&&i<="Z"))throw new E;s=String.fromCharCode(i.charCodeAt(0)-64);break;case"%":if(i>="A"&&i<="E")s=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")s=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")s=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)s="\0";else if("V"===i)s="@";else if("W"===i)s="`";else{if("X"!==i&&"Y"!==i&&"Z"!==i)throw new E;s=""}break;case"/":if(i>="A"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)-32);else{if("Z"!==i)throw new E;s=":"}}r+=s,n++}else r+=t}return r}}Te.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Te.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Te.ASTERISK_ENCODING=148;class Re extends je{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,r){let n=this.decodeStart(t),i=this.decodeEnd(t),s=new T;Re.decodeMiddle(t,n[1],i[0],s);let a=s.toString(),o=null;null!=r&&(o=r.get(_.ALLOWED_LENGTHS)),null==o&&(o=Re.DEFAULT_ALLOWED_LENGTHS);let l=a.length,c=!1,d=0;for(let h of o){if(l===h){c=!0;break}h>d&&(d=h)}if(!c&&l>d&&(c=!0),!c)throw new E;const u=[new fe(n[1],e),new fe(i[0],e)];return new U(a,null,0,u,G.ITF,(new Date).getTime())}static decodeMiddle(e,t,r,n){let i=new Int32Array(10),s=new Int32Array(5),a=new Int32Array(5);for(i.fill(0),s.fill(0),a.fill(0);t<r;){je.recordPattern(e,t,i);for(let e=0;e<5;e++){let t=2*e;s[e]=i[t],a[e]=i[t+1]}let r=Re.decodeDigit(s);n.append(r.toString()),r=this.decodeDigit(a),n.append(r.toString()),i.forEach((function(e){t+=e}))}}decodeStart(e){let t=Re.skipWhiteSpace(e),r=Re.findGuardPattern(e,t,Re.START_PATTERN);return this.narrowLineWidth=(r[1]-r[0])/4,this.validateQuietZone(e,r[0]),r}validateQuietZone(e,t){let r=10*this.narrowLineWidth;r=r<t?r:t;for(let n=t-1;r>0&&n>=0&&!e.get(n);n--)r--;if(0!==r)throw new N}static skipWhiteSpace(e){const t=e.getSize(),r=e.getNextSet(0);if(r===t)throw new N;return r}decodeEnd(e){e.reverse();try{let r,n=Re.skipWhiteSpace(e);try{r=Re.findGuardPattern(e,n,Re.END_PATTERN_REVERSED[0])}catch(t){t instanceof N&&(r=Re.findGuardPattern(e,n,Re.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,r[0]);let i=r[0];return r[0]=e.getSize()-r[1],r[1]=e.getSize()-i,r}finally{e.reverse()}}static findGuardPattern(e,t,r){let n=r.length,i=new Int32Array(n),s=e.getSize(),a=!1,o=0,l=t;i.fill(0);for(let c=t;c<s;c++)if(e.get(c)!==a)i[o]++;else{if(o===n-1){if(je.patternMatchVariance(i,r,Re.MAX_INDIVIDUAL_VARIANCE)<Re.MAX_AVG_VARIANCE)return[l,c];l+=i[0]+i[1],f.arraycopy(i,2,i,0,o-1),i[o-1]=0,i[o]=0,o--}else o++;i[o]=1,a=!a}throw new N}static decodeDigit(e){let t=Re.MAX_AVG_VARIANCE,r=-1,n=Re.PATTERNS.length;for(let i=0;i<n;i++){let n=Re.PATTERNS[i],s=je.patternMatchVariance(e,n,Re.MAX_INDIVIDUAL_VARIANCE);s<t?(t=s,r=i):s===t&&(r=-1)}if(r>=0)return r%10;throw new N}}Re.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Re.MAX_AVG_VARIANCE=.38,Re.MAX_INDIVIDUAL_VARIANCE=.5,Re.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Re.START_PATTERN=Int32Array.from([1,1,1,1]),Re.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Ne extends je{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t,r=!1,n=0,i=Int32Array.from([0,0,0]);for(;!r;){i=Int32Array.from([0,0,0]),t=Ne.findGuardPattern(e,n,!1,this.START_END_PATTERN,i);let s=t[0];n=t[1];let a=s-(n-s);a>=0&&(r=e.isRange(a,s,!1))}return t}static checkChecksum(e){return Ne.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return Ne.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new E;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new E;r+=t}return(1e3-r)%10}static decodeEnd(e,t){return Ne.findGuardPattern(e,t,!1,Ne.START_END_PATTERN,new Int32Array(Ne.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,r,n){return this.findGuardPattern(e,t,r,n,new Int32Array(n.length))}static findGuardPattern(e,t,r,n,i){let s=e.getSize(),a=0,o=t=r?e.getNextUnset(t):e.getNextSet(t),l=n.length,c=r;for(let d=t;d<s;d++)if(e.get(d)!==c)i[a]++;else{if(a===l-1){if(je.patternMatchVariance(i,n,Ne.MAX_INDIVIDUAL_VARIANCE)<Ne.MAX_AVG_VARIANCE)return Int32Array.from([o,d]);o+=i[0]+i[1];let e=i.slice(2,i.length-1);for(let t=0;t<a-1;t++)i[t]=e[t];i[a-1]=0,i[a]=0,a--}else a++;i[a]=1,c=!c}throw new N}static decodeDigit(e,t,r,n){this.recordPattern(e,r,t);let i=this.MAX_AVG_VARIANCE,s=-1,a=n.length;for(let o=0;o<a;o++){let e=n[o],r=je.patternMatchVariance(t,e,Ne.MAX_INDIVIDUAL_VARIANCE);r<i&&(i=r,s=o)}if(s>=0)return s;throw new N}}Ne.MAX_AVG_VARIANCE=.48,Ne.MAX_INDIVIDUAL_VARIANCE=.7,Ne.START_END_PATTERN=Int32Array.from([1,1,1]),Ne.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Ne.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Ne.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class De{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=De.parseExtensionString(s),o=[new fe((r[0]+r[1])/2,e),new fe(i,e)],l=new U(s,null,0,o,G.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let l=0;l<5&&s<i;l++){let t=Ne.decodeDigit(e,n,s,Ne.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<4-l),4!==l&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(5!==r.length)throw new N;let o=this.determineCheckDigit(a);if(De.extensionChecksum(r.toString())!==o)throw new N;return s}static extensionChecksum(e){let t=e.length,r=0;for(let n=t-2;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);r*=3;for(let n=t-1;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);return r*=3,r%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new N}static parseExtensionString(e){if(5!==e.length)return null;let t=De.parseExtension5String(e);return null==t?null:new Map([[ne.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="Â£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}let r=parseInt(e.substring(1)),n=r%100;return t+(r/100).toString()+"."+(n<10?"0"+n:n.toString())}}class Oe{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=Oe.parseExtensionString(s),o=[new fe((r[0]+r[1])/2,e),new fe(i,e)],l=new U(s,null,0,o,G.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let o=0;o<2&&s<i;o++){let t=Ne.decodeDigit(e,n,s,Ne.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<1-o),1!==o&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(2!==r.length)throw new N;if(parseInt(r.toString())%4!==a)throw new N;return s}static parseExtensionString(e){return 2!==e.length?null:new Map([[ne.ISSUE_NUMBER,parseInt(e)]])}}class Pe{static decodeRow(e,t,r){let n=Ne.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new De).decodeRow(e,t,n)}catch(i){return(new Oe).decodeRow(e,t,n)}}}Pe.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Me extends Ne{constructor(){super(),this.decodeRowStringBuffer="",Me.L_AND_G_PATTERNS=Me.L_PATTERNS.map((e=>Int32Array.from(e)));for(let e=10;e<20;e++){let t=Me.L_PATTERNS[e-10],r=new Int32Array(t.length);for(let e=0;e<t.length;e++)r[e]=t[t.length-e-1];Me.L_AND_G_PATTERNS[e]=r}}decodeRow(e,t,r){let n=Me.findStartGuardPattern(t),i=null==r?null:r.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=i){const t=new fe((n[0]+n[1])/2,e);i.foundPossibleResultPoint(t)}let s=this.decodeMiddle(t,n,this.decodeRowStringBuffer),a=s.rowOffset,o=s.resultString;if(null!=i){const t=new fe(a,e);i.foundPossibleResultPoint(t)}let l=this.decodeEnd(t,a);if(null!=i){const t=new fe((l[0]+l[1])/2,e);i.foundPossibleResultPoint(t)}let c=l[1],d=c+(c-l[0]);if(d>=t.getSize()||!t.isRange(c,d,!1))throw new N;let u=o.toString();if(u.length<8)throw new E;if(!Me.checkChecksum(u))throw new p;let h=(n[1]+n[0])/2,m=(l[1]+l[0])/2,f=this.getBarcodeFormat(),g=[new fe(h,e),new fe(m,e)],x=new U(u,null,0,g,f,(new Date).getTime()),y=0;try{let r=Pe.decodeRow(e,t,l[1]);x.putMetadata(ne.UPC_EAN_EXTENSION,r.getText()),x.putAllMetadata(r.getResultMetadata()),x.addResultPoints(r.getResultPoints()),y=r.getText().length}catch(b){}let w=null==r?null:r.get(_.ALLOWED_EAN_EXTENSIONS);if(null!=w){let e=!1;for(let t in w)if(y.toString()===t){e=!0;break}if(!e)throw new N}return x}decodeEnd(e,t){return Me.findGuardPattern(e,t,!1,Me.START_END_PATTERN,new Int32Array(Me.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return Me.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return Me.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new E;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new E;r+=t}return(1e3-r)%10}}class ke extends Me{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let o=0;o<6&&s<i;o++){let t=Me.decodeDigit(e,n,s,Me.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<5-o)}r=ke.determineFirstDigit(r,a),s=Me.findGuardPattern(e,s,!0,Me.MIDDLE_PATTERN,new Int32Array(Me.MIDDLE_PATTERN.length).fill(0))[1];for(let o=0;o<6&&s<i;o++){let t=Me.decodeDigit(e,n,s,Me.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return G.EAN_13}static determineFirstDigit(e,t){for(let r=0;r<10;r++)if(t===this.FIRST_DIGIT_ENCODINGS[r])return e=String.fromCharCode("0".charCodeAt(0)+r)+e;throw new N}}ke.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Be extends Me{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){const n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1];for(let a=0;a<4&&s<i;a++){let t=Me.decodeDigit(e,n,s,Me.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}s=Me.findGuardPattern(e,s,!0,Me.MIDDLE_PATTERN,new Int32Array(Me.MIDDLE_PATTERN.length).fill(0))[1];for(let a=0;a<4&&s<i;a++){let t=Me.decodeDigit(e,n,s,Me.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return G.EAN_8}}class Le extends Me{constructor(){super(...arguments),this.ean13Reader=new ke}getBarcodeFormat(){return G.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,r){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,r))}decodeMiddle(e,t,r){return this.ean13Reader.decodeMiddle(e,t,r)}maybeReturnResult(e){let t=e.getText();if("0"===t.charAt(0)){let r=new U(t.substring(1),null,null,e.getResultPoints(),G.UPC_A);return null!=e.getResultMetadata()&&r.putAllMetadata(e.getResultMetadata()),r}throw new N}reset(){this.ean13Reader.reset()}}class Fe extends Me{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,r){const n=this.decodeMiddleCounters.map((e=>e));n[0]=0,n[1]=0,n[2]=0,n[3]=0;const i=e.getSize();let s=t[1],a=0;for(let o=0;o<6&&s<i;o++){const t=Fe.decodeDigit(e,n,s,Fe.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<5-o)}return{rowOffset:s,resultString:Fe.determineNumSysAndCheckDigit(r,a)}}decodeEnd(e,t){return Fe.findGuardPatternWithoutCounters(e,t,!0,Fe.MIDDLE_END_PATTERN)}checkChecksum(e){return Me.checkChecksum(Fe.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let r=0;r<=1;r++)for(let n=0;n<10;n++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[r][n])return String.fromCharCode("0".charCodeAt(0)+r)+e+String.fromCharCode("0".charCodeAt(0)+n);throw N.getNotFoundInstance()}getBarcodeFormat(){return G.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map((e=>e.charCodeAt(0))),r=new T;r.append(e.charAt(0));let n=t[5];switch(n){case 0:case 1:case 2:r.appendChars(t,0,2),r.append(n),r.append("0000"),r.appendChars(t,2,3);break;case 3:r.appendChars(t,0,3),r.append("00000"),r.appendChars(t,3,2);break;case 4:r.appendChars(t,0,4),r.append("00000"),r.append(t[4]);break;default:r.appendChars(t,0,5),r.append("0000"),r.append(n)}return e.length>=8&&r.append(e.charAt(7)),r.toString()}}Fe.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Fe.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ze extends je{constructor(e){super();let r=null==e?null:e.get(_.POSSIBLE_FORMATS),n=[];t(r)?(n.push(new ke),n.push(new Le),n.push(new Be),n.push(new Fe)):(r.indexOf(G.EAN_13)>-1&&n.push(new ke),r.indexOf(G.UPC_A)>-1&&n.push(new Le),r.indexOf(G.EAN_8)>-1&&n.push(new Be),r.indexOf(G.UPC_E)>-1&&n.push(new Fe)),this.readers=n}decodeRow(e,t,r){for(let i of this.readers)try{const n=i.decodeRow(e,t,r),s=n.getBarcodeFormat()===G.EAN_13&&"0"===n.getText().charAt(0),a=null==r?null:r.get(_.POSSIBLE_FORMATS),o=null==a||a.includes(G.UPC_A);if(s&&o){const e=n.getRawBytes(),t=new U(n.getText().substring(1),e,e?e.length:null,n.getResultPoints(),G.UPC_A);return t.putAllMetadata(n.getResultMetadata()),t}return n}catch(n){}throw new N}reset(){for(let e of this.readers)e.reset()}}class We extends je{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let r=0;r<t.length;r++)if(je.patternMatchVariance(e,t[r],We.MAX_INDIVIDUAL_VARIANCE)<We.MAX_AVG_VARIANCE)return r;throw new N}static count(e){return pe.sum(new Int32Array(e))}static increment(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]>n&&(n=t[i],r=i);e[r]++}static decrement(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]<n&&(n=t[i],r=i);e[r]--}static isFinderPattern(e){let t=e[0]+e[1],r=t/(t+e[2]+e[3]);if(r>=We.MIN_FINDER_PATTERN_RATIO&&r<=We.MAX_FINDER_PATTERN_RATIO){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n of e)n>r&&(r=n),n<t&&(t=n);return r<10*t}return!1}}We.MAX_AVG_VARIANCE=.2,We.MAX_INDIVIDUAL_VARIANCE=.45,We.MIN_FINDER_PATTERN_RATIO=9.5/12,We.MAX_FINDER_PATTERN_RATIO=12.5/14;class Ue{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof Ue))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Ve{constructor(e,t,r,n,i){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new fe(r,i)),this.resultPoints.push(new fe(n,i))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Ve))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class He{constructor(){}static getRSSvalue(e,t,r){let n=0;for(let o of e)n+=o;let i=0,s=0,a=e.length;for(let o=0;o<a-1;o++){let l;for(l=1,s|=1<<o;l<e[o];l++,s&=~(1<<o)){let e=He.combins(n-l-1,a-o-2);if(r&&0===s&&n-l-(a-o-1)>=a-o-1&&(e-=He.combins(n-l-(a-o),a-o-2)),a-o-1>1){let r=0;for(let e=n-l-(a-o-2);e>t;e--)r+=He.combins(n-l-e-1,a-o-3);e-=r*(a-1-o)}else n-l>t&&e--;i+=e}n-=l}return i}static combins(e,t){let r,n;e-t>t?(n=t,r=e-t):(n=e-t,r=t);let i=1,s=1;for(let a=e;a>r;a--)i*=a,s<=n&&(i/=s,s++);for(;s<=n;)i/=s,s++;return i}}class Ge{static buildBitArray(e){let t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);let r=new b(12*t),n=0,i=e[0].getRightChar().getValue();for(let s=11;s>=0;--s)i&1<<s&&r.set(n),n++;for(let s=1;s<e.length;++s){let t=e[s],i=t.getLeftChar().getValue();for(let e=11;e>=0;--e)i&1<<e&&r.set(n),n++;if(null!=t.getRightChar()){let e=t.getRightChar().getValue();for(let t=11;t>=0;--t)e&1<<t&&r.set(n),n++}}return r}}class qe{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class $e{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class Xe extends $e{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===Xe.FNC1}}Xe.FNC1="$";class Ye extends $e{constructor(e,t,r){super(e),r?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Ze extends $e{constructor(e,t,r){if(super(e),t<0||t>10||r<0||r>10)throw new E;this.firstDigit=t,this.secondDigit=r}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Ze.FNC1}isSecondDigitFNC1(){return this.secondDigit===Ze.FNC1}isAnyFNC1(){return this.firstDigit===Ze.FNC1||this.secondDigit===Ze.FNC1}}Ze.FNC1=10;class Ke{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new N;let t=e.substring(0,2);for(let i of Ke.TWO_DIGIT_DATA_LENGTH)if(i[0]===t)return i[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(2,i[2],e):Ke.processFixedAI(2,i[1],e);if(e.length<3)throw new N;let r=e.substring(0,3);for(let i of Ke.THREE_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(3,i[2],e):Ke.processFixedAI(3,i[1],e);for(let i of Ke.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(4,i[2],e):Ke.processFixedAI(4,i[1],e);if(e.length<4)throw new N;let n=e.substring(0,4);for(let i of Ke.FOUR_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Ke.VARIABLE_LENGTH?Ke.processVariableAI(4,i[2],e):Ke.processFixedAI(4,i[1],e);throw new N}static processFixedAI(e,t,r){if(r.length<e)throw new N;let n=r.substring(0,e);if(r.length<e+t)throw new N;let i=r.substring(e,e+t),s=r.substring(e+t),a="("+n+")"+i,o=Ke.parseFieldsInGeneralPurpose(s);return null==o?a:a+o}static processVariableAI(e,t,r){let n,i=r.substring(0,e);n=r.length<e+t?r.length:e+t;let s=r.substring(e,n),a=r.substring(n),o="("+i+")"+s,l=Ke.parseFieldsInGeneralPurpose(a);return null==l?o:o+l}}Ke.VARIABLE_LENGTH=[],Ke.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Ke.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Ke.VARIABLE_LENGTH,20],["22",Ke.VARIABLE_LENGTH,29],["30",Ke.VARIABLE_LENGTH,8],["37",Ke.VARIABLE_LENGTH,8],["90",Ke.VARIABLE_LENGTH,30],["91",Ke.VARIABLE_LENGTH,30],["92",Ke.VARIABLE_LENGTH,30],["93",Ke.VARIABLE_LENGTH,30],["94",Ke.VARIABLE_LENGTH,30],["95",Ke.VARIABLE_LENGTH,30],["96",Ke.VARIABLE_LENGTH,30],["97",Ke.VARIABLE_LENGTH,3],["98",Ke.VARIABLE_LENGTH,30],["99",Ke.VARIABLE_LENGTH,30]],Ke.THREE_DIGIT_DATA_LENGTH=[["240",Ke.VARIABLE_LENGTH,30],["241",Ke.VARIABLE_LENGTH,30],["242",Ke.VARIABLE_LENGTH,6],["250",Ke.VARIABLE_LENGTH,30],["251",Ke.VARIABLE_LENGTH,30],["253",Ke.VARIABLE_LENGTH,17],["254",Ke.VARIABLE_LENGTH,20],["400",Ke.VARIABLE_LENGTH,30],["401",Ke.VARIABLE_LENGTH,30],["402",17],["403",Ke.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Ke.VARIABLE_LENGTH,20],["421",Ke.VARIABLE_LENGTH,15],["422",3],["423",Ke.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Ke.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Ke.VARIABLE_LENGTH,15],["391",Ke.VARIABLE_LENGTH,18],["392",Ke.VARIABLE_LENGTH,15],["393",Ke.VARIABLE_LENGTH,18],["703",Ke.VARIABLE_LENGTH,30]],Ke.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Ke.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Ke.VARIABLE_LENGTH,20],["8003",Ke.VARIABLE_LENGTH,30],["8004",Ke.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Ke.VARIABLE_LENGTH,30],["8008",Ke.VARIABLE_LENGTH,12],["8018",18],["8020",Ke.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Ke.VARIABLE_LENGTH,70],["8200",Ke.VARIABLE_LENGTH,70]];class Qe{constructor(e){this.buffer=new T,this.information=e}decodeAllCodes(e,t){let r=t,n=null;for(;;){let t=this.decodeGeneralPurposeField(r,n),i=Ke.parseFieldsInGeneralPurpose(t.getNewString());if(null!=i&&e.append(i),n=t.isRemaining()?""+t.getRemainingValue():null,r===t.getNewPosition())break;r=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return new Ze(this.information.getSize(),0===t?Ze.FNC1:t-1,Ze.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new Ze(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return Qe.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,r){let n=0;for(let i=0;i<r;++i)e.get(t+i)&&(n|=1<<r-i-1);return n}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let r=this.parseBlocks();return null!=r&&r.isRemaining()?new Ye(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new Ye(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let r=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),r===this.current.getPosition()&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return t=e.isSecondDigitFNC1()?new Ye(this.current.getPosition(),this.buffer.toString()):new Ye(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new qe(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let e=new Ye(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new qe(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Ye(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new qe(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Ye(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new qe(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,8);return n>=232&&n<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Xe(e+5,Xe.FNC1);if(t>=5&&t<15)return new Xe(e+5,"0"+(t-5));let r,n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<90)return new Xe(e+7,""+(n+1));if(n>=90&&n<116)return new Xe(e+7,""+(n+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:r="!";break;case 233:r='"';break;case 234:r="%";break;case 235:r="&";break;case 236:r="'";break;case 237:r="(";break;case 238:r=")";break;case 239:r="*";break;case 240:r="+";break;case 241:r=",";break;case 242:r="-";break;case 243:r=".";break;case 244:r="/";break;case 245:r=":";break;case 246:r=";";break;case 247:r="<";break;case 248:r="=";break;case 249:r=">";break;case 250:r="?";break;case 251:r="_";break;case 252:r=" ";break;default:throw new E}return new Xe(e+8,r)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new Xe(e+5,Xe.FNC1);if(t>=5&&t<15)return new Xe(e+5,"0"+(t-5));let r,n=this.extractNumericValueFromBitArray(e,6);if(n>=32&&n<58)return new Xe(e+6,""+(n+33));switch(n){case 58:r="*";break;case 59:r=",";break;case 60:r="-";break;case 61:r=".";break;case 62:r="/";break;default:throw new de("Decoding invalid alphanumeric value: "+n)}return new Xe(e+6,r)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class Je{constructor(e){this.information=e,this.generalDecoder=new Qe(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class et extends Je{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let r=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,r)}encodeCompressedGtinWithoutAI(e,t,r){for(let n=0;n<4;++n){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*n,10);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r)}et.appendCheckDigit(e,r)}static appendCheckDigit(e,t){let r=0;for(let n=0;n<13;n++){let i=e.charAt(n+t).charCodeAt(0)-"0".charCodeAt(0);r+=1&n?i:3*i}r=10-r%10,10===r&&(r=0),e.append(r)}}et.GTIN_SIZE=40;class tt extends et{constructor(e){super(e)}parseInformation(){let e=new T;e.append("(01)");let t=e.length(),r=this.getGeneralDecoder().extractNumericValueFromBitArray(tt.HEADER_SIZE,4);return e.append(r),this.encodeCompressedGtinWithoutAI(e,tt.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,tt.HEADER_SIZE+44)}}tt.HEADER_SIZE=4;class rt extends Je{constructor(e){super(e)}parseInformation(){let e=new T;return this.getGeneralDecoder().decodeAllCodes(e,rt.HEADER_SIZE)}}rt.HEADER_SIZE=5;class nt extends et{constructor(e){super(e)}encodeCompressedWeight(e,t,r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,r);this.addWeightCode(e,n);let i=this.checkWeight(n),s=1e5;for(let a=0;a<5;++a)i/s===0&&e.append("0"),s/=10;e.append(i)}}class it extends nt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=it.HEADER_SIZE+nt.GTIN_SIZE+it.WEIGHT_SIZE)throw new N;let e=new T;return this.encodeCompressedGtin(e,it.HEADER_SIZE),this.encodeCompressedWeight(e,it.HEADER_SIZE+nt.GTIN_SIZE,it.WEIGHT_SIZE),e.toString()}}it.HEADER_SIZE=5,it.WEIGHT_SIZE=15;class st extends it{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class at extends it{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class ot extends et{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<ot.HEADER_SIZE+et.GTIN_SIZE)throw new N;let e=new T;this.encodeCompressedGtin(e,ot.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(ot.HEADER_SIZE+et.GTIN_SIZE,ot.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let r=this.getGeneralDecoder().decodeGeneralPurposeField(ot.HEADER_SIZE+et.GTIN_SIZE+ot.LAST_DIGIT_SIZE,null);return e.append(r.getNewString()),e.toString()}}ot.HEADER_SIZE=8,ot.LAST_DIGIT_SIZE=2;class lt extends et{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<lt.HEADER_SIZE+et.GTIN_SIZE)throw new N;let e=new T;this.encodeCompressedGtin(e,lt.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(lt.HEADER_SIZE+et.GTIN_SIZE,lt.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let r=this.getGeneralDecoder().extractNumericValueFromBitArray(lt.HEADER_SIZE+et.GTIN_SIZE+lt.LAST_DIGIT_SIZE,lt.FIRST_THREE_DIGITS_SIZE);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r);let n=this.getGeneralDecoder().decodeGeneralPurposeField(lt.HEADER_SIZE+et.GTIN_SIZE+lt.LAST_DIGIT_SIZE+lt.FIRST_THREE_DIGITS_SIZE,null);return e.append(n.getNewString()),e.toString()}}lt.HEADER_SIZE=8,lt.LAST_DIGIT_SIZE=2,lt.FIRST_THREE_DIGITS_SIZE=10;class ct extends nt{constructor(e,t,r){super(e),this.dateCode=r,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=ct.HEADER_SIZE+ct.GTIN_SIZE+ct.WEIGHT_SIZE+ct.DATE_SIZE)throw new N;let e=new T;return this.encodeCompressedGtin(e,ct.HEADER_SIZE),this.encodeCompressedWeight(e,ct.HEADER_SIZE+ct.GTIN_SIZE,ct.WEIGHT_SIZE),this.encodeCompressedDate(e,ct.HEADER_SIZE+ct.GTIN_SIZE+ct.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,ct.DATE_SIZE);if(38400==r)return;e.append("("),e.append(this.dateCode),e.append(")");let n=r%32;r/=32;let i=r%12+1;r/=12;let s=r;s/10==0&&e.append("0"),e.append(s),i/10==0&&e.append("0"),e.append(i),n/10==0&&e.append("0"),e.append(n)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}function dt(e){try{if(e.get(1))return new tt(e);if(!e.get(2))return new rt(e);switch(Qe.extractNumericValueFromBitArray(e,1,4)){case 4:return new st(e);case 5:return new at(e)}switch(Qe.extractNumericValueFromBitArray(e,1,5)){case 12:return new ot(e);case 13:return new lt(e)}switch(Qe.extractNumericValueFromBitArray(e,1,7)){case 56:return new ct(e,"310","11");case 57:return new ct(e,"320","11");case 58:return new ct(e,"310","13");case 59:return new ct(e,"320","13");case 60:return new ct(e,"310","15");case 61:return new ct(e,"320","15");case 62:return new ct(e,"310","17");case 63:return new ct(e,"320","17")}}catch(t){throw console.log(t),new de("unknown decoder: "+e)}}ct.HEADER_SIZE=8,ct.WEIGHT_SIZE=20,ct.DATE_SIZE=16;class ut{constructor(e,t,r,n){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=n}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof ut&&ut.equalsOrNull(e.leftchar,t.leftchar)&&ut.equalsOrNull(e.rightchar,t.rightchar)&&ut.equalsOrNull(e.finderpattern,t.finderpattern)}static equalsOrNull(e,t){return null===e?null===t:ut.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class ht{constructor(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof ht&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed}checkEqualitity(e,t){if(!e||!t)return;let r;return e.forEach(((e,n)=>{t.forEach((t=>{e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(r=!0)}))})),r}}class pt extends We{constructor(e){super(...arguments),this.pairs=new Array(pt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===e}decodeRow(e,t,r){this.pairs.length=0,this.startFromEven=!1;try{return pt.constructResult(this.decodeRow2pairs(e,t))}catch(n){this.verbose&&console.log(n)}return this.pairs.length=0,this.startFromEven=!0,pt.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let r,n=!1;for(;!n;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(i){if(i instanceof N){if(!this.pairs.length)throw new N;n=!0}}if(this.checkChecksum())return this.pairs;if(r=!!this.rows.length,this.storeRow(e,!1),r){let e=this.checkRowsBoolean(!1);if(null!=e)return e;if(e=this.checkRowsBoolean(!0),null!=e)return e}throw new N}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(r){this.verbose&&console.log(r)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let n=t;n<this.rows.length;n++){let t=this.rows[n];this.pairs.length=0;for(let r of e)this.pairs.push(r.getPairs());if(this.pairs.push(t.getPairs()),!pt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let i=new Array(e);i.push(t);try{return this.checkRows(i,n+1)}catch(r){this.verbose&&console.log(r)}}throw new N}static isValidSequence(e){for(let t of pt.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let r=!0;for(let n=0;n<e.length;n++)if(e[n].getFinderPattern().getValue()!=t[n]){r=!1;break}if(r)return!0}return!1}storeRow(e,t){let r=0,n=!1,i=!1;for(;r<this.rows.length;){let t=this.rows[r];if(t.getRowNumber()>e){i=t.isEquivalent(this.pairs);break}n=t.isEquivalent(this.pairs),r++}i||n||pt.isPartialRow(this.pairs,this.rows)||(this.rows.push(r,new ht(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let r of t)if(r.getPairs().length!==e.length)for(let t of r.getPairs())for(let r of e)if(ut.equals(t,r))break}static isPartialRow(e,t){for(let r of t){let t=!0;for(let n of e){let e=!1;for(let t of r.getPairs())if(n.equals(t)){e=!0;break}if(!e){t=!1;break}}if(t)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=dt(Ge.buildBitArray(e)).parseInformation(),r=e[0].getFinderPattern().getResultPoints(),n=e[e.length-1].getFinderPattern().getResultPoints(),i=[r[0],r[1],n[0],n[1]];return new U(t,null,null,i,G.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),r=e.getRightChar();if(null==r)return!1;let n=r.getChecksumPortion(),i=2;for(let s=1;s<this.pairs.size();++s){let e=this.pairs.get(s);n+=e.getLeftChar().getChecksumPortion(),i++;let t=e.getRightChar();null!=t&&(n+=t.getChecksumPortion(),i++)}return n%=211,211*(i-4)+n==t.getValue()}static getNextSecondBar(e,t){let r;return e.get(t)?(r=e.getNextUnset(t),r=e.getNextSet(r)):(r=e.getNextSet(t),r=e.getNextUnset(r)),r}retrieveNextPair(e,t,r){let n,i=t.length%2==0;this.startFromEven&&(i=!i);let s=!0,a=-1;do{this.findNextPair(e,t,a),n=this.parseFoundFinderPattern(e,r,i),null==n?a=pt.getNextSecondBar(e,this.startEnd[0]):s=!1}while(s);let o,l=this.decodeDataCharacter(e,n,i,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new N;try{o=this.decodeDataCharacter(e,n,i,!1)}catch(c){o=null,this.verbose&&console.log(c)}return new ut(l,o,n,!0)}isEmptyPair(e){return 0===e.length}findNextPair(e,t,r){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i,s=e.getSize();i=r>=0?r:this.isEmptyPair(t)?0:t[t.length-1].getFinderPattern().getStartEnd()[1];let a=t.length%2!=0;this.startFromEven&&(a=!a);let o=!1;for(;i<s&&(o=!e.get(i),o);)i++;let l=0,c=i;for(let d=i;d<s;d++)if(e.get(d)!=o)n[l]++;else{if(3==l){if(a&&pt.reverseCounters(n),pt.isFinderPattern(n))return this.startEnd[0]=c,void(this.startEnd[1]=d);a&&pt.reverseCounters(n),c+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,l--}else l++;n[l]=1,o=!o}throw new N}static reverseCounters(e){let t=e.length;for(let r=0;r<t/2;++r){let n=e[r];e[r]=e[t-r-1],e[t-r-1]=n}}parseFoundFinderPattern(e,t,r){let n,i,s;if(r){let t=this.startEnd[0]-1;for(;t>=0&&!e.get(t);)t--;t++,n=this.startEnd[0]-t,i=t,s=this.startEnd[1]}else i=this.startEnd[0],s=e.getNextUnset(this.startEnd[1]+1),n=s-this.startEnd[1];let a,o=this.getDecodeFinderCounters();f.arraycopy(o,0,o,1,o.length-1),o[0]=n;try{a=this.parseFinderValue(o,pt.FINDER_PATTERNS)}catch(l){return null}return new Ve(a,[i,s],i,s,t)}decodeDataCharacter(e,t,r,n){let i=this.getDataCharacterCounters();for(let E=0;E<i.length;E++)i[E]=0;if(n)pt.recordPatternInReverse(e,t.getStartEnd()[0],i);else{pt.recordPattern(e,t.getStartEnd()[1],i);for(let e=0,t=i.length-1;e<t;e++,t--){let r=i[e];i[e]=i[t],i[t]=r}}let s=17,a=pe.sum(new Int32Array(i))/s,o=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(a-o)/o>.3)throw new N;let l=this.getOddCounts(),c=this.getEvenCounts(),d=this.getOddRoundingErrors(),u=this.getEvenRoundingErrors();for(let E=0;E<i.length;E++){let e=1*i[E]/a,t=e+.5;if(t<1){if(e<.3)throw new N;t=1}else if(t>8){if(e>8.7)throw new N;t=8}let r=E/2;1&E?(c[r]=t,u[r]=e-t):(l[r]=t,d[r]=e-t)}this.adjustOddEvenCounts(s);let h=4*t.getValue()+(r?0:2)+(n?0:1)-1,p=0,m=0;for(let E=l.length-1;E>=0;E--){if(pt.isNotA1left(t,r,n)){let e=pt.WEIGHTS[h][2*E];m+=l[E]*e}p+=l[E]}let f=0;for(let E=c.length-1;E>=0;E--)if(pt.isNotA1left(t,r,n)){let e=pt.WEIGHTS[h][2*E+1];f+=c[E]*e}let g=m+f;if(1&p||p>13||p<4)throw new N;let x=(13-p)/2,y=pt.SYMBOL_WIDEST[x],w=9-y,b=He.getRSSvalue(l,y,!0),v=He.getRSSvalue(c,w,!1),C=pt.EVEN_TOTAL_SUBSET[x],_=pt.GSUM[x];return new Ue(b*C+v+_,g)}static isNotA1left(e,t,r){return!(0==e.getValue()&&t&&r)}adjustOddEvenCounts(e){let t=pe.sum(new Int32Array(this.getOddCounts())),r=pe.sum(new Int32Array(this.getEvenCounts())),n=!1,i=!1;t>13?i=!0:t<4&&(n=!0);let s=!1,a=!1;r>13?a=!0:r<4&&(s=!0);let o=t+r-e,l=!(1&~t),c=!(1&r);if(1==o)if(l){if(c)throw new N;i=!0}else{if(!c)throw new N;a=!0}else if(-1==o)if(l){if(c)throw new N;n=!0}else{if(!c)throw new N;s=!0}else{if(0!=o)throw new N;if(l){if(!c)throw new N;t<r?(n=!0,a=!0):(i=!0,s=!0)}else if(c)throw new N}if(n){if(i)throw new N;pt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&pt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),s){if(a)throw new N;pt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}a&&pt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}pt.SYMBOL_WIDEST=[7,5,4,3,1],pt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],pt.GSUM=[0,348,1388,2948,3988],pt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],pt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],pt.FINDER_PAT_A=0,pt.FINDER_PAT_B=1,pt.FINDER_PAT_C=2,pt.FINDER_PAT_D=3,pt.FINDER_PAT_E=4,pt.FINDER_PAT_F=5,pt.FINDER_PATTERN_SEQUENCES=[[pt.FINDER_PAT_A,pt.FINDER_PAT_A],[pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B],[pt.FINDER_PAT_A,pt.FINDER_PAT_C,pt.FINDER_PAT_B,pt.FINDER_PAT_D],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_C],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_D,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_D],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_E],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F]],pt.MAX_PAIRS=11;class mt extends Ue{constructor(e,t,r){super(e,t),this.count=0,this.finderPattern=r}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ft extends We{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,r){const n=this.decodePair(t,!1,e,r);ft.addOrTally(this.possibleLeftPairs,n),t.reverse();let i=this.decodePair(t,!0,e,r);ft.addOrTally(this.possibleRightPairs,i),t.reverse();for(let s of this.possibleLeftPairs)if(s.getCount()>1)for(let e of this.possibleRightPairs)if(e.getCount()>1&&ft.checkChecksum(s,e))return ft.constructResult(s,e);throw new N}static addOrTally(e,t){if(null==t)return;let r=!1;for(let n of e)if(n.getValue()===t.getValue()){n.incrementCount(),r=!0;break}r||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let r=4537077*e.getValue()+t.getValue(),n=new String(r).toString(),i=new T;for(let l=13-n.length;l>0;l--)i.append("0");i.append(n);let s=0;for(let l=0;l<13;l++){let e=i.charAt(l).charCodeAt(0)-"0".charCodeAt(0);s+=1&l?e:3*e}s=10-s%10,10===s&&(s=0),i.append(s.toString());let a=e.getFinderPattern().getResultPoints(),o=t.getFinderPattern().getResultPoints();return new U(i.toString(),null,0,[a[0],a[1],o[0],o[1]],G.RSS_14,(new Date).getTime())}static checkChecksum(e,t){let r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n}decodePair(e,t,r,n){try{let i=this.findFinderPattern(e,t),s=this.parseFoundFinderPattern(e,r,t,i),a=null==n?null:n.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=a){let n=(i[0]+i[1])/2;t&&(n=e.getSize()-1-n),a.foundPossibleResultPoint(new fe(n,r))}let o=this.decodeDataCharacter(e,s,!0),l=this.decodeDataCharacter(e,s,!1);return new mt(1597*o.getValue()+l.getValue(),o.getChecksumPortion()+4*l.getChecksumPortion(),s)}catch(i){return null}}decodeDataCharacter(e,t,r){let n=this.getDataCharacterCounters();for(let f=0;f<n.length;f++)n[f]=0;if(r)je.recordPatternInReverse(e,t.getStartEnd()[0],n);else{je.recordPattern(e,t.getStartEnd()[1]+1,n);for(let e=0,t=n.length-1;e<t;e++,t--){let r=n[e];n[e]=n[t],n[t]=r}}let i=r?16:15,s=pe.sum(new Int32Array(n))/i,a=this.getOddCounts(),o=this.getEvenCounts(),l=this.getOddRoundingErrors(),c=this.getEvenRoundingErrors();for(let f=0;f<n.length;f++){let e=n[f]/s,t=Math.floor(e+.5);t<1?t=1:t>8&&(t=8);let r=Math.floor(f/2);1&f?(o[r]=t,c[r]=e-t):(a[r]=t,l[r]=e-t)}this.adjustOddEvenCounts(r,i);let d=0,u=0;for(let f=a.length-1;f>=0;f--)u*=9,u+=a[f],d+=a[f];let h=0,p=0;for(let f=o.length-1;f>=0;f--)h*=9,h+=o[f],p+=o[f];let m=u+3*h;if(r){if(1&d||d>12||d<4)throw new N;let e=(12-d)/2,t=ft.OUTSIDE_ODD_WIDEST[e],r=9-t,n=He.getRSSvalue(a,t,!1),i=He.getRSSvalue(o,r,!0),s=ft.OUTSIDE_EVEN_TOTAL_SUBSET[e],l=ft.OUTSIDE_GSUM[e];return new Ue(n*s+i+l,m)}{if(1&p||p>10||p<4)throw new N;let e=(10-p)/2,t=ft.INSIDE_ODD_WIDEST[e],r=9-t,n=He.getRSSvalue(a,t,!0),i=He.getRSSvalue(o,r,!1),s=ft.INSIDE_ODD_TOTAL_SUBSET[e],l=ft.INSIDE_GSUM[e];return new Ue(i*s+n+l,m)}}findFinderPattern(e,t){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let n=e.getSize(),i=!1,s=0;for(;s<n&&(i=!e.get(s),t!==i);)s++;let a=0,o=s;for(let l=s;l<n;l++)if(e.get(l)!==i)r[a]++;else{if(3===a){if(We.isFinderPattern(r))return[o,l];o+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,i=!i}throw new N}parseFoundFinderPattern(e,t,r,n){let i=e.get(n[0]),s=n[0]-1;for(;s>=0&&i!==e.get(s);)s--;s++;const a=n[0]-s,o=this.getDecodeFinderCounters(),l=new Int32Array(o.length);f.arraycopy(o,0,l,1,o.length-1),l[0]=a;const c=this.parseFinderValue(l,ft.FINDER_PATTERNS);let d=s,u=n[1];return r&&(d=e.getSize()-1-d,u=e.getSize()-1-u),new Ve(c,[s,n[1]],d,u,t)}adjustOddEvenCounts(e,t){let r=pe.sum(new Int32Array(this.getOddCounts())),n=pe.sum(new Int32Array(this.getEvenCounts())),i=!1,s=!1,a=!1,o=!1;e?(r>12?s=!0:r<4&&(i=!0),n>12?o=!0:n<4&&(a=!0)):(r>11?s=!0:r<5&&(i=!0),n>10?o=!0:n<4&&(a=!0));let l=r+n-t,c=(1&r)==(e?1:0),d=!(1&~n);if(1===l)if(c){if(d)throw new N;s=!0}else{if(!d)throw new N;o=!0}else if(-1===l)if(c){if(d)throw new N;i=!0}else{if(!d)throw new N;a=!0}else{if(0!==l)throw new N;if(c){if(!d)throw new N;r<n?(i=!0,o=!0):(s=!0,a=!0)}else if(d)throw new N}if(i){if(s)throw new N;We.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&We.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new N;We.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&We.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ft.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ft.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ft.OUTSIDE_GSUM=[0,161,961,2015,2715],ft.INSIDE_GSUM=[0,336,1036,1516],ft.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ft.INSIDE_ODD_WIDEST=[2,4,6,8],ft.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class gt extends je{constructor(e,t){super(),this.readers=[],this.verbose=!0===t;const r=e?e.get(_.POSSIBLE_FORMATS):null,n=e&&void 0!==e.get(_.ASSUME_CODE_39_CHECK_DIGIT);r?((r.includes(G.EAN_13)||r.includes(G.UPC_A)||r.includes(G.EAN_8)||r.includes(G.UPC_E))&&this.readers.push(new ze(e)),r.includes(G.CODE_39)&&this.readers.push(new Te(n)),r.includes(G.CODE_128)&&this.readers.push(new Ie),r.includes(G.ITF)&&this.readers.push(new Re),r.includes(G.RSS_14)&&this.readers.push(new ft),r.includes(G.RSS_EXPANDED)&&this.readers.push(new pt(this.verbose))):(this.readers.push(new ze(e)),this.readers.push(new Te),this.readers.push(new ze(e)),this.readers.push(new Ie),this.readers.push(new Re),this.readers.push(new ft),this.readers.push(new pt(this.verbose)))}decodeRow(e,t,r){for(let i=0;i<this.readers.length;i++)try{return this.readers[i].decodeRow(e,t,r)}catch(n){}throw new N}reset(){this.readers.forEach((e=>e.reset()))}}class xt extends W{constructor(e=500,t){super(new gt(t),e,t)}}class yt{constructor(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class bt{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class vt{constructor(e,t,r,n,i,s){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=n,this.dataRegionSizeColumns=i,this.ecBlocks=s;let a=0;const o=s.getECCodewords(),l=s.getECBlocks();for(let c of l)a+=c.getCount()*(c.getDataCodewords()+o);this.totalCodewords=a}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if(1&e||1&t)throw new E;for(let r of vt.VERSIONS)if(r.symbolSizeRows===e&&r.symbolSizeColumns===t)return r;throw new E}toString(){return""+this.versionNumber}static buildVersions(){return[new vt(1,10,10,8,8,new yt(5,new bt(1,3))),new vt(2,12,12,10,10,new yt(7,new bt(1,5))),new vt(3,14,14,12,12,new yt(10,new bt(1,8))),new vt(4,16,16,14,14,new yt(12,new bt(1,12))),new vt(5,18,18,16,16,new yt(14,new bt(1,18))),new vt(6,20,20,18,18,new yt(18,new bt(1,22))),new vt(7,22,22,20,20,new yt(20,new bt(1,30))),new vt(8,24,24,22,22,new yt(24,new bt(1,36))),new vt(9,26,26,24,24,new yt(28,new bt(1,44))),new vt(10,32,32,14,14,new yt(36,new bt(1,62))),new vt(11,36,36,16,16,new yt(42,new bt(1,86))),new vt(12,40,40,18,18,new yt(48,new bt(1,114))),new vt(13,44,44,20,20,new yt(56,new bt(1,144))),new vt(14,48,48,22,22,new yt(68,new bt(1,174))),new vt(15,52,52,24,24,new yt(42,new bt(2,102))),new vt(16,64,64,14,14,new yt(56,new bt(2,140))),new vt(17,72,72,16,16,new yt(36,new bt(4,92))),new vt(18,80,80,18,18,new yt(48,new bt(4,114))),new vt(19,88,88,20,20,new yt(56,new bt(4,144))),new vt(20,96,96,22,22,new yt(68,new bt(4,174))),new vt(21,104,104,24,24,new yt(56,new bt(6,136))),new vt(22,120,120,18,18,new yt(68,new bt(6,175))),new vt(23,132,132,20,20,new yt(62,new bt(8,163))),new vt(24,144,144,22,22,new yt(62,new bt(8,156),new bt(2,155))),new vt(25,8,18,6,16,new yt(7,new bt(1,5))),new vt(26,8,32,6,14,new yt(11,new bt(1,10))),new vt(27,12,26,10,24,new yt(14,new bt(1,16))),new vt(28,12,36,10,16,new yt(18,new bt(1,22))),new vt(29,16,36,14,16,new yt(24,new bt(1,32))),new vt(30,16,48,14,22,new yt(28,new bt(1,49)))]}}vt.VERSIONS=vt.buildVersions();class Ct{constructor(e){const t=e.getHeight();if(t<8||t>144||1&t)throw new E;this.version=Ct.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new R(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),r=e.getWidth();return vt.getVersionForDimensions(t,r)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,r=4,n=0;const i=this.mappingBitMatrix.getHeight(),s=this.mappingBitMatrix.getWidth();let a=!1,o=!1,l=!1,c=!1;do{if(r!==i||0!==n||a)if(r===i-2&&0===n&&3&s&&!o)e[t++]=255&this.readCorner2(i,s),r-=2,n+=2,o=!0;else if(r!==i+4||2!==n||7&s||l)if(r!==i-2||0!==n||4!=(7&s)||c){do{r<i&&n>=0&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r-=2,n+=2}while(r>=0&&n<s);r+=1,n+=3;do{r>=0&&n<s&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r+=2,n-=2}while(r<i&&n>=0);r+=3,n+=1}else e[t++]=255&this.readCorner4(i,s),r-=2,n+=2,c=!0;else e[t++]=255&this.readCorner3(i,s),r-=2,n+=2,l=!0;else e[t++]=255&this.readCorner1(i,s),r-=2,n+=2,a=!0}while(r<i||n<s);if(t!==this.version.getTotalCodewords())throw new E;return e}readModule(e,t,r,n){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=n,e+=4-(n+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,r,n){let i=0;return this.readModule(e-2,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-2,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t,r,n)&&(i|=1),i<<=1,this.readModule(e,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e,t,r,n)&&(i|=1),i}readCorner1(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}readCorner2(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner3(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner4(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new u("Dimension of bitMatrix must match the version size");const n=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),s=t/n|0,a=r/i|0,o=new R(a*i,s*n);for(let l=0;l<s;++l){const t=l*n;for(let r=0;r<a;++r){const s=r*i;for(let a=0;a<n;++a){const c=l*(n+2)+1+a,d=t+a;for(let t=0;t<i;++t){const n=r*(i+2)+1+t;if(e.get(n,c)){const e=s+t;o.set(e,d)}}}}}return o}}class _t{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const r=t.getECBlocks();let n=0;const i=r.getECBlocks();for(let u of i)n+=u.getCount();const s=new Array(n);let a=0;for(let u of i)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=r.getECCodewords()+e;s[a++]=new _t(e,new Uint8Array(t))}const o=s[0].codewords.length-r.getECCodewords(),l=o-1;let c=0;for(let u=0;u<l;u++)for(let t=0;t<a;t++)s[t].codewords[u]=e[c++];const d=24===t.getVersionNumber(),h=d?8:a;for(let u=0;u<h;u++)s[u].codewords[o-1]=e[c++];const p=s[0].codewords.length;for(let u=o;u<p;u++)for(let t=0;t<a;t++){const r=d?(t+8)%a:t,n=d&&r>7?u-1:u;s[r].codewords[n]=e[c++]}if(c!==e.length)throw new u;return s}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Et{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new u(""+e);let t=0,r=this.bitOffset,n=this.byteOffset;const i=this.bytes;if(r>0){const s=8-r,a=e<s?e:s,o=s-a,l=255>>8-a<<o;t=(i[n]&l)>>o,e-=a,r+=a,8===r&&(r=0,n++)}if(e>0){for(;e>=8;)t=t<<8|255&i[n],n++,e-=8;if(e>0){const s=8-e,a=255>>s<<s;t=t<<e|(i[n]&a)>>s,r+=e}}return this.bitOffset=r,this.byteOffset=n,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}(J=$||($={}))[J.PAD_ENCODE=0]="PAD_ENCODE",J[J.ASCII_ENCODE=1]="ASCII_ENCODE",J[J.C40_ENCODE=2]="C40_ENCODE",J[J.TEXT_ENCODE=3]="TEXT_ENCODE",J[J.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",J[J.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",J[J.BASE256_ENCODE=6]="BASE256_ENCODE";class At{static decode(e){const t=new Et(e),r=new T,n=new T,i=new Array;let s=$.ASCII_ENCODE;do{if(s===$.ASCII_ENCODE)s=this.decodeAsciiSegment(t,r,n);else{switch(s){case $.C40_ENCODE:this.decodeC40Segment(t,r);break;case $.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case $.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case $.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case $.BASE256_ENCODE:this.decodeBase256Segment(t,r,i);break;default:throw new E}s=$.ASCII_ENCODE}}while(s!==$.PAD_ENCODE&&t.available()>0);return n.length()>0&&r.append(n.toString()),new ie(e,r.toString(),0===i.length?null:i,null)}static decodeAsciiSegment(e,t,r){let n=!1;do{let i=e.readBits(8);if(0===i)throw new E;if(i<=128)return n&&(i+=128),t.append(String.fromCharCode(i-1)),$.ASCII_ENCODE;if(129===i)return $.PAD_ENCODE;if(i<=229){const e=i-130;e<10&&t.append("0"),t.append(""+e)}else switch(i){case 230:return $.C40_ENCODE;case 231:return $.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:n=!0;break;case 236:t.append("[)>05"),r.insert(0,"");break;case 237:t.append("[)>06"),r.insert(0,"");break;case 238:return $.ANSIX12_ENCODE;case 239:return $.TEXT_ENCODE;case 240:return $.EDIFACT_ENCODE;default:if(254!==i||0!==e.available())throw new E}}while(e.available()>0);return $.ASCII_ENCODE}static decodeC40Segment(e,t){let r=!1;const n=[];let i=0;do{if(8===e.available())return;const s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){const s=n[e];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.C40_BASIC_SET_CHARS.length))throw new E;{const e=this.C40_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}}break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.C40_SHIFT2_SET_CHARS.length){const e=this.C40_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new E}i=0;break;case 3:r?(t.append(String.fromCharCode(s+224)),r=!1):t.append(String.fromCharCode(s+96)),i=0;break;default:throw new E}}}while(e.available()>0)}static decodeTextSegment(e,t){let r=!1,n=[],i=0;do{if(8===e.available())return;const s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){const s=n[e];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.TEXT_BASIC_SET_CHARS.length))throw new E;{const e=this.TEXT_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}}break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.TEXT_SHIFT2_SET_CHARS.length){const e=this.TEXT_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new E}i=0;break;case 3:if(!(s<this.TEXT_SHIFT3_SET_CHARS.length))throw new E;{const e=this.TEXT_SHIFT3_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e),i=0}break;default:throw new E}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const r=[];do{if(8===e.available())return;const n=e.readBits(8);if(254===n)return;this.parseTwoBytes(n,e.readBits(8),r);for(let e=0;e<3;e++){const n=r[e];switch(n){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(n<14)t.append(String.fromCharCode(n+44));else{if(!(n<40))throw new E;t.append(String.fromCharCode(n+51))}}}}while(e.available()>0)}static parseTwoBytes(e,t,r){let n=(e<<8)+t-1,i=Math.floor(n/1600);r[0]=i,n-=1600*i,i=Math.floor(n/40),r[1]=i,r[2]=n-40*i}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let r=0;r<4;r++){let r=e.readBits(6);if(31===r){const t=8-e.getBitOffset();return void(8!==t&&e.readBits(t))}32&r||(r|=64),t.append(String.fromCharCode(r))}}while(e.available()>0)}static decodeBase256Segment(e,t,r){let n=1+e.getByteOffset();const i=this.unrandomize255State(e.readBits(8),n++);let s;if(s=0===i?e.available()/8|0:i<250?i:250*(i-249)+this.unrandomize255State(e.readBits(8),n++),s<0)throw new E;const a=new Uint8Array(s);for(let l=0;l<s;l++){if(e.available()<8)throw new E;a[l]=this.unrandomize255State(e.readBits(8),n++)}r.push(a);try{t.append(j.decode(a,I.ISO88591))}catch(o){throw new de("Platform does not support required encoding: "+o.message)}}static unrandomize255State(e,t){const r=e-(149*t%255+1);return r>=0?r:r+256}}At.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],At.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],At.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],At.TEXT_SHIFT2_SET_CHARS=At.C40_SHIFT2_SET_CHARS,At.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class St{constructor(){this.rsDecoder=new ue(le.DATA_MATRIX_FIELD_256)}decode(e){const t=new Ct(e),r=t.getVersion(),n=t.readCodewords(),i=_t.getDataBlocks(n,r);let s=0;for(let l of i)s+=l.getNumDataCodewords();const a=new Uint8Array(s),o=i.length;for(let l=0;l<o;l++){const e=i[l],t=e.getCodewords(),r=e.getNumDataCodewords();this.correctErrors(t,r);for(let n=0;n<r;n++)a[n*o+l]=t[n]}return At.decode(a)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(n){throw new p}for(let i=0;i<t;i++)e[i]=r[i]}}class jt{constructor(e){this.image=e,this.rectangleDetector=new ye(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new N;t=this.shiftToModuleCenter(t);const r=t[0],n=t[1],i=t[2],s=t[3];let a=this.transitionsBetween(r,s)+1,o=this.transitionsBetween(i,s)+1;1&~a||(a+=1),1&~o||(o+=1),4*a<7*o&&4*o<7*a&&(a=o=Math.max(a,o));let l=jt.sampleGrid(this.image,r,n,i,s,a,o);return new ge(l,[r,n,i,s])}static shiftPoint(e,t,r){let n=(t.getX()-e.getX())/(r+1),i=(t.getY()-e.getY())/(r+1);return new fe(e.getX()+n,e.getY()+i)}static moveAway(e,t,r){let n=e.getX(),i=e.getY();return n<t?n-=1:n+=1,i<r?i-=1:i+=1,new fe(n,i)}detectSolid1(e){let t=e[0],r=e[1],n=e[3],i=e[2],s=this.transitionsBetween(t,r),a=this.transitionsBetween(r,n),o=this.transitionsBetween(n,i),l=this.transitionsBetween(i,t),c=s,d=[i,t,r,n];return c>a&&(c=a,d[0]=t,d[1]=r,d[2]=n,d[3]=i),c>o&&(c=o,d[0]=r,d[1]=n,d[2]=i,d[3]=t),c>l&&(d[0]=n,d[1]=i,d[2]=t,d[3]=r),d}detectSolid2(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=jt.shiftPoint(r,n,4*(s+1)),o=jt.shiftPoint(n,r,4*(s+1));return this.transitionsBetween(a,t)<this.transitionsBetween(o,i)?(e[0]=t,e[1]=r,e[2]=n,e[3]=i):(e[0]=r,e[1]=n,e[2]=i,e[3]=t),e}correctTopRight(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=this.transitionsBetween(r,i),o=jt.shiftPoint(t,r,4*(a+1)),l=jt.shiftPoint(n,r,4*(s+1));s=this.transitionsBetween(o,i),a=this.transitionsBetween(l,i);let c=new fe(i.getX()+(n.getX()-r.getX())/(s+1),i.getY()+(n.getY()-r.getY())/(s+1)),d=new fe(i.getX()+(t.getX()-r.getX())/(a+1),i.getY()+(t.getY()-r.getY())/(a+1));return this.isValid(c)?this.isValid(d)?this.transitionsBetween(o,c)+this.transitionsBetween(l,c)>this.transitionsBetween(o,d)+this.transitionsBetween(l,d)?c:d:c:this.isValid(d)?d:null}shiftToModuleCenter(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i)+1,a=this.transitionsBetween(n,i)+1,o=jt.shiftPoint(t,r,4*a),l=jt.shiftPoint(n,r,4*s);s=this.transitionsBetween(o,i)+1,a=this.transitionsBetween(l,i)+1,1&~s||(s+=1),1&~a||(a+=1);let c,d,u=(t.getX()+r.getX()+n.getX()+i.getX())/4,h=(t.getY()+r.getY()+n.getY()+i.getY())/4;return t=jt.moveAway(t,u,h),r=jt.moveAway(r,u,h),n=jt.moveAway(n,u,h),i=jt.moveAway(i,u,h),o=jt.shiftPoint(t,r,4*a),o=jt.shiftPoint(o,i,4*s),c=jt.shiftPoint(r,t,4*a),c=jt.shiftPoint(c,n,4*s),l=jt.shiftPoint(n,i,4*a),l=jt.shiftPoint(l,r,4*s),d=jt.shiftPoint(i,n,4*a),d=jt.shiftPoint(d,t,4*s),[o,c,l,d]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,r,n,i,s,a){return Ce.getInstance().sampleGrid(e,s,a,.5,.5,s-.5,.5,s-.5,a-.5,.5,a-.5,t.getX(),t.getY(),i.getX(),i.getY(),n.getX(),n.getY(),r.getX(),r.getY())}transitionsBetween(e,t){let r=Math.trunc(e.getX()),n=Math.trunc(e.getY()),i=Math.trunc(t.getX()),s=Math.trunc(t.getY()),a=Math.abs(s-n)>Math.abs(i-r);if(a){let e=r;r=n,n=e,e=i,i=s,s=e}let o=Math.abs(i-r),l=Math.abs(s-n),c=-o/2,d=n<s?1:-1,u=r<i?1:-1,h=0,p=this.image.get(a?n:r,a?r:n);for(let m=r,f=n;m!==i;m+=u){let e=this.image.get(a?f:m,a?m:f);if(e!==p&&(h++,p=e),c+=l,c>0){if(f===s)break;f+=d,c-=o}}return h}}class It{constructor(){this.decoder=new St}decode(e,t=null){let r,n;if(null!=t&&t.has(_.PURE_BARCODE)){const t=It.extractPureBits(e.getBlackMatrix());r=this.decoder.decode(t),n=It.NO_POINTS}else{const t=new jt(e.getBlackMatrix()).detect();r=this.decoder.decode(t.getBits()),n=t.getPoints()}const i=r.getRawBytes(),s=new U(r.getText(),i,8*i.length,n,G.DATA_MATRIX,f.currentTimeMillis()),a=r.getByteSegments();null!=a&&s.putMetadata(ne.BYTE_SEGMENTS,a);const o=r.getECLevel();return null!=o&&s.putMetadata(ne.ERROR_CORRECTION_LEVEL,o),s}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null==t||null==r)throw new N;const n=this.moduleSize(t,e);let i=t[1];const s=r[1];let a=t[0];const o=(r[0]-a+1)/n,l=(s-i+1)/n;if(o<=0||l<=0)throw new N;const c=n/2;i+=c,a+=c;const d=new R(o,l);for(let u=0;u<l;u++){const t=i+u*n;for(let r=0;r<o;r++)e.get(a+r*n,t)&&d.set(r,u)}return d}static moduleSize(e,t){const r=t.getWidth();let n=e[0];const i=e[1];for(;n<r&&t.get(n,i);)n++;if(n===r)throw new N;const s=n-e[0];if(0===s)throw new N;return s}}It.NO_POINTS=[];class Tt extends W{constructor(e=500){super(new It,e)}}(ee=X||(X={}))[ee.L=0]="L",ee[ee.M=1]="M",ee[ee.Q=2]="Q",ee[ee.H=3]="H";class Rt{constructor(e,t,r){this.value=e,this.stringValue=t,this.bits=r,Rt.FOR_BITS.set(r,this),Rt.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return Rt.L;case"M":return Rt.M;case"Q":return Rt.Q;case"H":return Rt.H;default:throw new d(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof Rt))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=Rt.FOR_BITS.size)throw new u;return Rt.FOR_BITS.get(e)}}Rt.FOR_BITS=new Map,Rt.FOR_VALUE=new Map,Rt.L=new Rt(X.L,"L",1),Rt.M=new Rt(X.M,"M",0),Rt.Q=new Rt(X.Q,"Q",3),Rt.H=new Rt(X.H,"H",2);class Nt{constructor(e){this.errorCorrectionLevel=Rt.forBits(e>>3&3),this.dataMask=7&e}static numBitsDiffering(e,t){return w.bitCount(e^t)}static decodeFormatInformation(e,t){const r=Nt.doDecodeFormatInformation(e,t);return null!==r?r:Nt.doDecodeFormatInformation(e^Nt.FORMAT_INFO_MASK_QR,t^Nt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let r=Number.MAX_SAFE_INTEGER,n=0;for(const i of Nt.FORMAT_INFO_DECODE_LOOKUP){const s=i[0];if(s===e||s===t)return new Nt(i[1]);let a=Nt.numBitsDiffering(e,s);a<r&&(n=i[1],r=a),e!==t&&(a=Nt.numBitsDiffering(t,s),a<r&&(n=i[1],r=a))}return r<=3?new Nt(n):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof Nt))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}Nt.FORMAT_INFO_MASK_QR=21522,Nt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Dt{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const r of t)e+=r.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Ot{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Pt{constructor(e,t,...r){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=r;let n=0;const i=r[0].getECCodewordsPerBlock(),s=r[0].getECBlocks();for(const a of s)n+=a.getCount()*(a.getDataCodewords()+i);this.totalCodewords=n}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!=1)throw new E;try{return this.getVersionForNumber((e-17)/4)}catch(t){throw new E}}static getVersionForNumber(e){if(e<1||e>40)throw new u;return Pt.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,r=0;for(let n=0;n<Pt.VERSION_DECODE_INFO.length;n++){const i=Pt.VERSION_DECODE_INFO[n];if(i===e)return Pt.getVersionForNumber(n+7);const s=Nt.numBitsDiffering(e,i);s<t&&(r=n+7,t=s)}return t<=3?Pt.getVersionForNumber(r):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new R(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const r=this.alignmentPatternCenters.length;for(let n=0;n<r;n++){const e=this.alignmentPatternCenters[n]-2;for(let i=0;i<r;i++)0===n&&(0===i||i===r-1)||n===r-1&&0===i||t.setRegion(this.alignmentPatternCenters[i]-2,e,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}Pt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Pt.VERSIONS=[new Pt(1,new Int32Array(0),new Dt(7,new Ot(1,19)),new Dt(10,new Ot(1,16)),new Dt(13,new Ot(1,13)),new Dt(17,new Ot(1,9))),new Pt(2,Int32Array.from([6,18]),new Dt(10,new Ot(1,34)),new Dt(16,new Ot(1,28)),new Dt(22,new Ot(1,22)),new Dt(28,new Ot(1,16))),new Pt(3,Int32Array.from([6,22]),new Dt(15,new Ot(1,55)),new Dt(26,new Ot(1,44)),new Dt(18,new Ot(2,17)),new Dt(22,new Ot(2,13))),new Pt(4,Int32Array.from([6,26]),new Dt(20,new Ot(1,80)),new Dt(18,new Ot(2,32)),new Dt(26,new Ot(2,24)),new Dt(16,new Ot(4,9))),new Pt(5,Int32Array.from([6,30]),new Dt(26,new Ot(1,108)),new Dt(24,new Ot(2,43)),new Dt(18,new Ot(2,15),new Ot(2,16)),new Dt(22,new Ot(2,11),new Ot(2,12))),new Pt(6,Int32Array.from([6,34]),new Dt(18,new Ot(2,68)),new Dt(16,new Ot(4,27)),new Dt(24,new Ot(4,19)),new Dt(28,new Ot(4,15))),new Pt(7,Int32Array.from([6,22,38]),new Dt(20,new Ot(2,78)),new Dt(18,new Ot(4,31)),new Dt(18,new Ot(2,14),new Ot(4,15)),new Dt(26,new Ot(4,13),new Ot(1,14))),new Pt(8,Int32Array.from([6,24,42]),new Dt(24,new Ot(2,97)),new Dt(22,new Ot(2,38),new Ot(2,39)),new Dt(22,new Ot(4,18),new Ot(2,19)),new Dt(26,new Ot(4,14),new Ot(2,15))),new Pt(9,Int32Array.from([6,26,46]),new Dt(30,new Ot(2,116)),new Dt(22,new Ot(3,36),new Ot(2,37)),new Dt(20,new Ot(4,16),new Ot(4,17)),new Dt(24,new Ot(4,12),new Ot(4,13))),new Pt(10,Int32Array.from([6,28,50]),new Dt(18,new Ot(2,68),new Ot(2,69)),new Dt(26,new Ot(4,43),new Ot(1,44)),new Dt(24,new Ot(6,19),new Ot(2,20)),new Dt(28,new Ot(6,15),new Ot(2,16))),new Pt(11,Int32Array.from([6,30,54]),new Dt(20,new Ot(4,81)),new Dt(30,new Ot(1,50),new Ot(4,51)),new Dt(28,new Ot(4,22),new Ot(4,23)),new Dt(24,new Ot(3,12),new Ot(8,13))),new Pt(12,Int32Array.from([6,32,58]),new Dt(24,new Ot(2,92),new Ot(2,93)),new Dt(22,new Ot(6,36),new Ot(2,37)),new Dt(26,new Ot(4,20),new Ot(6,21)),new Dt(28,new Ot(7,14),new Ot(4,15))),new Pt(13,Int32Array.from([6,34,62]),new Dt(26,new Ot(4,107)),new Dt(22,new Ot(8,37),new Ot(1,38)),new Dt(24,new Ot(8,20),new Ot(4,21)),new Dt(22,new Ot(12,11),new Ot(4,12))),new Pt(14,Int32Array.from([6,26,46,66]),new Dt(30,new Ot(3,115),new Ot(1,116)),new Dt(24,new Ot(4,40),new Ot(5,41)),new Dt(20,new Ot(11,16),new Ot(5,17)),new Dt(24,new Ot(11,12),new Ot(5,13))),new Pt(15,Int32Array.from([6,26,48,70]),new Dt(22,new Ot(5,87),new Ot(1,88)),new Dt(24,new Ot(5,41),new Ot(5,42)),new Dt(30,new Ot(5,24),new Ot(7,25)),new Dt(24,new Ot(11,12),new Ot(7,13))),new Pt(16,Int32Array.from([6,26,50,74]),new Dt(24,new Ot(5,98),new Ot(1,99)),new Dt(28,new Ot(7,45),new Ot(3,46)),new Dt(24,new Ot(15,19),new Ot(2,20)),new Dt(30,new Ot(3,15),new Ot(13,16))),new Pt(17,Int32Array.from([6,30,54,78]),new Dt(28,new Ot(1,107),new Ot(5,108)),new Dt(28,new Ot(10,46),new Ot(1,47)),new Dt(28,new Ot(1,22),new Ot(15,23)),new Dt(28,new Ot(2,14),new Ot(17,15))),new Pt(18,Int32Array.from([6,30,56,82]),new Dt(30,new Ot(5,120),new Ot(1,121)),new Dt(26,new Ot(9,43),new Ot(4,44)),new Dt(28,new Ot(17,22),new Ot(1,23)),new Dt(28,new Ot(2,14),new Ot(19,15))),new Pt(19,Int32Array.from([6,30,58,86]),new Dt(28,new Ot(3,113),new Ot(4,114)),new Dt(26,new Ot(3,44),new Ot(11,45)),new Dt(26,new Ot(17,21),new Ot(4,22)),new Dt(26,new Ot(9,13),new Ot(16,14))),new Pt(20,Int32Array.from([6,34,62,90]),new Dt(28,new Ot(3,107),new Ot(5,108)),new Dt(26,new Ot(3,41),new Ot(13,42)),new Dt(30,new Ot(15,24),new Ot(5,25)),new Dt(28,new Ot(15,15),new Ot(10,16))),new Pt(21,Int32Array.from([6,28,50,72,94]),new Dt(28,new Ot(4,116),new Ot(4,117)),new Dt(26,new Ot(17,42)),new Dt(28,new Ot(17,22),new Ot(6,23)),new Dt(30,new Ot(19,16),new Ot(6,17))),new Pt(22,Int32Array.from([6,26,50,74,98]),new Dt(28,new Ot(2,111),new Ot(7,112)),new Dt(28,new Ot(17,46)),new Dt(30,new Ot(7,24),new Ot(16,25)),new Dt(24,new Ot(34,13))),new Pt(23,Int32Array.from([6,30,54,78,102]),new Dt(30,new Ot(4,121),new Ot(5,122)),new Dt(28,new Ot(4,47),new Ot(14,48)),new Dt(30,new Ot(11,24),new Ot(14,25)),new Dt(30,new Ot(16,15),new Ot(14,16))),new Pt(24,Int32Array.from([6,28,54,80,106]),new Dt(30,new Ot(6,117),new Ot(4,118)),new Dt(28,new Ot(6,45),new Ot(14,46)),new Dt(30,new Ot(11,24),new Ot(16,25)),new Dt(30,new Ot(30,16),new Ot(2,17))),new Pt(25,Int32Array.from([6,32,58,84,110]),new Dt(26,new Ot(8,106),new Ot(4,107)),new Dt(28,new Ot(8,47),new Ot(13,48)),new Dt(30,new Ot(7,24),new Ot(22,25)),new Dt(30,new Ot(22,15),new Ot(13,16))),new Pt(26,Int32Array.from([6,30,58,86,114]),new Dt(28,new Ot(10,114),new Ot(2,115)),new Dt(28,new Ot(19,46),new Ot(4,47)),new Dt(28,new Ot(28,22),new Ot(6,23)),new Dt(30,new Ot(33,16),new Ot(4,17))),new Pt(27,Int32Array.from([6,34,62,90,118]),new Dt(30,new Ot(8,122),new Ot(4,123)),new Dt(28,new Ot(22,45),new Ot(3,46)),new Dt(30,new Ot(8,23),new Ot(26,24)),new Dt(30,new Ot(12,15),new Ot(28,16))),new Pt(28,Int32Array.from([6,26,50,74,98,122]),new Dt(30,new Ot(3,117),new Ot(10,118)),new Dt(28,new Ot(3,45),new Ot(23,46)),new Dt(30,new Ot(4,24),new Ot(31,25)),new Dt(30,new Ot(11,15),new Ot(31,16))),new Pt(29,Int32Array.from([6,30,54,78,102,126]),new Dt(30,new Ot(7,116),new Ot(7,117)),new Dt(28,new Ot(21,45),new Ot(7,46)),new Dt(30,new Ot(1,23),new Ot(37,24)),new Dt(30,new Ot(19,15),new Ot(26,16))),new Pt(30,Int32Array.from([6,26,52,78,104,130]),new Dt(30,new Ot(5,115),new Ot(10,116)),new Dt(28,new Ot(19,47),new Ot(10,48)),new Dt(30,new Ot(15,24),new Ot(25,25)),new Dt(30,new Ot(23,15),new Ot(25,16))),new Pt(31,Int32Array.from([6,30,56,82,108,134]),new Dt(30,new Ot(13,115),new Ot(3,116)),new Dt(28,new Ot(2,46),new Ot(29,47)),new Dt(30,new Ot(42,24),new Ot(1,25)),new Dt(30,new Ot(23,15),new Ot(28,16))),new Pt(32,Int32Array.from([6,34,60,86,112,138]),new Dt(30,new Ot(17,115)),new Dt(28,new Ot(10,46),new Ot(23,47)),new Dt(30,new Ot(10,24),new Ot(35,25)),new Dt(30,new Ot(19,15),new Ot(35,16))),new Pt(33,Int32Array.from([6,30,58,86,114,142]),new Dt(30,new Ot(17,115),new Ot(1,116)),new Dt(28,new Ot(14,46),new Ot(21,47)),new Dt(30,new Ot(29,24),new Ot(19,25)),new Dt(30,new Ot(11,15),new Ot(46,16))),new Pt(34,Int32Array.from([6,34,62,90,118,146]),new Dt(30,new Ot(13,115),new Ot(6,116)),new Dt(28,new Ot(14,46),new Ot(23,47)),new Dt(30,new Ot(44,24),new Ot(7,25)),new Dt(30,new Ot(59,16),new Ot(1,17))),new Pt(35,Int32Array.from([6,30,54,78,102,126,150]),new Dt(30,new Ot(12,121),new Ot(7,122)),new Dt(28,new Ot(12,47),new Ot(26,48)),new Dt(30,new Ot(39,24),new Ot(14,25)),new Dt(30,new Ot(22,15),new Ot(41,16))),new Pt(36,Int32Array.from([6,24,50,76,102,128,154]),new Dt(30,new Ot(6,121),new Ot(14,122)),new Dt(28,new Ot(6,47),new Ot(34,48)),new Dt(30,new Ot(46,24),new Ot(10,25)),new Dt(30,new Ot(2,15),new Ot(64,16))),new Pt(37,Int32Array.from([6,28,54,80,106,132,158]),new Dt(30,new Ot(17,122),new Ot(4,123)),new Dt(28,new Ot(29,46),new Ot(14,47)),new Dt(30,new Ot(49,24),new Ot(10,25)),new Dt(30,new Ot(24,15),new Ot(46,16))),new Pt(38,Int32Array.from([6,32,58,84,110,136,162]),new Dt(30,new Ot(4,122),new Ot(18,123)),new Dt(28,new Ot(13,46),new Ot(32,47)),new Dt(30,new Ot(48,24),new Ot(14,25)),new Dt(30,new Ot(42,15),new Ot(32,16))),new Pt(39,Int32Array.from([6,26,54,82,110,138,166]),new Dt(30,new Ot(20,117),new Ot(4,118)),new Dt(28,new Ot(40,47),new Ot(7,48)),new Dt(30,new Ot(43,24),new Ot(22,25)),new Dt(30,new Ot(10,15),new Ot(67,16))),new Pt(40,Int32Array.from([6,30,58,86,114,142,170]),new Dt(30,new Ot(19,118),new Ot(6,119)),new Dt(28,new Ot(18,47),new Ot(31,48)),new Dt(30,new Ot(34,24),new Ot(34,25)),new Dt(30,new Ot(20,15),new Ot(61,16)))],(te=Y||(Y={}))[te.DATA_MASK_000=0]="DATA_MASK_000",te[te.DATA_MASK_001=1]="DATA_MASK_001",te[te.DATA_MASK_010=2]="DATA_MASK_010",te[te.DATA_MASK_011=3]="DATA_MASK_011",te[te.DATA_MASK_100=4]="DATA_MASK_100",te[te.DATA_MASK_101=5]="DATA_MASK_101",te[te.DATA_MASK_110=6]="DATA_MASK_110",te[te.DATA_MASK_111=7]="DATA_MASK_111";class Mt{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let r=0;r<t;r++)for(let n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)}}Mt.values=new Map([[Y.DATA_MASK_000,new Mt(Y.DATA_MASK_000,((e,t)=>!(e+t&1)))],[Y.DATA_MASK_001,new Mt(Y.DATA_MASK_001,((e,t)=>!(1&e)))],[Y.DATA_MASK_010,new Mt(Y.DATA_MASK_010,((e,t)=>t%3==0))],[Y.DATA_MASK_011,new Mt(Y.DATA_MASK_011,((e,t)=>(e+t)%3==0))],[Y.DATA_MASK_100,new Mt(Y.DATA_MASK_100,((e,t)=>!(Math.floor(e/2)+Math.floor(t/3)&1)))],[Y.DATA_MASK_101,new Mt(Y.DATA_MASK_101,((e,t)=>e*t%6==0))],[Y.DATA_MASK_110,new Mt(Y.DATA_MASK_110,((e,t)=>e*t%6<3))],[Y.DATA_MASK_111,new Mt(Y.DATA_MASK_111,((e,t)=>!(e+t+e*t%3&1)))]]);class kt{constructor(e){const t=e.getHeight();if(t<21||1!=(3&t))throw new E;this.bitMatrix=e}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let e=0;for(let i=0;i<6;i++)e=this.copyBit(i,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let i=5;i>=0;i--)e=this.copyBit(8,i,e);const t=this.bitMatrix.getHeight();let r=0;const n=t-7;for(let i=t-1;i>=n;i--)r=this.copyBit(8,i,r);for(let i=t-8;i<t;i++)r=this.copyBit(i,8,r);if(this.parsedFormatInfo=Nt.decodeFormatInformation(e,r),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new E}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return Pt.getVersionForNumber(t);let r=0;const n=e-11;for(let s=5;s>=0;s--)for(let t=e-9;t>=n;t--)r=this.copyBit(t,s,r);let i=Pt.decodeVersionInformation(r);if(null!==i&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;r=0;for(let s=5;s>=0;s--)for(let t=e-9;t>=n;t--)r=this.copyBit(s,t,r);if(i=Pt.decodeVersionInformation(r),null!==i&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;throw new E}copyBit(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),r=Mt.values.get(e.getDataMask()),n=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,n);const i=t.buildFunctionPattern();let s=!0;const a=new Uint8Array(t.getTotalCodewords());let o=0,l=0,c=0;for(let d=n-1;d>0;d-=2){6===d&&d--;for(let e=0;e<n;e++){const t=s?n-1-e:e;for(let e=0;e<2;e++)i.get(d-e,t)||(c++,l<<=1,this.bitMatrix.get(d-e,t)&&(l|=1),8===c&&(a[o++]=l,c=0,l=0))}s=!s}if(o!==t.getTotalCodewords())throw new E;return a}remask(){if(null===this.parsedFormatInfo)return;const e=Mt.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,r=e.getWidth();t<r;t++)for(let n=t+1,i=e.getHeight();n<i;n++)e.get(t,n)!==e.get(n,t)&&(e.flip(n,t),e.flip(t,n))}}class Bt{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,r){if(e.length!==t.getTotalCodewords())throw new u;const n=t.getECBlocksForLevel(r);let i=0;const s=n.getECBlocks();for(const u of s)i+=u.getCount();const a=new Array(i);let o=0;for(const u of s)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=n.getECCodewordsPerBlock()+e;a[o++]=new Bt(e,new Uint8Array(t))}const l=a[0].codewords.length;let c=a.length-1;for(;c>=0&&a[c].codewords.length!==l;)c--;c++;const d=l-n.getECCodewordsPerBlock();let h=0;for(let u=0;u<d;u++)for(let t=0;t<o;t++)a[t].codewords[u]=e[h++];for(let u=c;u<o;u++)a[u].codewords[d]=e[h++];const p=a[0].codewords.length;for(let u=d;u<p;u++)for(let t=0;t<o;t++){const r=t<c?u:u+1;a[t].codewords[r]=e[h++]}return a}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}(re=Z||(Z={}))[re.TERMINATOR=0]="TERMINATOR",re[re.NUMERIC=1]="NUMERIC",re[re.ALPHANUMERIC=2]="ALPHANUMERIC",re[re.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",re[re.BYTE=4]="BYTE",re[re.ECI=5]="ECI",re[re.KANJI=6]="KANJI",re[re.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",re[re.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",re[re.HANZI=9]="HANZI";class Lt{constructor(e,t,r,n){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=r,this.bits=n,Lt.FOR_BITS.set(n,this),Lt.FOR_VALUE.set(e,this)}static forBits(e){const t=Lt.FOR_BITS.get(e);if(void 0===t)throw new u;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let r;return r=t<=9?0:t<=26?1:2,this.characterCountBitsForVersions[r]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof Lt))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}Lt.FOR_BITS=new Map,Lt.FOR_VALUE=new Map,Lt.TERMINATOR=new Lt(Z.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Lt.NUMERIC=new Lt(Z.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Lt.ALPHANUMERIC=new Lt(Z.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Lt.STRUCTURED_APPEND=new Lt(Z.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Lt.BYTE=new Lt(Z.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Lt.ECI=new Lt(Z.ECI,"ECI",Int32Array.from([0,0,0]),7),Lt.KANJI=new Lt(Z.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Lt.FNC1_FIRST_POSITION=new Lt(Z.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Lt.FNC1_SECOND_POSITION=new Lt(Z.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Lt.HANZI=new Lt(Z.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Ft{static decode(e,t,r,n){const i=new Et(e);let s=new T;const a=new Array;let o=-1,l=-1;try{let e,r=null,c=!1;do{if(i.available()<4)e=Lt.TERMINATOR;else{const t=i.readBits(4);e=Lt.forBits(t)}switch(e){case Lt.TERMINATOR:break;case Lt.FNC1_FIRST_POSITION:case Lt.FNC1_SECOND_POSITION:c=!0;break;case Lt.STRUCTURED_APPEND:if(i.available()<16)throw new E;o=i.readBits(8),l=i.readBits(8);break;case Lt.ECI:const d=Ft.parseECIValue(i);if(r=A.getCharacterSetECIByValue(d),null===r)throw new E;break;case Lt.HANZI:const u=i.readBits(4),h=i.readBits(e.getCharacterCountBits(t));u===Ft.GB2312_SUBSET&&Ft.decodeHanziSegment(i,s,h);break;default:const p=i.readBits(e.getCharacterCountBits(t));switch(e){case Lt.NUMERIC:Ft.decodeNumericSegment(i,s,p);break;case Lt.ALPHANUMERIC:Ft.decodeAlphanumericSegment(i,s,p,c);break;case Lt.BYTE:Ft.decodeByteSegment(i,s,p,r,a,n);break;case Lt.KANJI:Ft.decodeKanjiSegment(i,s,p);break;default:throw new E}}}while(e!==Lt.TERMINATOR)}catch(c){throw new E}return new ie(e,s.toString(),0===a.length?null:a,null===r?null:r.toString(),o,l)}static decodeHanziSegment(e,t,r){if(13*r>e.available())throw new E;const n=new Uint8Array(2*r);let i=0;for(;r>0;){const t=e.readBits(13);let s=t/96<<8&4294967295|t%96;s+=s<959?41377:42657,n[i]=s>>8&255,n[i+1]=255&s,i+=2,r--}try{t.append(j.decode(n,I.GB2312))}catch(s){throw new E(s)}}static decodeKanjiSegment(e,t,r){if(13*r>e.available())throw new E;const n=new Uint8Array(2*r);let i=0;for(;r>0;){const t=e.readBits(13);let s=t/192<<8&4294967295|t%192;s+=s<7936?33088:49472,n[i]=s>>8,n[i+1]=s,i+=2,r--}try{t.append(j.decode(n,I.SHIFT_JIS))}catch(s){throw new E(s)}}static decodeByteSegment(e,t,r,n,i,s){if(8*r>e.available())throw new E;const a=new Uint8Array(r);for(let c=0;c<r;c++)a[c]=e.readBits(8);let o;o=null===n?I.guessEncoding(a,s):n.getName();try{t.append(j.decode(a,o))}catch(l){throw new E(l)}i.push(a)}static toAlphaNumericChar(e){if(e>=Ft.ALPHANUMERIC_CHARS.length)throw new E;return Ft.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,r,n){const i=t.length();for(;r>1;){if(e.available()<11)throw new E;const n=e.readBits(11);t.append(Ft.toAlphaNumericChar(Math.floor(n/45))),t.append(Ft.toAlphaNumericChar(n%45)),r-=2}if(1===r){if(e.available()<6)throw new E;t.append(Ft.toAlphaNumericChar(e.readBits(6)))}if(n)for(let s=i;s<t.length();s++)"%"===t.charAt(s)&&(s<t.length()-1&&"%"===t.charAt(s+1)?t.deleteCharAt(s+1):t.setCharAt(s,String.fromCharCode(29)))}static decodeNumericSegment(e,t,r){for(;r>=3;){if(e.available()<10)throw new E;const n=e.readBits(10);if(n>=1e3)throw new E;t.append(Ft.toAlphaNumericChar(Math.floor(n/100))),t.append(Ft.toAlphaNumericChar(Math.floor(n/10)%10)),t.append(Ft.toAlphaNumericChar(n%10)),r-=3}if(2===r){if(e.available()<7)throw new E;const r=e.readBits(7);if(r>=100)throw new E;t.append(Ft.toAlphaNumericChar(Math.floor(r/10))),t.append(Ft.toAlphaNumericChar(r%10))}else if(1===r){if(e.available()<4)throw new E;const r=e.readBits(4);if(r>=10)throw new E;t.append(Ft.toAlphaNumericChar(r))}}static parseECIValue(e){const t=e.readBits(8);if(!(128&t))return 127&t;if(128==(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192==(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new E}}Ft.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Ft.GB2312_SUBSET=1;class zt{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||null===e||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class Wt{constructor(){this.rsDecoder=new ue(le.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(R.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const r=new kt(e);let n=null;try{return this.decodeBitMatrixParser(r,t)}catch(i){n=i}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();const e=this.decodeBitMatrixParser(r,t);return e.setOther(new zt(!0)),e}catch(i){if(null!==n)throw n;throw i}}decodeBitMatrixParser(e,t){const r=e.readVersion(),n=e.readFormatInformation().getErrorCorrectionLevel(),i=e.readCodewords(),s=Bt.getDataBlocks(i,r,n);let a=0;for(const c of s)a+=c.getNumDataCodewords();const o=new Uint8Array(a);let l=0;for(const c of s){const e=c.getCodewords(),t=c.getNumDataCodewords();this.correctErrors(e,t);for(let r=0;r<t;r++)o[l++]=e[r]}return Ft.decode(o,r,n,t)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(n){throw new p}for(let i=0;i<t;i++)e[i]=r[i]}}class Ut extends fe{constructor(e,t,r){super(e,t),this.estimatedModuleSize=r}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const n=(this.getX()+t)/2,i=(this.getY()+e)/2,s=(this.estimatedModuleSize+r)/2;return new Ut(n,i,s)}}class Vt{constructor(e,t,r,n,i,s,a){this.image=e,this.startX=t,this.startY=r,this.width=n,this.height=i,this.moduleSize=s,this.resultPointCallback=a,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,r=e+this.width,n=this.startY+t/2,i=new Int32Array(3),s=this.image;for(let a=0;a<t;a++){const t=n+(1&a?-Math.floor((a+1)/2):Math.floor((a+1)/2));i[0]=0,i[1]=0,i[2]=0;let o=e;for(;o<r&&!s.get(o,t);)o++;let l=0;for(;o<r;){if(s.get(o,t))if(1===l)i[1]++;else if(2===l){if(this.foundPatternCross(i)){const e=this.handlePossibleCenter(i,t,o);if(null!==e)return e}i[0]=i[2],i[1]=1,i[2]=0,l=1}else i[++l]++;else 1===l&&l++,i[l]++;o++}if(this.foundPatternCross(i)){const e=this.handlePossibleCenter(i,t,r);if(null!==e)return e}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new N}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,r=t/2;for(let n=0;n<3;n++)if(Math.abs(t-e[n])>=r)return!1;return!0}crossCheckVertical(e,t,r,n){const i=this.image,s=i.getHeight(),a=this.crossCheckStateCount;a[0]=0,a[1]=0,a[2]=0;let o=e;for(;o>=0&&i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&!i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o)&&a[1]<=r;)a[1]++,o++;if(o===s||a[1]>r)return NaN;for(;o<s&&!i.get(t,o)&&a[2]<=r;)a[2]++,o++;if(a[2]>r)return NaN;const l=a[0]+a[1]+a[2];return 5*Math.abs(l-n)>=2*n?NaN:this.foundPatternCross(a)?Vt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r){const n=e[0]+e[1]+e[2],i=Vt.centerFromEnd(e,r),s=this.crossCheckVertical(t,i,2*e[1],n);if(!isNaN(s)){const t=(e[0]+e[1]+e[2])/3;for(const e of this.possibleCenters)if(e.aboutEquals(t,s,i))return e.combineEstimate(s,i,t);const r=new Ut(i,s,t);this.possibleCenters.push(r),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(r)}return null}}class Ht extends fe{constructor(e,t,r,n){super(e,t),this.estimatedModuleSize=r,this.count=n,void 0===n&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const n=this.count+1,i=(this.count*this.getX()+t)/n,s=(this.count*this.getY()+e)/n,a=(this.count*this.estimatedModuleSize+r)/n;return new Ht(i,s,a,n)}}class Gt{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class qt{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=null!=e&&void 0!==e.get(_.TRY_HARDER),r=null!=e&&void 0!==e.get(_.PURE_BARCODE),n=this.image,i=n.getHeight(),s=n.getWidth();let a=Math.floor(3*i/(4*qt.MAX_MODULES));(a<qt.MIN_SKIP||t)&&(a=qt.MIN_SKIP);let o=!1;const l=new Int32Array(5);for(let d=a-1;d<i&&!o;d+=a){l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0;let e=0;for(let t=0;t<s;t++)if(n.get(t,d))1&~e||e++,l[e]++;else if(1&e)l[e]++;else if(4===e)if(qt.foundPatternCross(l)){if(!0!==this.handlePossibleCenter(l,d,t,r)){l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;continue}if(a=2,!0===this.hasSkipped)o=this.haveMultiplyConfirmedCenters();else{const e=this.findRowSkip();e>l[2]&&(d+=e-l[2]-a,t=s-1)}e=0,l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0}else l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;else l[++e]++;qt.foundPatternCross(l)&&!0===this.handlePossibleCenter(l,d,s,r)&&(a=l[0],this.hasSkipped&&(o=this.haveMultiplyConfirmedCenters()))}const c=this.selectBestPatterns();return fe.orderBestPatterns(c),new Gt(c)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let i=0;i<5;i++){const r=e[i];if(0===r)return!1;t+=r}if(t<7)return!1;const r=t/7,n=r/2;return Math.abs(r-e[0])<n&&Math.abs(r-e[1])<n&&Math.abs(3*r-e[2])<3*n&&Math.abs(r-e[3])<n&&Math.abs(r-e[4])<n}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,r,n){const i=this.getCrossCheckStateCount();let s=0;const a=this.image;for(;e>=s&&t>=s&&a.get(t-s,e-s);)i[2]++,s++;if(e<s||t<s)return!1;for(;e>=s&&t>=s&&!a.get(t-s,e-s)&&i[1]<=r;)i[1]++,s++;if(e<s||t<s||i[1]>r)return!1;for(;e>=s&&t>=s&&a.get(t-s,e-s)&&i[0]<=r;)i[0]++,s++;if(i[0]>r)return!1;const o=a.getHeight(),l=a.getWidth();for(s=1;e+s<o&&t+s<l&&a.get(t+s,e+s);)i[2]++,s++;if(e+s>=o||t+s>=l)return!1;for(;e+s<o&&t+s<l&&!a.get(t+s,e+s)&&i[3]<r;)i[3]++,s++;if(e+s>=o||t+s>=l||i[3]>=r)return!1;for(;e+s<o&&t+s<l&&a.get(t+s,e+s)&&i[4]<r;)i[4]++,s++;if(i[4]>=r)return!1;const c=i[0]+i[1]+i[2]+i[3]+i[4];return Math.abs(c-n)<2*n&&qt.foundPatternCross(i)}crossCheckVertical(e,t,r,n){const i=this.image,s=i.getHeight(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&i.get(t,o);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(t,o)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(t,o)&&a[4]<r;)a[4]++,o++;if(a[4]>=r)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-n)>=2*n?NaN:qt.foundPatternCross(a)?qt.centerFromEnd(a,o):NaN}crossCheckHorizontal(e,t,r,n){const i=this.image,s=i.getWidth(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&i.get(o,t);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(o,t)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(o,t)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(o,t);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(o,t)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(o,t)&&a[4]<r;)a[4]++,o++;if(a[4]>=r)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-n)>=n?NaN:qt.foundPatternCross(a)?qt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r,n){const i=e[0]+e[1]+e[2]+e[3]+e[4];let s=qt.centerFromEnd(e,r),a=this.crossCheckVertical(t,Math.floor(s),e[2],i);if(!isNaN(a)&&(s=this.crossCheckHorizontal(Math.floor(s),Math.floor(a),e[2],i),!isNaN(s)&&(!n||this.crossCheckDiagonal(Math.floor(a),Math.floor(s),e[2],i)))){const e=i/7;let t=!1;const r=this.possibleCenters;for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i.aboutEquals(e,a,s)){r[n]=i.combineEstimate(a,s,e),t=!0;break}}if(!t){const t=new Ht(s,a,e);r.push(t),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(t)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(const t of this.possibleCenters)if(t.getCount()>=qt.CENTER_QUORUM){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-t.getX())-Math.abs(e.getY()-t.getY()))/2);e=t}return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const r=this.possibleCenters.length;for(const s of this.possibleCenters)s.getCount()>=qt.CENTER_QUORUM&&(e++,t+=s.getEstimatedModuleSize());if(e<3)return!1;const n=t/r;let i=0;for(const s of this.possibleCenters)i+=Math.abs(s.getEstimatedModuleSize()-n);return i<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new N;const t=this.possibleCenters;let r;if(e>3){let n=0,i=0;for(const e of this.possibleCenters){const t=e.getEstimatedModuleSize();n+=t,i+=t*t}r=n/e;let s=Math.sqrt(i/e-r*r);t.sort(((e,t)=>{const n=Math.abs(t.getEstimatedModuleSize()-r),i=Math.abs(e.getEstimatedModuleSize()-r);return n<i?-1:n>i?1:0}));const a=Math.max(.2*r,s);for(let e=0;e<t.length&&t.length>3;e++){const n=t[e];Math.abs(n.getEstimatedModuleSize()-r)>a&&(t.splice(e,1),e--)}}if(t.length>3){let e=0;for(const r of t)e+=r.getEstimatedModuleSize();r=e/t.length,t.sort(((e,t)=>{if(t.getCount()===e.getCount()){const n=Math.abs(t.getEstimatedModuleSize()-r),i=Math.abs(e.getEstimatedModuleSize()-r);return n<i?1:n>i?-1:0}return t.getCount()-e.getCount()})),t.splice(3)}return[t[0],t[1],t[2]]}}qt.CENTER_QUORUM=2,qt.MIN_SKIP=3,qt.MAX_MODULES=57;class $t{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=null==e?null:e.get(_.NEED_RESULT_POINT_CALLBACK);const t=new qt(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)}processFinderPatternInfo(e){const t=e.getTopLeft(),r=e.getTopRight(),n=e.getBottomLeft(),i=this.calculateModuleSize(t,r,n);if(i<1)throw new N("No pattern found in proccess finder.");const s=$t.computeDimension(t,r,n,i),a=Pt.getProvisionalVersionForDimension(s),o=a.getDimensionForVersion()-7;let l=null;if(a.getAlignmentPatternCenters().length>0){const e=r.getX()-t.getX()+n.getX(),s=r.getY()-t.getY()+n.getY(),a=1-3/o,c=Math.floor(t.getX()+a*(e-t.getX())),d=Math.floor(t.getY()+a*(s-t.getY()));for(let t=4;t<=16;t<<=1)try{l=this.findAlignmentInRegion(i,c,d,t);break}catch(h){if(!(h instanceof N))throw h}}const c=$t.createTransform(t,r,n,l,s),d=$t.sampleGrid(this.image,c,s);let u;return u=null===l?[n,t,r]:[n,t,r,l],new ge(d,u)}static createTransform(e,t,r,n,i){const s=i-3.5;let a,o,l,c;return null!==n?(a=n.getX(),o=n.getY(),l=s-3,c=l):(a=t.getX()-e.getX()+r.getX(),o=t.getY()-e.getY()+r.getY(),l=s,c=s),be.quadrilateralToQuadrilateral(3.5,3.5,s,3.5,l,c,3.5,s,e.getX(),e.getY(),t.getX(),t.getY(),a,o,r.getX(),r.getY())}static sampleGrid(e,t,r){return Ce.getInstance().sampleGridWithTransform(e,r,r,t)}static computeDimension(e,t,r,n){const i=pe.round(fe.distance(e,t)/n),s=pe.round(fe.distance(e,r)/n);let a=Math.floor((i+s)/2)+7;switch(3&a){case 0:a++;break;case 2:a--;break;case 3:throw new N("Dimensions could be not found.")}return a}calculateModuleSize(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2}calculateModuleSizeOneWay(e,t){const r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?n/7:isNaN(n)?r/7:(r+n)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,r,n){let i=this.sizeOfBlackWhiteBlackRun(e,t,r,n),s=1,a=e-(r-e);a<0?(s=e/(e-a),a=0):a>=this.image.getWidth()&&(s=(this.image.getWidth()-1-e)/(a-e),a=this.image.getWidth()-1);let o=Math.floor(t-(n-t)*s);return s=1,o<0?(s=t/(t-o),o=0):o>=this.image.getHeight()&&(s=(this.image.getHeight()-1-t)/(o-t),o=this.image.getHeight()-1),a=Math.floor(e+(a-e)*s),i+=this.sizeOfBlackWhiteBlackRun(e,t,a,o),i-1}sizeOfBlackWhiteBlackRun(e,t,r,n){const i=Math.abs(n-t)>Math.abs(r-e);if(i){let i=e;e=t,t=i,i=r,r=n,n=i}const s=Math.abs(r-e),a=Math.abs(n-t);let o=-s/2;const l=e<r?1:-1,c=t<n?1:-1;let d=0;const u=r+l;for(let h=e,p=t;h!==u;h+=l){const r=i?p:h,l=i?h:p;if(1===d===this.image.get(r,l)){if(2===d)return pe.distance(h,p,e,t);d++}if(o+=a,o>0){if(p===n)break;p+=c,o-=s}}return 2===d?pe.distance(r+l,n,e,t):NaN}findAlignmentInRegion(e,t,r,n){const i=Math.floor(n*e),s=Math.max(0,t-i),a=Math.min(this.image.getWidth()-1,t+i);if(a-s<3*e)throw new N("Alignment top exceeds estimated module size.");const o=Math.max(0,r-i),l=Math.min(this.image.getHeight()-1,r+i);if(l-o<3*e)throw new N("Alignment bottom exceeds estimated module size.");return new Vt(this.image,s,o,a-s,l-o,e,this.resultPointCallback).find()}}class Xt{constructor(){this.decoder=new Wt}getDecoder(){return this.decoder}decode(e,t){let r,n;if(null!=t&&void 0!==t.get(_.PURE_BARCODE)){const i=Xt.extractPureBits(e.getBlackMatrix());r=this.decoder.decodeBitMatrix(i,t),n=Xt.NO_POINTS}else{const i=new $t(e.getBlackMatrix()).detect(t);r=this.decoder.decodeBitMatrix(i.getBits(),t),n=i.getPoints()}r.getOther()instanceof zt&&r.getOther().applyMirroredCorrection(n);const i=new U(r.getText(),r.getRawBytes(),void 0,n,G.QR_CODE,void 0),s=r.getByteSegments();null!==s&&i.putMetadata(ne.BYTE_SEGMENTS,s);const a=r.getECLevel();return null!==a&&i.putMetadata(ne.ERROR_CORRECTION_LEVEL,a),r.hasStructuredAppend()&&(i.putMetadata(ne.STRUCTURED_APPEND_SEQUENCE,r.getStructuredAppendSequenceNumber()),i.putMetadata(ne.STRUCTURED_APPEND_PARITY,r.getStructuredAppendParity())),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null===t||null===r)throw new N;const n=this.moduleSize(t,e);let i=t[1],s=r[1],a=t[0],o=r[0];if(a>=o||i>=s)throw new N;if(s-i!==o-a&&(o=a+(s-i),o>=e.getWidth()))throw new N;const l=Math.round((o-a+1)/n),c=Math.round((s-i+1)/n);if(l<=0||c<=0)throw new N;if(c!==l)throw new N;const d=Math.floor(n/2);i+=d,a+=d;const u=a+Math.floor((l-1)*n)-o;if(u>0){if(u>d)throw new N;a-=u}const h=i+Math.floor((c-1)*n)-s;if(h>0){if(h>d)throw new N;i-=h}const p=new R(l,c);for(let m=0;m<c;m++){const t=i+Math.floor(m*n);for(let r=0;r<l;r++)e.get(a+Math.floor(r*n),t)&&p.set(r,m)}return p}static moduleSize(e,t){const r=t.getHeight(),n=t.getWidth();let i=e[0],s=e[1],a=!0,o=0;for(;i<n&&s<r;){if(a!==t.get(i,s)){if(5===++o)break;a=!a}i++,s++}if(i===n||s===r)throw new N;return(i-e[0])/7}}Xt.NO_POINTS=new Array;class Yt{PDF417Common(){}static getBitCountSum(e){return pe.sum(e)}static toIntArray(e){if(null==e||!e.length)return Yt.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let r=0;for(const n of e)t[r++]=n;return t}static getCodeword(e){const t=y.binarySearch(Yt.SYMBOL_TABLE,262143&e);return t<0?-1:(Yt.CODEWORD_TABLE[t]-1)%Yt.NUMBER_OF_CODEWORDS}}Yt.NUMBER_OF_CODEWORDS=929,Yt.MAX_CODEWORDS_IN_BARCODE=Yt.NUMBER_OF_CODEWORDS-1,Yt.MIN_ROWS_IN_BARCODE=3,Yt.MAX_ROWS_IN_BARCODE=90,Yt.MODULES_IN_CODEWORD=17,Yt.MODULES_IN_STOP_PATTERN=18,Yt.BARS_IN_MODULE=8,Yt.EMPTY_INT_ARRAY=new Int32Array([]),Yt.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Yt.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Zt{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class Kt{static detectMultiple(e,t,r){let n=e.getBlackMatrix(),i=Kt.detect(r,n);return i.length||(n=n.clone(),n.rotate180(),i=Kt.detect(r,n)),new Zt(n,i)}static detect(e,t){const r=new Array;let n=0,i=0,s=!1;for(;n<t.getHeight();){const a=Kt.findVertices(t,n,i);if(null!=a[0]||null!=a[3]){if(s=!0,r.push(a),!e)break;null!=a[2]?(i=Math.trunc(a[2].getX()),n=Math.trunc(a[2].getY())):(i=Math.trunc(a[4].getX()),n=Math.trunc(a[4].getY()))}else{if(!s)break;s=!1,i=0;for(const e of r)null!=e[1]&&(n=Math.trunc(Math.max(n,e[1].getY()))),null!=e[3]&&(n=Math.max(n,Math.trunc(e[3].getY())));n+=Kt.ROW_STEP}}return r}static findVertices(e,t,r){const n=e.getHeight(),i=e.getWidth(),s=new Array(8);return Kt.copyToResult(s,Kt.findRowsWithPattern(e,n,i,t,r,Kt.START_PATTERN),Kt.INDEXES_START_PATTERN),null!=s[4]&&(r=Math.trunc(s[4].getX()),t=Math.trunc(s[4].getY())),Kt.copyToResult(s,Kt.findRowsWithPattern(e,n,i,t,r,Kt.STOP_PATTERN),Kt.INDEXES_STOP_PATTERN),s}static copyToResult(e,t,r){for(let n=0;n<r.length;n++)e[r[n]]=t[n]}static findRowsWithPattern(e,t,r,n,i,s){const a=new Array(4);let o=!1;const l=new Int32Array(s.length);for(;n<t;n+=Kt.ROW_STEP){let t=Kt.findGuardPattern(e,i,n,r,!1,s,l);if(null!=t){for(;n>0;){const a=Kt.findGuardPattern(e,i,--n,r,!1,s,l);if(null==a){n++;break}t=a}a[0]=new fe(t[0],n),a[1]=new fe(t[1],n),o=!0;break}}let c=n+1;if(o){let n=0,i=Int32Array.from([Math.trunc(a[0].getX()),Math.trunc(a[1].getX())]);for(;c<t;c++){const t=Kt.findGuardPattern(e,i[0],c,r,!1,s,l);if(null!=t&&Math.abs(i[0]-t[0])<Kt.MAX_PATTERN_DRIFT&&Math.abs(i[1]-t[1])<Kt.MAX_PATTERN_DRIFT)i=t,n=0;else{if(n>Kt.SKIPPED_ROW_COUNT_MAX)break;n++}}c-=n+1,a[2]=new fe(i[0],c),a[3]=new fe(i[1],c)}return c-n<Kt.BARCODE_MIN_HEIGHT&&y.fill(a,null),a}static findGuardPattern(e,t,r,n,i,s,a){y.fillWithin(a,0,a.length,0);let o=t,l=0;for(;e.get(o,r)&&o>0&&l++<Kt.MAX_PIXEL_DRIFT;)o--;let c=o,d=0,u=s.length;for(let h=i;c<n;c++)if(e.get(c,r)!==h)a[d]++;else{if(d===u-1){if(Kt.patternMatchVariance(a,s,Kt.MAX_INDIVIDUAL_VARIANCE)<Kt.MAX_AVG_VARIANCE)return new Int32Array([o,c]);o+=a[0]+a[1],f.arraycopy(a,2,a,0,d-1),a[d-1]=0,a[d]=0,d--}else d++;a[d]=1,h=!h}return d===u-1&&Kt.patternMatchVariance(a,s,Kt.MAX_INDIVIDUAL_VARIANCE)<Kt.MAX_AVG_VARIANCE?new Int32Array([o,c-1]):null}static patternMatchVariance(e,t,r){let n=e.length,i=0,s=0;for(let l=0;l<n;l++)i+=e[l],s+=t[l];if(i<s)return 1/0;let a=i/s;r*=a;let o=0;for(let l=0;l<n;l++){let n=e[l],i=t[l]*a,s=n>i?n-i:i-n;if(s>r)return 1/0;o+=s}return o/i}}Kt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Kt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Kt.MAX_AVG_VARIANCE=.42,Kt.MAX_INDIVIDUAL_VARIANCE=.8,Kt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Kt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Kt.MAX_PIXEL_DRIFT=3,Kt.MAX_PATTERN_DRIFT=5,Kt.SKIPPED_ROW_COUNT_MAX=25,Kt.ROW_STEP=5,Kt.BARCODE_MIN_HEIGHT=10;class Qt{constructor(e,t){if(0===t.length)throw new u;this.field=e;let r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-e),f.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);if(1===e){let e=0;for(let t of this.coefficients)e=this.field.add(e,t);return e}let t=this.coefficients[0],r=this.coefficients.length;for(let n=1;n<r;n++)t=this.field.add(this.field.multiply(e,t),this.coefficients[n]);return t}add(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){let e=t;t=r,r=e}let n=new Int32Array(r.length),i=r.length-t.length;f.arraycopy(r,0,n,0,i);for(let s=i;s<r.length;s++)n[s]=this.field.add(t[s-i],r[s]);return new Qt(this.field,n)}subtract(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof Qt?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new Qt(this.field,new Int32Array([0]));let t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1);for(let a=0;a<r;a++){let e=t[a];for(let t=0;t<i;t++)s[a+t]=this.field.add(s[a+t],this.field.multiply(e,n[t]))}return new Qt(this.field,s)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=this.field.subtract(0,this.coefficients[r]);return new Qt(this.field,t)}multiplyScalar(e){if(0===e)return new Qt(this.field,new Int32Array([0]));if(1===e)return this;let t=this.coefficients.length,r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=this.field.multiply(this.coefficients[n],e);return new Qt(this.field,r)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return new Qt(this.field,new Int32Array([0]));let r=this.coefficients.length,n=new Int32Array(r+e);for(let i=0;i<r;i++)n[i]=this.field.multiply(this.coefficients[i],t);return new Qt(this.field,n)}toString(){let e=new T;for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);0!==r&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),0!==t&&1===r||e.append(r),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class Jt{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}inverse(e){if(0===e)throw new oe;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class er extends Jt{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let r=1;for(let n=0;n<e;n++)this.expTable[n]=r,r=r*t%e;for(let n=0;n<e-1;n++)this.logTable[this.expTable[n]]=n;this.zero=new Qt(this,new Int32Array([0])),this.one=new Qt(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;let r=new Int32Array(e+1);return r[0]=t,new Qt(this,r)}}er.PDF417_GF=new er(Yt.NUMBER_OF_CODEWORDS,3);class tr{constructor(){this.field=er.PDF417_GF}decode(e,t,r){let n=new Qt(this.field,e),i=new Int32Array(t),s=!1;for(let p=t;p>0;p--){let e=n.evaluateAt(this.field.exp(p));i[t-p]=e,0!==e&&(s=!0)}if(!s)return 0;let a=this.field.getOne();if(null!=r)for(const p of r){let t=this.field.exp(e.length-1-p),r=new Qt(this.field,new Int32Array([this.field.subtract(0,t),1]));a=a.multiply(r)}let o=new Qt(this.field,i),l=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),o,t),c=l[0],d=l[1],u=this.findErrorLocations(c),h=this.findErrorMagnitudes(d,c,u);for(let m=0;m<u.length;m++){let t=e.length-1-this.field.log(u[m]);if(t<0)throw p.getChecksumInstance();e[t]=this.field.subtract(e[t],h[m])}return u.length}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){let r=e;e=t,t=r}let n=e,i=t,s=this.field.getZero(),a=this.field.getOne();for(;i.getDegree()>=Math.round(r/2);){let e=n,t=s;if(n=i,s=a,n.isZero())throw p.getChecksumInstance();i=e;let r=this.field.getZero(),o=n.getCoefficient(n.getDegree()),l=this.field.inverse(o);for(;i.getDegree()>=n.getDegree()&&!i.isZero();){let e=i.getDegree()-n.getDegree(),t=this.field.multiply(i.getCoefficient(i.getDegree()),l);r=r.add(this.field.buildMonomial(e,t)),i=i.subtract(n.multiplyByMonomial(e,t))}a=r.multiply(s).subtract(t).negative()}let o=a.getCoefficient(0);if(0===o)throw p.getChecksumInstance();let l=this.field.inverse(o);return[a.multiply(l),i.multiply(l)]}findErrorLocations(e){let t=e.getDegree(),r=new Int32Array(t),n=0;for(let i=1;i<this.field.getSize()&&n<t;i++)0===e.evaluateAt(i)&&(r[n]=this.field.inverse(i),n++);if(n!==t)throw p.getChecksumInstance();return r}findErrorMagnitudes(e,t,r){let n=t.getDegree(),i=new Int32Array(n);for(let l=1;l<=n;l++)i[n-l]=this.field.multiply(l,t.getCoefficient(l));let s=new Qt(this.field,i),a=r.length,o=new Int32Array(a);for(let l=0;l<a;l++){let t=this.field.inverse(r[l]),n=this.field.subtract(0,e.evaluateAt(t)),i=this.field.inverse(s.evaluateAt(t));o[l]=this.field.multiply(n,i)}return o}}class rr{constructor(e,t,r,n,i){e instanceof rr?this.constructor_2(e):this.constructor_1(e,t,r,n,i)}constructor_1(e,t,r,n,i){const s=null==t||null==r,a=null==n||null==i;if(s&&a)throw new N;s?(t=new fe(0,n.getY()),r=new fe(0,i.getY())):a&&(n=new fe(e.getWidth()-1,t.getY()),i=new fe(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=n,this.bottomRight=i,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(n.getX(),i.getX())),this.minY=Math.trunc(Math.min(t.getY(),n.getY())),this.maxY=Math.trunc(Math.max(r.getY(),i.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return null==e?t:null==t?e:new rr(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,r){let n=this.topLeft,i=this.bottomLeft,s=this.topRight,a=this.bottomRight;if(e>0){let t=r?this.topLeft:this.topRight,i=Math.trunc(t.getY()-e);i<0&&(i=0);let a=new fe(t.getX(),i);r?n=a:s=a}if(t>0){let e=r?this.bottomLeft:this.bottomRight,n=Math.trunc(e.getY()+t);n>=this.image.getHeight()&&(n=this.image.getHeight()-1);let s=new fe(e.getX(),n);r?i=s:a=s}return new rr(this.image,n,i,s,a)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class nr{constructor(e,t,r,n){this.columnCount=e,this.errorCorrectionLevel=n,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ir{constructor(){this.buffer=""}static form(e,t){let r=-1;function n(e,n,i,s,a,o){if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[r],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(i),u=i&&i[0]+""=="0"?"0":" ";for(;l.length<d;)l=void 0!==n?l+u:u+l;return l}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,n)}format(e,...t){this.buffer+=ir.form(e,t)}toString(){return this.buffer}}class sr{constructor(e){this.boundingBox=new rr(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(null!=t)return t;for(let r=1;r<sr.MAX_NEARBY_DISTANCE;r++){let n=this.imageRowToCodewordIndex(e)-r;if(n>=0&&(t=this.codewords[n],null!=t))return t;if(n=this.imageRowToCodewordIndex(e)+r,n<this.codewords.length&&(t=this.codewords[n],null!=t))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new ir;let t=0;for(const r of this.codewords)null!=r?e.format("%3d: %3d|%3d%n",t++,r.getRowNumber(),r.getValue()):e.format("%3d:    |   %n",t++);return e.toString()}}sr.MAX_NEARBY_DISTANCE=5;class ar{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[r,n]of this.values.entries()){const i={getKey:()=>r,getValue:()=>n};i.getValue()>e?(e=i.getValue(),t=[],t.push(i.getKey())):i.getValue()===e&&t.push(i.getKey())}return Yt.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class or extends sr{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())null!=e&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let r=this.getBoundingBox(),n=this._isLeft?r.getTopLeft():r.getTopRight(),i=this._isLeft?r.getBottomLeft():r.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.imageRowToCodewordIndex(Math.trunc(i.getY())),o=-1,l=1,c=0;for(let d=s;d<a;d++){if(null==t[d])continue;let r=t[d],n=r.getRowNumber()-o;if(0===n)c++;else if(1===n)l=Math.max(l,c),c=1,o=r.getRowNumber();else if(n<0||r.getRowNumber()>=e.getRowCount()||n>d)t[d]=null;else{let e;e=l>2?(l-2)*n:n;let i=e>=d;for(let r=1;r<=e&&!i;r++)i=null!=t[d-r];i?t[d]=null:(o=r.getRowNumber(),c=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(null==e)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let r of this.getCodewords())if(null!=r){let e=r.getRowNumber();if(e>=t.length)continue;t[e]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),r=this._isLeft?t.getTopLeft():t.getTopRight(),n=this._isLeft?t.getBottomLeft():t.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(r.getY())),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.getCodewords(),o=-1;for(let l=i;l<s;l++){if(null==a[l])continue;let t=a[l];t.setRowNumberAsRowIndicatorColumn();let r=t.getRowNumber()-o;0===r||(1===r?o=t.getRowNumber():t.getRowNumber()>=e.getRowCount()?a[l]=null:o=t.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new ar,r=new ar,n=new ar,i=new ar;for(let a of e){if(null==a)continue;a.setRowNumberAsRowIndicatorColumn();let e=a.getValue()%30,s=a.getRowNumber();switch(this._isLeft||(s+=2),s%3){case 0:r.setValue(3*e+1);break;case 1:i.setValue(e/3),n.setValue(e%3);break;case 2:t.setValue(e+1)}}if(0===t.getValue().length||0===r.getValue().length||0===n.getValue().length||0===i.getValue().length||t.getValue()[0]<1||r.getValue()[0]+n.getValue()[0]<Yt.MIN_ROWS_IN_BARCODE||r.getValue()[0]+n.getValue()[0]>Yt.MAX_ROWS_IN_BARCODE)return null;let s=new nr(t.getValue()[0],r.getValue()[0],n.getValue()[0],i.getValue()[0]);return this.removeIncorrectCodewords(e,s),s}removeIncorrectCodewords(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(null==e[r])continue;let i=n.getValue()%30,s=n.getRowNumber();if(s>t.getRowCount())e[r]=null;else switch(this._isLeft||(s+=2),s%3){case 0:3*i+1!==t.getRowCountUpperPart()&&(e[r]=null);break;case 1:Math.trunc(i/3)===t.getErrorCorrectionLevel()&&i%3===t.getRowCountLowerPart()||(e[r]=null);break;case 2:i+1!==t.getColumnCount()&&(e[r]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class lr{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e,t=Yt.MAX_CODEWORDS_IN_BARCODE;do{e=t,t=this.adjustRowNumbersAndGetCount()}while(t>0&&t<e);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(0===e)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let e=this.detectionResultColumns[t].getCodewords();for(let r=0;r<e.length;r++)null!=e[r]&&(e[r].hasValidRowNumber()||this.adjustRowNumbers(t,r,e))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<e.length;r++)if(null!=e[r]&&null!=t[r]&&e[r].getRowNumber()===t[r].getRowNumber())for(let t=1;t<=this.barcodeColumnCount;t++){let n=this.detectionResultColumns[t].getCodewords()[r];null!=n&&(n.setRowNumber(e[r].getRowNumber()),n.hasValidRowNumber()||(this.detectionResultColumns[t].getCodewords()[r]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=this.barcodeColumnCount+1;t>0&&i<this.ADJUST_ROW_NUMBER_SKIP;t--){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=lr.adjustRowNumberIfValid(n,i,s),s.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=1;t<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;t++){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=lr.adjustRowNumberIfValid(n,i,s),s.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,r){return null==r||r.hasValidRowNumber()||(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,r){if(!this.detectionResultColumns[e-1])return;let n=r[t],i=this.detectionResultColumns[e-1].getCodewords(),s=i;null!=this.detectionResultColumns[e+1]&&(s=this.detectionResultColumns[e+1].getCodewords());let a=new Array(14);a[2]=i[t],a[3]=s[t],t>0&&(a[0]=r[t-1],a[4]=i[t-1],a[5]=s[t-1]),t>1&&(a[8]=r[t-2],a[10]=i[t-2],a[11]=s[t-2]),t<r.length-1&&(a[1]=r[t+1],a[6]=i[t+1],a[7]=s[t+1]),t<r.length-2&&(a[9]=r[t+2],a[12]=i[t+2],a[13]=s[t+2]);for(let o of a)if(lr.adjustRowNumber(n,o))return}static adjustRowNumber(e,t){return!(null==t||!t.hasValidRowNumber()||t.getBucket()!==e.getBucket()||(e.setRowNumber(t.getRowNumber()),0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new ir;for(let r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(let e=0;e<this.barcodeColumnCount+2;e++){if(null==this.detectionResultColumns[e]){t.format("    |   ");continue}let n=this.detectionResultColumns[e].getCodewords()[r];null!=n?t.format(" %3d|%3d",n.getRowNumber(),n.getValue()):t.format("    |   ")}t.format("%n")}return t.toString()}}class cr{constructor(e,t,r,n){this.rowNumber=cr.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(r),this.value=Math.trunc(n)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==cr.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}cr.BARCODE_ROW_UNKNOWN=-1;class dr{static initialize(){for(let e=0;e<Yt.SYMBOL_TABLE.length;e++){let t=Yt.SYMBOL_TABLE[e],r=1&t;for(let n=0;n<Yt.BARS_IN_MODULE;n++){let i=0;for(;(1&t)===r;)i+=1,t>>=1;r=1&t,dr.RATIOS_TABLE[e]||(dr.RATIOS_TABLE[e]=new Array(Yt.BARS_IN_MODULE)),dr.RATIOS_TABLE[e][Yt.BARS_IN_MODULE-n-1]=Math.fround(i/Yt.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=dr.getDecodedCodewordValue(dr.sampleBitCounts(e));return-1!==t?t:dr.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=pe.sum(e),r=new Int32Array(Yt.BARS_IN_MODULE),n=0,i=0;for(let s=0;s<Yt.MODULES_IN_CODEWORD;s++){let a=t/(2*Yt.MODULES_IN_CODEWORD)+s*t/Yt.MODULES_IN_CODEWORD;i+e[n]<=a&&(i+=e[n],n++),r[n]++}return r}static getDecodedCodewordValue(e){let t=dr.getBitValue(e);return-1===Yt.getCodeword(t)?-1:t}static getBitValue(e){let t=0;for(let r=0;r<e.length;r++)for(let n=0;n<e[r];n++)t=t<<1|(r%2==0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=pe.sum(e),r=new Array(Yt.BARS_IN_MODULE);if(t>1)for(let s=0;s<r.length;s++)r[s]=Math.fround(e[s]/t);let n=me.MAX_VALUE,i=-1;this.bSymbolTableReady||dr.initialize();for(let s=0;s<dr.RATIOS_TABLE.length;s++){let e=0,t=dr.RATIOS_TABLE[s];for(let i=0;i<Yt.BARS_IN_MODULE;i++){let s=Math.fround(t[i]-r[i]);if(e+=Math.fround(s*s),e>=n)break}e<n&&(n=e,i=Yt.SYMBOL_TABLE[s])}return i}}dr.bSymbolTableReady=!1,dr.RATIOS_TABLE=new Array(Yt.SYMBOL_TABLE.length).map((e=>new Array(Yt.BARS_IN_MODULE)));class ur{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class hr{static parseLong(e,t=void 0){return parseInt(e,t)}}class pr extends c{}pr.kind="NullPointerException";class mr{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,r){if(null==e)throw new pr;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new g;if(0!==r)for(let n=0;n<r;n++)this.write(e[t+n])}flush(){}close(){}}class fr extends c{}class gr extends mr{constructor(e=32){if(super(),this.count=0,e<0)throw new u("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new fr;t=w.MAX_VALUE}this.buf=y.copyOfUint8Array(this.buf,t)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,r){if(t<0||t>e.length||r<0||t+r-e.length>0)throw new g;this.ensureCapacity(this.count+r),f.arraycopy(e,t,this.buf,this.count,r),this.count+=r}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return y.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?"string"==typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}function xr(){if("undefined"!=typeof window)return window.BigInt||null;if(void 0!==wt)return wt.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let yr;function wr(e){if(void 0===yr&&(yr=xr()),null===yr)throw new Error("BigInt is not supported!");return yr(e)}function br(){let e=[];e[0]=wr(1);let t=wr(900);e[1]=t;for(let r=2;r<16;r++)e[r]=e[r-1]*t;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(K||(K={}));class vr{static decode(e,t){let r=new T(""),n=A.ISO8859_1;r.enableDecoding(n);let i=1,s=e[i++],a=new ur;for(;i<e[0];){switch(s){case vr.TEXT_COMPACTION_MODE_LATCH:i=vr.textCompaction(e,i,r);break;case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:i=vr.byteCompaction(s,e,n,i,r);break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[i++]);break;case vr.NUMERIC_COMPACTION_MODE_LATCH:i=vr.numericCompaction(e,i,r);break;case vr.ECI_CHARSET:A.getCharacterSetECIByValue(e[i++]);break;case vr.ECI_GENERAL_PURPOSE:i+=2;break;case vr.ECI_USER_DEFINED:i++;break;case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=vr.decodeMacroBlock(e,i,a);break;case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:throw new E;default:i--,i=vr.textCompaction(e,i,r)}if(!(i<e.length))throw E.getFormatInstance();s=e[i++]}if(0===r.length())throw E.getFormatInstance();let o=new ie(null,r.toString(),null,t);return o.setOther(a),o}static decodeMacroBlock(e,t,r){if(t+vr.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw E.getFormatInstance();let n=new Int32Array(vr.NUMBER_OF_SEQUENCE_CODEWORDS);for(let a=0;a<vr.NUMBER_OF_SEQUENCE_CODEWORDS;a++,t++)n[a]=e[t];r.setSegmentIndex(w.parseInt(vr.decodeBase900toBase10(n,vr.NUMBER_OF_SEQUENCE_CODEWORDS)));let i=new T;t=vr.textCompaction(e,t,i),r.setFileId(i.toString());let s=-1;for(e[t]===vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(s=t+1);t<e[0];)switch(e[t]){case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let n=new T;t=vr.textCompaction(e,t+1,n),r.setFileName(n.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let i=new T;t=vr.textCompaction(e,t+1,i),r.setSender(i.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let s=new T;t=vr.textCompaction(e,t+1,s),r.setAddressee(s.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let a=new T;t=vr.numericCompaction(e,t+1,a),r.setSegmentCount(w.parseInt(a.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let o=new T;t=vr.numericCompaction(e,t+1,o),r.setTimestamp(hr.parseLong(o.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let l=new T;t=vr.numericCompaction(e,t+1,l),r.setChecksum(w.parseInt(l.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let c=new T;t=vr.numericCompaction(e,t+1,c),r.setFileSize(hr.parseLong(c.toString()));break;default:throw E.getFormatInstance()}break;case vr.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw E.getFormatInstance()}if(-1!==s){let n=t-s;r.isLastSegment()&&n--,r.setOptionalData(y.copyOfRange(e,s,s+n))}return t}static textCompaction(e,t,r){let n=new Int32Array(2*(e[0]-t)),i=new Int32Array(2*(e[0]-t)),s=0,a=!1;for(;t<e[0]&&!a;){let r=e[t++];if(r<vr.TEXT_COMPACTION_MODE_LATCH)n[s]=r/30,n[s+1]=r%30,s+=2;else switch(r){case vr.TEXT_COMPACTION_MODE_LATCH:n[s++]=vr.TEXT_COMPACTION_MODE_LATCH;break;case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:t--,a=!0;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n[s]=vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,r=e[t++],i[s]=r,s++}}return vr.decodeTextCompaction(n,i,s,r),t}static decodeTextCompaction(e,t,r,n){let i=K.ALPHA,s=K.ALPHA,a=0;for(;a<r;){let r=e[a],o="";switch(i){case K.ALPHA:if(r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case vr.LL:i=K.LOWER;break;case vr.ML:i=K.MIXED;break;case vr.PS:s=i,i=K.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}break;case K.LOWER:if(r<26)o=String.fromCharCode(97+r);else switch(r){case 26:o=" ";break;case vr.AS:s=i,i=K.ALPHA_SHIFT;break;case vr.ML:i=K.MIXED;break;case vr.PS:s=i,i=K.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}break;case K.MIXED:if(r<vr.PL)o=vr.MIXED_CHARS[r];else switch(r){case vr.PL:i=K.PUNCT;break;case 26:o=" ";break;case vr.LL:i=K.LOWER;break;case vr.AL:i=K.ALPHA;break;case vr.PS:s=i,i=K.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}break;case K.PUNCT:if(r<vr.PAL)o=vr.PUNCT_CHARS[r];else switch(r){case vr.PAL:i=K.ALPHA;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}break;case K.ALPHA_SHIFT:if(i=s,r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}break;case K.PUNCT_SHIFT:if(i=s,r<vr.PAL)o=vr.PUNCT_CHARS[r];else switch(r){case vr.PAL:i=K.ALPHA;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=K.ALPHA}}""!==o&&n.append(o),a++}}static byteCompaction(e,t,r,n,i){let s=new gr,a=0,o=0,l=!1;switch(e){case vr.BYTE_COMPACTION_MODE_LATCH:let e=new Int32Array(6),r=t[n++];for(;n<t[0]&&!l;)switch(e[a++]=r,o=900*o+r,r=t[n++],r){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:n--,l=!0;break;default:if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(wr(o)>>wr(8*(5-e))));o=0,a=0}}n===t[0]&&r<vr.TEXT_COMPACTION_MODE_LATCH&&(e[a++]=r);for(let t=0;t<a;t++)s.write(e[t]);break;case vr.BYTE_COMPACTION_MODE_LATCH_6:for(;n<t[0]&&!l;){let e=t[n++];if(e<vr.TEXT_COMPACTION_MODE_LATCH)a++,o=900*o+e;else switch(e){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:n--,l=!0}if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(wr(o)>>wr(8*(5-e))));o=0,a=0}}}return i.append(j.decode(s.toByteArray(),r)),n}static numericCompaction(e,t,r){let n=0,i=!1,s=new Int32Array(vr.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!i;){let a=e[t++];if(t===e[0]&&(i=!0),a<vr.TEXT_COMPACTION_MODE_LATCH)s[n]=a,n++;else switch(a){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:t--,i=!0}(n%vr.MAX_NUMERIC_CODEWORDS===0||a===vr.NUMERIC_COMPACTION_MODE_LATCH||i)&&n>0&&(r.append(vr.decodeBase900toBase10(s,n)),n=0)}return t}static decodeBase900toBase10(e,t){let r=wr(0);for(let i=0;i<t;i++)r+=vr.EXP900[t-i-1]*wr(e[i]);let n=r.toString();if("1"!==n.charAt(0))throw new E;return n.substring(1)}}vr.TEXT_COMPACTION_MODE_LATCH=900,vr.BYTE_COMPACTION_MODE_LATCH=901,vr.NUMERIC_COMPACTION_MODE_LATCH=902,vr.BYTE_COMPACTION_MODE_LATCH_6=924,vr.ECI_USER_DEFINED=925,vr.ECI_GENERAL_PURPOSE=926,vr.ECI_CHARSET=927,vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,vr.MACRO_PDF417_TERMINATOR=922,vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,vr.MAX_NUMERIC_CODEWORDS=15,vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,vr.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,vr.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,vr.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,vr.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,vr.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,vr.PL=25,vr.LL=27,vr.AS=27,vr.ML=28,vr.AL=28,vr.PS=29,vr.PAL=29,vr.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",vr.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",vr.EXP900=xr()?br():[],vr.NUMBER_OF_SEQUENCE_CODEWORDS=2;class Cr{constructor(){}static decode(e,t,r,n,i,s,a){let o,l=new rr(e,t,r,n,i),c=null,d=null;for(let p=!0;;p=!1){if(null!=t&&(c=Cr.getRowIndicatorColumn(e,l,t,!0,s,a)),null!=n&&(d=Cr.getRowIndicatorColumn(e,l,n,!1,s,a)),o=Cr.merge(c,d),null==o)throw N.getNotFoundInstance();let r=o.getBoundingBox();if(!p||null==r||!(r.getMinY()<l.getMinY()||r.getMaxY()>l.getMaxY()))break;l=r}o.setBoundingBox(l);let u=o.getBarcodeColumnCount()+1;o.setDetectionResultColumn(0,c),o.setDetectionResultColumn(u,d);let h=null!=c;for(let p=1;p<=u;p++){let t,r=h?p:u-p;if(void 0!==o.getDetectionResultColumn(r))continue;t=0===r||r===u?new or(l,0===r):new sr(l),o.setDetectionResultColumn(r,t);let n=-1,i=n;for(let c=l.getMinY();c<=l.getMaxY();c++){if(n=Cr.getStartColumn(o,r,c,h),n<0||n>l.getMaxX()){if(-1===i)continue;n=i}let d=Cr.detectCodeword(e,l.getMinX(),l.getMaxX(),h,n,c,s,a);null!=d&&(t.setCodeword(c,d),i=n,s=Math.min(s,d.getWidth()),a=Math.max(a,d.getWidth()))}}return Cr.createDecoderResult(o)}static merge(e,t){if(null==e&&null==t)return null;let r=Cr.getBarcodeMetadata(e,t);if(null==r)return null;let n=rr.merge(Cr.adjustBoundingBox(e),Cr.adjustBoundingBox(t));return new lr(r,n)}static adjustBoundingBox(e){if(null==e)return null;let t=e.getRowHeights();if(null==t)return null;let r=Cr.getMax(t),n=0;for(let a of t)if(n+=r-a,a>0)break;let i=e.getCodewords();for(let a=0;n>0&&null==i[a];a++)n--;let s=0;for(let a=t.length-1;a>=0&&(s+=r-t[a],!(t[a]>0));a--);for(let a=i.length-1;s>0&&null==i[a];a--)s--;return e.getBoundingBox().addMissingRows(n,s,e.isLeft())}static getMax(e){let t=-1;for(let r of e)t=Math.max(t,r);return t}static getBarcodeMetadata(e,t){let r,n;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(n=t.getBarcodeMetadata())?r:r.getColumnCount()!==n.getColumnCount()&&r.getErrorCorrectionLevel()!==n.getErrorCorrectionLevel()&&r.getRowCount()!==n.getRowCount()?null:r}static getRowIndicatorColumn(e,t,r,n,i,s){let a=new or(t,n);for(let o=0;o<2;o++){let l=0===o?1:-1,c=Math.trunc(Math.trunc(r.getX()));for(let o=Math.trunc(Math.trunc(r.getY()));o<=t.getMaxY()&&o>=t.getMinY();o+=l){let t=Cr.detectCodeword(e,0,e.getWidth(),n,c,o,i,s);null!=t&&(a.setCodeword(o,t),c=n?t.getStartX():t.getEndX())}}return a}static adjustCodewordCount(e,t){let r=t[0][1],n=r.getValue(),i=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-Cr.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===n.length){if(i<1||i>Yt.MAX_CODEWORDS_IN_BARCODE)throw N.getNotFoundInstance();r.setValue(i)}else n[0]!==i&&r.setValue(i)}static createDecoderResult(e){let t=Cr.createBarcodeMatrix(e);Cr.adjustCodewordCount(e,t);let r=new Array,n=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),i=[],s=new Array;for(let o=0;o<e.getBarcodeRowCount();o++)for(let a=0;a<e.getBarcodeColumnCount();a++){let l=t[o][a+1].getValue(),c=o*e.getBarcodeColumnCount()+a;0===l.length?r.push(c):1===l.length?n[c]=l[0]:(s.push(c),i.push(l))}let a=new Array(i.length);for(let o=0;o<a.length;o++)a[o]=i[o];return Cr.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),n,Yt.toIntArray(r),Yt.toIntArray(s),a)}static createDecoderResultFromAmbiguousValues(e,t,r,n,i){let s=new Int32Array(n.length),a=100;for(;a-- >0;){for(let e=0;e<s.length;e++)t[n[e]]=i[e][s[e]];try{return Cr.decodeCodewords(t,e,r)}catch(o){if(!(o instanceof p))throw o}if(0===s.length)throw p.getChecksumInstance();for(let e=0;e<s.length;e++){if(s[e]<i[e].length-1){s[e]++;break}if(s[e]=0,e===s.length-1)throw p.getChecksumInstance()}}throw p.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},(()=>new Array(e.getBarcodeColumnCount()+2)));for(let n=0;n<t.length;n++)for(let e=0;e<t[n].length;e++)t[n][e]=new ar;let r=0;for(let n of e.getDetectionResultColumns()){if(null!=n)for(let e of n.getCodewords())if(null!=e){let n=e.getRowNumber();if(n>=0){if(n>=t.length)continue;t[n][r].setValue(e.getValue())}}r++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,r,n){let i=n?1:-1,s=null;if(Cr.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodeword(r)),null!=s)return n?s.getEndX():s.getStartX();if(s=e.getDetectionResultColumn(t).getCodewordNearby(r),null!=s)return n?s.getStartX():s.getEndX();if(Cr.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodewordNearby(r)),null!=s)return n?s.getEndX():s.getStartX();let a=0;for(;Cr.isValidBarcodeColumn(e,t-i);){t-=i;for(let r of e.getDetectionResultColumn(t).getCodewords())if(null!=r)return(n?r.getEndX():r.getStartX())+i*a*(r.getEndX()-r.getStartX());a++}return n?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,r,n,i,s,a,o){i=Cr.adjustCodewordStartColumn(e,t,r,n,i,s);let l,c=Cr.getModuleBitCount(e,t,r,n,i,s);if(null==c)return null;let d=pe.sum(c);if(n)l=i+d;else{for(let e=0;e<c.length/2;e++){let t=c[e];c[e]=c[c.length-1-e],c[c.length-1-e]=t}l=i,i=l-d}if(!Cr.checkCodewordSkew(d,a,o))return null;let u=dr.getDecodedValue(c),h=Yt.getCodeword(u);return-1===h?null:new cr(i,l,Cr.getCodewordBucketNumber(u),h)}static getModuleBitCount(e,t,r,n,i,s){let a=i,o=new Int32Array(8),l=0,c=n?1:-1,d=n;for(;(n?a<r:a>=t)&&l<o.length;)e.get(a,s)===d?(o[l]++,a+=c):(l++,d=!d);return l===o.length||a===(n?r:t)&&l===o.length-1?o:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,r,n,i,s){let a=i,o=n?-1:1;for(let l=0;l<2;l++){for(;(n?a>=t:a<r)&&n===e.get(a,s);){if(Math.abs(i-a)>Cr.CODEWORD_SKEW_SIZE)return i;a+=o}o=-o,n=!n}return a}static checkCodewordSkew(e,t,r){return t-Cr.CODEWORD_SKEW_SIZE<=e&&e<=r+Cr.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,r){if(0===e.length)throw E.getFormatInstance();let n=1<<t+1,i=Cr.correctErrors(e,r,n);Cr.verifyCodewordCount(e,n);let s=vr.decode(e,""+t);return s.setErrorsCorrected(i),s.setErasures(r.length),s}static correctErrors(e,t,r){if(null!=t&&t.length>r/2+Cr.MAX_ERRORS||r<0||r>Cr.MAX_EC_CODEWORDS)throw p.getChecksumInstance();return Cr.errorCorrection.decode(e,r,t)}static verifyCodewordCount(e,t){if(e.length<4)throw E.getFormatInstance();let r=e[0];if(r>e.length)throw E.getFormatInstance();if(0===r){if(!(t<e.length))throw E.getFormatInstance();e[0]=e.length-t}}static getBitCountForCodeword(e){let t=new Int32Array(8),r=0,n=t.length-1;for(;!((1&e)!==r&&(r=1&e,n--,n<0));)t[n]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return Cr.getCodewordBucketNumber(Cr.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new ir;for(let r=0;r<e.length;r++){t.format("Row %2d: ",r);for(let n=0;n<e[r].length;n++){let i=e[r][n];0===i.getValue().length?t.format("        ",null):t.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}t.format("%n")}return t.toString()}}Cr.CODEWORD_SKEW_SIZE=2,Cr.MAX_ERRORS=3,Cr.MAX_EC_CODEWORDS=512,Cr.errorCorrection=new tr;class _r{decode(e,t=null){let r=_r.decode(e,t,!1);if(null==r||0===r.length||null==r[0])throw N.getNotFoundInstance();return r[0]}decodeMultiple(e,t=null){try{return _r.decode(e,t,!0)}catch(r){if(r instanceof E||r instanceof p)throw N.getNotFoundInstance();throw r}}static decode(e,t,r){const n=new Array,i=Kt.detectMultiple(e,t,r);for(const s of i.getPoints()){const e=Cr.decode(i.getBits(),s[4],s[5],s[6],s[7],_r.getMinCodewordWidth(s),_r.getMaxCodewordWidth(s)),t=new U(e.getText(),e.getRawBytes(),void 0,s,G.PDF_417);t.putMetadata(ne.ERROR_CORRECTION_LEVEL,e.getECLevel());const r=e.getOther();null!=r&&t.putMetadata(ne.PDF417_EXTRA_METADATA,r),n.push(t)}return n.map((e=>e))}static getMaxWidth(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return null==e||null==t?w.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(_r.getMaxWidth(e[0],e[4]),_r.getMaxWidth(e[6],e[2])*Yt.MODULES_IN_CODEWORD/Yt.MODULES_IN_STOP_PATTERN),Math.max(_r.getMaxWidth(e[1],e[5]),_r.getMaxWidth(e[7],e[3])*Yt.MODULES_IN_CODEWORD/Yt.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(_r.getMinWidth(e[0],e[4]),_r.getMinWidth(e[6],e[2])*Yt.MODULES_IN_CODEWORD/Yt.MODULES_IN_STOP_PATTERN),Math.min(_r.getMinWidth(e[1],e[5]),_r.getMinWidth(e[7],e[3])*Yt.MODULES_IN_CODEWORD/Yt.MODULES_IN_STOP_PATTERN)))}reset(){}}class Er extends c{}Er.kind="ReaderException";class Ar{constructor(e,t){this.verbose=!0===e,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const r=!t(e)&&!0===e.get(_.TRY_HARDER),n=t(e)?null:e.get(_.POSSIBLE_FORMATS),i=new Array;if(!t(n)){const t=n.some((e=>e===G.UPC_A||e===G.UPC_E||e===G.EAN_13||e===G.EAN_8||e===G.CODABAR||e===G.CODE_39||e===G.CODE_93||e===G.CODE_128||e===G.ITF||e===G.RSS_14||e===G.RSS_EXPANDED));t&&!r&&i.push(new gt(e,this.verbose)),n.includes(G.QR_CODE)&&i.push(new Xt),n.includes(G.DATA_MATRIX)&&i.push(new It),n.includes(G.AZTEC)&&i.push(new Ae),n.includes(G.PDF_417)&&i.push(new _r),t&&r&&i.push(new gt(e,this.verbose))}0===i.length&&(r||i.push(new gt(e,this.verbose)),i.push(new Xt),i.push(new It),i.push(new Ae),i.push(new _r),r&&i.push(new gt(e,this.verbose))),this.readers=i}reset(){if(null!==this.readers)for(const e of this.readers)e.reset()}decodeInternal(e){if(null===this.readers)throw new Er("No readers where selected, nothing can be read.");for(const r of this.readers)try{return r.decode(e,this.hints)}catch(t){if(t instanceof Er)continue}throw new N("No MultiFormat Readers were able to detect the code.")}}class Sr extends W{constructor(e=null,t=500){const r=new Ar;r.setHints(e),super(r,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class jr extends W{constructor(e=500){super(new _r,e)}}class Ir extends W{constructor(e=500){super(new Xt,e)}}var Tr,Rr;(Rr=Tr||(Tr={}))[Rr.ERROR_CORRECTION=0]="ERROR_CORRECTION",Rr[Rr.CHARACTER_SET=1]="CHARACTER_SET",Rr[Rr.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",Rr[Rr.MIN_SIZE=3]="MIN_SIZE",Rr[Rr.MAX_SIZE=4]="MAX_SIZE",Rr[Rr.MARGIN=5]="MARGIN",Rr[Rr.PDF417_COMPACT=6]="PDF417_COMPACT",Rr[Rr.PDF417_COMPACTION=7]="PDF417_COMPACTION",Rr[Rr.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",Rr[Rr.AZTEC_LAYERS=9]="AZTEC_LAYERS",Rr[Rr.QR_VERSION=10]="QR_VERSION";var Nr=Tr;class Dr{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new ae(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let r=t[t.length-1];const n=this.field;for(let i=t.length;i<=e;i++){const e=r.multiply(new ae(n,Int32Array.from([1,n.exp(i-1+n.getGeneratorBase())])));t.push(e),r=e}}return t[e]}encode(e,t){if(0===t)throw new u("No error correction bytes");const r=e.length-t;if(r<=0)throw new u("No data bytes provided");const n=this.buildGenerator(t),i=new Int32Array(r);f.arraycopy(e,0,i,0,r);let s=new ae(this.field,i);s=s.multiplyByMonomial(t,1);const a=s.divide(n)[1].getCoefficients(),o=t-a.length;for(let l=0;l<o;l++)e[r+l]=0;f.arraycopy(a,0,e,r+o,a.length)}}class Or{constructor(){}static applyMaskPenaltyRule1(e){return Or.applyMaskPenaltyRule1Internal(e,!0)+Or.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let s=0;s<i-1;s++){const e=r[s];for(let i=0;i<n-1;i++){const n=e[i];n===e[i+1]&&n===r[s+1][i]&&n===r[s+1][i+1]&&t++}}return Or.N2*t}static applyMaskPenaltyRule3(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let s=0;s<i;s++)for(let e=0;e<n;e++){const a=r[s];e+6<n&&1===a[e]&&0===a[e+1]&&1===a[e+2]&&1===a[e+3]&&1===a[e+4]&&0===a[e+5]&&1===a[e+6]&&(Or.isWhiteHorizontal(a,e-4,e)||Or.isWhiteHorizontal(a,e+7,e+11))&&t++,s+6<i&&1===r[s][e]&&0===r[s+1][e]&&1===r[s+2][e]&&1===r[s+3][e]&&1===r[s+4][e]&&0===r[s+5][e]&&1===r[s+6][e]&&(Or.isWhiteVertical(r,e,s-4,s)||Or.isWhiteVertical(r,e,s+7,s+11))&&t++}return t*Or.N3}static isWhiteHorizontal(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(let n=t;n<r;n++)if(1===e[n])return!1;return!0}static isWhiteVertical(e,t,r,n){r=Math.max(r,0),n=Math.min(n,e.length);for(let i=r;i<n;i++)if(1===e[i][t])return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let a=0;a<i;a++){const e=r[a];for(let r=0;r<n;r++)1===e[r]&&t++}const s=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-s)/s)*Or.N4}static getDataMaskBit(e,t,r){let n,i;switch(e){case 0:n=r+t&1;break;case 1:n=1&r;break;case 2:n=t%3;break;case 3:n=(r+t)%3;break;case 4:n=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:i=r*t,n=(1&i)+i%3;break;case 6:i=r*t,n=(1&i)+i%3&1;break;case 7:i=r*t,n=i%3+(r+t&1)&1;break;default:throw new u("Invalid mask pattern: "+e)}return 0===n}static applyMaskPenaltyRule1Internal(e,t){let r=0;const n=t?e.getHeight():e.getWidth(),i=t?e.getWidth():e.getHeight(),s=e.getArray();for(let a=0;a<n;a++){let e=0,n=-1;for(let o=0;o<i;o++){const i=t?s[a][o]:s[o][a];i===n?e++:(e>=5&&(r+=Or.N1+(e-5)),e=1,n=i)}e>=5&&(r+=Or.N1+(e-5))}return r}}Or.N1=3,Or.N2=3,Or.N3=40,Or.N4=10;class Pr{constructor(e,t){this.width=e,this.height=t;const r=new Array(t);for(let n=0;n!==t;n++)r[n]=new Uint8Array(e);this.bytes=r}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,r){this.bytes[t][e]=r}setBoolean(e,t,r){this.bytes[t][e]=r?1:0}clear(e){for(const t of this.bytes)y.fill(t,e)}equals(e){if(!(e instanceof Pr))return!1;const t=e;if(this.width!==t.width)return!1;if(this.height!==t.height)return!1;for(let r=0,n=this.height;r<n;++r){const e=this.bytes[r],n=t.bytes[r];for(let t=0,r=this.width;t<r;++t)if(e[t]!==n[t])return!1}return!0}toString(){const e=new T;for(let t=0,r=this.height;t<r;++t){const r=this.bytes[t];for(let t=0,n=this.width;t<n;++t)switch(r[t]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()}}class Mr{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new T;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<Mr.NUM_MASK_PATTERNS}}Mr.NUM_MASK_PATTERNS=8;class kr extends c{}kr.kind="WriterException";class Br{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,r,n,i){Br.clearMatrix(i),Br.embedBasicPatterns(r,i),Br.embedTypeInfo(t,n,i),Br.maybeEmbedVersionInfo(r,i),Br.embedDataBits(e,n,i)}static embedBasicPatterns(e,t){Br.embedPositionDetectionPatternsAndSeparators(t),Br.embedDarkDotAtLeftBottomCorner(t),Br.maybeEmbedPositionAdjustmentPatterns(e,t),Br.embedTimingPatterns(t)}static embedTypeInfo(e,t,r){const n=new b;Br.makeTypeInfoBits(e,t,n);for(let i=0,s=n.getSize();i<s;++i){const e=n.get(n.getSize()-1-i),t=Br.TYPE_INFO_COORDINATES[i],s=t[0],a=t[1];if(r.setBoolean(s,a,e),i<8){const t=r.getWidth()-i-1,n=8;r.setBoolean(t,n,e)}else{const t=8,n=r.getHeight()-7+(i-8);r.setBoolean(t,n,e)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const r=new b;Br.makeVersionInfoBits(e,r);let n=17;for(let i=0;i<6;++i)for(let e=0;e<3;++e){const s=r.get(n);n--,t.setBoolean(i,t.getHeight()-11+e,s),t.setBoolean(t.getHeight()-11+e,i,s)}}static embedDataBits(e,t,r){let n=0,i=-1,s=r.getWidth()-1,a=r.getHeight()-1;for(;s>0;){for(6===s&&(s-=1);a>=0&&a<r.getHeight();){for(let i=0;i<2;++i){const o=s-i;if(!Br.isEmpty(r.get(o,a)))continue;let l;n<e.getSize()?(l=e.get(n),++n):l=!1,255!==t&&Or.getDataMaskBit(t,o,a)&&(l=!l),r.setBoolean(o,a,l)}a+=i}i=-i,a+=i,s-=2}if(n!==e.getSize())throw new kr("Not all bits consumed: "+n+"/"+e.getSize())}static findMSBSet(e){return 32-w.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(0===t)throw new u("0 polynomial");const r=Br.findMSBSet(t);for(e<<=r-1;Br.findMSBSet(e)>=r;)e^=t<<Br.findMSBSet(e)-r;return e}static makeTypeInfoBits(e,t,r){if(!Mr.isValidMaskPattern(t))throw new kr("Invalid mask pattern");const n=e.getBits()<<3|t;r.appendBits(n,5);const i=Br.calculateBCHCode(n,Br.TYPE_INFO_POLY);r.appendBits(i,10);const s=new b;if(s.appendBits(Br.TYPE_INFO_MASK_PATTERN,15),r.xor(s),15!==r.getSize())throw new kr("should not happen but we got: "+r.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const r=Br.calculateBCHCode(e.getVersionNumber(),Br.VERSION_INFO_POLY);if(t.appendBits(r,12),18!==t.getSize())throw new kr("should not happen but we got: "+t.getSize())}static isEmpty(e){return 255===e}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const r=(t+1)%2;Br.isEmpty(e.get(t,6))&&e.setNumber(t,6,r),Br.isEmpty(e.get(6,t))&&e.setNumber(6,t,r)}}static embedDarkDotAtLeftBottomCorner(e){if(0===e.get(8,e.getHeight()-8))throw new kr;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,r){for(let n=0;n<8;++n){if(!Br.isEmpty(r.get(e+n,t)))throw new kr;r.setNumber(e+n,t,0)}}static embedVerticalSeparationPattern(e,t,r){for(let n=0;n<7;++n){if(!Br.isEmpty(r.get(e,t+n)))throw new kr;r.setNumber(e,t+n,0)}}static embedPositionAdjustmentPattern(e,t,r){for(let n=0;n<5;++n){const i=Br.POSITION_ADJUSTMENT_PATTERN[n];for(let s=0;s<5;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPattern(e,t,r){for(let n=0;n<7;++n){const i=Br.POSITION_DETECTION_PATTERN[n];for(let s=0;s<7;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPatternsAndSeparators(e){const t=Br.POSITION_DETECTION_PATTERN[0].length;Br.embedPositionDetectionPattern(0,0,e),Br.embedPositionDetectionPattern(e.getWidth()-t,0,e),Br.embedPositionDetectionPattern(0,e.getWidth()-t,e);const r=8;Br.embedHorizontalSeparationPattern(0,r-1,e),Br.embedHorizontalSeparationPattern(e.getWidth()-r,r-1,e),Br.embedHorizontalSeparationPattern(0,e.getWidth()-r,e);const n=7;Br.embedVerticalSeparationPattern(n,0,e),Br.embedVerticalSeparationPattern(e.getHeight()-n-1,0,e),Br.embedVerticalSeparationPattern(n,e.getHeight()-n,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const r=e.getVersionNumber()-1,n=Br.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[r];for(let i=0,s=n.length;i!==s;i++){const e=n[i];if(e>=0)for(let r=0;r!==s;r++){const i=n[r];i>=0&&Br.isEmpty(t.get(i,e))&&Br.embedPositionAdjustmentPattern(i-2,e-2,t)}}}}Br.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Br.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Br.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Br.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Br.VERSION_INFO_POLY=7973,Br.TYPE_INFO_POLY=1335,Br.TYPE_INFO_MASK_PATTERN=21522;class Lr{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Fr{constructor(){}static calculateMaskPenalty(e){return Or.applyMaskPenaltyRule1(e)+Or.applyMaskPenaltyRule2(e)+Or.applyMaskPenaltyRule3(e)+Or.applyMaskPenaltyRule4(e)}static encode(e,t,r=null){let n=Fr.DEFAULT_BYTE_MODE_ENCODING;const i=null!==r&&void 0!==r.get(Nr.CHARACTER_SET);i&&(n=r.get(Nr.CHARACTER_SET).toString());const s=this.chooseMode(e,n),a=new b;if(s===Lt.BYTE&&(i||Fr.DEFAULT_BYTE_MODE_ENCODING!==n)){const e=A.getCharacterSetECIByName(n);void 0!==e&&this.appendECI(e,a)}this.appendModeInfo(s,a);const o=new b;let l;if(this.appendBytes(e,s,o,n),null!==r&&void 0!==r.get(Nr.QR_VERSION)){const e=Number.parseInt(r.get(Nr.QR_VERSION).toString(),10);l=Pt.getVersionForNumber(e);const n=this.calculateBitsNeeded(s,a,o,l);if(!this.willFit(n,l,t))throw new kr("Data too big for requested version")}else l=this.recommendVersion(t,s,a,o);const c=new b;c.appendBitArray(a);const d=s===Lt.BYTE?o.getSizeInBytes():e.length;this.appendLengthInfo(d,l,s,c),c.appendBitArray(o);const u=l.getECBlocksForLevel(t),h=l.getTotalCodewords()-u.getTotalECCodewords();this.terminateBits(h,c);const p=this.interleaveWithECBytes(c,l.getTotalCodewords(),h,u.getNumBlocks()),m=new Mr;m.setECLevel(t),m.setMode(s),m.setVersion(l);const f=l.getDimensionForVersion(),g=new Pr(f,f),x=this.chooseMaskPattern(p,t,l,g);return m.setMaskPattern(x),Br.buildMatrix(p,t,l,x,g),m.setMatrix(g),m}static recommendVersion(e,t,r,n){const i=this.calculateBitsNeeded(t,r,n,Pt.getVersionForNumber(1)),s=this.chooseVersion(i,e),a=this.calculateBitsNeeded(t,r,n,s);return this.chooseVersion(a,e)}static calculateBitsNeeded(e,t,r,n){return t.getSize()+e.getCharacterCountBits(n)+r.getSize()}static getAlphanumericCode(e){return e<Fr.ALPHANUMERIC_TABLE.length?Fr.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(A.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return Lt.KANJI;let r=!1,n=!1;for(let i=0,s=e.length;i<s;++i){const t=e.charAt(i);if(Fr.isDigit(t))r=!0;else{if(-1===this.getAlphanumericCode(t.charCodeAt(0)))return Lt.BYTE;n=!0}}return n?Lt.ALPHANUMERIC:r?Lt.NUMERIC:Lt.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=j.encode(e,A.SJIS)}catch(n){return!1}const r=t.length;if(r%2!=0)return!1;for(let i=0;i<r;i+=2){const e=255&t[i];if((e<129||e>159)&&(e<224||e>235))return!1}return!0}static chooseMaskPattern(e,t,r,n){let i=Number.MAX_SAFE_INTEGER,s=-1;for(let a=0;a<Mr.NUM_MASK_PATTERNS;a++){Br.buildMatrix(e,t,r,a,n);let o=this.calculateMaskPenalty(n);o<i&&(i=o,s=a)}return s}static chooseVersion(e,t){for(let r=1;r<=40;r++){const n=Pt.getVersionForNumber(r);if(Fr.willFit(e,n,t))return n}throw new kr("Data too big")}static willFit(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8}static terminateBits(e,t){const r=8*e;if(t.getSize()>r)throw new kr("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(let s=0;s<4&&t.getSize()<r;++s)t.appendBit(!1);const n=7&t.getSize();if(n>0)for(let s=n;s<8;s++)t.appendBit(!1);const i=e-t.getSizeInBytes();for(let s=0;s<i;++s)t.appendBits(1&s?17:236,8);if(t.getSize()!==r)throw new kr("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,r,n,i,s){if(n>=r)throw new kr("Block ID too large");const a=e%r,o=r-a,l=Math.floor(e/r),c=l+1,d=Math.floor(t/r),u=d+1,h=l-d,p=c-u;if(h!==p)throw new kr("EC bytes mismatch");if(r!==o+a)throw new kr("RS blocks mismatch");if(e!==(d+h)*o+(u+p)*a)throw new kr("Total bytes mismatch");n<o?(i[0]=d,s[0]=h):(i[0]=u,s[0]=p)}static interleaveWithECBytes(e,t,r,n){if(e.getSizeInBytes()!==r)throw new kr("Number of bits and data bytes does not match");let i=0,s=0,a=0;const o=new Array;for(let c=0;c<n;++c){const l=new Int32Array(1),d=new Int32Array(1);Fr.getNumDataBytesAndNumECBytesForBlockID(t,r,n,c,l,d);const u=l[0],h=new Uint8Array(u);e.toBytes(8*i,h,0,u);const p=Fr.generateECBytes(h,d[0]);o.push(new Lr(h,p)),s=Math.max(s,u),a=Math.max(a,p.length),i+=l[0]}if(r!==i)throw new kr("Data bytes does not match offset");const l=new b;for(let c=0;c<s;++c)for(const e of o){const t=e.getDataBytes();c<t.length&&l.appendBits(t[c],8)}for(let c=0;c<a;++c)for(const e of o){const t=e.getErrorCorrectionBytes();c<t.length&&l.appendBits(t[c],8)}if(t!==l.getSizeInBytes())throw new kr("Interleaving error: "+t+" and "+l.getSizeInBytes()+" differ.");return l}static generateECBytes(e,t){const r=e.length,n=new Int32Array(r+t);for(let s=0;s<r;s++)n[s]=255&e[s];new Dr(le.QR_CODE_FIELD_256).encode(n,t);const i=new Uint8Array(t);for(let s=0;s<t;s++)i[s]=n[r+s];return i}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,r,n){const i=r.getCharacterCountBits(t);if(e>=1<<i)throw new kr(e+" is bigger than "+((1<<i)-1));n.appendBits(e,i)}static appendBytes(e,t,r,n){switch(t){case Lt.NUMERIC:Fr.appendNumericBytes(e,r);break;case Lt.ALPHANUMERIC:Fr.appendAlphanumericBytes(e,r);break;case Lt.BYTE:Fr.append8BitBytes(e,r,n);break;case Lt.KANJI:Fr.appendKanjiBytes(e,r);break;default:throw new kr("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=Fr.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const r=e.length;let n=0;for(;n<r;){const i=Fr.getDigit(e.charAt(n));if(n+2<r){const r=Fr.getDigit(e.charAt(n+1)),s=Fr.getDigit(e.charAt(n+2));t.appendBits(100*i+10*r+s,10),n+=3}else if(n+1<r){const r=Fr.getDigit(e.charAt(n+1));t.appendBits(10*i+r,7),n+=2}else t.appendBits(i,4),n++}}static appendAlphanumericBytes(e,t){const r=e.length;let n=0;for(;n<r;){const i=Fr.getAlphanumericCode(e.charCodeAt(n));if(-1===i)throw new kr;if(n+1<r){const r=Fr.getAlphanumericCode(e.charCodeAt(n+1));if(-1===r)throw new kr;t.appendBits(45*i+r,11),n+=2}else t.appendBits(i,6),n++}}static append8BitBytes(e,t,r){let n;try{n=j.encode(e,r)}catch(i){throw new kr(i)}for(let s=0,a=n.length;s!==a;s++){const e=n[s];t.appendBits(e,8)}}static appendKanjiBytes(e,t){let r;try{r=j.encode(e,A.SJIS)}catch(i){throw new kr(i)}const n=r.length;for(let s=0;s<n;s+=2){const e=(255&r[s])<<8&4294967295|255&r[s+1];let n=-1;if(e>=33088&&e<=40956?n=e-33088:e>=57408&&e<=60351&&(n=e-49472),-1===n)throw new kr("Invalid byte sequence");const i=192*(n>>8)+(255&n);t.appendBits(i,13)}}static appendECI(e,t){t.appendBits(Lt.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}Fr.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Fr.DEFAULT_BYTE_MODE_ENCODING=A.UTF8.getName();class zr{write(e,t,r,n=null){if(0===e.length)throw new u("Found empty contents");if(t<0||r<0)throw new u("Requested dimensions are too small: "+t+"x"+r);let i=Rt.L,s=zr.QUIET_ZONE_SIZE;null!==n&&(void 0!==n.get(Nr.ERROR_CORRECTION)&&(i=Rt.fromString(n.get(Nr.ERROR_CORRECTION).toString())),void 0!==n.get(Nr.MARGIN)&&(s=Number.parseInt(n.get(Nr.MARGIN).toString(),10)));const a=Fr.encode(e,i,n);return this.renderResult(a,t,r,s)}writeToDom(e,t,r,n,i=null){"string"==typeof e&&(e=document.querySelector(e));const s=this.write(t,r,n,i);e&&e.appendChild(s)}renderResult(e,t,r,n){const i=e.getMatrix();if(null===i)throw new de;const s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,c=Math.max(t,o),d=Math.max(r,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-s*u)/2),p=Math.floor((d-a*u)/2),m=this.createSVGElement(c,d);for(let f=0,g=p;f<a;f++,g+=u)for(let e=0,t=h;e<s;e++,t+=u)if(1===i.get(e,f)){const e=this.createSvgRectElement(t,g,u,u);m.appendChild(e)}return m}createSVGElement(e,t){const r=document.createElementNS(zr.SVG_NS,"svg");return r.setAttributeNS(null,"height",e.toString()),r.setAttributeNS(null,"width",t.toString()),r}createSvgRectElement(e,t,r,n){const i=document.createElementNS(zr.SVG_NS,"rect");return i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y",t.toString()),i.setAttributeNS(null,"height",r.toString()),i.setAttributeNS(null,"width",n.toString()),i.setAttributeNS(null,"fill","#000000"),i}}zr.QUIET_ZONE_SIZE=4,zr.SVG_NS="http://www.w3.org/2000/svg";class Wr{encode(e,t,r,n,i){if(0===e.length)throw new u("Found empty contents");if(t!==G.QR_CODE)throw new u("Can only encode QR_CODE, but got "+t);if(r<0||n<0)throw new u(`Requested dimensions are too small: ${r}x${n}`);let s=Rt.L,a=Wr.QUIET_ZONE_SIZE;null!==i&&(void 0!==i.get(Nr.ERROR_CORRECTION)&&(s=Rt.fromString(i.get(Nr.ERROR_CORRECTION).toString())),void 0!==i.get(Nr.MARGIN)&&(a=Number.parseInt(i.get(Nr.MARGIN).toString(),10)));const o=Fr.encode(e,s,i);return Wr.renderResult(o,r,n,a)}static renderResult(e,t,r,n){const i=e.getMatrix();if(null===i)throw new de;const s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,c=Math.max(t,o),d=Math.max(r,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-s*u)/2),p=Math.floor((d-a*u)/2),m=new R(c,d);for(let f=0,g=p;f<a;f++,g+=u)for(let e=0,t=h;e<s;e++,t+=u)1===i.get(e,f)&&m.setRegion(t,g,u,u);return m}}Wr.QUIET_ZONE_SIZE=4;class Ur{encode(e,t,r,n,i){let s;if(t!==G.QR_CODE)throw new u("No encoder available for format "+t);return s=new Wr,s.encode(e,t,r,n,i)}}class Vr extends P{constructor(e,t,r,n,i,s,a,o){if(super(s,a),this.yuvData=e,this.dataWidth=t,this.dataHeight=r,this.left=n,this.top=i,n+s>t||i+a>r)throw new u("Crop rectangle does not fit within image data.");o&&this.reverseHorizontal(s,a)}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));const n=(e+this.top)*this.dataWidth+this.left;return f.arraycopy(this.yuvData,n,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const r=e*t,n=new Uint8ClampedArray(r);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return f.arraycopy(this.yuvData,i,n,0,r),n;for(let s=0;s<t;s++){const t=s*e;f.arraycopy(this.yuvData,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new Vr(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,r,n,!1)}renderThumbnail(){const e=this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR,r=new Int32Array(e*t),n=this.yuvData;let i=this.top*this.dataWidth+this.left;for(let s=0;s<t;s++){const t=s*e;for(let s=0;s<e;s++){const e=255&n[i+s*Vr.THUMBNAIL_SCALE_FACTOR];r[t+s]=4278190080|65793*e}i+=this.dataWidth*Vr.THUMBNAIL_SCALE_FACTOR}return r}getThumbnailWidth(){return this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const r=this.yuvData;for(let n=0,i=this.top*this.dataWidth+this.left;n<t;n++,i+=this.dataWidth){const t=i+e/2;for(let n=i,s=i+e-1;n<t;n++,s--){const e=r[n];r[n]=r[s],r[s]=e}}}invert(){return new M(this)}}Vr.THUMBNAIL_SCALE_FACTOR=2;class Hr extends P{constructor(e,t,r,n,i,s,a){if(super(t,r),this.dataWidth=n,this.dataHeight=i,this.left=s,this.top=a,4===e.BYTES_PER_ELEMENT){const n=t*r,i=new Uint8ClampedArray(n);for(let t=0;t<n;t++){const r=e[t],n=r>>16&255,s=r>>7&510,a=255&r;i[t]=(n+s+a)/4&255}this.luminances=i}else this.luminances=e;if(void 0===n&&(this.dataWidth=t),void 0===i&&(this.dataHeight=r),void 0===s&&(this.left=0),void 0===a&&(this.top=0),this.left+t>this.dataWidth||this.top+r>this.dataHeight)throw new u("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));const n=(e+this.top)*this.dataWidth+this.left;return f.arraycopy(this.luminances,n,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const r=e*t,n=new Uint8ClampedArray(r);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return f.arraycopy(this.luminances,i,n,0,r),n;for(let s=0;s<t;s++){const t=s*e;f.arraycopy(this.luminances,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new Hr(this.luminances,r,n,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new M(this)}}class Gr extends A{static forName(e){return this.getCharacterSetECIByName(e)}}class qr{}qr.ISO_8859_1=A.ISO8859_1;class $r{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class Xr{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class Yr{constructor(e){this.previous=e}getPrevious(){return this.previous}}class Zr extends Yr{constructor(e,t,r){super(e),this.value=t,this.bitCount=r}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new Zr(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Zr(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+w.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class Kr extends Zr{constructor(e,t,r){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=r}appendTo(e,t){for(let r=0;r<this.binaryShiftByteCount;r++)(0===r||31===r&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===r?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+r],8)}addBinaryShift(e,t){return new Kr(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Qr(e,t,r){return new Kr(e,t,r)}function Jr(e,t,r){return new Zr(e,t,r)}const en=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],tn=0,rn=1,nn=2,sn=3,an=4,on=new Zr(null,0,0),ln=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];function cn(e){for(let t of e)y.fill(t,-1);return e[tn][an]=0,e[rn][an]=0,e[rn][tn]=28,e[sn][an]=0,e[nn][an]=0,e[nn][tn]=15,e}const dn=cn(y.createInt32Array(6,6));class un{constructor(e,t,r,n){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=n}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let r=this.bitCount,n=this.token;if(e!==this.mode){let t=ln[this.mode][e];n=Jr(n,65535&t,t>>16),r+=t>>16}let i=e===nn?4:5;return n=Jr(n,t,i),new un(n,e,0,r+i)}shiftAndAppend(e,t){let r=this.token,n=this.mode===nn?4:5;return r=Jr(r,dn[this.mode][e],n),r=Jr(r,t,5),new un(r,this.mode,0,this.bitCount+n+5)}addBinaryShiftChar(e){let t=this.token,r=this.mode,n=this.bitCount;if(this.mode===an||this.mode===nn){let e=ln[r][tn];t=Jr(t,65535&e,e>>16),n+=e>>16,r=tn}let i=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,s=new un(t,r,this.binaryShiftByteCount+1,n+i);return 2078===s.binaryShiftByteCount&&(s=s.endBinaryShift(e+1)),s}endBinaryShift(e){if(0===this.binaryShiftByteCount)return this;let t=this.token;return t=Qr(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new un(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(ln[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=un.calculateBinaryShiftCost(e)-un.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let n=this.endBinaryShift(e.length).token;null!==n;n=n.getPrevious())t.unshift(n);let r=new b;for(const n of t)n.appendTo(r,e);return r}toString(){return I.format("%s bits=%d bytes=%d",en[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}function hn(e){const t=I.getCharCode(" "),r=I.getCharCode("."),n=I.getCharCode(",");e[tn][t]=1;const i=I.getCharCode("Z"),s=I.getCharCode("A");for(let h=s;h<=i;h++)e[tn][h]=h-s+2;e[rn][t]=1;const a=I.getCharCode("z"),o=I.getCharCode("a");for(let h=o;h<=a;h++)e[rn][h]=h-o+2;e[nn][t]=1;const l=I.getCharCode("9"),c=I.getCharCode("0");for(let h=c;h<=l;h++)e[nn][h]=h-c+2;e[nn][n]=12,e[nn][r]=13;const d=["\0"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~",""];for(let h=0;h<d.length;h++)e[sn][I.getCharCode(d[h])]=h;const u=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let h=0;h<u.length;h++)I.getCharCode(u[h])>0&&(e[an][I.getCharCode(u[h])]=h);return e}un.INITIAL_STATE=new un(on,tn,0,0);const pn=hn(y.createInt32Array(5,256));class mn{constructor(e){this.text=e}encode(){const e=I.getCharCode(" "),t=I.getCharCode("\n");let r=Xr.singletonList(un.INITIAL_STATE);for(let n=0;n<this.text.length;n++){let i,s=n+1<this.text.length?this.text[n+1]:0;switch(this.text[n]){case I.getCharCode("\r"):i=s===t?2:0;break;case I.getCharCode("."):i=s===e?3:0;break;case I.getCharCode(","):i=s===e?4:0;break;case I.getCharCode(":"):i=s===e?5:0;break;default:i=0}i>0?(r=mn.updateStateListForPair(r,n,i),n++):r=this.updateStateListForChar(r,n)}return Xr.min(r,((e,t)=>e.getBitCount()-t.getBitCount())).toBitArray(this.text)}updateStateListForChar(e,t){const r=[];for(let n of e)this.updateStateForChar(n,t,r);return mn.simplifyStates(r)}updateStateForChar(e,t,r){let n=255&this.text[t],i=pn[e.getMode()][n]>0,s=null;for(let a=0;a<=an;a++){let o=pn[a][n];if(o>0){if(null==s&&(s=e.endBinaryShift(t)),!i||a===e.getMode()||a===nn){const e=s.latchAndAppend(a,o);r.push(e)}if(!i&&dn[e.getMode()][a]>=0){const e=s.shiftAndAppend(a,o);r.push(e)}}}if(e.getBinaryShiftByteCount()>0||0===pn[e.getMode()][n]){let n=e.addBinaryShiftChar(t);r.push(n)}}static updateStateListForPair(e,t,r){const n=[];for(let i of e)this.updateStateForPair(i,t,r,n);return this.simplifyStates(n)}static updateStateForPair(e,t,r,n){let i=e.endBinaryShift(t);if(n.push(i.latchAndAppend(an,r)),e.getMode()!==an&&n.push(i.shiftAndAppend(an,r)),3===r||4===r){let e=i.latchAndAppend(nn,16-r).latchAndAppend(nn,1);n.push(e)}if(e.getBinaryShiftByteCount()>0){let r=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);n.push(r)}}static simplifyStates(e){let t=[];for(const r of e){let e=!0;for(const n of t){if(n.isBetterThanOrEqualTo(r)){e=!1;break}r.isBetterThanOrEqualTo(n)&&(t=t.filter((e=>e!==n)))}e&&t.push(r)}return t}}class fn{constructor(){}static encodeBytes(e){return fn.encode(e,fn.DEFAULT_EC_PERCENT,fn.DEFAULT_AZTEC_LAYERS)}static encode(e,t,r){let n,i,s,a,o,l=new mn(e).encode(),c=w.truncDivision(l.getSize()*t,100)+11,d=l.getSize()+c;if(r!==fn.DEFAULT_AZTEC_LAYERS){if(n=r<0,i=Math.abs(r),i>(n?fn.MAX_NB_BITS_COMPACT:fn.MAX_NB_BITS))throw new u(I.format("Illegal value %s for layers",r));s=fn.totalBitsInLayer(i,n),a=fn.WORD_SIZE[i];let e=s-s%a;if(o=fn.stuffBits(l,a),o.getSize()+c>e)throw new u("Data to large for user specified layer");if(n&&o.getSize()>64*a)throw new u("Data to large for user specified layer")}else{a=0,o=null;for(let e=0;;e++){if(e>fn.MAX_NB_BITS)throw new u("Data too large for an Aztec code");if(n=e<=3,i=n?e+1:e,s=fn.totalBitsInLayer(i,n),d>s)continue;null!=o&&a===fn.WORD_SIZE[i]||(a=fn.WORD_SIZE[i],o=fn.stuffBits(l,a));let t=s-s%a;if(!(n&&o.getSize()>64*a)&&o.getSize()+c<=t)break}}let h,p=fn.generateCheckWords(o,s,a),m=o.getSize()/a,f=fn.generateModeMessage(n,i,m),g=(n?11:14)+4*i,x=new Int32Array(g);if(n){h=g;for(let e=0;e<x.length;e++)x[e]=e}else{h=g+1+2*w.truncDivision(w.truncDivision(g,2)-1,15);let e=w.truncDivision(g,2),t=w.truncDivision(h,2);for(let r=0;r<e;r++){let n=r+w.truncDivision(r,15);x[e-r-1]=t-n-1,x[e+r]=t+n+1}}let y=new R(h);for(let u=0,w=0;u<i;u++){let e=4*(i-u)+(n?9:12);for(let t=0;t<e;t++){let r=2*t;for(let n=0;n<2;n++)p.get(w+r+n)&&y.set(x[2*u+n],x[2*u+t]),p.get(w+2*e+r+n)&&y.set(x[2*u+t],x[g-1-2*u-n]),p.get(w+4*e+r+n)&&y.set(x[g-1-2*u-n],x[g-1-2*u-t]),p.get(w+6*e+r+n)&&y.set(x[g-1-2*u-t],x[2*u+n])}w+=8*e}if(fn.drawModeMessage(y,n,h,f),n)fn.drawBullsEye(y,w.truncDivision(h,2),5);else{fn.drawBullsEye(y,w.truncDivision(h,2),7);for(let e=0,t=0;e<w.truncDivision(g,2)-1;e+=15,t+=16)for(let r=1&w.truncDivision(h,2);r<h;r+=2)y.set(w.truncDivision(h,2)-t,r),y.set(w.truncDivision(h,2)+t,r),y.set(r,w.truncDivision(h,2)-t),y.set(r,w.truncDivision(h,2)+t)}let b=new $r;return b.setCompact(n),b.setSize(h),b.setLayers(i),b.setCodeWords(m),b.setMatrix(y),b}static drawBullsEye(e,t,r){for(let n=0;n<r;n+=2)for(let r=t-n;r<=t+n;r++)e.set(r,t-n),e.set(r,t+n),e.set(t-n,r),e.set(t+n,r);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)}static generateModeMessage(e,t,r){let n=new b;return e?(n.appendBits(t-1,2),n.appendBits(r-1,6),n=fn.generateCheckWords(n,28,4)):(n.appendBits(t-1,5),n.appendBits(r-1,11),n=fn.generateCheckWords(n,40,4)),n}static drawModeMessage(e,t,r,n){let i=w.truncDivision(r,2);if(t)for(let s=0;s<7;s++){let t=i-3+s;n.get(s)&&e.set(t,i-5),n.get(s+7)&&e.set(i+5,t),n.get(20-s)&&e.set(t,i+5),n.get(27-s)&&e.set(i-5,t)}else for(let s=0;s<10;s++){let t=i-5+s+w.truncDivision(s,5);n.get(s)&&e.set(t,i-7),n.get(s+10)&&e.set(i+7,t),n.get(29-s)&&e.set(t,i+7),n.get(39-s)&&e.set(i-7,t)}}static generateCheckWords(e,t,r){let n=e.getSize()/r,i=new Dr(fn.getGF(r)),s=w.truncDivision(t,r),a=fn.bitsToWords(e,r,s);i.encode(a,s-n);let o=t%r,l=new b;l.appendBits(0,o);for(const c of Array.from(a))l.appendBits(c,r);return l}static bitsToWords(e,t,r){let n,i,s=new Int32Array(r);for(n=0,i=e.getSize()/t;n<i;n++){let r=0;for(let i=0;i<t;i++)r|=e.get(n*t+i)?1<<t-i-1:0;s[n]=r}return s}static getGF(e){switch(e){case 4:return le.AZTEC_PARAM;case 6:return le.AZTEC_DATA_6;case 8:return le.AZTEC_DATA_8;case 10:return le.AZTEC_DATA_10;case 12:return le.AZTEC_DATA_12;default:throw new u("Unsupported word size "+e)}}static stuffBits(e,t){let r=new b,n=e.getSize(),i=(1<<t)-2;for(let s=0;s<n;s+=t){let a=0;for(let r=0;r<t;r++)(s+r>=n||e.get(s+r))&&(a|=1<<t-1-r);(a&i)===i?(r.appendBits(a&i,t),s--):0===(a&i)?(r.appendBits(1|a,t),s--):r.appendBits(a,t)}return r}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}fn.DEFAULT_EC_PERCENT=33,fn.DEFAULT_AZTEC_LAYERS=0,fn.MAX_NB_BITS=32,fn.MAX_NB_BITS_COMPACT=4,fn.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class gn{encode(e,t,r,n){return this.encodeWithHints(e,t,r,n,null)}encodeWithHints(e,t,r,n,i){let s=qr.ISO_8859_1,a=fn.DEFAULT_EC_PERCENT,o=fn.DEFAULT_AZTEC_LAYERS;return null!=i&&(i.has(Nr.CHARACTER_SET)&&(s=Gr.forName(i.get(Nr.CHARACTER_SET).toString())),i.has(Nr.ERROR_CORRECTION)&&(a=w.parseInt(i.get(Nr.ERROR_CORRECTION).toString())),i.has(Nr.AZTEC_LAYERS)&&(o=w.parseInt(i.get(Nr.AZTEC_LAYERS).toString()))),gn.encodeLayers(e,t,r,n,s,a,o)}static encodeLayers(e,t,r,n,i,s,a){if(t!==G.AZTEC)throw new u("Can only encode AZTEC, but got "+t);let o=fn.encode(I.getBytes(e,i),s,a);return gn.renderResult(o,r,n)}static renderResult(e,t,r){let n=e.getMatrix();if(null==n)throw new de;let i=n.getWidth(),s=n.getHeight(),a=Math.max(t,i),o=Math.max(r,s),l=Math.min(a/i,o/s),c=(a-i*l)/2,d=(o-s*l)/2,u=new R(a,o);for(let h=0,p=d;h<s;h++,p+=l)for(let e=0,t=c;e<i;e++,t+=l)n.get(e,h)&&u.setRegion(t,p,l,l);return u}}e.AbstractExpandedDecoder=Je,e.ArgumentException=d,e.ArithmeticException=oe,e.AztecCode=$r,e.AztecCodeReader=Ae,e.AztecCodeWriter=gn,e.AztecDecoder=he,e.AztecDetector=Ee,e.AztecDetectorResult=xe,e.AztecEncoder=fn,e.AztecHighLevelEncoder=mn,e.AztecPoint=_e,e.BarcodeFormat=G,e.Binarizer=m,e.BinaryBitmap=h,e.BitArray=b,e.BitMatrix=R,e.BitSource=Et,e.BrowserAztecCodeReader=Se,e.BrowserBarcodeReader=xt,e.BrowserCodeReader=W,e.BrowserDatamatrixCodeReader=Tt,e.BrowserMultiFormatReader=Sr,e.BrowserPDF417Reader=jr,e.BrowserQRCodeReader=Ir,e.BrowserQRCodeSvgWriter=zr,e.CharacterSetECI=A,e.ChecksumException=p,e.Code128Reader=Ie,e.Code39Reader=Te,e.DataMatrixDecodedBitStreamParser=At,e.DataMatrixReader=It,e.DecodeHintType=_,e.DecoderResult=ie,e.DefaultGridSampler=ve,e.DetectorResult=ge,e.EAN13Reader=ke,e.EncodeHintType=Nr,e.Exception=c,e.FormatException=E,e.GenericGF=le,e.GenericGFPoly=ae,e.GlobalHistogramBinarizer=D,e.GridSampler=we,e.GridSamplerInstance=Ce,e.HTMLCanvasElementLuminanceSource=k,e.HybridBinarizer=O,e.ITFReader=Re,e.IllegalArgumentException=u,e.IllegalStateException=de,e.InvertedLuminanceSource=M,e.LuminanceSource=P,e.MathUtils=pe,e.MultiFormatOneDReader=gt,e.MultiFormatReader=Ar,e.MultiFormatWriter=Ur,e.NotFoundException=N,e.OneDReader=je,e.PDF417DecodedBitStreamParser=vr,e.PDF417DecoderErrorCorrection=tr,e.PDF417Reader=_r,e.PDF417ResultMetadata=ur,e.PerspectiveTransform=be,e.PlanarYUVLuminanceSource=Vr,e.QRCodeByteMatrix=Pr,e.QRCodeDataMask=Mt,e.QRCodeDecodedBitStreamParser=Ft,e.QRCodeDecoderErrorCorrectionLevel=Rt,e.QRCodeDecoderFormatInformation=Nt,e.QRCodeEncoder=Fr,e.QRCodeEncoderQRCode=Mr,e.QRCodeMaskUtil=Or,e.QRCodeMatrixUtil=Br,e.QRCodeMode=Lt,e.QRCodeReader=Xt,e.QRCodeVersion=Pt,e.QRCodeWriter=Wr,e.RGBLuminanceSource=Hr,e.RSS14Reader=ft,e.RSSExpandedReader=pt,e.ReaderException=Er,e.ReedSolomonDecoder=ue,e.ReedSolomonEncoder=Dr,e.ReedSolomonException=ce,e.Result=U,e.ResultMetadataType=ne,e.ResultPoint=fe,e.StringUtils=I,e.UnsupportedOperationException=S,e.VideoInputDevice=B,e.WhiteRectangleDetector=ye,e.WriterException=kr,e.ZXingArrays=y,e.ZXingCharset=Gr,e.ZXingInteger=w,e.ZXingStandardCharsets=qr,e.ZXingStringBuilder=T,e.ZXingStringEncoding=j,e.ZXingSystem=f,e.createAbstractExpandedDecoder=dt,Object.defineProperty(e,"__esModule",{value:!0})}(xo.exports);var yo=xo.exports;const wo=zt({__proto__:null,default:bt(yo)},[yo]);var bo,vo,Co=function(){function e(e,t,r){if(this.formatMap=new Map([[Qa.QR_CODE,yo.BarcodeFormat.QR_CODE],[Qa.AZTEC,yo.BarcodeFormat.AZTEC],[Qa.CODABAR,yo.BarcodeFormat.CODABAR],[Qa.CODE_39,yo.BarcodeFormat.CODE_39],[Qa.CODE_93,yo.BarcodeFormat.CODE_93],[Qa.CODE_128,yo.BarcodeFormat.CODE_128],[Qa.DATA_MATRIX,yo.BarcodeFormat.DATA_MATRIX],[Qa.MAXICODE,yo.BarcodeFormat.MAXICODE],[Qa.ITF,yo.BarcodeFormat.ITF],[Qa.EAN_13,yo.BarcodeFormat.EAN_13],[Qa.EAN_8,yo.BarcodeFormat.EAN_8],[Qa.PDF_417,yo.BarcodeFormat.PDF_417],[Qa.RSS_14,yo.BarcodeFormat.RSS_14],[Qa.RSS_EXPANDED,yo.BarcodeFormat.RSS_EXPANDED],[Qa.UPC_A,yo.BarcodeFormat.UPC_A],[Qa.UPC_E,yo.BarcodeFormat.UPC_E],[Qa.UPC_EAN_EXTENSION,yo.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!wo)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=r;var n=this.createZXingFormats(e),i=new Map;i.set(yo.DecodeHintType.POSSIBLE_FORMATS,n),i.set(yo.DecodeHintType.TRY_HARDER,!1),this.hints=i}return e.prototype.decodeAsync=function(e){var t=this;return new Promise((function(r,n){try{r(t.decode(e))}catch(i){n(i)}}))},e.prototype.decode=function(e){var t=new yo.MultiFormatReader(this.verbose,this.hints),r=new yo.HTMLCanvasElementLuminanceSource(e),n=new yo.BinaryBitmap(new yo.HybridBinarizer(r)),i=t.decode(n);return{text:i.text,format:co.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,r,n){e.set(t,r)})),e},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createZXingFormats=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this.formatMap.has(i)?t.push(this.formatMap.get(i)):this.logger.logError("".concat(i," is not supported by")+"ZXingHtml5QrcodeShim")}return t},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),_o=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Eo=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Ao=function(){function e(t,r,n){if(this.formatMap=new Map([[Qa.QR_CODE,"qr_code"],[Qa.AZTEC,"aztec"],[Qa.CODABAR,"codabar"],[Qa.CODE_39,"code_39"],[Qa.CODE_93,"code_93"],[Qa.CODE_128,"code_128"],[Qa.DATA_MATRIX,"data_matrix"],[Qa.ITF,"itf"],[Qa.EAN_13,"ean_13"],[Qa.EAN_8,"ean_8"],[Qa.PDF_417,"pdf417"],[Qa.UPC_A,"upc_a"],[Qa.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=n;var i=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){return"BarcodeDetector"in window&&void 0!==new BarcodeDetector({formats:["qr_code"]})},e.prototype.decodeAsync=function(e){return _o(this,void 0,void 0,(function(){var t,r;return Eo(this,(function(n){switch(n.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=n.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(r=this.selectLargestBarcode(t)).rawValue,format:co.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}]}}))}))},e.prototype.selectLargestBarcode=function(e){for(var t=null,r=0,n=0,i=e;n<i.length;n++){var s=i[n],a=s.boundingBox.width*s.boundingBox.height;a>r&&(r=a,t=s)}if(!t)throw"No largest barcode found";return t},e.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this.formatMap.has(i)?t.push(this.formatMap.get(i)):this.logger.warn("".concat(i," is not supported by")+"BarcodeDetectorDelegate")}return{formats:t}},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,r,n){e.set(t,r)})),e},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),So=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},jo=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Io=function(){function e(e,t,r,n){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=r,t&&Ao.isSupported()?(this.primaryDecoder=new Ao(e,r,n),this.secondaryDecoder=new Co(e,r,n)):this.primaryDecoder=new Co(e,r,n)}return e.prototype.decodeAsync=function(e){return So(this,void 0,void 0,(function(){var t;return jo(this,(function(r){switch(r.label){case 0:t=performance.now(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,r.sent()];case 3:return this.possiblyLogPerformance(t),[7];case 4:return[2]}}))}))},e.prototype.decodeRobustlyAsync=function(e){return So(this,void 0,void 0,(function(){var t,r;return jo(this,(function(n){switch(n.label){case 0:t=performance.now(),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,n.sent()];case 3:if(r=n.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw r;case 4:return this.possiblyLogPerformance(t),[7];case 5:return[2]}}))}))},e.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(e){if(this.verbose){var t=performance.now()-e;this.executionResults.push(t),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,r=this.executionResults;t<r.length;t++){e+=r[t]}var n=e/this.executionResults.length;console.log("".concat(n," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},e}(),To=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ro=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},No=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Do=function(){function e(e,t){this.name=e,this.track=t}return e.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},e.prototype.apply=function(e){var t={};t[this.name]=e;var r={advanced:[t]};return this.track.applyConstraints(r)},e.prototype.value=function(){var e=this.track.getSettings();return this.name in e?e[this.name]:null},e}(),Oo=function(e){function t(t){return e.call(this,"zoom",t)||this}return To(t,e),t}(function(e){function t(t,r){return e.call(this,t,r)||this}return To(t,e),t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var t={};t[this.name]=e;var r={advanced:[t]};return this.track.applyConstraints(r)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities()[this.name];return{min:e.min,max:e.max,step:e.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(Do)),Po=function(e){function t(t){return e.call(this,"torch",t)||this}return To(t,e),t}(Do),Mo=function(){function e(e){this.track=e}return e.prototype.zoomFeature=function(){return new Oo(this.track)},e.prototype.torchFeature=function(){return new Po(this.track)},e}(),ko=function(){function e(e,t,r){this.isClosed=!1,this.parentElement=e,this.mediaStream=t,this.callbacks=r,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return e.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width="".concat(e,"px"),t.style.display="block",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},e.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var t=function(){var r=e.surface.clientWidth,n=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(r,n),e.surface.removeEventListener("playing",t)};this.surface.addEventListener("playing",t),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(t,r,n,i){return Ro(this,void 0,void 0,(function(){var s,a;return No(this,(function(o){switch(o.label){case 0:return s=new e(t,r,i),n.aspectRatio?(a={aspectRatio:n.aspectRatio},[4,s.getFirstTrackOrFail().applyConstraints(a)]):[3,2];case 1:o.sent(),o.label=2;case 2:return s.setupSurface(),[2,s]}}))}))},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(e){this.failIfClosed();var t=this,r=function(){setTimeout(e,200),t.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(e){return Ro(this,void 0,void 0,(function(){return No(this,(function(t){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]}))}))},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise((function(t,r){var n=e.mediaStream.getVideoTracks().length,i=0;e.mediaStream.getVideoTracks().forEach((function(r){e.mediaStream.removeTrack(r),r.stop(),++i>=n&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),t())}))}))},e.prototype.getCapabilities=function(){return new Mo(this.getFirstTrackOrFail())},e}(),Bo=function(){function e(e){this.mediaStream=e}return e.prototype.render=function(e,t,r){return Ro(this,void 0,void 0,(function(){return No(this,(function(n){return[2,ko.create(e,this.mediaStream,t,r)]}))}))},e.create=function(t){return Ro(this,void 0,void 0,(function(){var r;return No(this,(function(n){switch(n.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return[2,new e(n.sent())]}}))}))},e}(),Lo=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Fo=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},zo=function(){function e(){}return e.failIfNotSupported=function(){return Lo(this,void 0,void 0,(function(){return Fo(this,(function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]}))}))},e.prototype.create=function(e){return Lo(this,void 0,void 0,(function(){return Fo(this,(function(t){return[2,Bo.create(e)]}))}))},e}(),Wo=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Uo=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Vo=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var t=fo.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(t=fo.insecureContextCameraQueryError()),Promise.reject(t)},e.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var e=location.host.split(":")[0];return"127.0.0.1"===e||"localhost"===e},e.getCamerasFromMediaDevices=function(){return Wo(this,void 0,void 0,(function(){var e,t,r,n,i,s,a;return Uo(this,(function(o){switch(o.label){case 0:return e=function(e){for(var t=0,r=e.getVideoTracks();t<r.length;t++){var n=r[t];n.enabled=!1,n.stop(),e.removeTrack(n)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return t=o.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(r=o.sent(),n=[],i=0,s=r;i<s.length;i++)"videoinput"===(a=s[i]).kind&&n.push({id:a.deviceId,label:a.label});return e(t),[2,n]}}))}))},e.getCamerasFromMediaStreamTrack=function(){return new Promise((function(e,t){MediaStreamTrack.getSources((function(t){for(var r=[],n=0,i=t;n<i.length;n++){var s=i[n];"video"===s.kind&&r.push({id:s.id,label:s.label})}e(r)}))}))},e}();(vo=bo||(bo={}))[vo.UNKNOWN=0]="UNKNOWN",vo[vo.NOT_STARTED=1]="NOT_STARTED",vo[vo.SCANNING=2]="SCANNING",vo[vo.PAUSED=3]="PAUSED";var Ho,Go,qo=function(){function e(){this.state=bo.NOT_STARTED,this.onGoingTransactionNewState=bo.UNKNOWN}return e.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},e.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===bo.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=bo.UNKNOWN,this.directTransition(e)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===bo.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=bo.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==bo.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(e){switch(this.state){case bo.UNKNOWN:throw"Transition from unknown is not allowed";case bo.NOT_STARTED:this.failIfNewStateIs(e,[bo.PAUSED]);case bo.SCANNING:case bo.PAUSED:}},e.prototype.failIfNewStateIs=function(e,t){for(var r=0,n=t;r<n.length;r++){if(e===n[r])throw"Cannot transition from ".concat(this.state," to ").concat(e)}},e}(),$o=function(){function e(e){this.stateManager=e}return e.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},e.prototype.directTransition=function(e){this.stateManager.directTransition(e)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===bo.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==bo.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===bo.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===bo.PAUSED},e}(),Xo=function(){function e(){}return e.create=function(){return new $o(new qo)},e}(),Yo=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yo(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(lo),Ko=function(){function e(e,t){this.logger=t,this.fps=Zo.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=Zo.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?go.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!mo(this.qrbox)},e.create=function(t,r){return new e(t,r)},e}(),Qo=function(){function e(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");var r;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(r=t,this.verbose=!0===r.verbose,r.experimentalFeatures),this.logger=new po(this.verbose),this.qrcode=new Io(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=Xo.create()}return e.prototype.start=function(e,t,r,n){var i,s=this;if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i=n||(this.verbose?this.logger.log:function(){});var a=Ko.create(t,this.logger);this.clearElement();var o=!1;a.videoConstraints&&(a.isMediaStreamConstraintsValid()?o=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var l=o,c=document.getElementById(this.elementId);c.clientWidth?c.clientWidth:Zo.DEFAULT_WIDTH,c.style.position="relative",this.shouldScan=!0,this.element=c;var d=this,u=this.stateManagerProxy.startTransition(bo.SCANNING);return new Promise((function(t,n){var o=l?a.videoConstraints:d.createVideoConstraints(e);if(!o)return u.cancel(),void n("videoConstraints should be defined");var c={};l&&!a.aspectRatio||(c.aspectRatio=a.aspectRatio);var h={onRenderSurfaceReady:function(e,t){d.setupUi(e,t,a),d.isScanning=!0,d.foreverScan(a,r,i)}};zo.failIfNotSupported().then((function(e){e.create(o).then((function(e){return e.render(s.element,c,h).then((function(e){d.renderedCamera=e,u.execute(),t(null)})).catch((function(e){u.cancel(),n(e)}))})).catch((function(e){u.cancel(),n(fo.errorGettingUserMedia(e))}))})).catch((function(e){u.cancel(),n(fo.cameraStreamingNotSupported())}))}))},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(bo.PAUSED),this.showPausedState(),(mo(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(bo.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((function(){t()})):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(bo.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=this;return this.renderedCamera.close().then((function(){return r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),function(){if(e.element){var t=document.getElementById(Zo.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}}(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),t.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve()}))},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then((function(e){return e.decodedText}))},e.prototype.scanFileV2=function(e,t){var r=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(mo(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise((function(n,i){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var s=new Image;s.onload=function(){var e=s.width,a=s.height,o=document.getElementById(r.elementId),l=o.clientWidth?o.clientWidth:Zo.DEFAULT_WIDTH,c=Math.max(o.clientHeight?o.clientHeight:a,Zo.FILE_SCAN_MIN_HEIGHT),d=r.computeCanvasDrawConfig(e,a,l,c);if(t){var u=r.createCanvasElement(l,c,"qr-canvas-visible");u.style.display="inline-block",o.appendChild(u);var h=u.getContext("2d");if(!h)throw"Unable to get 2d context from canvas";h.canvas.width=l,h.canvas.height=c,h.drawImage(s,0,0,e,a,d.x,d.y,d.width,d.height)}var p=Zo.FILE_SCAN_HIDDEN_CANVAS_PADDING,m=Math.max(s.width,d.width),f=Math.max(s.height,d.height),g=m+2*p,x=f+2*p,y=r.createCanvasElement(g,x);o.appendChild(y);var w=y.getContext("2d");if(!w)throw"Unable to get 2d context from canvas";w.canvas.width=g,w.canvas.height=x,w.drawImage(s,0,0,e,a,p,p,m,f);try{r.qrcode.decodeRobustlyAsync(y).then((function(e){n(uo.createFromQrcodeResult(e))})).catch(i)}catch(b){i("QR code parse error, error = ".concat(b))}},s.onerror=i,s.onabort=i,s.onstalled=i,s.onsuspend=i,s.src=URL.createObjectURL(e)}))},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return Vo.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(!e)throw"videoConstaints is required argument.";if(!go.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[Qa.QR_CODE,Qa.AZTEC,Qa.CODABAR,Qa.CODE_39,Qa.CODE_93,Qa.CODE_128,Qa.DATA_MATRIX,Qa.MAXICODE,Qa.ITF,Qa.EAN_13,Qa.EAN_8,Qa.PDF_417,Qa.RSS_14,Qa.RSS_EXPANDED,Qa.UPC_A,Qa.UPC_E,Qa.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],n=0,i=e.formatsToSupport;n<i.length;n++){var s=i[n];so(s)?r.push(s):this.logger.warn("Invalid format: ".concat(s," passed in config, ignoring."))}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(mo(e))return!0;if(!mo(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(mo(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!mo(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,r){var n=this,i=r.qrbox;this.validateQrboxConfig(i);var s,a=this.toQrdimensions(e,t,i),o=function(e){if(e<Zo.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Zo.MIN_QR_BOX_SIZE,"px.")};o(a.width),o(a.height),a.width=((s=a.width)>e&&(n.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),s=e),s)},e.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,r){if("number"==typeof r)return{width:r,height:r};if("function"==typeof r)try{return r(e,t)}catch(n){throw new Error("qrbox config was passed as a function but it failed with unknown error"+n)}return r},e.prototype.setupUi=function(e,t,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,r);var n=mo(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(n);var i=this.toQrdimensions(e,t,n);i.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=r.isShadedBoxEnabled()&&i.height<=t,a={x:0,y:0,width:e,height:t},o=s?this.getShadedRegionBounds(e,t,i):a,l=this.createCanvasElement(o.width,o.height),c=l.getContext("2d",{willReadFrequently:!0});c.canvas.width=o.width,c.canvas.height=o.height,this.element.append(l),s&&this.possiblyInsertShadingElement(this.element,e,t,i),this.createScannerPausedUiElement(this.element),this.qrRegion=o,this.context=c,this.canvasElement=l},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText=fo.scannerPaused(),t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="rgba(9, 9, 9, 0.46)",t.style.color="#FFECEC",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((function(t){return e(t.text,uo.createFromQrcodeResult(t)),r.possiblyUpdateShaders(!0),!0})).catch((function(e){r.possiblyUpdateShaders(!1);var n=fo.codeParseError(e);return t(n,ho.createFrom(n)),!1}))},e.prototype.foreverScan=function(e,t,r){var n=this;if(this.shouldScan&&this.renderedCamera){var i=this.renderedCamera.getSurface(),s=i.videoWidth/i.clientWidth,a=i.videoHeight/i.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var o=this.qrRegion.width*s,l=this.qrRegion.height*a,c=this.qrRegion.x*s,d=this.qrRegion.y*a;this.context.drawImage(i,c,d,o,l,0,0,this.qrRegion.width,this.qrRegion.height);var u=function(){n.foreverScanTimeout=setTimeout((function(){n.foreverScan(e,t,r)}),n.getTimeoutFps(e.fps))};this.scanContext(t,r).then((function(i){i||!0===e.disableFlip?u():(n.context.translate(n.context.canvas.width,0),n.context.scale(-1,1),n.scanContext(t,r).finally((function(){u()})))})).catch((function(e){n.logger.logError("Error happend while scanning context",e),u()}))}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",n={user:!0,environment:!0},i="exact",s=function(e){if(e in n)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(e,"'")},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(a.length," keys");var o=Object.keys(e)[0];if(o!==t&&o!==r)throw"Only '".concat(t,"' and '").concat(r,"' ")+" are supported for 'cameraIdOrConfig'";if(o!==t){var l=e.deviceId;if("string"==typeof l)return{deviceId:l};if("object"==typeof l){if(i in l)return{deviceId:{exact:l["".concat(i)]}};throw"'deviceId' should be string or object with"+" ".concat(i," as key.")}throw"Invalid type of 'deviceId' = ".concat(typeof l)}var c=e.facingMode;if("string"==typeof c){if(s(c))return{facingMode:c}}else{if("object"!=typeof c)throw"Invalid type of 'facingMode' = ".concat(typeof c);if(!(i in c))throw"'facingMode' should be string or object with"+" ".concat(i," as key.");if(s(c["".concat(i)]))return{facingMode:{exact:c["".concat(i)]}}}}throw"Invalid type of 'cameraIdOrConfig' = ".concat(typeof e)},e.prototype.computeCanvasDrawConfig=function(e,t,r,n){if(e<=r&&t<=n)return{x:(r-e)/2,y:(n-t)/2,width:e,height:t};var i=e,s=t;return e>r&&(t*=r/e,e=r),t>n&&(e*=n/t,t=n),this.logger.log("Image downsampled from "+"".concat(i,"X").concat(s)+" to ".concat(e,"X").concat(t,".")),this.computeCanvasDrawConfig(e,t,r,n)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(t){t.style.backgroundColor=e?Zo.BORDER_SHADER_MATCH_COLOR:Zo.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,r){var n=e,i=t,s=document.createElement("canvas");return s.style.width="".concat(n,"px"),s.style.height="".concat(i,"px"),s.style.display="none",s.id=mo(r)?"qr-canvas":r,s},e.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},e.prototype.possiblyInsertShadingElement=function(e,t,r,n){if(!(t-n.width<1||r-n.height<1)){var i=document.createElement("div");i.style.position="absolute";var s=(t-n.width)/2,a=(r-n.height)/2;if(i.style.borderLeft="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderRight="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderTop="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderBottom="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.boxSizing="border-box",i.style.top="0px",i.style.bottom="0px",i.style.left="0px",i.style.right="0px",i.id="".concat(Zo.SHADED_REGION_ELEMENT_ID),t-n.width<11||r-n.height<11)this.hasBorderShaders=!1;else{var o=40;this.insertShaderBorders(i,o,5,-5,null,0,!0),this.insertShaderBorders(i,o,5,-5,null,0,!1),this.insertShaderBorders(i,o,5,null,-5,0,!0),this.insertShaderBorders(i,o,5,null,-5,0,!1),this.insertShaderBorders(i,5,45,-5,null,-5,!0),this.insertShaderBorders(i,5,45,null,-5,-5,!0),this.insertShaderBorders(i,5,45,-5,null,-5,!1),this.insertShaderBorders(i,5,45,null,-5,-5,!1),this.hasBorderShaders=!0}e.append(i)}},e.prototype.insertShaderBorders=function(e,t,r,n,i,s,a){var o=document.createElement("div");o.style.position="absolute",o.style.backgroundColor=Zo.BORDER_SHADER_DEFAULT_COLOR,o.style.width="".concat(t,"px"),o.style.height="".concat(r,"px"),null!==n&&(o.style.top="".concat(n,"px")),null!==i&&(o.style.bottom="".concat(i,"px")),a?o.style.left="".concat(s,"px"):o.style.right="".concat(s,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(o),e.appendChild(o)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}();(Go=Ho||(Ho={}))[Go.STATUS_DEFAULT=0]="STATUS_DEFAULT",Go[Go.STATUS_SUCCESS=1]="STATUS_SUCCESS",Go[Go.STATUS_WARNING=2]="STATUS_WARNING",Go[Go.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION";const Jo=({requiredPermission:e,disabledMessage:r="You do not have permission for this action",hideOnNoPermission:n=!1,children:i,disabled:s,...a})=>{const{hasPermission:o,loading:c}=pi();if(!e||c)return t.jsx(M,{disabled:c||s,...a,children:i});const d=o(e);return!d&&n?null:d?t.jsx(M,{disabled:s,...a,children:i}):t.jsx(l,{title:r,children:t.jsx("span",{children:t.jsx(M,{disabled:!0,...a,children:i})})})},el=({requiredPermission:e,fallbackPath:r,children:n})=>{const{hasPermission:i,loading:s,isAdmin:a}=pi();return s?null:a||i(e)?t.jsx(t.Fragment,{children:n}):t.jsx(vt,{to:r,replace:!0})};function tl(e){const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`sales-tabpanel-${i}`,"aria-labelledby":`sales-tab-${i}`,...s,children:n===i&&t.jsx(c,{sx:{py:3},children:r})})}const rl=()=>{var e,r,n,i;const{canPerform:s}=Ka(),a=s("change_sale"),o=s("delete_sale"),[h,p]=ht.useState(0),[m,x]=ht.useState([]),[y,w]=ht.useState([]),[b,C]=ht.useState([]),[E,A]=ht.useState(!0),[S,j]=ht.useState(""),[I,T]=ht.useState(""),[R,N]=ht.useState(!1),[D,O]=ht.useState(!1),[P,k]=ht.useState(null),[B,F]=ht.useState(null),[z,G]=ht.useState([]),[q,X]=ht.useState(null),[Y,Z]=ht.useState(1),[Q,J]=ht.useState(1),[ee,te]=ht.useState(null),[Ce,_e]=ht.useState([]),[Ee,Ae]=ht.useState([]),[Se,je]=ht.useState({}),[Re,Ne]=ht.useState(null),[Ge,qe]=ht.useState([]),[$e,Xe]=ht.useState([]),[Ye,Ze]=ht.useState([]),[Ke,Qe]=ht.useState(!1),[Je,et]=ht.useState(!1),[tt,rt]=ht.useState(""),[nt,it]=ht.useState(""),[st,at]=ht.useState(""),[ot,lt]=ht.useState(""),[ct,dt]=ht.useState(""),[ut,pt]=ht.useState(""),[mt,ft]=ht.useState(!1),[gt,xt]=ht.useState(!1),[yt,wt]=ht.useState(null),[bt,vt]=ht.useState(null),[Ct,_t]=ht.useState(!1),[Et,At]=ht.useState(null),[St,jt]=ht.useState(!1),[It,Tt]=ht.useState(null),[Rt,Nt]=ht.useState(null),[Dt,Ot]=ht.useState(!1),[Pt,Mt]=ht.useState(!1),[kt,Bt]=ht.useState(null),[Lt,Ft]=ht.useState(null),[zt,Wt]=ht.useState(null),[Ut,Vt]=ht.useState(null),[Ht,Gt]=ht.useState({}),[qt,$t]=ht.useState({}),Xt=u(K)((()=>({borderRadius:12,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 16px rgba(0,0,0,0.1)"}}))),[Yt,Zt]=ht.useState(!1),[Kt,Qt]=ht.useState(null),[Jt,er]=ht.useState(1),[tr,rr]=ht.useState(null),[nr,ir]=ht.useState(!1),sr=ht.useRef(null),[ar,or]=ht.useState({open:!1,message:"",severity:"info"}),[lr,cr]=ht.useState({pageSize:10,page:0}),[dr,ur]=ht.useState({pageSize:10,page:0}),[hr,pr]=ht.useState({pageSize:10,page:0}),mr=e=>{switch(e){case"pending":return["confirmed","cancelled","fast_track"];case"confirmed":case"payment_pending":return["partially_paid","paid","cancelled","fast_track"];case"partially_paid":return["paid","cancelled","fast_track"];case"paid":return["shipped","cancelled","fast_track"];case"shipped":return["delivered","cancelled","fast_track"];case"delivered":return["completed","cancelled"];default:return[]}},fr=ht.useCallback((async()=>{try{A(!0),k(null);const[e,t,r]=await Promise.all([ls(),ji(),Mi()]);x(e),w(t),C(r),A(!1),gr(),xr()}catch(e){console.error("Error loading data:",e),k("Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer plus tard."),A(!1)}}),[]);ht.useEffect((()=>{k(null),(async()=>{const e=await Di();Ae(e)})(),fr()}),[fr]),ht.useEffect((()=>{(async()=>{try{if(!Q)return;A(!0);const e=await Hi(Q),t=b.filter((t=>{const r=e.find((e=>e.product===t.id));return r&&r.quantity>0})),r=e.reduce(((e,t)=>(e[t.product]=t.quantity,e)),{});qe(t),je(r),A(!1)}catch(e){console.error("Error fetching stock data:",e),k("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es de stock."),A(!1)}})()}),[Q,b]);const gr=async()=>{try{Qe(!0);const e=await ms();Xe(e),Qe(!1)}catch(e){console.error("Error loading invoices:",e),Qe(!1),k("Erreur lors du chargement des factures. Veuillez rÃ©essayer plus tard.")}},xr=async()=>{try{et(!0);const e=await ws();Ze(e),et(!1)}catch(e){console.error("Error loading quotes:",e),et(!1),k("Erreur lors du chargement des devis. Veuillez rÃ©essayer plus tard.")}},yr=m.filter((e=>{var t;const r=Number(e.client),n=y.find((e=>e.id===r)),i=e.reference.toLowerCase().includes(S.toLowerCase())||(null==(t=null==n?void 0:n.name)?void 0:t.toLowerCase().includes(S.toLowerCase()))||!1,s=""===I||e.status===I;return i&&s})),wr=$e.filter((e=>{var t,r;const n=e.reference.toLowerCase().includes(tt.toLowerCase())||(null==(t=e.client_name)?void 0:t.toLowerCase().includes(tt.toLowerCase()))||!1||(null==(r=e.sale_reference)?void 0:r.toLowerCase().includes(tt.toLowerCase()))||!1,i=""===st||e.status===st;let s=!0;if(ct){const t=new Date(e.date),r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate());switch(ct){case"today":s=t>=n;break;case"week":{const e=new Date(n);e.setDate(e.getDate()-7),s=t>=e;break}case"month":{const e=new Date(n);e.setMonth(e.getMonth()-1),s=t>=e;break}case"quarter":{const e=new Date(n);e.setMonth(e.getMonth()-3),s=t>=e;break}case"year":{const e=new Date(n);e.setFullYear(e.getFullYear()-1),s=t>=e;break}}}return n&&i&&s})),br=Ye.filter((e=>{var t;const r=Number(e.client),n=y.find((e=>e.id===r)),i=e.reference.toLowerCase().includes(nt.toLowerCase())||(null==(t=null==n?void 0:n.name)?void 0:t.toLowerCase().includes(nt.toLowerCase()))||!1,s=""===ot||e.status===ot;let a=!0;if(ut){const t=new Date(e.date),r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate());switch(ut){case"today":a=t>=n;break;case"week":{const e=new Date(n);e.setDate(e.getDate()-7),a=t>=e;break}case"month":{const e=new Date(n);e.setMonth(e.getMonth()-1),a=t>=e;break}case"quarter":{const e=new Date(n);e.setMonth(e.getMonth()-3),a=t>=e;break}case"year":{const e=new Date(n);e.setFullYear(e.getFullYear()-1),a=t>=e;break}}}return i&&s&&a}));ht.useEffect((()=>{cr((e=>({...e,page:0})))}),[S,I]),ht.useEffect((()=>{ur((e=>({...e,page:0})))}),[tt,st]),ht.useEffect((()=>{pr((e=>({...e,page:0})))}),[nt,ot]);const vr=async()=>{if(q&&!(Y<=0)&&Q){k(null),Ne(null);try{if(!(await os(q.id,Q,Y)).available)return void Ne("Stock insuffisant pour ce produit dans la zone sÃ©lectionnÃ©e.");G([...z,{product:q,quantity:Y}]),je((e=>({...e,[q.id]:(e[q.id]||0)-Y}))),X(null),Z(1),Ne(null)}catch(e){console.error("Error checking stock availability:",e),Ne("Erreur lors de la vÃ©rification du stock disponible.")}}},Cr=e=>{const t=[...z];t.splice(e,1),G(t)},_r=()=>z.reduce(((e,t)=>e+t.product.selling_price*t.quantity),0),Er=e=>null==e||isNaN(e)?new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(0):new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),Ar=(e,t)=>{"clickaway"!==t&&or({...ar,open:!1})},Sr=[{field:"reference",headerName:Sa("reference"),flex:1},{field:"client",headerName:Sa("client"),flex:1,valueGetter:(e,t)=>{if(!t)return"N/A";const r=Number(t.client),n=y.find((e=>e.id===r));return n||console.log("Client not found for sale:",{saleClientId:r,availableClients:y.map((e=>({id:e.id,name:e.name})))}),n?n.name:"N/A"}},{field:"date",headerName:Sa("date"),flex:1,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString():""},{field:"total_amount",headerName:Sa("totalAmount"),flex:1,valueGetter:(e,t)=>t&&void 0!==t.total_amount&&null!==t.total_amount?Er(t.total_amount):"",renderCell:e=>e.row?t.jsx(c,{sx:{display:"flex",alignItems:"center",height:"100%"},children:t.jsx(d,{variant:"body2",fontWeight:"bold",color:"primary.main",children:Er(e.row.total_amount)})}):t.jsx(t.Fragment,{})},{field:"paid_amount",headerName:Sa("paidAmount"),flex:1,valueGetter:(e,t)=>t&&void 0!==t.paid_amount?Er(t.paid_amount||0):"",renderCell:e=>{if(!e.row)return t.jsx(t.Fragment,{});const r=e.row.paid_amount||0,n=e.row.total_amount||0,i=n>0?r/n*100:0;return t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",width:"100%",height:"100%"},children:[t.jsx(d,{variant:"body2",fontWeight:"medium",color:"success.main",sx:{mb:.5},children:Er(r)}),t.jsx(Ie,{variant:"determinate",value:i,sx:{width:"100%",height:4,borderRadius:2,backgroundColor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:2,backgroundColor:100===i?"success.main":i>0?"warning.main":"error.main"}}}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:[i.toFixed(0),"%"]})]})}},{field:"remaining_amount",headerName:Sa("remainingAmount"),flex:1,valueGetter:(e,t)=>{if(!t)return"";const r=void 0!==t.remaining_amount?t.remaining_amount:(t.total_amount||0)-(t.paid_amount||0);return Er(r)},renderCell:e=>{if(!e.row)return t.jsx(t.Fragment,{});const r=void 0!==e.row.remaining_amount?e.row.remaining_amount:(e.row.total_amount||0)-(e.row.paid_amount||0),n=r>0&&new Date(e.row.date)<new Date(Date.now()-2592e6);return t.jsxs(c,{sx:{display:"flex",alignItems:"center",height:"100%"},children:[t.jsx(d,{variant:"body2",fontWeight:"medium",color:r>0?n?"error.main":"warning.main":"success.main",sx:{mr:1},children:Er(r)}),n&&r>0&&t.jsx(l,{title:Sa("overduePayment"),children:t.jsx(De,{color:"error",fontSize:"small"})})]})}},{field:"status",headerName:Sa("status"),flex:1,renderCell:e=>{if(!e.row||!e.row.status)return t.jsx(t.Fragment,{});const r="pending"===e.row.status||"cancelled"===e.row.status;return t.jsxs(c,{sx:{display:"flex",alignItems:"center",height:"100%",gap:1},children:[t.jsx(Wa,{status:e.row.status}),r&&t.jsx(l,{title:Sa("safeDeletable"),children:t.jsx(c,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"warning.main",ml:.5,"@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}},animation:"pulse 2s infinite"}})})]})}},{field:"payment_status",headerName:Sa("payment"),flex:1,renderCell:e=>e.row&&e.row.payment_status?t.jsx(Wa,{status:e.row.payment_status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:Sa("actions"),flex:1,sortable:!1,renderCell:e=>{if(!e.row)return t.jsx(t.Fragment,{});const r="pending"===e.row.status||"cancelled"===e.row.status;return t.jsxs(c,{children:[t.jsx(l,{title:Sa("edit"),children:t.jsx(g,{size:"small",color:"primary",onClick:t=>{t.stopPropagation(),(async e=>{try{if(k(null),!e.id)return void k("ID de la vente manquant");const t=await cs(e.id);console.log("Sale details:",t),_e(t.items),te(e),O(!0)}catch(t){console.error("Error fetching sale items:",t),k("Erreur lors de la rÃ©cupÃ©ration des articles de vente. Veuillez rÃ©essayer plus tard.")}})(e.row)},disabled:!a,children:t.jsx(Oe,{fontSize:"small"})})}),r&&t.jsx(l,{title:Sa("delete"),children:t.jsx(g,{size:"small",color:"error",onClick:t=>{t.stopPropagation(),(async e=>{var t,r;try{if(k(null),!e.id)return void k("ID de la vente manquant");Bt(e),Vt(null),Mt(!0)}catch(n){console.error("Error checking delete eligibility:",n);let e="Erreur lors de la vÃ©rification de suppression.";if(n&&"object"==typeof n&&"response"in n){const i=n.response;(null==(t=null==i?void 0:i.data)?void 0:t.message)?e=i.data.message:(null==(r=null==i?void 0:i.data)?void 0:r.error)&&(e=i.data.error)}k(e)}})(e.row)},disabled:!o,children:t.jsx(we,{fontSize:"small"})})})]})}}],jr=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"client_name",headerName:"Client",flex:1},{field:"sale_reference",headerName:"Vente",flex:1},{field:"date",headerName:"Date",flex:1,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString():""},{field:"due_date",headerName:"Ã‰chÃ©ance",flex:1,valueGetter:(e,t)=>t&&t.due_date?new Date(t.due_date).toLocaleDateString():""},{field:"amount",headerName:"Montant",flex:1,valueGetter:(e,t)=>t&&void 0!==t.amount&&null!==t.amount?Er(t.amount):""},{field:"paid_amount",headerName:"PayÃ©",flex:1,valueGetter:(e,t)=>t&&void 0!==t.paid_amount&&null!==t.paid_amount?Er(t.paid_amount):""},{field:"balance",headerName:"Solde",flex:1,valueGetter:(e,t)=>t&&void 0!==t.balance&&null!==t.balance?Er(t.balance):""},{field:"status",headerName:"Statut",flex:1,renderCell:e=>e.row&&e.row.status?t.jsx(Wa,{status:e.row.status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e.row?t.jsxs(We,{direction:"row",spacing:1,justifyContent:"flex-end",children:[t.jsx(g,{color:"primary",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{k(null);const t=await fs(e.id);vt(t),_t(!0)}catch(t){console.error("Error fetching invoice details:",t),k("Erreur lors de la rÃ©cupÃ©ration des dÃ©tails de la facture. Veuillez rÃ©essayer plus tard.")}})(e.row)},children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"secondary",size:"small",onClick:e=>e.stopPropagation(),children:t.jsx(Ue,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{var t,r;try{if(k(null),!e.id)return void k("ID de la vente manquant");Ft(e),Vt(null),Mt(!0)}catch(n){console.error("Error checking delete eligibility:",n);let e="Erreur lors de la vÃ©rification de suppression.";if(n&&"object"==typeof n&&"response"in n){const i=n.response;(null==(t=null==i?void 0:i.data)?void 0:t.message)?e=i.data.message:(null==(r=null==i?void 0:i.data)?void 0:r.error)&&(e=i.data.error)}k(e)}})(e.row)},children:t.jsx(we,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}],Ir=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"client",headerName:"Client",flex:1,valueGetter:(e,t)=>{if(!t||!t.client)return"N/A";const r=Number(t.client),n=y.find((e=>e.id===r));return n?n.name:"N/A"}},{field:"date",headerName:"Date",flex:1,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString():""},{field:"expiry_date",headerName:"Expiration",flex:1,valueGetter:(e,t)=>t&&t.expiry_date?new Date(t.expiry_date).toLocaleDateString():""},{field:"total_amount",headerName:"Montant",flex:1,valueGetter:(e,t)=>t&&void 0!==t.total_amount&&null!==t.total_amount?Er(t.total_amount):""},{field:"is_converted",headerName:"Converti",flex:.8,renderCell:e=>e.row?t.jsx(ce,{label:e.row.is_converted?"Oui":"Non",color:e.row.is_converted?"success":"default",size:"small",variant:e.row.is_converted?"filled":"outlined"}):t.jsx(t.Fragment,{})},{field:"status",headerName:"Statut",flex:1,renderCell:e=>e.row&&e.row.status?t.jsx(Wa,{status:e.row.status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e.row?t.jsxs(We,{direction:"row",spacing:1,justifyContent:"flex-end",children:[t.jsx(g,{color:"primary",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{k(null);const t=await bs(e.id);Nt(t),Ot(!0)}catch(t){console.error("Error fetching quote details:",t),or({open:!0,message:"Erreur lors de la rÃ©cupÃ©ration des dÃ©tails du devis.",severity:"error"})}})(e.row)},children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"secondary",size:"small",onClick:e=>e.stopPropagation(),children:t.jsx(Ue,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{var t,r;try{if(k(null),!e.id)return void k("ID de la vente manquant");Wt(e),Vt(null),Mt(!0)}catch(n){console.error("Error checking delete eligibility:",n);let e="Erreur lors de la vÃ©rification de suppression.";if(n&&"object"==typeof n&&"response"in n){const i=n.response;(null==(t=null==i?void 0:i.data)?void 0:t.message)?e=i.data.message:(null==(r=null==i?void 0:i.data)?void 0:r.error)&&(e=i.data.error)}k(e)}})(e.row)},children:t.jsx(we,{fontSize:"small"})}),t.jsx(g,{color:"success",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{if(!e.id)return;if(e.is_converted)return void or({open:!0,message:"Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente",severity:"warning"});At(e),jt(!0)}catch(t){console.error("Error preparing quote conversion:",t),or({open:!0,message:"Erreur lors de la prÃ©paration de la conversion du devis.",severity:"error"})}})(e.row)},disabled:!e.row.status||e.row.is_converted||"draft"!==e.row.status&&"sent"!==e.row.status&&"accepted"!==e.row.status,title:e.row.is_converted?"Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente":"Convertir en vente",children:t.jsx(Me,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}],Tr=async e=>{try{if(!tr||!nr)return;let r=null;try{const t=JSON.parse(e);t&&t.id&&(r=t.id)}catch(t){e.includes("product-id:")?r=parseInt(e.split("product-id:")[1],10):isNaN(parseInt(e,10))||(r=parseInt(e,10))}if(!r)return void or({open:!0,message:`Invalid QR code: ${e}`,severity:"error"});await tr.pause();const n=await ki(r);Qt(n);const i=Q;if(!i)return void or({open:!0,message:"Veuillez d'abord sÃ©lectionner une zone",severity:"warning"});const s=await os(r,i,Jt);s&&s.available?(e=>{const t=z.findIndex((t=>t.product.id===e.id));if(t>=0){const e=[...z];e[t]={...e[t],quantity:e[t].quantity+Jt},G(e)}else G([...z,{product:e,quantity:Jt}]);Qt(null),er(1)})(n):or({open:!0,message:`Stock insuffisant pour ${n.name} dans la zone sÃ©lectionnÃ©e`,severity:"warning"});new Audio("/sounds/beep-success.mp3").play().catch((()=>{}))}catch(r){console.error("Error processing scan:",r),or({open:!0,message:`Error processing scan: ${r.message}`,severity:"error"})}finally{setTimeout((()=>{tr&&nr&&tr.resume()}),2e3)}},Rr=e=>{console.debug("QR scan error:",e)},Nr=async()=>{if(tr&&nr)try{await tr.stop(),ir(!1)}catch(e){console.error("Error stopping camera:",e)}},Dr=()=>{Zt(!0),setTimeout((()=>(async()=>{if(!tr||!nr)if(sr.current)try{const e=new Qo("scanner-container");rr(e);const t=await Qo.getCameras();t&&t.length?(await e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250},aspectRatio:1},Tr,Rr),ir(!0)):or({open:!0,message:"No camera devices found",severity:"error"})}catch(e){console.error("Error starting camera:",e),or({open:!0,message:`Error starting camera: ${e.message}`,severity:"error"})}else or({open:!0,message:"Scanner container not ready",severity:"error"})})()),500)};return t.jsx(el,{requiredPermission:"view_sale",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"}},children:[t.jsxs(c,{children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Ventes"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez vos ventes, factures et devis"})]}),0===h&&t.jsxs(c,{sx:{display:"flex",gap:1,mt:{xs:2,sm:0},backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Ventes"}),t.jsx(d,{variant:"h6",color:"primary.main",children:m.length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"En attente"}),t.jsx(d,{variant:"h6",color:"warning.main",children:m.filter((e=>"pending"===e.status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Non payÃ©"}),t.jsx(d,{variant:"h6",color:"error.main",children:m.filter((e=>"unpaid"===e.payment_status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Partiellement payÃ©"}),t.jsx(d,{variant:"h6",color:"warning.main",children:m.filter((e=>"partially_paid"===e.payment_status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"PayÃ©"}),t.jsx(d,{variant:"h6",color:"success.main",children:m.filter((e=>"paid"===e.payment_status)).length})]})]}),1===h&&t.jsxs(c,{sx:{display:"flex",gap:1,mt:{xs:2,sm:0},backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Factures"}),t.jsx(d,{variant:"h6",color:"primary.main",children:wr.length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"PayÃ©es"}),t.jsx(d,{variant:"h6",color:"success.main",children:wr.filter((e=>"paid"===e.status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"En retard"}),t.jsx(d,{variant:"h6",color:"warning.main",children:wr.filter((e=>"overdue"===e.status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Montant Total"}),t.jsx(d,{variant:"h6",color:"info.main",children:Er(wr.reduce(((e,t)=>e+(t.amount||0)),0))})]})]}),2===h&&t.jsxs(c,{sx:{display:"flex",gap:1,mt:{xs:2,sm:0},backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Devis"}),t.jsx(d,{variant:"h6",color:"primary.main",children:br.length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"AcceptÃ©s"}),t.jsx(d,{variant:"h6",color:"success.main",children:br.filter((e=>"accepted"===e.status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"ExpirÃ©s"}),t.jsx(d,{variant:"h6",color:"warning.main",children:br.filter((e=>new Date(e.expiry_date)<new Date&&"accepted"!==e.status&&"rejected"!==e.status)).length})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Valeur Totale"}),t.jsx(d,{variant:"h6",color:"info.main",children:Er(br.reduce(((e,t)=>e+(t.total_amount||0)),0))})]})]})]}),t.jsxs(W,{sx:{mb:4,borderRadius:2,overflow:"hidden"},children:[t.jsxs(be,{value:h,onChange:(e,t)=>{p(t)},indicatorColor:"primary",variant:"fullWidth",sx:{backgroundColor:e=>"dark"===e.palette.mode?"background.paper":"primary.light","& .MuiTab-root":{fontWeight:"medium",py:2}},children:[t.jsx(ve,{label:"Ventes",id:"sales-tab-0","aria-controls":"sales-tabpanel-0"}),t.jsx(ve,{label:"Factures",id:"sales-tab-1","aria-controls":"sales-tabpanel-1"}),t.jsx(ve,{label:"Devis",id:"sales-tab-2","aria-controls":"sales-tabpanel-2"})]}),t.jsxs(tl,{value:h,index:0,children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,px:3,py:2,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence ou client",variant:"outlined",size:"small",fullWidth:!0,InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx($,{fontSize:"small",color:"action"})})},value:S,onChange:e=>j(e.target.value)}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"status-filter-label",children:"Statut"}),t.jsxs(le,{labelId:"status-filter-label",id:"status-filter",value:I,onChange:e=>T(e.target.value),label:"Statut",children:[t.jsx(L,{value:"",children:"Tous les statuts"}),t.jsx(L,{value:"pending",children:"En attente"}),t.jsx(L,{value:"confirmed",children:"ConfirmÃ©e"}),t.jsx(L,{value:"payment_pending",children:"Paiement en attente"}),t.jsx(L,{value:"partially_paid",children:"Partiellement payÃ©e"}),t.jsx(L,{value:"paid",children:"PayÃ©e"}),t.jsx(L,{value:"shipped",children:"ExpÃ©diÃ©e"}),t.jsx(L,{value:"delivered",children:"LivrÃ©e"}),t.jsx(L,{value:"completed",children:"TerminÃ©e"}),t.jsx(L,{value:"cancelled",children:"AnnulÃ©e"})]})]})]}),t.jsx(Jo,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>N(!0),requiredPermission:"add_sale",children:"Nouvelle vente"})]}),E?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsxs(t.Fragment,{children:[P&&t.jsx(U,{severity:"error",sx:{mb:3},children:P}),t.jsx(ja,{rows:yr,columns:Sr,paginationModel:lr,onPaginationModelChange:cr,onRowClick:e=>{te(e.row),O(!0),(async e=>{try{if(A(!0),k(null),!e)return void k("ID de la vente manquant");const t=await cs(e);console.log("Sale details:",t),t&&t.items?_e(t.items):_e([])}catch(t){console.error("Error fetching sale items:",t),k("Erreur lors de la rÃ©cupÃ©ration des articles de vente. Veuillez rÃ©essayer plus tard.")}finally{A(!1)}})(e.row.id)},loading:E,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]})]}),t.jsxs(tl,{value:h,index:1,children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,px:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence, client ou vente",variant:"outlined",size:"small",fullWidth:!0,value:tt,onChange:e=>rt(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx($,{color:"action"})})}}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"invoice-status-filter-label",children:"Statut"}),t.jsxs(le,{labelId:"invoice-status-filter-label",id:"invoice-status-filter",value:st,onChange:e=>at(e.target.value),label:"Statut",children:[t.jsx(L,{value:"",children:"Tous les statuts"}),t.jsx(L,{value:"draft",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"Brouillon",color:"default",size:"small",sx:{mr:1}}),"Brouillon"]})}),t.jsx(L,{value:"sent",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"EnvoyÃ©e",color:"info",size:"small",sx:{mr:1}}),"EnvoyÃ©e"]})}),t.jsx(L,{value:"paid",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"PayÃ©e",color:"success",size:"small",sx:{mr:1}}),"PayÃ©e"]})}),t.jsx(L,{value:"overdue",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"En retard",color:"error",size:"small",sx:{mr:1}}),"En retard"]})}),t.jsx(L,{value:"cancelled",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"AnnulÃ©e",color:"error",size:"small",sx:{mr:1}}),"AnnulÃ©e"]})})]})]}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(oe,{children:"PÃ©riode"}),t.jsxs(le,{value:ct,onChange:e=>dt(e.target.value),label:"PÃ©riode",children:[t.jsx(L,{value:"",children:"Toutes les pÃ©riodes"}),t.jsx(L,{value:"today",children:"Aujourd'hui"}),t.jsx(L,{value:"week",children:"Cette semaine"}),t.jsx(L,{value:"month",children:"Ce mois"}),t.jsx(L,{value:"quarter",children:"Ce trimestre"}),t.jsx(L,{value:"year",children:"Cette annÃ©e"})]})]})]}),t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>ft(!0),sx:{borderRadius:2,px:3,boxShadow:2,"&:hover":{boxShadow:4}},children:"Nouvelle facture"})]}),Ke?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsxs(t.Fragment,{children:[P&&t.jsx(U,{severity:"error",sx:{mb:3},children:P}),t.jsx(ja,{rows:wr,columns:jr,paginationModel:dr,onPaginationModelChange:ur,loading:Ke,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]})]}),t.jsxs(tl,{value:h,index:2,children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,px:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence, client ou devis",variant:"outlined",size:"small",fullWidth:!0,value:nt,onChange:e=>it(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx($,{color:"action"})})}}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"quote-status-filter-label",children:"Statut"}),t.jsxs(le,{labelId:"quote-status-filter-label",id:"quote-status-filter",value:ot,onChange:e=>lt(e.target.value),label:"Statut",children:[t.jsx(L,{value:"",children:"Tous les statuts"}),t.jsx(L,{value:"draft",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"Brouillon",color:"default",size:"small",sx:{mr:1}}),"Brouillon"]})}),t.jsx(L,{value:"sent",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"EnvoyÃ©",color:"info",size:"small",sx:{mr:1}}),"EnvoyÃ©"]})}),t.jsx(L,{value:"accepted",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"AcceptÃ©",color:"success",size:"small",sx:{mr:1}}),"AcceptÃ©"]})}),t.jsx(L,{value:"rejected",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"RejetÃ©",color:"error",size:"small",sx:{mr:1}}),"RejetÃ©"]})}),t.jsx(L,{value:"expired",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ce,{label:"ExpirÃ©",color:"warning",size:"small",sx:{mr:1}}),"ExpirÃ©"]})})]})]}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(oe,{children:"PÃ©riode"}),t.jsxs(le,{value:ut,onChange:e=>pt(e.target.value),label:"PÃ©riode",children:[t.jsx(L,{value:"",children:"Toutes les pÃ©riodes"}),t.jsx(L,{value:"today",children:"Aujourd'hui"}),t.jsx(L,{value:"week",children:"Cette semaine"}),t.jsx(L,{value:"month",children:"Ce mois"}),t.jsx(L,{value:"quarter",children:"Ce trimestre"}),t.jsx(L,{value:"year",children:"Cette annÃ©e"})]})]})]}),t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>xt(!0),sx:{borderRadius:2,px:3,boxShadow:2,"&:hover":{boxShadow:4}},children:"Nouveau devis"})]}),Je?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsxs(t.Fragment,{children:[P&&t.jsx(U,{severity:"error",sx:{mb:3},children:P}),t.jsx(ja,{rows:br,columns:Ir,paginationModel:hr,onPaginationModelChange:pr,loading:Je,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]})]})]}),t.jsxs(re,{open:R,onClose:()=>N(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{children:"Nouvelle vente"}),t.jsx(ie,{children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[" ",t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:y,getOptionLabel:e=>e.name,value:B,onChange:(e,t)=>{F(t)},renderInput:e=>t.jsx(V,{...e,label:"Client",variant:"outlined",fullWidth:!0,required:!0}),renderOption:(e,t)=>ht.createElement("li",{...e,key:`client-${t.id}`},t.name)})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Zone"}),t.jsx(le,{value:Q,onChange:e=>J(Number(e.target.value)),label:"Zone",children:Ee.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsxs(de,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Ajouter des produits"}),t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[" ",t.jsx(ue,{options:Ge,getOptionLabel:e=>`${e.name} (Stock: ${Se[e.id]||0})`,value:q,onChange:(e,t)=>{X(t),Z(1)},renderInput:e=>t.jsx(V,{...e,label:"Produit",variant:"outlined",fullWidth:!0}),renderOption:(e,t)=>ht.createElement("li",{...e,key:`product-${t.id}`},t.name," - Stock disponible: ",Se[t.id]||0),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"text",value:Ga(Y),onChange:e=>{const t=Va(e.target.value,Y);Z(t)},error:Y<1&&0!==Y,helperText:qa(Y,"quantity"),sx:{width:100}}),t.jsx(M,{variant:"contained",onClick:vr,disabled:!q||Y<=0,sx:{height:"fit-content"},children:"Ajouter"}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(he,{}),onClick:Dr,sx:{height:"fit-content"},children:"Scanner"})]}),Re&&t.jsx(U,{severity:"warning",sx:{mt:1,mb:2},children:Re})]}),t.jsxs(de,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Produits sÃ©lectionnÃ©s"}),z.length>0?t.jsx(pe,{component:W,variant:"outlined",children:t.jsxs(me,{size:"small",children:[t.jsx(fe,{children:t.jsxs(ge,{children:[t.jsx(xe,{children:"Produit"}),t.jsx(xe,{align:"right",children:"Prix unitaire"}),t.jsx(xe,{align:"right",children:"QuantitÃ©"}),t.jsx(xe,{align:"right",children:"Total"}),t.jsx(xe,{align:"right",children:"Actions"})]})}),t.jsxs(ye,{children:[z.map(((e,r)=>t.jsxs(ge,{children:[t.jsx(xe,{children:e.product.name}),t.jsx(xe,{align:"right",children:Er(e.product.selling_price)}),t.jsx(xe,{align:"right",children:e.quantity}),t.jsx(xe,{align:"right",children:Er(e.product.selling_price*e.quantity)}),t.jsx(xe,{align:"right",children:t.jsx(g,{size:"small",color:"error",onClick:()=>Cr(r),children:t.jsx(we,{fontSize:"small"})})})]},r))),t.jsxs(ge,{children:[t.jsx(xe,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold"},children:Er(_r())}),t.jsx(xe,{})]})]})]})}):t.jsx(W,{variant:"outlined",sx:{p:3,textAlign:"center"},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucun produit sÃ©lectionnÃ©"})})]})]})}),t.jsxs(se,{children:[t.jsx(M,{onClick:()=>N(!1),children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{if(B)if(0!==z.length)try{k(null);const e=Number(_r().toFixed(2)),t=Number((.2*e).toFixed(2)),r=Number((e+t).toFixed(2)),n={client:B.id,zone:Q,date:(new Date).toISOString().split("T")[0],status:"pending",subtotal:e,discount_amount:0,tax_amount:t,total_amount:r,notes:"CrÃ©Ã© depuis l'application",items:z.map((e=>({product:e.product.id,quantity:e.quantity,unit_price:e.product.selling_price,discount_percentage:0,total_price:e.product.selling_price*e.quantity})))};console.log("Creating sale:",n);const i=await ds(n);console.log("Sale created:",i),await fr(),N(!1),F(null),G([]),J(1)}catch(e){console.error("Error creating sale:",e),k("Erreur lors de la crÃ©ation de la vente. Veuillez rÃ©essayer.")}else k("Veuillez ajouter au moins un produit");else k("Veuillez sÃ©lectionner un client")},disabled:!B||0===z.length,children:"CrÃ©er la vente"})]})]}),t.jsxs(re,{open:D,onClose:()=>O(!1),maxWidth:"md",fullWidth:!0,children:[t.jsxs(ne,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider",display:"flex",alignItems:"center"},children:[t.jsx(v,{sx:{mr:1,color:"primary.main"}}),t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[t.jsxs(d,{variant:"h5",children:["Modifier la vente ",null==ee?void 0:ee.reference]}),t.jsx(Wa,{status:(null==ee?void 0:ee.status)||"pending",size:"medium"})]})]}),t.jsx(ie,{children:ee&&t.jsxs(de,{container:!0,spacing:3,sx:{mt:1},children:[t.jsxs(de,{item:!0,xs:12,children:[t.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:3},children:[t.jsxs(W,{sx:{flex:"1 0 200px",p:2,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"background.default",border:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Client"}),t.jsx(d,{variant:"body1",fontWeight:"bold",align:"center",children:(null==(e=y.find((e=>e.id===ee.client)))?void 0:e.name)||"N/A"})]}),t.jsxs(W,{sx:{flex:"1 0 140px",p:2,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"background.default",border:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Date"}),t.jsx(d,{variant:"body1",fontWeight:"bold",children:new Date(ee.date).toLocaleDateString()})]}),t.jsxs(W,{sx:{flex:"1 0 140px",p:2,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"background.default",border:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Montant total"}),t.jsx(d,{variant:"body1",fontWeight:"bold",color:"primary.main",children:Er(ee.total_amount)})]})]}),t.jsxs(Xt,{elevation:3,sx:{p:3,mb:3,border:"2px solid",borderColor:"partially_paid"===ee.payment_status?"warning.main":"paid"===ee.payment_status?"success.main":"error.main",bgcolor:"partially_paid"===ee.payment_status?"warning.50":"paid"===ee.payment_status?"success.50":"error.50"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(Me,{sx:{mr:1,color:"primary.main"}}),t.jsx(d,{variant:"h6",color:"primary.main",sx:{fontWeight:"bold"},children:"Statut des Paiements"}),t.jsx(ce,{label:"paid"===ee.payment_status?"PayÃ©":"partially_paid"===ee.payment_status?"Partiellement payÃ©":"Non payÃ©",color:"paid"===ee.payment_status?"success":"partially_paid"===ee.payment_status?"warning":"error",sx:{ml:"auto",fontWeight:"bold"}})]}),t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,sm:4,children:t.jsxs(W,{elevation:1,sx:{p:2,textAlign:"center",borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"primary.light"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",fontWeight:"bold"},children:"Montant Total"}),t.jsx(d,{variant:"h5",sx:{fontWeight:"bold",color:"primary.main",mt:1},children:Er(ee.total_amount)})]})}),t.jsx(de,{item:!0,xs:12,sm:4,children:t.jsxs(W,{elevation:1,sx:{p:2,textAlign:"center",borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:"success.light"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",fontWeight:"bold"},children:"Montant PayÃ©"}),t.jsx(d,{variant:"h5",sx:{fontWeight:"bold",color:"success.main",mt:1},children:Er(ee.paid_amount||0)}),t.jsxs(c,{sx:{mt:2},children:[t.jsx(Ie,{variant:"determinate",value:ee.total_amount>0?(ee.paid_amount||0)/ee.total_amount*100:0,sx:{height:8,borderRadius:4,backgroundColor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4,backgroundColor:"paid"===ee.payment_status?"success.main":"partially_paid"===ee.payment_status?"warning.main":"error.main"}}}),t.jsxs(d,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[ee.total_amount>0?((ee.paid_amount||0)/ee.total_amount*100).toFixed(1):0,"% payÃ©"]})]})]})}),t.jsx(de,{item:!0,xs:12,sm:4,children:t.jsxs(W,{elevation:1,sx:{p:2,textAlign:"center",borderRadius:2,bgcolor:"background.paper",border:"1px solid",borderColor:(ee.remaining_amount||ee.total_amount-(ee.paid_amount||0))>0?"error.light":"success.light"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",fontWeight:"bold"},children:"Solde Restant"}),t.jsx(d,{variant:"h5",sx:{fontWeight:"bold",color:(ee.remaining_amount||ee.total_amount-(ee.paid_amount||0))>0?"error.main":"success.main",mt:1},children:Er(ee.remaining_amount||ee.total_amount-(ee.paid_amount||0))}),(ee.remaining_amount||ee.total_amount-(ee.paid_amount||0))>0&&new Date(ee.date)<new Date(Date.now()-2592e6)&&t.jsxs(c,{sx:{mt:1,display:"flex",alignItems:"center",justifyContent:"center"},children:[t.jsx(De,{color:"error",fontSize:"small",sx:{mr:.5}}),t.jsx(d,{variant:"caption",color:"error.main",sx:{fontWeight:"bold"},children:"En retard"})]})]})})]}),"paid"===ee.payment_status&&t.jsxs(U,{severity:"success",sx:{mt:2},icon:t.jsx(ke,{}),children:[t.jsx(d,{variant:"body2",sx:{fontWeight:"bold"},children:"Paiement complet"}),t.jsx(d,{variant:"body2",children:"Cette vente a Ã©tÃ© entiÃ¨rement payÃ©e."})]})]})]}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{elevation:0,sx:{p:3,border:"1px solid",borderColor:"divider",borderRadius:2,mb:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Mise Ã  jour du statut"}),t.jsx(c,{sx:{mb:2},children:t.jsxs(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Statut actuel: ",t.jsx(Wa,{status:ee.status,size:"small",sx:{ml:1}})]})}),t.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[mr(ee.status).map((e=>{if("fast_track"===e)return null;const r=(r=>{switch(r){case"confirmed":return{icon:t.jsx(v,{}),color:"primary",label:"Confirmer"};case"payment_pending":return{icon:t.jsx(Fe,{}),color:"warning",label:"Attente paiement"};case"partially_paid":return{icon:t.jsx(Te,{}),color:"warning",label:"Partiellement payÃ©"};case"paid":return{icon:t.jsx(Me,{}),color:"success",label:"PayÃ©"};case"shipped":return{icon:t.jsx(_,{}),color:"info",label:"ExpÃ©diÃ©"};case"delivered":return{icon:t.jsx(He,{}),color:"primary",label:"LivrÃ©"};case"completed":return{icon:t.jsx(ke,{}),color:"success",label:"TerminÃ©"};case"cancelled":return{icon:t.jsx(Ve,{}),color:"error",label:"Annuler"};default:return{icon:null,color:"primary",label:Sa(e)}}})(e);return t.jsx(M,{variant:"contained",color:r.color,startIcon:r.icon,onClick:()=>{te("confirmed"===e?{...ee,status:"payment_pending"}:{...ee,status:e})},children:r.label},e)})),mr(ee.status).includes("fast_track")&&!["completed","cancelled"].includes(ee.status)&&t.jsx(M,{variant:"outlined",color:"secondary",startIcon:t.jsx(Be,{}),onClick:()=>{te({...ee,status:"completed"})},children:"ComplÃ©ter rapidement"})]})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{elevation:0,sx:{borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:[t.jsx(c,{sx:{p:2,bgcolor:"primary.light",color:"primary.contrastText"},children:t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:"Articles"})}),t.jsx(pe,{children:t.jsxs(me,{size:"small",children:[t.jsx(fe,{children:t.jsxs(ge,{children:[t.jsx(xe,{children:"Produit"}),t.jsx(xe,{align:"right",children:"QuantitÃ©"}),t.jsx(xe,{align:"right",children:"Prix unitaire"}),t.jsx(xe,{align:"right",children:"Total"})]})}),t.jsx(ye,{children:Ce.map((e=>{var r;return t.jsxs(ge,{children:[t.jsx(xe,{children:e.product_name||(null==(r=b.find((t=>t.id===e.product)))?void 0:r.name)||"N/A"}),t.jsx(xe,{align:"right",children:e.quantity}),t.jsx(xe,{align:"right",children:Er(e.unit_price)}),t.jsx(xe,{align:"right",children:Er(e.total_price)})]},e.id)}))}),t.jsx(Le,{children:t.jsxs(ge,{sx:{bgcolor:"background.default"},children:[t.jsx(xe,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total:"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold",color:"primary.main"},children:Er(ee.total_amount)})]})})]})})]})})]})}),t.jsxs(se,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(M,{onClick:()=>O(!1),variant:"outlined",children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{if(k(null),!ee)return void k("DonnÃ©es de vente manquantes");if(!ee.id)return void k("ID de la vente manquant");const e={id:ee.id,reference:ee.reference,client:ee.client,zone:ee.zone,date:ee.date,status:ee.status,subtotal:ee.subtotal,discount_amount:ee.discount_amount,tax_amount:ee.tax_amount,total_amount:ee.total_amount,notes:ee.notes||"",items:Ce.map((e=>({id:e.id,sale:e.sale,product:e.product,quantity:e.quantity,unit_price:e.unit_price,discount_percentage:e.discount_percentage,total_price:e.total_price})))};console.log("Updating sale:",e);const t=await us(ee.id,e);console.log("Sale updated:",t),x(m.map((e=>e.id===ee.id?{...e,...t,client:ee.client}:e))),O(!1),te(null),_e([])}catch(e){console.error("Error updating sale:",e);let t="Erreur lors de la mise Ã  jour de la vente. Veuillez rÃ©essayer plus tard.";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){t=`Erreur: ${Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`)).join("\n")}`}}k(t)}},disabled:!ee,color:"primary",children:"Enregistrer les modifications"})]})]}),t.jsxs(re,{open:mt,onClose:()=>ft(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Fe,{sx:{mr:1,color:"primary.main"}}),"Nouvelle facture"]})}),t.jsx(ie,{children:t.jsxs(de,{container:!0,spacing:3,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:m.filter((e=>("payment_pending"===e.status||"confirmed"===e.status||"completed"===e.status)&&!$e.some((t=>t.sale===e.id)))),getOptionLabel:e=>{const t=y.find((t=>t.id===e.client));return`${e.reference} - ${(null==t?void 0:t.name)||"N/A"} (${Er(e.total_amount)})`},value:yt,onChange:(e,t)=>{wt(t)},renderInput:e=>t.jsx(V,{...e,label:"Vente associÃ©e *",variant:"outlined",fullWidth:!0,helperText:"SÃ©lectionnez une vente confirmÃ©e ou livrÃ©e sans facture existante"}),renderOption:(e,r)=>{var n;return ht.createElement("li",{...e,key:`sale-${r.id}`},t.jsxs(c,{children:[t.jsxs(d,{variant:"body1",children:[r.reference," - ",(null==(n=y.find((e=>e.id===r.client)))?void 0:n.name)||"N/A"]}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Montant: ",Er(r.total_amount)," â€¢ Date: ",new Date(r.date).toLocaleDateString()]})]}))},noOptionsText:"Aucune vente Ã©ligible pour facturation"})}),yt&&t.jsxs(t.Fragment,{children:[t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"background.default"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"DÃ©tails de la vente"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Client:"}),t.jsx(d,{variant:"body1",children:(null==(r=y.find((e=>e.id===yt.client)))?void 0:r.name)||"N/A"})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Date de vente:"}),t.jsx(d,{variant:"body1",children:new Date(yt.date).toLocaleDateString()})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total:"}),t.jsx(d,{variant:"h6",color:"primary",children:Er(yt.total_amount)})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Statut:"}),t.jsx(Wa,{status:yt.status,size:"small"})]})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©mission",type:"date",defaultValue:(new Date).toISOString().split("T")[0],fullWidth:!0,InputLabelProps:{shrink:!0},onChange:e=>Gt({...Ht,date:e.target.value})})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©chÃ©ance",type:"date",defaultValue:new Date(Date.now()+2592e6).toISOString().split("T")[0],fullWidth:!0,InputLabelProps:{shrink:!0},onChange:e=>Gt({...Ht,due_date:e.target.value})})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:3,fullWidth:!0,placeholder:"Notes additionnelles pour la facture...",onChange:e=>Gt({...Ht,notes:e.target.value})})})]})]})}),t.jsxs(se,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(M,{onClick:()=>{ft(!1),wt(null),Gt({})},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{if(yt)try{k(null);const e=y.find((e=>e.id===yt.client)),t={reference:`FACT-${(new Date).getFullYear()}-${String($e.length+1).padStart(4,"0")}`,sale:yt.id,date:Ht.date||(new Date).toISOString().split("T")[0],due_date:Ht.due_date||new Date(Date.now()+2592e6).toISOString().split("T")[0],status:"draft",amount:yt.total_amount,paid_amount:0,balance:yt.total_amount,notes:Ht.notes||`Facture pour la vente ${yt.reference}`,sale_reference:yt.reference,client_name:null==e?void 0:e.name},r=await gs(t);Xe([...$e,r]),ft(!1),wt(null),Gt({}),or({open:!0,message:`Facture ${r.reference} crÃ©Ã©e avec succÃ¨s`,severity:"success"})}catch(e){console.error("Error creating invoice:",e),or({open:!0,message:"Erreur lors de la crÃ©ation de la facture. Veuillez rÃ©essayer.",severity:"error"})}else or({open:!0,message:"Veuillez sÃ©lectionner une vente",severity:"error"})},disabled:!yt,startIcon:t.jsx(Pe,{}),children:"CrÃ©er la facture"})]})]}),t.jsxs(re,{open:Ct,onClose:()=>_t(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Oe,{sx:{mr:1,color:"primary.main"}}),"Modifier la facture ",null==bt?void 0:bt.reference]}),bt&&t.jsx(Wa,{status:bt.status,size:"medium"})]})}),t.jsx(ie,{children:bt&&t.jsxs(de,{container:!0,spacing:3,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"background.default"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Informations de la facture"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"RÃ©fÃ©rence:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:bt.reference})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Vente associÃ©e:"}),t.jsx(d,{variant:"body1",children:bt.sale_reference||"N/A"})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Client:"}),t.jsx(d,{variant:"body1",children:bt.client_name||"N/A"})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total:"}),t.jsx(d,{variant:"h6",color:"primary",children:Er(bt.amount)})]})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©mission",type:"date",value:bt.date,onChange:e=>vt({...bt,date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©chÃ©ance",type:"date",value:bt.due_date,onChange:e=>vt({...bt,due_date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Statut"}),t.jsxs(le,{value:bt.status,onChange:e=>vt({...bt,status:e.target.value}),label:"Statut",children:[t.jsx(L,{value:"draft",children:"Brouillon"}),t.jsx(L,{value:"sent",children:"EnvoyÃ©e"}),t.jsx(L,{value:"unpaid",children:"ImpayÃ©e"}),t.jsx(L,{value:"partially_paid",children:"Partiellement payÃ©e"}),t.jsx(L,{value:"paid",children:"PayÃ©e"}),t.jsx(L,{value:"overdue",children:"En retard"}),t.jsx(L,{value:"cancelled",children:"AnnulÃ©e"})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Montant payÃ©",type:"text",value:Ga(bt.paid_amount),onChange:e=>{const t=Ha(e.target.value,bt.paid_amount),r=bt.amount-t;vt({...bt,paid_amount:t,balance:r})},error:bt.paid_amount<0||bt.paid_amount>bt.amount,helperText:bt.paid_amount<0?"Le montant ne peut pas Ãªtre nÃ©gatif":bt.paid_amount>bt.amount?"Le montant payÃ© ne peut pas dÃ©passer le montant total":`Solde restant: ${Er(bt.balance)}`,fullWidth:!0,InputProps:{endAdornment:t.jsx(H,{position:"end",children:"GNF"})}})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:3,fullWidth:!0,value:bt.notes||"",onChange:e=>vt({...bt,notes:e.target.value}),placeholder:"Notes additionnelles..."})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"info.lighter"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"RÃ©sumÃ© des paiements"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:Er(bt.amount)})]}),t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant payÃ©:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:Er(bt.paid_amount)})]}),t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Solde restant:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium",color:bt.balance>0?"error.main":"success.main"},children:Er(bt.balance)})]})]})]})})]})}),t.jsxs(se,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(M,{onClick:()=>_t(!1),children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{if(!bt||!bt.id)return;if(bt.paid_amount<0)return void or({open:!0,message:"Le montant payÃ© ne peut pas Ãªtre nÃ©gatif",severity:"error"});if(bt.paid_amount>bt.amount)return void or({open:!0,message:"Le montant payÃ© ne peut pas dÃ©passer le montant total",severity:"error"});const e={...bt,balance:bt.amount-bt.paid_amount},t=await xs(bt.id,e);Xe($e.map((e=>e.id===bt.id?t:e))),_t(!1),vt(null),or({open:!0,message:`Facture ${t.reference} mise Ã  jour avec succÃ¨s`,severity:"success"})}catch(e){console.error("Error updating invoice:",e),or({open:!0,message:"Erreur lors de la mise Ã  jour de la facture. Veuillez rÃ©essayer.",severity:"error"})}},disabled:!bt,startIcon:t.jsx(Oe,{}),children:"Enregistrer"})]})]}),t.jsxs(re,{open:Dt,onClose:()=>Ot(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Oe,{sx:{mr:1,color:"primary.main"}}),"Modifier le devis ",null==Rt?void 0:Rt.reference]}),Rt&&t.jsx(Wa,{status:Rt.status,size:"medium"})]})}),t.jsx(ie,{children:Rt&&t.jsxs(de,{container:!0,spacing:3,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"background.default"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Informations du devis"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"RÃ©fÃ©rence:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:Rt.reference})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Client:"}),t.jsx(d,{variant:"body1",children:(null==(n=y.find((e=>e.id===Rt.client)))?void 0:n.name)||"N/A"})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total:"}),t.jsx(d,{variant:"h6",color:"primary",children:Er(Rt.total_amount)})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"CrÃ©Ã© le:"}),t.jsx(d,{variant:"body1",children:new Date(Rt.date).toLocaleDateString()})]})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date du devis",type:"date",value:Rt.date,onChange:e=>Nt({...Rt,date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'expiration",type:"date",value:Rt.expiry_date,onChange:e=>Nt({...Rt,expiry_date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0},helperText:"Date limite de validitÃ©"})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Statut"}),t.jsxs(le,{value:Rt.status,onChange:e=>Nt({...Rt,status:e.target.value}),label:"Statut",children:[t.jsx(L,{value:"draft",children:"Brouillon"}),t.jsx(L,{value:"sent",children:"EnvoyÃ©"}),t.jsx(L,{value:"accepted",children:"AcceptÃ©"}),t.jsx(L,{value:"rejected",children:"RejetÃ©"}),t.jsx(L,{value:"expired",children:"ExpirÃ©"})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"ValiditÃ© du devis",value:`${Math.ceil((new Date(Rt.expiry_date).getTime()-(new Date).getTime())/864e5)} jours`,fullWidth:!0,disabled:!0,helperText:"Jours restants de validitÃ©"})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:4,fullWidth:!0,value:Rt.notes||"",onChange:e=>Nt({...Rt,notes:e.target.value}),placeholder:"Notes ou conditions particuliÃ¨res..."})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"info.lighter"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"RÃ©sumÃ© du devis"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:3,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Sous-total:"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:Er(Rt.subtotal)})]}),t.jsxs(de,{item:!0,xs:3,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"TVA (20%):"}),t.jsx(d,{variant:"body1",sx:{fontWeight:"medium"},children:Er(Rt.tax_amount)})]}),t.jsxs(de,{item:!0,xs:3,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Total TTC:"}),t.jsx(d,{variant:"h6",color:"primary",sx:{fontWeight:"bold"},children:Er(Rt.total_amount)})]}),t.jsxs(de,{item:!0,xs:3,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Articles:"}),t.jsxs(d,{variant:"body1",sx:{fontWeight:"medium"},children:[(null==(i=Rt.items)?void 0:i.length)||0," produit(s)"]})]})]})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:2,bgcolor:"warning.lighter"},children:[t.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Actions disponibles"}),t.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:["draft"===Rt.status&&t.jsx(M,{variant:"outlined",size:"small",onClick:()=>Nt({...Rt,status:"sent"}),children:"Marquer comme envoyÃ©"}),"sent"===Rt.status&&t.jsxs(t.Fragment,{children:[t.jsx(M,{variant:"outlined",size:"small",color:"success",onClick:()=>Nt({...Rt,status:"accepted"}),children:"Marquer comme acceptÃ©"}),t.jsx(M,{variant:"outlined",size:"small",color:"error",onClick:()=>Nt({...Rt,status:"rejected"}),children:"Marquer comme rejetÃ©"})]}),"accepted"===Rt.status&&t.jsx(M,{variant:"contained",size:"small",color:"primary",onClick:()=>{At(Rt),jt(!0)},children:"Convertir en vente"})]})]})})]})}),t.jsxs(se,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(M,{onClick:()=>Ot(!1),children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{if(!Rt||!Rt.id)return;const e=await Cs(Rt.id,Rt);Ze(Ye.map((t=>t.id===Rt.id?e:t))),Ot(!1),Nt(null),or({open:!0,message:"Devis mis Ã  jour avec succÃ¨s",severity:"success"})}catch(e){console.error("Error updating quote:",e),or({open:!0,message:"Erreur lors de la mise Ã  jour du devis",severity:"error"})}},disabled:!Rt,startIcon:t.jsx(Oe,{}),children:"Enregistrer"})]})]}),t.jsxs(re,{open:gt,onClose:()=>xt(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Fe,{sx:{mr:1,color:"primary.main"}}),"Nouveau devis"]})}),t.jsx(ie,{children:t.jsxs(de,{container:!0,spacing:3,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:y,getOptionLabel:e=>e.name,value:B,onChange:(e,t)=>{F(t)},renderInput:e=>t.jsx(V,{...e,label:"Client *",variant:"outlined",fullWidth:!0}),renderOption:(e,r)=>ht.createElement("li",{...e,key:`client-${r.id}`},t.jsxs(c,{children:[t.jsx(d,{variant:"body1",children:r.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:[r.email&&`Email: ${r.email} â€¢ `,r.phone&&`TÃ©l: ${r.phone}`]})]}))})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date du devis",type:"date",value:qt.date||(new Date).toISOString().split("T")[0],onChange:e=>$t({...qt,date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'expiration",type:"date",value:qt.expiry_date||new Date(Date.now()+2592e6).toISOString().split("T")[0],onChange:e=>$t({...qt,expiry_date:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0},helperText:"Date limite de validitÃ© du devis"})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Zone *"}),t.jsx(le,{value:Q,onChange:e=>J(Number(e.target.value)),label:"Zone *",children:Ee.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsxs(de,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Produits du devis"}),t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[t.jsx(ue,{options:Ge,getOptionLabel:e=>`${e.name} (Stock: ${Se[e.id]||0})`,value:q,onChange:(e,t)=>{X(t),Z(1)},renderInput:e=>t.jsx(V,{...e,label:"Produit",variant:"outlined",fullWidth:!0}),renderOption:(e,r)=>ht.createElement("li",{...e,key:`product-${r.id}`},t.jsxs(c,{sx:{width:"100%"},children:[t.jsx(d,{variant:"body1",children:r.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Prix: ",Er(r.selling_price)," â€¢ Stock: ",Se[r.id]||0]})]})),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"text",value:Ga(Y),onChange:e=>{const t=Va(e.target.value,Y);Z(t)},error:Y<1&&0!==Y,helperText:qa(Y,"quantity"),sx:{width:120}}),t.jsx(M,{variant:"contained",onClick:vr,disabled:!q||Y<=0,sx:{height:"fit-content",px:3},children:"Ajouter"}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(he,{}),onClick:Dr,sx:{height:"fit-content"},children:"Scanner"})]}),Re&&t.jsx(U,{severity:"warning",sx:{mt:1,mb:2},children:Re}),z.length>0?t.jsx(pe,{component:W,variant:"outlined",children:t.jsxs(me,{size:"small",children:[t.jsx(fe,{children:t.jsxs(ge,{children:[t.jsx(xe,{children:"Produit"}),t.jsx(xe,{align:"right",children:"Prix unitaire"}),t.jsx(xe,{align:"right",children:"QuantitÃ©"}),t.jsx(xe,{align:"right",children:"Total"}),t.jsx(xe,{align:"right",children:"Actions"})]})}),t.jsxs(ye,{children:[z.map(((e,r)=>t.jsxs(ge,{children:[t.jsx(xe,{children:t.jsxs(c,{children:[t.jsx(d,{variant:"body2",children:e.product.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["RÃ©f: ",e.product.reference]})]})}),t.jsx(xe,{align:"right",children:t.jsx(V,{type:"text",value:Ga(e.product.selling_price),onChange:t=>{const n=Ha(t.target.value,e.product.selling_price),i=[...z];i[r].product.selling_price=n,G(i)},size:"small",variant:"standard",InputProps:{endAdornment:t.jsx(H,{position:"end",children:"GNF"})}})}),t.jsx(xe,{align:"right",children:t.jsx(V,{type:"text",value:Ga(e.quantity),onChange:t=>{const n=Va(t.target.value,e.quantity),i=[...z];i[r].quantity=n,G(i)},size:"small",variant:"standard",sx:{width:80}})}),t.jsx(xe,{align:"right",children:t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:Er(e.product.selling_price*e.quantity)})}),t.jsx(xe,{align:"right",children:t.jsx(g,{size:"small",color:"error",onClick:()=>Cr(r),children:t.jsx(we,{fontSize:"small"})})})]},r))),t.jsxs(ge,{children:[t.jsx(xe,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Sous-total"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold"},children:Er(_r())}),t.jsx(xe,{})]}),t.jsxs(ge,{children:[t.jsx(xe,{colSpan:3,align:"right",children:"TVA (20%)"}),t.jsx(xe,{align:"right",children:Er(.2*_r())}),t.jsx(xe,{})]}),t.jsxs(ge,{children:[t.jsx(xe,{colSpan:3,align:"right",sx:{fontWeight:"bold",fontSize:"1.1em"},children:"Total TTC"}),t.jsx(xe,{align:"right",sx:{fontWeight:"bold",fontSize:"1.1em",color:"primary.main"},children:Er(1.2*_r())}),t.jsx(xe,{})]})]})]})}):t.jsx(W,{variant:"outlined",sx:{p:3,textAlign:"center"},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucun produit ajoutÃ© au devis"})})]}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:3,fullWidth:!0,value:qt.notes||"",onChange:e=>$t({...qt,notes:e.target.value}),placeholder:"Notes ou conditions particuliÃ¨res du devis..."})})]})}),t.jsxs(se,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(M,{onClick:()=>{xt(!1),F(null),G([]),$t({})},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{if(B)if(0!==z.length)if(Q)try{k(null);const e=Number(_r().toFixed(2)),t=Number((.2*e).toFixed(2)),r=Number((e+t).toFixed(2)),n={reference:`DEV-${(new Date).getFullYear()}-${String(Ye.length+1).padStart(4,"0")}`,client:B.id,date:qt.date||(new Date).toISOString().split("T")[0],expiry_date:qt.expiry_date||new Date(Date.now()+2592e6).toISOString().split("T")[0],status:"draft",subtotal:e,tax_amount:t,total_amount:r,notes:qt.notes||`Devis pour ${B.name}`,items:z.map((e=>({product:e.product.id,quantity:e.quantity,unit_price:e.product.selling_price,discount_percentage:0,total_price:e.product.selling_price*e.quantity})))},i=await vs(n);Ze([...Ye,i]),xt(!1),F(null),G([]),$t({}),J(0),or({open:!0,message:`Devis ${i.reference} crÃ©Ã© avec succÃ¨s`,severity:"success"})}catch(e){console.error("Error creating quote:",e),or({open:!0,message:"Erreur lors de la crÃ©ation du devis. Veuillez rÃ©essayer.",severity:"error"})}else or({open:!0,message:"Veuillez sÃ©lectionner une zone",severity:"error"});else or({open:!0,message:"Veuillez ajouter au moins un produit",severity:"error"});else or({open:!0,message:"Veuillez sÃ©lectionner un client",severity:"error"})},disabled:!B||0===z.length||!Q,startIcon:t.jsx(Pe,{}),children:"CrÃ©er le devis"})]})]}),t.jsxs(re,{open:St,onClose:()=>jt(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(ne,{children:"Convertir un devis en vente"}),t.jsx(ie,{children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsxs(de,{item:!0,xs:12,children:[t.jsxs(d,{variant:"subtitle1",children:["Convertir le devis ",null==Et?void 0:Et.reference," en vente."]}),(null==Et?void 0:Et.is_converted)&&t.jsx(U,{severity:"warning",sx:{mt:2},children:"Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente."})]}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,required:!0,disabled:null==Et?void 0:Et.is_converted,children:[t.jsx(oe,{children:"Zone"}),t.jsx(le,{value:Q,onChange:e=>J(Number(e.target.value)),label:"Zone",children:Ee.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})})]})}),t.jsxs(se,{children:[t.jsx(M,{onClick:()=>jt(!1),children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{var e;try{if(!Et||!Et.id)return;if(Et.is_converted)return or({open:!0,message:"Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente",severity:"warning"}),void jt(!1);if(!Q)return void or({open:!0,message:"Veuillez sÃ©lectionner une zone",severity:"error"});const e=await Es(Et.id,Q);await Promise.all([fr(),xr()]),jt(!1),At(null),J(0),or({open:!0,message:`Devis ${Et.reference} converti en vente avec succÃ¨s. RÃ©fÃ©rence: ${e.reference}`,severity:"success"})}catch(t){console.error("Error converting quote to sale:",t);let r="Erreur lors de la conversion du devis en vente. Veuillez rÃ©essayer.";if(t&&"object"==typeof t&&"response"in t){const n=t.response;(null==(e=null==n?void 0:n.data)?void 0:e.error)&&(r=n.data.error)}or({open:!0,message:r,severity:"error"})}},disabled:!Et||(null==Et?void 0:Et.is_converted),children:"Convertir"})]})]}),t.jsxs(re,{open:Yt,onClose:()=>{Nr(),Zt(!1)},maxWidth:"sm",fullWidth:!0,children:[t.jsx(ne,{children:"Scanner un produit"}),t.jsxs(ie,{children:[t.jsx(c,{sx:{mb:2},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Positionnez le code QR dans la vue de la camÃ©ra pour le scanner."})}),t.jsx(c,{ref:sr,id:"scanner-container",sx:{width:"100%",height:300,mb:2,border:"1px solid #ddd",borderRadius:1,overflow:"hidden",position:"relative","& video":{objectFit:"cover"}}}),Kt&&t.jsxs(c,{sx:{mt:2,p:2,border:"1px solid #ddd",borderRadius:1},children:[t.jsx(d,{variant:"subtitle1",children:"Produit scannÃ© :"}),t.jsx(d,{variant:"h6",children:Kt.name}),t.jsxs(d,{variant:"body2",children:["RÃ©fÃ©rence : ",Kt.reference]}),t.jsxs(d,{variant:"body2",children:["Prix : ",Er(Kt.selling_price)]}),t.jsx(c,{sx:{mt:2},children:t.jsx(V,{label:"QuantitÃ©",type:"text",value:Ga(Jt),onChange:e=>{const t=Va(e.target.value,Jt);er(t)},error:Jt<1&&0!==Jt,helperText:qa(Jt,"quantity"),fullWidth:!0,size:"small"})})]})]}),t.jsx(se,{children:t.jsx(M,{onClick:()=>{Nr(),Zt(!1)},children:"Fermer"})})]}),t.jsx(ze,{open:ar.open,autoHideDuration:6e3,onClose:Ar,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:Ar,severity:ar.severity,sx:{width:"100%"},children:ar.message})}),t.jsx(La,{open:Pt,onClose:()=>{Mt(!1),Bt(null),Wt(null),Vt(null),Ft(null)},onConfirm:async()=>{var e,t;if((null==kt?void 0:kt.id)||(null==Lt?void 0:Lt.id)||(null==zt?void 0:zt.id))try{if(k(null),A(!0),null==kt?void 0:kt.id){console.log("Deleting sale:",kt);const e=await hs(kt.id);if(console.log("Sale deleted:",e),e.deletion_summary){const t=e.deletion_summary;let r=`Vente ${t.sale_reference} supprimÃ©e avec succÃ¨s.`;t.stock_restored&&t.stock_restored.length>0&&(r+="\n\nStock restaurÃ©:",t.stock_restored.forEach((e=>{r+=`\nâ€¢ ${e.product}: ${e.quantity} unitÃ©s dans ${e.zone}`}))),t.payment_refunded>0&&(r+=`\n\nMontant remboursÃ©: ${Er(t.payment_refunded)}`),Tt(r),setTimeout((()=>Tt(null)),8e3)}x(m.filter((e=>e.id!==kt.id))),Mt(!1),Bt(null),Vt(null)}else if(null==Lt?void 0:Lt.id){console.log("Deleting invoice:",Lt);const e=await ys(Lt.id);console.log("Invoice deleted:",e),e&&(Tt("Facture supprimÃ©e avec succÃ¨s."),setTimeout((()=>Tt(null)),8e3)),Xe($e.filter((e=>e.id!==Lt.id))),Mt(!1),Ft(null)}else if(null==zt?void 0:zt.id){console.log("Deleting quote:",zt);const e=await _s(zt.id);console.log("Quote deleted:",e),e&&(Tt(`Devis ${e} supprimÃ© avec succÃ¨s.`),setTimeout((()=>Tt(null)),8e3)),Ze(Ye.filter((e=>e.id!==zt.id))),Mt(!1),Wt(null)}}catch(r){console.error("Error deleting sale:",r);let n="Erreur lors de la suppression de la vente.";if(r&&"object"==typeof r&&"response"in r){const i=r.response;(null==(e=null==i?void 0:i.data)?void 0:e.message)?n=i.data.message:(null==(t=null==i?void 0:i.data)?void 0:t.error)&&(n=i.data.error)}k(n)}finally{A(!1)}else k("Aucun Ã©lÃ©ment sÃ©lectionnÃ© pour suppression")},loading:E,type:Lt?"invoice":kt?"sale":"quote",item:Lt||kt||zt,confirmationInfo:Ut}),It&&t.jsx(ze,{open:Boolean(It),autoHideDuration:8e3,onClose:()=>Tt(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(U,{onClose:()=>Tt(null),severity:"success",sx:{width:"100%",maxWidth:600,whiteSpace:"pre-line"},children:It})})]})})},nl=()=>{const{canPerform:e}=Ka(),r=e("change_client"),n=e("delete_client"),[i,s]=ht.useState([]),[a,o]=ht.useState(!0),[u,h]=ht.useState(""),[p,m]=ht.useState(!1),[x,y]=ht.useState({name:"",contact_person:"",email:"",phone:"",address:"",price_group:1,account:void 0,is_active:!0}),[w,b]=ht.useState(!1),[v,C]=ht.useState(null),[_,E]=ht.useState(null),[A,S]=ht.useState({open:!1,message:"",severity:"success"}),j=[{id:1,name:"Standard"},{id:2,name:"Premium"},{id:3,name:"VIP"}],[I,T]=ht.useState([]),[R,N]=ht.useState(!1),[D,O]=ht.useState({page:0,pageSize:10});ht.useEffect((()=>{(async()=>{try{o(!0),E(null);const e=await ji();s(e)}catch(e){console.error("Error loading clients:",e),E("Erreur lors du chargement des clients. Veuillez rÃ©essayer plus tard.")}finally{o(!1)}})()}),[]),ht.useEffect((()=>{p&&(async()=>{try{N(!0);const e=await Hs("client"),t=i.filter((e=>void 0!==e.account)).map((e=>e.account)),r=e.filter((e=>!t.includes(e.id)));T(r)}catch(e){console.error("Error loading available accounts:",e)}finally{N(!1)}})()}),[p,i]);const P=i.filter((e=>e.name.toLowerCase().includes(u.toLowerCase())||e.contact_person.toLowerCase().includes(u.toLowerCase())||e.email.toLowerCase().includes(u.toLowerCase())||e.phone.includes(u))),M=e=>{e?(y({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address,price_group:e.price_group,account:e.account,is_active:e.is_active}),b(!0),C(e.id)):(y({name:"",contact_person:"",email:"",phone:"",address:"",price_group:1,account:void 0,is_active:!0}),b(!1),C(null)),m(!0)},k=()=>{m(!1)},B=()=>{S({...A,open:!1})},L=[{field:"name",headerName:Sa("company"),flex:1.2,renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name})},{field:"contact_person",headerName:Sa("contactPerson"),flex:1,renderCell:e=>t.jsx(d,{variant:"body2",children:e.row.contact_person})},{field:"phone",headerName:Sa("phone"),flex:1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Ge,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.phone})]})},{field:"email",headerName:Sa("email"),flex:1.2,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(qe,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.email})]})},{field:"address",headerName:Sa("address"),flex:1.3,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[t.jsx($e,{fontSize:"small",color:"action",sx:{mt:.25}}),t.jsx(d,{variant:"body2",children:e.row.address})]})},{field:"price_group",headerName:Sa("priceGroup"),flex:.8,valueGetter:(e,t)=>(e=>{if(!e)return"Aucun";const t=j.find((t=>t.id===e));return t?t.name:"Inconnu"})(t.price_group)},{field:"is_active",headerName:Sa("status"),flex:.7,renderCell:e=>t.jsx(Wa,{status:e.row.is_active?"active":"inactive"})},{field:"actions",headerName:Sa("actions"),flex:.8,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(l,{title:Sa("edit"),children:t.jsx(g,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),M(e.row)},disabled:!r,children:t.jsx(Oe,{fontSize:"small"})})}),t.jsx(l,{title:Sa("delete"),children:t.jsx(g,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{if(E(null),!window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le client "${e.name}" ?`))return;await Ni(e.id),s(i.filter((t=>t.id!==e.id))),S({open:!0,message:"Client supprimÃ© avec succÃ¨s",severity:"success"})}catch(t){console.error("Error deleting client:",t);let e="Erreur lors de la suppression du client.";if(t&&"object"==typeof t&&"response"in t&&t.response&&"object"==typeof t.response&&"data"in t.response&&t.response.data){const r=t.response.data;"object"==typeof r&&"error"in r&&(e=String(r.error),"detail"in r&&r.detail&&(e+=" "+String(r.detail)))}S({open:!0,message:e,severity:"error"})}})(e.row)},disabled:!n,children:t.jsx(we,{fontSize:"small"})})})]})}];return t.jsx(el,{requiredPermission:"view_client",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Clients"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez votre portefeuille clients"})]}),t.jsxs(W,{sx:{p:3,mb:4},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsx(Fa,{label:Sa("search"),placeholder:"Nom, contact, email ou tÃ©lÃ©phone",value:u,onChange:e=>h(e.target.value),sx:{maxWidth:{md:400}},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Xe,{})})}}),t.jsx(ca,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>M(),disabled:!e("add_client"),children:Sa("addClient")})]}),_&&t.jsx(U,{severity:"error",sx:{mb:3},children:_}),a?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsx(ja,{rows:P,columns:L,paginationModel:D,onPaginationModelChange:O,loading:a,getRowId:e=>e.id||Math.random(),onRowClick:e=>{r&&M(e.row)},sx:{minHeight:400,"& .MuiDataGrid-row":{cursor:"pointer"}}})]}),t.jsx(Ua,{open:p,editMode:w,contactType:"client",formData:x,availableAccounts:I.map((e=>({id:e.id,name:e.name}))),loadingAccounts:R,priceGroups:j,onClose:k,onSubmit:async()=>{try{if(!x.name)return void S({open:!0,message:"Le nom du client est requis",severity:"error"});if(!x.contact_person)return void S({open:!0,message:"Le nom du contact est requis",severity:"error"});if(!x.email)return void S({open:!0,message:"L'email est requis",severity:"error"});if(!x.phone)return void S({open:!0,message:"Le tÃ©lÃ©phone est requis",severity:"error"});if(!x.address)return void S({open:!0,message:"L'adresse est requise",severity:"error"});if(!x.price_group)return void S({open:!0,message:"Le groupe de prix est requis",severity:"error"});if(w&&v){await Ri(v,x);const e=await ji();s(e),S({open:!0,message:"Client mis Ã  jour avec succÃ¨s",severity:"success"})}else{await Ti(x);const e=await ji();s(e),S({open:!0,message:"Client ajoutÃ© avec succÃ¨s",severity:"success"})}k()}catch(e){let t="Erreur lors de l'enregistrement du client";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):String(t)}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}S({open:!0,message:t,severity:"error"})}},onFormDataChange:e=>{y(e)},onAccountChange:e=>{y((t=>({...t,account:""===e?void 0:e})))},onPriceGroupChange:e=>{y((t=>({...t,price_group:e})))}}),t.jsx(ze,{open:A.open,autoHideDuration:6e3,onClose:B,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:B,severity:A.severity,variant:"filled",sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:A.message})})]})})},il=({productId:e,productName:r,downloadable:n=!0,width:i="150px",height:s="150px"})=>{const[a,o]=ht.useState(!0),[l,u]=ht.useState(null),[h,p]=ht.useState(null);ht.useEffect((()=>(e&&(async()=>{try{o(!0),u(null);const t=await qs(e),r=URL.createObjectURL(t);p(r)}catch(t){console.error(`Error fetching QR code for product ${e}:`,t),u("Impossible de charger le code QR")}finally{o(!1)}})(),()=>{h&&URL.revokeObjectURL(h)})),[e]);return t.jsx(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px dashed rgba(0, 0, 0, 0.2)",borderRadius:2,padding:2,bgcolor:"rgba(0, 0, 0, 0.02)"},children:a?t.jsx(f,{size:40}):l?t.jsx(d,{color:"error",variant:"body2",children:l}):h?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:h,alt:`QR Code pour ${r||`produit ${e}`}`,style:{width:i,height:s,marginBottom:n?"8px":"0"}}),n&&t.jsx(M,{variant:"outlined",size:"small",onClick:()=>{h&&window.open(h,"_blank","noopener,noreferrer")},sx:{mt:1},children:"TÃ©lÃ©charger"})]}):t.jsx(d,{color:"textSecondary",children:"QR Code non disponible"})})},sl=()=>{const e=h(),{canPerform:r}=Ka(),n=r("change_product"),i=r("delete_product"),[s,a]=ht.useState([]),[o,l]=ht.useState(!0),[u,p]=ht.useState(""),[m,x]=ht.useState(""),[y,w]=ht.useState(!1),[b,v]=ht.useState(!1),[C,_]=ht.useState(null),[E,A]=ht.useState([]),[S,j]=ht.useState([]),[I,T]=ht.useState(!1),[R,N]=ht.useState(!1),[D,O]=ht.useState({name:"",reference:"",description:"",category:0,unit:0,purchase_price:0,selling_price:0,min_stock_level:0,is_raw_material:!1,is_active:!0}),[P,k]=ht.useState(null),[B,F]=ht.useState(!1),[z,G]=ht.useState(null),[q,$]=ht.useState(!1),[X,Y]=ht.useState({page:0,pageSize:10});ht.useEffect((()=>{Y((e=>({...e,page:0})))}),[u,m]),ht.useEffect((()=>{(async()=>{try{l(!0),_(null);const e=await Mi();a(e),T(!0);const t=await Oi();A(t),T(!1),N(!0);const r=await Pi();j(r),N(!1)}catch(e){console.error("Error loading data:",e),_("Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer plus tard.")}finally{l(!1)}})()}),[]);const Z=e=>{const t=E.find((t=>t.id===e));return t?t.name:"Inconnu"},K=[...new Set(s.map((e=>e.category)))],Q=s.filter((e=>{const t=e.name.toLowerCase().includes(u.toLowerCase())||e.reference.toLowerCase().includes(u.toLowerCase()),r=""===m||e.category===Number(m);return t&&r})),J=async e=>{k(e),v(!0)},ee=()=>{F(!1),G(null)};return t.jsx(el,{requiredPermission:"view_product",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsx(c,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(c,{children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Produits"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez votre catalogue de produits"})]})}),t.jsxs(W,{sx:{p:3,mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom ou rÃ©fÃ©rence",variant:"outlined",size:"small",fullWidth:!0,value:u,onChange:e=>p(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Xe,{})}),sx:{borderRadius:2}}}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"category-filter-label",children:"CatÃ©gorie"}),t.jsxs(le,{labelId:"category-filter-label",id:"category-filter",value:m,onChange:e=>x(e.target.value),label:"CatÃ©gorie",sx:{borderRadius:2},children:[t.jsx(L,{value:"",children:"Toutes les catÃ©gories"}),I?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}})," Chargement..."]}):K.map((e=>t.jsx(L,{value:e,children:Z(e)},e)))]})]})]}),t.jsx(Jo,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>w(!0),requiredPermission:"add_product",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Ajouter un produit"})]}),C&&t.jsx(U,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 2px 10px rgba(0,0,0,0.08)"},children:C}),o?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsx(ja,{rows:Q,columns:[{field:"name",headerName:"Produit",flex:1},{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"category",headerName:"CatÃ©gorie",flex:1,valueGetter:(e,t)=>t?Z(t.category):"N/A"},{field:"unit",headerName:"UnitÃ©",flex:1,valueGetter:(e,t)=>t?(e=>{const t=S.find((t=>t.id===e));return t?t.name:"Inconnu"})(t.unit):"N/A"},{field:"purchase_price",headerName:"Prix d'achat",flex:1,valueGetter:(e,t)=>t&&void 0!==t.purchase_price?`${t.purchase_price.toLocaleString()} GNF`:""},{field:"selling_price",headerName:"Prix de vente",flex:1,valueGetter:(e,t)=>t&&void 0!==t.selling_price?`${t.selling_price.toLocaleString()} GNF`:""},{field:"min_stock_level",headerName:"Stock Min.",flex:1,valueGetter:(e,t)=>t&&void 0!==t.min_stock_level?t.min_stock_level.toString():"0"},{field:"is_raw_material",headerName:"Type",flex:1,renderCell:e=>t.jsx(Wa,{status:e.value?"raw_material":"finished_product",size:"small"})},{field:"is_active",headerName:"Statut",flex:1,renderCell:e=>t.jsx(Wa,{status:e.value?"active":"inactive",size:"small"})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(g,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),J(e.row)},disabled:!n,children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"secondary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),qs(e.row.id).then((t=>{const r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`qr-code-product-${e.row.id}-${e.row.name.replace(/\s+/g,"-").toLowerCase()}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)})).catch((e=>{console.error("Error downloading QR code:",e),alert("Impossible de tÃ©lÃ©charger le code QR. VÃ©rifiez votre connexion.")}))},children:t.jsx(Ye,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{if(_(null),console.log("Deleting product:",e),!e.id)return void _("ID du produit manquant");G(e),F(!0)}catch(t){console.error("Error deleting product:",t),_("Erreur lors de la suppression du produit. Veuillez rÃ©essayer plus tard.")}})(e.row)},disabled:!i,children:t.jsx(we,{fontSize:"small"})})]})}],paginationModel:X,onPaginationModelChange:Y,onRowClick:e=>{J(e.row)},loading:o,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]}),t.jsxs(re,{open:y,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ne,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold"},children:"Ajouter un produit"}),t.jsx(ie,{sx:{p:3,mt:1},children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:D.name,onChange:e=>O({...D,name:e.target.value}),required:!0})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:D.description,onChange:e=>O({...D,description:e.target.value})})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"CatÃ©gorie"}),t.jsx(le,{value:D.category||"",onChange:e=>O({...D,category:Number(e.target.value)}),label:"CatÃ©gorie",children:I?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}})," Chargement..."]}):E.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"UnitÃ©"}),t.jsx(le,{value:D.unit||"",onChange:e=>O({...D,unit:Number(e.target.value)}),label:"UnitÃ©",children:R?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}})," Chargement..."]}):S.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix d'achat",fullWidth:!0,type:"text",value:Ga(D.purchase_price),onChange:e=>{const t=Ha(e.target.value,D.purchase_price);O({...D,purchase_price:t})},error:D.purchase_price<0,helperText:qa(D.purchase_price,"price")})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix de vente",fullWidth:!0,type:"text",value:Ga(D.selling_price),onChange:e=>{const t=Ha(e.target.value,D.selling_price);O({...D,selling_price:t})},error:D.selling_price<0,helperText:qa(D.selling_price,"price")})}),t.jsxs(de,{item:!0,xs:12,sm:6,children:[" ",t.jsx(V,{label:"Niveau Stock Min.",fullWidth:!0,type:"text",value:Ga(D.min_stock_level),onChange:e=>{const t=Va(e.target.value,D.min_stock_level);O({...D,min_stock_level:t})},error:D.min_stock_level<0,helperText:qa(D.min_stock_level,"stock")})]}),t.jsx(de,{item:!0,xs:6,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Type"}),t.jsxs(le,{value:D.is_raw_material?1:0,onChange:e=>O({...D,is_raw_material:1===Number(e.target.value)}),label:"Type",children:[t.jsx(L,{value:0,children:"Produit fini"}),t.jsx(L,{value:1,children:"MatiÃ¨re premiÃ¨re"})]})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Note: Un code QR sera automatiquement gÃ©nÃ©rÃ© lors de la crÃ©ation du produit."})})]})}),t.jsxs(se,{sx:{p:2,pt:0},children:[t.jsx(M,{onClick:()=>w(!1),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{if(_(null),!D.name)return void _("Le nom du produit est requis");if(!D.category)return void _("La catÃ©gorie du produit est requise");if(!D.unit)return void _("L'unitÃ© du produit est requise");const e={...D,purchase_price:Number(D.purchase_price),selling_price:Number(D.selling_price),min_stock_level:Number(D.min_stock_level)};console.log("Creating product:",e);const t=await Bi(e);console.log("Product created:",t),console.log(`New product reference: ${t.reference}`),a([...s,t]),w(!1),O({name:"",reference:"",description:"",category:0,unit:0,purchase_price:0,selling_price:0,min_stock_level:0,is_raw_material:!1,is_active:!0})}catch(e){console.error("Error creating product:",e);let t="Erreur lors de la crÃ©ation du produit. Veuillez rÃ©essayer plus tard.";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}_(t)}},sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Ajouter"})]})]}),t.jsxs(re,{open:b,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ne,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold"},children:"Modifier un produit"}),t.jsx(ie,{sx:{p:3,mt:1},children:P&&t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:P.name,onChange:e=>k({...P,name:e.target.value}),required:!0})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"RÃ©fÃ©rence",fullWidth:!0,value:P.reference,onChange:e=>k({...P,reference:e.target.value}),required:!0,helperText:"La rÃ©fÃ©rence doit Ãªtre unique"})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:P.description,onChange:e=>k({...P,description:e.target.value})})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"CatÃ©gorie"}),t.jsx(le,{value:P.category||"",onChange:e=>k({...P,category:Number(e.target.value)}),label:"CatÃ©gorie",children:I?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}})," Chargement..."]}):E.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"UnitÃ©"}),t.jsx(le,{value:P.unit||"",onChange:e=>k({...P,unit:Number(e.target.value)}),label:"UnitÃ©",children:R?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}})," Chargement..."]}):S.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix d'achat",fullWidth:!0,type:"text",value:Ga(P.purchase_price),onChange:e=>{const t=Ha(e.target.value,P.purchase_price);k({...P,purchase_price:t})},error:(P.purchase_price??0)<0,helperText:qa(P.purchase_price,"price")})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix de vente",fullWidth:!0,type:"text",value:Ga(P.selling_price),onChange:e=>{const t=Ha(e.target.value,P.selling_price);k({...P,selling_price:t})},error:(P.selling_price??0)<0,helperText:qa(P.selling_price,"price")})}),t.jsxs(de,{item:!0,xs:12,sm:6,children:[" ",t.jsx(V,{label:"Niveau Stock Min.",fullWidth:!0,type:"text",value:Ga(P.min_stock_level),onChange:e=>{const t=Ha(e.target.value,P.min_stock_level);k({...P,min_stock_level:t})},error:(P.min_stock_level??0)<0,helperText:qa(P.min_stock_level,"stock")})]}),t.jsx(de,{item:!0,xs:6,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Type"}),t.jsxs(le,{value:P.is_raw_material?1:0,onChange:e=>k({...P,is_raw_material:1===Number(e.target.value)}),label:"Type",children:[t.jsx(L,{value:0,children:"Produit fini"}),t.jsx(L,{value:1,children:"MatiÃ¨re premiÃ¨re"})]})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(c,{sx:{mt:2,textAlign:"center"},children:[t.jsx(d,{variant:"subtitle1",sx:{mb:1,fontWeight:"bold"},children:"Code QR du produit"}),t.jsxs(c,{className:"qr-code-container",children:[t.jsx(il,{productId:P.id,productName:P.name,width:"150px",height:"150px",downloadable:!0}),t.jsx(d,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:"Le code QR contient les informations du produit et peut Ãªtre scannÃ© pour identification rapide."})]})]})})]})}),t.jsxs(se,{sx:{p:2,pt:0},children:[t.jsx(M,{onClick:()=>v(!1),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{if(_(null),!P)return void _("Produit Ã  Ã©diter manquant");if(!P.id)return void _("ID du produit manquant");if(!P.name)return void _("Le nom du produit est requis");if(!P.reference)return void _("La rÃ©fÃ©rence du produit est requise");if(!P.category)return void _("La catÃ©gorie du produit est requise");if(!P.unit)return void _("L'unitÃ© du produit est requise");const e={...P,purchase_price:Number(P.purchase_price),selling_price:Number(P.selling_price),min_stock_level:Number(P.min_stock_level)};console.log("Updating product:",e);const t=await Li(P.id,e);console.log("Product updated:",t),a(s.map((e=>e.id===P.id?t:e))),v(!1),k(null)}catch(e){console.error("Error updating product:",e);let t="Erreur lors de la mise Ã  jour du produit. Veuillez rÃ©essayer plus tard.";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}_(t)}},sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Enregistrer"})]})]}),t.jsxs(re,{open:B,onClose:ee,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:"background.paper"}},children:[t.jsx(ne,{sx:{backgroundColor:"error.main",color:"#fff",fontWeight:"bold"},children:"Confirmation de suppression"}),t.jsxs(ie,{sx:{p:3,mt:2,backgroundColor:"background.paper"},children:[t.jsxs(Ze,{color:"text.primary",sx:{mb:2},children:["ÃŠtes-vous sÃ»r de vouloir supprimer le produit ",t.jsx("strong",{children:null==z?void 0:z.name})," ?"]}),t.jsx(U,{severity:"warning",sx:{mb:2},children:"âš ï¸ Cette action supprimera dÃ©finitivement le produit et ses donnÃ©es associÃ©es."}),t.jsx(U,{severity:"error",children:"Cette action est irrÃ©versible."})]}),t.jsxs(se,{sx:{p:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:ee,disabled:q,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(M,{variant:"contained",color:"error",onClick:async()=>{if(null==z?void 0:z.id)try{_(null),$(!0),console.log("Deleting product:",z),await Fi(z.id),console.log("Product deleted"),a(s.filter((e=>e.id!==z.id))),F(!1),G(null)}catch(e){console.error("Error deleting product:",e),_("Erreur lors de la suppression du produit. Veuillez rÃ©essayer plus tard.")}finally{$(!1)}else _("Aucun produit sÃ©lectionnÃ© pour suppression")},disabled:q,startIcon:q?t.jsx(f,{size:20,color:"inherit"}):t.jsx(we,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:q?"Suppression...":"Supprimer"})]})]})]})})},al={name:"",contact_person:"",email:"",phone:"",address:"",is_active:!0,account:void 0},ol=()=>{const{canPerform:e}=Ka(),r=e("change_supplier"),n=e("delete_supplier"),[i,s]=ht.useState([]),[a,o]=ht.useState(!0),[l,u]=ht.useState(!1),[h,p]=ht.useState(al),[m,x]=ht.useState(!1),[y,w]=ht.useState(null),[b,v]=ht.useState(""),[C,_]=ht.useState({open:!1,message:"",severity:"success"}),[E,A]=ht.useState([]),[S,j]=ht.useState(!1),[I,T]=ht.useState({page:0,pageSize:10}),R=[{field:"name",headerName:Sa("company"),flex:1.2,renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name})},{field:"contact_person",headerName:Sa("contactPerson"),flex:1,renderCell:e=>t.jsx(d,{variant:"body2",children:e.row.contact_person})},{field:"phone",headerName:Sa("phone"),flex:1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Ge,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.phone})]})},{field:"email",headerName:Sa("email"),flex:1.2,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(qe,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.email})]})},{field:"address",headerName:Sa("address"),flex:1.3,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[t.jsx($e,{fontSize:"small",color:"action",sx:{mt:.25}}),t.jsx(d,{variant:"body2",children:e.row.address})]})},{field:"is_active",headerName:Sa("status"),flex:.7,renderCell:e=>t.jsx(Wa,{status:e.row.is_active?"active":"inactive"})},{field:"actions",headerName:Sa("actions"),flex:.8,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(g,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),N(e.row)},disabled:!r,children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),O(e.row.id)},disabled:!n,children:t.jsx(we,{fontSize:"small"})})]})}];ht.useEffect((()=>{(async()=>{try{o(!0);const e=await zi();s(e)}catch(e){console.error("Error loading clients:",e)}finally{o(!1)}})()}),[]),ht.useEffect((()=>{l&&(async()=>{try{j(!0);const e=await Hs("supplier"),t=i.filter((e=>void 0!==e.account)).map((e=>e.account)),r=e.filter((e=>!t.includes(e.id)));A(r.map((e=>({id:e.id??0,name:e.name??""}))))}catch(e){console.error("Error loading available accounts:",e)}finally{j(!1)}})()}),[l,i]);const N=e=>{e?(p({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address,is_active:e.is_active,account:e.account}),x(!0),w(e.id)):(p(al),x(!1),w(null)),u(!0)},D=()=>{u(!1)},O=async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce fournisseur?"))try{s((t=>t.filter((t=>t.id!==e)))),_({open:!0,message:"Fournisseur supprimÃ© avec succÃ¨s",severity:"success"})}catch(t){console.error("Error deleting supplier:",t),_({open:!0,message:"Erreur lors de la suppression du fournisseur",severity:"error"})}},P=()=>{_((e=>({...e,open:!1})))},M=i.filter((e=>e.name.toLowerCase().includes(b.toLowerCase())||e.contact_person.toLowerCase().includes(b.toLowerCase())||e.email.toLowerCase().includes(b.toLowerCase())));return t.jsx(el,{requiredPermission:"view_supplier",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Fournisseurs"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez vos relations avec les fournisseurs"})]}),t.jsxs(W,{sx:{p:3,mb:4},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[t.jsx(Fa,{label:Sa("search"),value:b,onChange:e=>v(e.target.value),sx:{width:"300px"},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Xe,{})})}}),t.jsx(ca,{variant:"contained",startIcon:t.jsx(Pe,{}),onClick:()=>N(),disabled:!e("add_supplier"),children:Sa("addSupplier")})]}),a?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):t.jsx(ja,{rows:M,columns:R,paginationModel:I,onPaginationModelChange:T,loading:a,getRowId:e=>e.id||Math.random(),onRowClick:e=>{r&&N(e.row)},sx:{minHeight:400,"& .MuiDataGrid-row":{cursor:"pointer"}}})]}),t.jsx(Ua,{open:l,editMode:m,contactType:"supplier",formData:h,availableAccounts:E,loadingAccounts:S,onClose:D,onSubmit:async()=>{try{if(!h.account)return void _({open:!0,message:"Le compte fournisseur est requis",severity:"error"});if(m&&y){await Ui(y,h);const e=await zi();s(e),_({open:!0,message:"Fournisseur mis Ã  jour avec succÃ¨s",severity:"success"})}else{await Wi(h);const e=await zi();s(e),_({open:!0,message:"Fournisseur ajoutÃ© avec succÃ¨s",severity:"success"})}D()}catch(e){let t="Erreur lors de l'enregistrement du fournisseur";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):String(t)}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}_({open:!0,message:t,severity:"error"})}},onFormDataChange:e=>{p(e)},onAccountChange:e=>{p((t=>({...t,account:""===e?void 0:e})))}}),t.jsx(ze,{open:C.open,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:P,severity:C.severity,variant:"filled",sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:C.message})})]})})},ll={product:0,quantity:0,zone:Number("1")||1,date:(new Date).toISOString().split("T")[0],notes:""},cl=[{id:1,name:"Atelier Principal"},{id:2,name:"EntrepÃ´t Central"},{id:3,name:"Magasin Paris"},{id:4,name:"Magasin Lyon"}],dl=()=>{const e=h(),{canPerform:r}=Ka(),n=r("change_production"),i=r("delete_production"),[s,a]=ht.useState([]),[o,l]=ht.useState([]),[u,p]=ht.useState(!0),[m,x]=ht.useState(!1),[y,w]=ht.useState(ll),[b,v]=ht.useState(!1),[C,_]=ht.useState(null),[E,A]=ht.useState({open:!1,message:"",severity:"success"}),[S,j]=ht.useState(null);ht.useEffect((()=>{I()}),[]);const I=async()=>{try{p(!0),j(null);const e=await Ms();a(e);const t=await Mi();l(t)}catch(e){console.error("Error loading data:",e),j("Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer.")}finally{p(!1)}},T=e=>{e?(w({product:e.product,quantity:e.quantity,zone:e.zone,date:e.date,notes:e.notes||""}),v(!0),_(e.id||null)):(w(ll),v(!1),_(null)),x(!0)},R=()=>{x(!1)},N=e=>{const{name:t,value:r}=e.target;w((e=>({...e,[t]:r})))},D=e=>{const{name:t,value:r}=e.target;w((e=>({...e,[t]:r})))},O=()=>{A((e=>({...e,open:!1})))},P=e=>{const t=o.find((t=>t.id===e));return t?t.name:"Produit inconnu"},k=e=>{const t=cl.find((t=>t.id===e));return t?t.name:"Zone inconnue"};return t.jsx(el,{requiredPermission:"view_production",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:e.palette.primary.main,borderBottom:`2px solid ${e.palette.primary.light}`,pb:1,width:"fit-content"},children:"Gestion de la Production"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"Suivez et gÃ©rez toutes les opÃ©rations de production"})]}),t.jsxs(W,{sx:{p:3,mb:4,borderRadius:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(d,{variant:"h6",children:"Productions"}),t.jsx(Jo,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>T(),requiredPermission:"add_production",sx:{borderRadius:2},children:"Nouvelle Production"})]}),S&&t.jsx(U,{severity:"error",sx:{mb:3},children:S}),u?t.jsx(c,{sx:{display:"flex",justifyContent:"center",my:4},children:t.jsx(f,{})}):t.jsx(pe,{children:t.jsxs(me,{children:[t.jsx(fe,{children:t.jsxs(ge,{children:[t.jsx(xe,{children:"Produit"}),t.jsx(xe,{align:"right",children:"QuantitÃ©"}),t.jsx(xe,{children:"Zone"}),t.jsx(xe,{children:"Date"}),t.jsx(xe,{children:"Notes"}),t.jsx(xe,{align:"right",children:"Actions"})]})}),t.jsx(ye,{children:0===s.length?t.jsx(ge,{children:t.jsx(xe,{colSpan:6,align:"center",children:"Aucune production enregistrÃ©e"})}):s.map((e=>t.jsxs(ge,{children:[t.jsx(xe,{children:P(e.product)}),t.jsx(xe,{align:"right",children:e.quantity}),t.jsx(xe,{children:k(e.zone)}),t.jsx(xe,{children:new Date(e.date).toLocaleDateString()}),t.jsx(xe,{children:e.notes}),t.jsxs(xe,{align:"right",children:[t.jsx(g,{color:"primary",size:"small",onClick:()=>T(e),disabled:!n,children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:()=>e.id&&(async e=>{if(i){if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette production ?"))try{await Ls(e),a((t=>t.filter((t=>t.id!==e)))),A({open:!0,message:"Production supprimÃ©e avec succÃ¨s",severity:"success"})}catch(t){console.error("Error deleting production:",t),A({open:!0,message:"Erreur lors de la suppression de la production",severity:"error"})}}else A({open:!0,message:"Vous n'avez pas la permission de supprimer des productions",severity:"error"})})(e.id),disabled:!i,children:t.jsx(we,{fontSize:"small"})})]})]},e.id)))})]})})]}),t.jsxs(re,{open:m,onClose:R,maxWidth:"sm",fullWidth:!0,children:[t.jsx(ne,{children:b?"Modifier la Production":"Nouvelle Production"}),t.jsx(ie,{children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Produit"}),t.jsxs(le,{name:"product",value:String(y.product),onChange:D,label:"Produit",children:[t.jsx(L,{value:"0",children:"SÃ©lectionnez un produit"}),o.map((e=>t.jsx(L,{value:String(e.id),children:e.name},e.id)))]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{name:"quantity",label:"QuantitÃ©",type:"number",fullWidth:!0,required:!0,value:y.quantity,onChange:N,inputProps:{min:0}})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"Zone"}),t.jsx(le,{name:"zone",value:String(y.zone),onChange:D,label:"Zone",children:cl.map((e=>t.jsx(L,{value:String(e.id),children:e.name},e.id)))})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{name:"date",label:"Date",type:"date",fullWidth:!0,required:!0,value:y.date,onChange:N,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{name:"notes",label:"Notes",multiline:!0,rows:3,fullWidth:!0,value:y.notes,onChange:N})})]})}),t.jsxs(se,{children:[t.jsx(M,{onClick:R,children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{var e;try{j(null);const t={...y,product:Number(y.product),quantity:Number(y.quantity),zone:Number(y.zone),reference:b&&C&&(null==(e=s.find((e=>e.id===C)))?void 0:e.reference)||`PROD-${Date.now()}`};if(b&&C){const e=await Bs(C,t);a((t=>t.map((t=>t.id===C?e:t)))),A({open:!0,message:"Production mise Ã  jour avec succÃ¨s",severity:"success"})}else{const e=await ks(t);a((t=>[...t,e])),A({open:!0,message:"Production ajoutÃ©e avec succÃ¨s",severity:"success"})}R()}catch(t){console.error("Error saving production:",t),j("Erreur lors de l'enregistrement de la production")}},disabled:!y.product||y.quantity<=0||!y.zone||!y.date,children:b?"Mettre Ã  jour":"Ajouter"})]})]}),t.jsx(ze,{open:E.open,autoHideDuration:6e3,onClose:O,children:t.jsx(U,{onClose:O,severity:E.severity,variant:"filled",children:E.message})})]})})};var ul={},hl=te;Object.defineProperty(ul,"__esModule",{value:!0});var pl=ul.default=void 0,ml=hl(Oa()),fl=t;pl=ul.default=(0,ml.default)((0,fl.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");var gl={},xl=te;Object.defineProperty(gl,"__esModule",{value:!0});var yl=gl.default=void 0,wl=xl(Oa()),bl=t;yl=gl.default=(0,wl.default)((0,bl.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");var vl={},Cl=te;Object.defineProperty(vl,"__esModule",{value:!0});var _l=vl.default=void 0,El=Cl(Oa()),Al=t;_l=vl.default=(0,El.default)((0,Al.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var Sl={},jl=te;Object.defineProperty(Sl,"__esModule",{value:!0});var Il=Sl.default=void 0,Tl=jl(Oa()),Rl=t;Il=Sl.default=(0,Tl.default)((0,Rl.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance");var Nl={},Dl=te;Object.defineProperty(Nl,"__esModule",{value:!0});var Ol=Nl.default=void 0,Pl=Dl(Oa()),Ml=t;Ol=Nl.default=(0,Pl.default)((0,Ml.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment");var kl={},Bl=te;Object.defineProperty(kl,"__esModule",{value:!0});var Ll=kl.default=void 0,Fl=Bl(Oa()),zl=t;Ll=kl.default=(0,Fl.default)((0,zl.jsx)("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"}),"Receipt");var Wl={},Ul=te;Object.defineProperty(Wl,"__esModule",{value:!0});var Vl=Wl.default=void 0,Hl=Ul(Oa()),Gl=t;Vl=Wl.default=(0,Hl.default)((0,Gl.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");var ql={},$l=te;Object.defineProperty(ql,"__esModule",{value:!0});var Xl=ql.default=void 0,Yl=$l(Oa()),Zl=t;Xl=ql.default=(0,Yl.default)((0,Zl.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoney");var Kl={},Ql=te;Object.defineProperty(Kl,"__esModule",{value:!0});var Jl=Kl.default=void 0,ec=Ql(Oa()),tc=t;Jl=Kl.default=(0,ec.default)((0,tc.jsx)("path",{d:"M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2zm-9-2h10V8H12zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"AccountBalanceWallet");var rc={},nc=te;Object.defineProperty(rc,"__esModule",{value:!0});var ic=rc.default=void 0,sc=nc(Oa()),ac=t;ic=rc.default=(0,sc.default)((0,ac.jsx)("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27M5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27z"}),"MoneyOff");var oc={},lc=te;Object.defineProperty(oc,"__esModule",{value:!0});var cc=oc.default=void 0,dc=lc(Oa()),uc=t;cc=oc.default=(0,dc.default)([(0,uc.jsx)("path",{d:"M5 8h2v8H5zm7 0H9c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1m-1 6h-1v-4h1zm7-6h-3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h3c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1m-1 6h-1v-4h1z"},"0"),(0,uc.jsx)("path",{d:"M2 4v16h20V4zm2 14V6h16v12z"},"1")],"Money");var hc={},pc=te;Object.defineProperty(hc,"__esModule",{value:!0});var mc=hc.default=void 0,fc=pc(Oa()),gc=t;mc=hc.default=(0,fc.default)((0,gc.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList");var xc={},yc=te;Object.defineProperty(xc,"__esModule",{value:!0});var wc=xc.default=void 0,bc=yc(Oa()),vc=t;wc=xc.default=(0,bc.default)((0,vc.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var Cc={},_c=te;Object.defineProperty(Cc,"__esModule",{value:!0});var Ec=Cc.default=void 0,Ac=_c(Oa()),Sc=t;Ec=Cc.default=(0,Ac.default)((0,Sc.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var jc={},Ic=te;Object.defineProperty(jc,"__esModule",{value:!0});var Tc=jc.default=void 0,Rc=Ic(Oa()),Nc=t;function Dc(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=Dc(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function Oc(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=Dc(e))&&(n&&(n+=" "),n+=t);return n}Tc=jc.default=(0,Rc.default)((0,Nc.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");let Pc={data:""},Mc=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,kc=/\/\*[^]*?\*\/|  +/g,Bc=/\n+/g,Lc=(e,t)=>{let r="",n="",i="";for(let s in e){let a=e[s];"@"==s[0]?"i"==s[1]?r=s+" "+a+";":n+="f"==s[1]?Lc(a,s):s+"{"+Lc(a,"k"==s[1]?"":t)+"}":"object"==typeof a?n+=Lc(a,t?t.replace(/([^,])+/g,(e=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):s):null!=a&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=Lc.p?Lc.p(s,a):s+":"+a+";")}return r+(t&&i?t+"{"+i+"}":i)+n},Fc={},zc=e=>{if("object"==typeof e){let t="";for(let r in e)t+=r+zc(e[r]);return t}return e};function Wc(e){let t=this||{},r=e.call?e(t.p):e;return((e,t,r,n,i)=>{let s=zc(e),a=Fc[s]||(Fc[s]=(e=>{let t=0,r=11;for(;t<e.length;)r=101*r+e.charCodeAt(t++)>>>0;return"go"+r})(s));if(!Fc[a]){let t=s!==e?e:(e=>{let t,r,n=[{}];for(;t=Mc.exec(e.replace(kc,""));)t[4]?n.shift():t[3]?(r=t[3].replace(Bc," ").trim(),n.unshift(n[0][r]=n[0][r]||{})):n[0][t[1]]=t[2].replace(Bc," ").trim();return n[0]})(e);Fc[a]=Lc(i?{["@keyframes "+a]:t}:t,r?"":"."+a)}let o=r&&Fc.g?Fc.g:null;return r&&(Fc.g=Fc[a]),l=Fc[a],c=t,d=n,(u=o)?c.data=c.data.replace(u,l):-1===c.data.indexOf(l)&&(c.data=d?l+c.data:c.data+l),a;var l,c,d,u})(r.unshift?r.raw?((e,t,r)=>e.reduce(((e,n,i)=>{let s=t[i];if(s&&s.call){let e=s(r),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":Lc(e,""):!1===e?"":e}return e+n+(null==s?"":s)}),""))(r,[].slice.call(arguments,1),t.p):r.reduce(((e,r)=>Object.assign(e,r&&r.call?r(t.p):r)),{}):r,(n=t.target,"object"==typeof window?((n?n.querySelector("#_goober"):window._goober)||Object.assign((n||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:n||Pc),t.g,t.o,t.k);var n}function Uc(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}function Vc(){return Vc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vc.apply(this,arguments)}function Hc(e,t){if(null==e)return{};var r,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}Wc.bind({g:1}),Wc.bind({k:1});var Gc=function(){return""},qc=xt.createContext({enqueueSnackbar:Gc,closeSnackbar:Gc}),$c="@media (max-width:599.95px)",Xc="@media (min-width:600px)",Yc="unmounted",Zc="exited",Kc="entering",Qc="entered",Jc="exiting",ed=function(e){var t,r;function n(t){var r;r=e.call(this,t)||this;var n,i=t.appear;return r.appearStatus=null,t.in?i?(n=Zc,r.appearStatus=Kc):n=Qc:n=t.unmountOnExit||t.mountOnEnter?Yc:Zc,r.state={status:n},r.nextCallback=null,r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Yc?{status:Zc}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var r=this.state.status;this.props.in?r!==Kc&&r!==Qc&&(t=Kc):r!==Kc&&r!==Qc||(t=Jc)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e=this.props.timeout,t=e,r=e;return null!=e&&"number"!=typeof e&&"string"!=typeof e&&(r=e.exit,t=e.enter),{exit:r,enter:t}},i.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===Kc?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===Zc&&this.setState({status:Yc})},i.performEnter=function(e){var t=this,r=this.props.enter,n=e,i=this.getTimeouts();e||r?(this.props.onEnter&&this.props.onEnter(this.node,n),this.safeSetState({status:Kc},(function(){t.props.onEntering&&t.props.onEntering(t.node,n),t.onTransitionEnd(i.enter,(function(){t.safeSetState({status:Qc},(function(){t.props.onEntered&&t.props.onEntered(t.node,n)}))}))}))):this.safeSetState({status:Qc},(function(){t.props.onEntered&&t.props.onEntered(t.node,n)}))},i.performExit=function(){var e=this,t=this.props.exit,r=this.getTimeouts();t?(this.props.onExit&&this.props.onExit(this.node),this.safeSetState({status:Jc},(function(){e.props.onExiting&&e.props.onExiting(e.node),e.onTransitionEnd(r.exit,(function(){e.safeSetState({status:Zc},(function(){e.props.onExited&&e.props.onExited(e.node)}))}))}))):this.safeSetState({status:Zc},(function(){e.props.onExited&&e.props.onExited(e.node)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&this.nextCallback.cancel&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,r=!0;return this.nextCallback=function(){r&&(r=!1,t.nextCallback=null,e())},this.nextCallback.cancel=function(){r=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var r=null==e&&!this.props.addEndListener;this.node&&!r?(this.props.addEndListener&&this.props.addEndListener(this.node,this.nextCallback),null!=e&&setTimeout(this.nextCallback,e)):setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===Yc)return null;var t=this.props;return(0,t.children)(e,Hc(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]))},Uc(n,[{key:"node",get:function(){var e,t=null===(e=this.props.nodeRef)||void 0===e?void 0:e.current;if(!t)throw new Error("notistack - Custom snackbar is not refForwarding");return t}}]),n}(xt.Component);function td(){}function rd(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function nd(e,t){return ht.useMemo((function(){return null==e&&null==t?null:function(r){rd(e,r),rd(t,r)}}),[e,t])}function id(e){var t=e.timeout,r=e.style,n=void 0===r?{}:r,i=e.mode;return{duration:"object"==typeof t?t[i]||0:t,easing:n.transitionTimingFunction,delay:n.transitionDelay}}ed.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:td,onEntering:td,onEntered:td,onExit:td,onExiting:td,onExited:td};var sd="cubic-bezier(0.4, 0, 0.2, 1)",ad="cubic-bezier(0.0, 0, 0.2, 1)",od="cubic-bezier(0.4, 0, 0.6, 1)",ld=function(e){e.scrollTop=e.scrollTop},cd=function(e){return Math.round(e)+"ms"};function dd(e,t){void 0===e&&(e=["all"]);var r=t||{},n=r.duration,i=void 0===n?300:n,s=r.easing,a=void 0===s?sd:s,o=r.delay,l=void 0===o?0:o;return(Array.isArray(e)?e:[e]).map((function(e){var t="string"==typeof i?i:cd(i),r="string"==typeof l?l:cd(l);return e+" "+t+" "+a+" "+r})).join(",")}function ud(e){var t=function(e){return e&&e.ownerDocument||document}(e);return t.defaultView||window}function hd(e,t){if(t){var r=function(e,t){var r,n=t.getBoundingClientRect(),i=ud(t);if(t.fakeTransform)r=t.fakeTransform;else{var s=i.getComputedStyle(t);r=s.getPropertyValue("-webkit-transform")||s.getPropertyValue("transform")}var a=0,o=0;if(r&&"none"!==r&&"string"==typeof r){var l=r.split("(")[1].split(")")[0].split(",");a=parseInt(l[4],10),o=parseInt(l[5],10)}switch(e){case"left":return"translateX("+(i.innerWidth+a-n.left)+"px)";case"right":return"translateX(-"+(n.left+n.width-a)+"px)";case"up":return"translateY("+(i.innerHeight+o-n.top)+"px)";default:return"translateY(-"+(n.top+n.height-o)+"px)"}}(e,t);r&&(t.style.webkitTransform=r,t.style.transform=r)}}function pd(e){return Object.entries(e).reduce((function(e,t){var r,n=t[0],i=t[1];return Vc({},e,((r={})[n]=Wc(i),r))}),{})}ht.forwardRef((function(e,t){var r=e.children,n=e.direction,i=void 0===n?"down":n,s=e.in,a=e.style,o=e.timeout,l=void 0===o?0:o,c=e.onEnter,d=e.onEntered,u=e.onExit,h=e.onExited,p=Hc(e,["children","direction","in","style","timeout","onEnter","onEntered","onExit","onExited"]),m=ht.useRef(null),f=nd(r.ref,m),g=nd(f,t),x=ht.useCallback((function(){m.current&&hd(i,m.current)}),[i]);return ht.useEffect((function(){if(!s&&"down"!==i&&"right"!==i){var e=function(e,t){var r;function n(){for(var n=this,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];clearTimeout(r),r=setTimeout((function(){e.apply(n,s)}),t)}return void 0===t&&(t=166),n.clear=function(){clearTimeout(r)},n}((function(){m.current&&hd(i,m.current)})),t=ud(m.current);return t.addEventListener("resize",e),function(){e.clear(),t.removeEventListener("resize",e)}}}),[i,s]),ht.useEffect((function(){s||x()}),[s,x]),ht.createElement(ed,Object.assign({appear:!0,nodeRef:m,onEnter:function(e,t){hd(i,e),ld(e),c&&c(e,t)},onEntered:d,onEntering:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||ad,r=id({timeout:l,mode:"enter",style:Vc({},a,{transitionTimingFunction:t})});e.style.webkitTransition=dd("-webkit-transform",r),e.style.transition=dd("transform",r),e.style.webkitTransform="none",e.style.transform="none"},onExit:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||od,r=id({timeout:l,mode:"exit",style:Vc({},a,{transitionTimingFunction:t})});e.style.webkitTransition=dd("-webkit-transform",r),e.style.transition=dd("transform",r),hd(i,e),u&&u(e)},onExited:function(e){e.style.webkitTransition="",e.style.transition="",h&&h(e)},in:s,timeout:l},p),(function(e,t){return ht.cloneElement(r,Vc({ref:g,style:Vc({visibility:"exited"!==e||s?void 0:"hidden"},a,{},r.props.style)},t))}))})).displayName="Slide";var md="notistack-Snackbar",fd="notistack-CollapseWrapper",gd="notistack-MuiContent",xd=function(e){return"notistack-MuiContent-"+e},yd=pd({root:{height:0},entered:{height:"auto"}}),wd="0px";ht.forwardRef((function(e,t){var r=e.children,n=e.in,i=e.onExited,s=ht.useRef(null),a=ht.useRef(null),o=nd(t,a),l=function(){return s.current?s.current.clientHeight:0};return ht.createElement(ed,{in:n,unmountOnExit:!0,onEnter:function(e){e.style.height=wd},onEntered:function(e){e.style.height="auto"},onEntering:function(e){var t=l(),r=id({timeout:175,mode:"enter"}),n=r.duration,i=r.easing;e.style.transitionDuration="string"==typeof n?n:n+"ms",e.style.height=t+"px",e.style.transitionTimingFunction=i||""},onExit:function(e){e.style.height=l()+"px"},onExited:i,onExiting:function(e){ld(e);var t=id({timeout:175,mode:"exit"}),r=t.duration,n=t.easing;e.style.transitionDuration="string"==typeof r?r:r+"ms",e.style.height=wd,e.style.transitionTimingFunction=n||""},nodeRef:a,timeout:175},(function(e,t){return ht.createElement("div",Object.assign({ref:o,className:Oc(yd.root,"entered"===e&&yd.entered),style:Vc({pointerEvents:"all",overflow:"hidden",minHeight:wd,transition:dd("height")},"entered"===e&&{overflow:"visible"},{},"exited"===e&&!n&&{visibility:"hidden"})},t),ht.createElement("div",{ref:s,className:fd,style:{display:"flex",width:"100%"}},r))}))})).displayName="Collapse";var bd,vd="undefined"!=typeof window?ht.useLayoutEffect:ht.useEffect;function Cd(e){var t=ht.useRef(e);return vd((function(){t.current=e})),ht.useCallback((function(){return t.current.apply(void 0,arguments)}),[])}ht.forwardRef((function(e,t){var r=e.children,n=e.className,i=e.autoHideDuration,s=e.disableWindowBlurListener,a=void 0!==s&&s,o=e.onClose,l=e.id,c=e.open,d=e.SnackbarProps,u=void 0===d?{}:d,h=ht.useRef(),p=Cd((function(){o&&o.apply(void 0,arguments)})),m=Cd((function(e){o&&null!=e&&(h.current&&clearTimeout(h.current),h.current=setTimeout((function(){p(null,"timeout",l)}),e))}));ht.useEffect((function(){return c&&m(i),function(){h.current&&clearTimeout(h.current)}}),[c,i,m]);var f=function(){h.current&&clearTimeout(h.current)},g=ht.useCallback((function(){null!=i&&m(.5*i)}),[i,m]);return ht.useEffect((function(){if(!a&&c)return window.addEventListener("focus",g),window.addEventListener("blur",f),function(){window.removeEventListener("focus",g),window.removeEventListener("blur",f)}}),[a,g,c]),ht.createElement("div",Object.assign({ref:t},u,{className:Oc(md,n),onMouseEnter:function(e){u.onMouseEnter&&u.onMouseEnter(e),f()},onMouseLeave:function(e){u.onMouseLeave&&u.onMouseLeave(e),g()}}),r)})).displayName="Snackbar";var _d=pd({root:(bd={display:"flex",flexWrap:"wrap",flexGrow:1},bd[Xc]={flexGrow:"initial",minWidth:"288px"},bd)}),Ed=ht.forwardRef((function(e,t){var r=e.className,n=Hc(e,["className"]);return xt.createElement("div",Object.assign({ref:t,className:Oc(_d.root,r)},n))}));Ed.displayName="SnackbarContent";var Ad,Sd,jd,Id=pd({root:{backgroundColor:"#313131",fontSize:"0.875rem",lineHeight:1.43,letterSpacing:"0.01071em",color:"#fff",alignItems:"center",padding:"6px 16px",borderRadius:"4px",boxShadow:"0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12)"},lessPadding:{paddingLeft:"20px"},default:{backgroundColor:"#313131"},success:{backgroundColor:"#43a047"},error:{backgroundColor:"#d32f2f"},warning:{backgroundColor:"#ff9800"},info:{backgroundColor:"#2196f3"},message:{display:"flex",alignItems:"center",padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:"16px",marginRight:"-8px"}}),Td="notistack-snackbar";ht.forwardRef((function(e,t){var r=e.id,n=e.message,i=e.action,s=e.iconVariant,a=e.variant,o=e.hideIconVariant,l=e.style,c=e.className,d=s[a],u=i;return"function"==typeof u&&(u=u(r)),xt.createElement(Ed,{ref:t,role:"alert","aria-describedby":Td,style:l,className:Oc(gd,xd(a),Id.root,Id[a],c,!o&&d&&Id.lessPadding)},xt.createElement("div",{id:Td,className:Id.message},o?null:d,n),u&&xt.createElement("div",{className:Id.action},u))})).displayName="MaterialDesignContent";var Rd={default:20},Nd={default:6,dense:2},Dd="."+fd;(Ad={boxSizing:"border-box",display:"flex",maxHeight:"100%",position:"fixed",zIndex:1400,height:"auto",width:"auto",transition:dd(["top","right","bottom","left","max-width"],{duration:300,easing:"ease"}),pointerEvents:"none"})[Dd]={padding:Nd.default+"px 0px",transition:"padding 300ms ease 0ms"},Ad.maxWidth="calc(100% - "+2*Rd.default+"px)",Ad[$c]={width:"100%",maxWidth:"calc(100% - 32px)"},Nd.dense,Rd.default,Nd.default,Rd.default,Nd.default,(Sd={left:Rd.default+"px"})[Xc]={alignItems:"flex-start"},Sd[$c]={left:"16px"},(jd={right:Rd.default+"px"})[Xc]={alignItems:"flex-end"},jd[$c]={right:"16px"};const Od=e=>new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),Pd=e=>{try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}},Md=e=>{switch(e){case"unpaid":return"error";case"partially_paid":return"warning";case"paid":return"success";default:return"default"}},kd=e=>{switch(e){case"unpaid":return"Non payÃ©";case"partially_paid":return"Partiellement payÃ©";case"paid":return"PayÃ©";case"overpaid":return"SurpayÃ©";default:return e}},Bd=e=>{const t=(e||"").toLowerCase();return{bgcolor:t.includes("dÃ©pÃ´t")?"rgba(46, 125, 50, 0.1)":t.includes("paiement")?"rgba(25, 118, 210, 0.1)":"rgba(156, 39, 176, 0.1)",color:t.includes("dÃ©pÃ´t")?"success.main":t.includes("paiement")?"primary.main":"secondary.main",borderRadius:"4px",fontWeight:500}},Ld=u(W)((()=>({borderRadius:12,boxShadow:"0 4px 12px 0 rgba(0,0,0,0.05)",overflow:"hidden"}))),Fd=u(K)((()=>({borderRadius:12,transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 20px rgba(0,0,0,0.1)"}})));function zd(e){const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`treasury-tabpanel-${i}`,"aria-labelledby":`treasury-tab-${i}`,...s,children:n===i&&t.jsx(c,{p:3,children:r})})}function Wd(e){return{id:`treasury-tab-${e}`,"aria-controls":`treasury-tabpanel-${e}`}}const Ud=()=>{var e,r,n;const[i,s]=ht.useState(0),[a,o]=ht.useState([]),[u,h]=ht.useState(null),[p,m]=ht.useState(null),[x,w]=ht.useState(!1),[b,v]=ht.useState(""),[C,_]=ht.useState(0),[E,A]=ht.useState(6),[S,j]=ht.useState(!1),[I,T]=ht.useState(null),[R,N]=ht.useState(!1),[D,O]=ht.useState(null),[P,k]=ht.useState(0),[B,L]=ht.useState(""),[F,z]=ht.useState(!1),[G,q]=ht.useState(null),[$,X]=ht.useState(null),[ee,te]=ht.useState(!1),[ae,oe]=ht.useState(!1),[le,he]=ht.useState({client:null,account:null,amount:0,payment_method:null,date:(new Date).toISOString().split("T")[0],description:"DÃ©pÃ´t sur compte"}),[pe,me]=ht.useState([]),[fe,ge]=ht.useState([]),[xe,ye]=ht.useState(!1),[we,Ce]=ht.useState(null),[_e,Ee]=ht.useState(!1),[Ae,Se]=ht.useState([]),[je,Ie]=ht.useState(!1),[Te,Re]=ht.useState(null),[Ne,De]=ht.useState([]),[Oe,Pe]=ht.useState(""),[Me,ke]=ht.useState(""),[Be,Le]=ht.useState(""),[Fe,Ue]=ht.useState({from_account:void 0,to_account:void 0,amount:0,transfer_date:(new Date).toISOString().split("T")[0],reference_number:"",notes:""}),[Ve,He]=ht.useState(null),[Ge,qe]=ht.useState(null),[$e,Xe]=ht.useState(!1),[Ye,Ze]=ht.useState(!1),[tt,rt]=ht.useState(!1),{enqueueSnackbar:nt}=ht.useContext(qc),it=ht.useCallback((async()=>{try{const e=await Vs();De(e)}catch(e){console.error("Error fetching accounts:",e),He("Erreur lors du chargement des comptes.")}}),[]),st=ht.useCallback((async()=>{try{Ie(!0),He(null);const e=new URLSearchParams;Te&&e.append("account",Te.id.toString()),Me&&e.append("start_date",Me),Be&&e.append("end_date",Be),Oe&&e.append("transaction_type",Oe);let t=[];t=Te?await Gs.getAccountStatements(Te.id):await Gs.getAccountStatements(),Se(t)}catch(e){console.error("Error fetching account movements:",e),He("Erreur lors du chargement des mouvements de compte."),Se([])}finally{Ie(!1)}}),[Te,Me,Be,Oe]);ht.useEffect((()=>{ct(),it(),ae?(dt(),j(!1),T(null)):(j(!1),T(null)),1===i&&st()}),[ae,i,it,st]);const at=a.filter((e=>e.name.toLowerCase().includes(b.toLowerCase())||e.contact_person&&e.contact_person.toLowerCase().includes(b.toLowerCase()))),ot=at.slice(C*E,C*E+E),lt=e=>{switch(e){case"client_payment":case"cash_receipt":case"transfer_in":case"sale":case"deposit":return"success";case"supplier_payment":case"cash_payment":case"transfer_out":case"expense":case"purchase":return"error";default:return"default"}},ct=async()=>{try{const e=await ji();o(e)}catch(e){console.error("Error fetching clients:",e),He("Erreur lors du chargement des clients. Veuillez rÃ©essayer plus tard.")}},dt=async()=>{try{ye(!0);const[e,t]=await Promise.all([Gs.getAccounts(),Fs("payment-methods")]);me(e),ge(t),ye(!1)}catch(e){console.error("Error loading resources:",e),He("Erreur lors du chargement des comptes et mÃ©thodes de paiement."),ye(!1)}},ut=()=>{O(null),k(0),L("")},pt=async e=>{try{w(!0),He(null);const t=p?p.balance:null,r=u||await Ii(e),n=null==r?void 0:r.account;console.log("Loading data for client:",e,"account:",n),console.log("Client data:",r);const[i,s,a]=await Promise.all([Gs.getClientBalance(e),n?Gs.getAccountStatements(n):Promise.resolve([]),ls()]);console.log("Fetched statements for account",n,":",s);const o=s;console.log("Final client statements:",o.length,"statements");const l=((e,t)=>e.filter((e=>e.client===t&&("unpaid"===e.payment_status||"partially_paid"===e.payment_status))).map((e=>({id:e.id||0,reference:e.reference||"",date:e.date,total_amount:e.total_amount,paid_amount:e.paid_amount||0,balance:e.remaining_amount||e.total_amount,payment_status:e.payment_status||"unpaid"}))))(a,e),c={...i,statements:o,outstanding_sales:l};m(c),w(!1),null!==t&&i.balance!==t&&mt(t,i.balance)}catch(t){console.error("Error loading client account data:",t),He("Erreur lors du chargement des donnÃ©es du compte client."),w(!1),m(null)}},mt=(e,r)=>{Ce(e),Ee(!0);const n=r>e,i=Math.abs(r-e);nt(t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(J,{sx:{bgcolor:n?"success.main":"error.main",width:32,height:32,mr:1.5},children:n?"+":"-"}),t.jsxs(c,{children:[t.jsx(d,{variant:"body2",fontWeight:500,children:n?"DÃ©pÃ´t effectuÃ©":"Retrait effectuÃ©"}),t.jsxs(d,{variant:"caption",sx:{display:"block"},children:[n?"CrÃ©dit":"DÃ©bit"," de ",Od(i)]})]})]}),{variant:n?"success":"warning",anchorOrigin:{vertical:"bottom",horizontal:"right"},TransitionComponent:Qe,autoHideDuration:5e3}),setTimeout((()=>{Ee(!1)}),3e3)};return t.jsx(el,{requiredPermission:"view_cashflow",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsxs(c,{children:[t.jsx(d,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"TrÃ©sorerie"}),t.jsx(d,{variant:"body2",color:"text.secondary",children:"Gestion des paiements et comptes clients"})]}),"        ",t.jsx(c,{children:0===i&&u&&t.jsx(We,{direction:"row",spacing:2,children:t.jsx(M,{variant:"outlined",color:"primary",startIcon:t.jsx(Ec,{}),onClick:()=>{h(null),m(null)},sx:{borderRadius:2},children:"Retour"})})})]}),t.jsxs(Ld,{children:["        ",t.jsxs(c,{sx:{borderBottom:1,borderColor:"divider"},children:["          ",t.jsxs(be,{value:i,onChange:(e,t)=>{s(t),He(null)},indicatorColor:"primary",variant:"fullWidth","aria-label":"treasury tabs",children:[t.jsx(ve,{label:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Jl,{fontSize:"small"}),t.jsx("span",{children:"Comptes Clients"})]}),...Wd(0)}),t.jsx(ve,{label:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Il,{fontSize:"small"}),t.jsx("span",{children:"Mouvements"})]}),...Wd(1)})]})]}),"        ",t.jsx(zd,{value:i,index:0,children:t.jsx(de,{container:!0,spacing:3,children:u?t.jsxs(t.Fragment,{children:[t.jsx(de,{item:!0,xs:12,children:x?t.jsx(K,{sx:{mb:3},elevation:2,children:t.jsx(Q,{children:t.jsxs(c,{sx:{display:"flex",justifyContent:"center",py:4},children:[t.jsx(f,{}),t.jsx(d,{variant:"body1",sx:{ml:2},children:"Chargement des donnÃ©es du client..."})]})})}):t.jsx(K,{sx:{mb:3},elevation:2,children:t.jsx(Q,{children:t.jsxs(de,{container:!0,alignItems:"center",spacing:3,children:[t.jsxs(de,{item:!0,xs:12,md:4,children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(J,{sx:{bgcolor:"primary.main",mr:2,width:56,height:56},children:u.name.charAt(0).toUpperCase()}),t.jsxs(c,{children:[t.jsx(d,{variant:"h6",fontWeight:"bold",children:u.name}),u.contact_person&&t.jsx(d,{variant:"body2",color:"text.secondary",children:u.contact_person})]})]}),t.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[u.phone&&t.jsx(ce,{icon:t.jsx(d,{children:"ðŸ“ž"}),label:u.phone,variant:"outlined",size:"small"}),u.email&&t.jsx(ce,{icon:t.jsx(d,{children:"âœ‰ï¸"}),label:u.email,variant:"outlined",size:"small"}),u.address&&t.jsx(ce,{icon:t.jsx(d,{children:"ðŸ "}),label:u.address,variant:"outlined",size:"small"})]})]}),t.jsx(de,{item:!0,xs:12,md:4,children:t.jsxs(c,{sx:{textAlign:"center"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Solde actuel"}),t.jsx(Qe,{in:!0,style:{transformOrigin:"0 0 0"},..._e?{timeout:1e3}:{},children:t.jsx(d,{variant:"h4",sx:{fontWeight:"bold",color:(null==p?void 0:p.balance)>=0?"success.main":"error.main",transition:"color 0.5s ease",animation:_e?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.6},"100%":{opacity:1}}},children:Od(p?p.balance:0)})}),null!==we&&p&&we!==p.balance&&t.jsx(Je,{direction:"up",in:_e,mountOnEnter:!0,unmountOnExit:!0,children:t.jsxs(d,{variant:"caption",sx:{color:p.balance>we?"success.main":"error.main",fontWeight:"medium"},children:[p.balance>we?"â†‘":"â†“",Od(Math.abs(p.balance-we))]})})]})}),t.jsx(de,{item:!0,xs:12,md:4,children:t.jsxs(We,{direction:"row",spacing:1,justifyContent:{xs:"center",md:"flex-end"},children:[t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(Xl,{}),onClick:()=>oe(!0),size:"small",children:"Nouveau dÃ©pÃ´t"}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(pl,{}),size:"small",children:"Imprimer relevÃ©"})]})})]})})})}),t.jsx(de,{item:!0,xs:12,children:x?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):Ve?t.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>He(null),children:Ve}):p?t.jsxs(c,{children:[p.outstanding_sales&&p.outstanding_sales.length>0&&t.jsxs(W,{sx:{mb:3,overflow:"hidden"},elevation:2,children:[t.jsxs(c,{sx:{bgcolor:"warning.light",px:2,py:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(d,{variant:"subtitle1",fontWeight:"bold",color:"warning.contrastText",children:[t.jsx(Tc,{sx:{fontSize:20,mr:1,verticalAlign:"text-bottom"}}),"Ventes non soldÃ©es (",(null==(e=p.outstanding_sales)?void 0:e.length)||0,")"]}),t.jsxs(c,{children:[t.jsx(l,{title:"Exporter les donnÃ©es",children:t.jsx(g,{size:"small",sx:{color:"warning.contrastText"},children:t.jsx(wc,{fontSize:"small"})})}),t.jsx(l,{title:"Filtrer les ventes",children:t.jsx(g,{size:"small",sx:{color:"warning.contrastText"},children:t.jsx(mc,{fontSize:"small"})})})]})]}),t.jsx(c,{sx:{height:Math.min(Math.max(50,60*p.outstanding_sales.length+160),300),width:"100%"},children:t.jsx(Y,{rowHeight:70,rows:(p.outstanding_sales||[]).map((e=>({id:e.id,reference:e.reference,date:Pd(e.date),rawDate:e.date,total_amount:e.total_amount,paid_amount:e.paid_amount,balance:"unpaid"===e.payment_status&&0===e.balance?e.total_amount:e.balance,payment_status:e.payment_status,actions:e}))),columns:[{field:"date",headerName:"Date",width:120,sortComparator:(e,t,r,n)=>{const i=new Date(r.api.getCellValue(r.id,"rawDate")),s=new Date(n.api.getCellValue(n.id,"rawDate"));return i.getTime()-s.getTime()}},{field:"reference",headerName:"RÃ©fÃ©rence",width:140},{field:"total_amount",headerName:"Montant",width:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:"500",children:Od(e.value)})},{field:"paid_amount",headerName:"PayÃ©",width:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{color:"success.main",fontWeight:500},children:Od(e.value)})},{field:"balance",headerName:"Solde",width:130,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:"error.main",backgroundColor:"rgba(211, 47, 47, 0.1)",py:.5,px:1,borderRadius:1,fontSize:"0.8125rem"},children:Od(e.value)})},{field:"payment_status",headerName:"Statut",width:140,renderCell:e=>t.jsx(ce,{label:kd(e.value),color:Md(e.value),size:"small",sx:{fontWeight:500}})},{field:"actions",headerName:"Actions",width:290,align:"center",headerAlign:"center",sortable:!1,renderCell:e=>t.jsx(l,{title:"Effectuer un paiement sur cette vente",children:t.jsx(M,{variant:"contained",color:"success",size:"medium",startIcon:t.jsx(Ol,{}),sx:{borderRadius:2,fontWeight:"bold",px:2,boxShadow:2,textTransform:"none"},onClick:()=>{const t=e.value,r="unpaid"===t.payment_status&&0===t.balance?t.total_amount:t.balance,n={...t,balance:r};if(O(n),p){const e=p.balance;k(e>0&&e<r?e:r)}else k(r);L(`Paiement pour la vente ${t.reference}`),N(!0)},children:"Effectuer un paiement"})})}],getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",initialState:{pagination:{paginationModel:{pageSize:5,page:0}},sorting:{sortModel:[{field:"rawDate",sort:"desc"}]}},density:"compact",disableRowSelectionOnClick:!0,slots:{toolbar:Z},slotProps:{toolbar:{showQuickFilter:!0,quickFilterProps:{debounceMs:300}}},sx:{border:"none","& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:0}},pageSizeOptions:[5,10,25]})})]}),t.jsxs(W,{sx:{mb:3,overflow:"hidden"},elevation:2,children:[t.jsxs(c,{sx:{bgcolor:"primary.light",px:2,py:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(d,{variant:"subtitle1",fontWeight:"bold",color:"primary.contrastText",children:[t.jsx(Ll,{sx:{fontSize:20,mr:1,verticalAlign:"text-bottom"}}),"Historique des transactions (",(null==(r=p.statements)?void 0:r.length)||0,")"]}),t.jsxs(c,{children:[t.jsx(l,{title:"Exporter les donnÃ©es",children:t.jsx(g,{size:"small",sx:{color:"primary.contrastText"},children:t.jsx(wc,{fontSize:"small"})})}),t.jsx(l,{title:"Filtrer les transactions",children:t.jsx(g,{size:"small",sx:{color:"primary.contrastText"},children:t.jsx(mc,{fontSize:"small"})})})]})]}),t.jsx(c,{sx:{height:Math.min(Math.max(350,55*((null==(n=p.statements)?void 0:n.length)||0)+180),400),width:"100%"},children:p.statements&&p.statements.length>0?t.jsx(Y,{rows:(ft=p.statements,ft.map((e=>({id:e.id,date:Pd(e.date),rawDate:e.date,reference:e.reference,type:e.transaction_type_display||e.transaction_type||"Type non dÃ©fini",description:e.description,debit:e.debit,credit:e.credit,balance:e.balance})))),columns:[{field:"date",headerName:"Date",width:120,sortComparator:(e,t,r,n)=>{const i=new Date(r.api.getCellValue(r.id,"rawDate")),s=new Date(n.api.getCellValue(n.id,"rawDate"));return i.getTime()-s.getTime()}},{field:"reference",headerName:"RÃ©fÃ©rence",width:140},{field:"type",headerName:"Type",width:180,renderCell:e=>{const r=e.value||"";return t.jsx(ce,{label:r,size:"small",sx:Bd(r)})}},{field:"description",headerName:"Description",flex:1,minWidth:200},{field:"debit",headerName:"DÃ©bit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?t.jsx(d,{variant:"body2",sx:{color:"error.main",fontWeight:500},children:Od(e.value)}):null},{field:"credit",headerName:"CrÃ©dit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?t.jsx(d,{variant:"body2",sx:{color:"success.main",fontWeight:500},children:Od(e.value)}):null},{field:"balance",headerName:"Solde",width:140,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:e.value>=0?"success.main":"error.main",backgroundColor:e.value>=0?"rgba(46, 125, 50, 0.1)":"rgba(211, 47, 47, 0.1)",py:.5,px:1,borderRadius:1,fontSize:"0.8125rem"},children:Od(e.value)})}],getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"rawDate",sort:"desc"}]}},density:"compact",disableRowSelectionOnClick:!0,slots:{toolbar:Z},slotProps:{toolbar:{showQuickFilter:!0,quickFilterProps:{debounceMs:300}}},sx:{border:"none","& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:0}},pageSizeOptions:[5,10,25,50]}):t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"text.secondary"},children:[t.jsx(Ll,{sx:{fontSize:60,mb:2,opacity:.5}}),t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Aucune transaction"}),t.jsx(d,{variant:"body2",sx:{textAlign:"center",maxWidth:300},children:"Les transactions de ce client apparaÃ®tront ici une fois qu'elles seront effectuÃ©es"})]})})]})]}):t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:t.jsx(f,{})})})]}):t.jsx(t.Fragment,{children:t.jsxs(de,{item:!0,xs:12,children:[t.jsxs(c,{sx:{mb:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"SÃ©lectionner un client"}),t.jsx(V,{fullWidth:!0,label:"Rechercher un client",variant:"outlined",value:b,onChange:e=>v(e.target.value),InputProps:{startAdornment:t.jsx(_l,{fontSize:"small",sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}})]}),Ve&&t.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>He(null),children:Ve}),t.jsxs(de,{container:!0,spacing:2,children:[ot.map((e=>t.jsx(de,{item:!0,xs:12,sm:6,md:4,children:t.jsx(Fd,{onClick:()=>(e=>{h(e),m(null),e&&(pt(e.id),he((t=>({...t,client:e.id,account:e.account||null}))))})(e),sx:{cursor:"pointer",height:"100%"},children:t.jsxs(Q,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(J,{sx:{bgcolor:"primary.main",mr:1},children:e.name.charAt(0).toUpperCase()}),t.jsx(d,{variant:"h6",sx:{fontWeight:"bold"},children:e.name})]}),e.is_active?t.jsx(ce,{size:"small",label:"Actif",color:"success"}):t.jsx(ce,{size:"small",label:"Inactif",color:"default"})]}),e.contact_person&&t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Contact: ",e.contact_person]}),e.phone&&t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["TÃ©l: ",e.phone]}),t.jsx(c,{sx:{mt:2,display:"flex",justifyContent:"center"},children:t.jsx(M,{variant:"outlined",color:"primary",size:"small",startIcon:t.jsx(Jl,{}),children:"Consulter compte"})})]})})},e.id))),0===at.length&&t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:4,textAlign:"center",bgcolor:"background.default"},children:[t.jsx(Vl,{sx:{fontSize:60,color:"text.secondary",mb:2}}),t.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aucun client trouvÃ©"}),t.jsx(d,{variant:"body2",color:"text.secondary",children:"Essayez d'autres termes de recherche"})]})})]}),t.jsx(Ke,{rowsPerPageOptions:[6,12,18],component:"div",count:at.length,rowsPerPage:E,page:C,onPageChange:(e,t)=>{_(t)},onRowsPerPageChange:e=>{A(parseInt(e.target.value,10)),_(0)},labelRowsPerPage:"Clients par page:",labelDisplayedRows:({from:e,to:t,count:r})=>`${e}-${t} sur ${r}`})]})})})}),"        ",t.jsx(zd,{value:i,index:1,children:t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,children:t.jsxs(W,{sx:{p:3,mb:3},elevation:1,children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Filtres et contrÃ´les"}),t.jsxs(de,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(ue,{options:Ne,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:Te,onChange:(e,t)=>Re(t),renderInput:e=>t.jsx(V,{...e,label:"Compte",size:"small",fullWidth:!0})})}),t.jsx(de,{item:!0,xs:12,sm:6,md:2,children:t.jsx(V,{label:"Date dÃ©but",type:"date",size:"small",fullWidth:!0,value:Me,onChange:e=>ke(e.target.value),InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,md:2,children:t.jsx(V,{label:"Date fin",type:"date",size:"small",fullWidth:!0,value:Be,onChange:e=>Le(e.target.value),InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,sm:6,md:2,children:t.jsx(ue,{options:[{value:"",label:"Tous les types"},{value:"client_payment",label:"RÃ¨glement client"},{value:"supplier_payment",label:"RÃ¨glement fournisseur"},{value:"transfer_in",label:"Virement entrant"},{value:"transfer_out",label:"Virement sortant"},{value:"cash_receipt",label:"Encaissement"},{value:"cash_payment",label:"DÃ©caissement"},{value:"expense",label:"DÃ©pense"},{value:"sale",label:"Vente"},{value:"purchase",label:"Achat"},{value:"deposit",label:"DÃ©pÃ´t"}],getOptionLabel:e=>e.label,value:[{value:"",label:"Tous les types"},{value:"client_payment",label:"RÃ¨glement client"},{value:"supplier_payment",label:"RÃ¨glement fournisseur"},{value:"transfer_in",label:"Virement entrant"},{value:"transfer_out",label:"Virement sortant"},{value:"cash_receipt",label:"Encaissement"},{value:"cash_payment",label:"DÃ©caissement"},{value:"expense",label:"DÃ©pense"},{value:"sale",label:"Vente"},{value:"purchase",label:"Achat"},{value:"deposit",label:"DÃ©pÃ´t"}].find((e=>e.value===Oe))||{value:"",label:"Tous les types"},isOptionEqualToValue:(e,t)=>e.value===t.value,onChange:(e,t)=>Pe((null==t?void 0:t.value)||""),renderInput:e=>t.jsx(V,{...e,label:"Type",size:"small",fullWidth:!0})})}),"                  ",t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsxs(We,{direction:"row",spacing:1,children:[t.jsx(M,{variant:"contained",startIcon:t.jsx(yl,{}),size:"small",onClick:()=>rt(!0),children:"Nouveau transfert"}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(wc,{}),size:"small",children:"Exporter"})]})})]})]})}),Te&&t.jsx(de,{item:!0,xs:12,children:t.jsxs(de,{container:!0,spacing:2,children:[t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(K,{children:t.jsxs(Q,{children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Compte sÃ©lectionnÃ©"}),t.jsx(d,{variant:"h6",fontWeight:"bold",children:Te.name}),t.jsx(d,{variant:"body2",color:"text.secondary",children:Te.account_type})]})})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(K,{children:t.jsxs(Q,{children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Solde actuel"}),t.jsx(d,{variant:"h6",fontWeight:"bold",color:Te.current_balance>=0?"success.main":"error.main",children:Od(Te.current_balance)})]})})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(K,{children:t.jsxs(Q,{children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total dÃ©bits"}),t.jsx(d,{variant:"h6",fontWeight:"bold",color:"error.main",children:Od(Ae.reduce(((e,t)=>e+t.debit),0))})]})})}),t.jsx(de,{item:!0,xs:12,sm:6,md:3,children:t.jsx(K,{children:t.jsxs(Q,{children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total crÃ©dits"}),t.jsx(d,{variant:"h6",fontWeight:"bold",color:"success.main",children:Od(Ae.reduce(((e,t)=>e+t.credit),0))})]})})})]})}),t.jsxs(de,{item:!0,xs:12,children:[Ve&&t.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>He(null),children:Ve}),t.jsxs(W,{sx:{width:"100%"},elevation:2,children:[t.jsxs(c,{sx:{bgcolor:"primary.light",px:2,py:1.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(d,{variant:"subtitle1",fontWeight:"bold",color:"primary.contrastText",children:[t.jsx(Ll,{sx:{fontSize:20,mr:1,verticalAlign:"text-bottom"}}),"Mouvements de compte"]}),t.jsxs(d,{variant:"body2",color:"primary.contrastText",children:[Ae.length," mouvement(s)"]})]}),t.jsx(c,{sx:{height:Math.min(Math.max(400,55*Ae.length+200),800),width:"100%"},children:je?t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(f,{})}):Ae.length>0?t.jsx(Y,{rows:Ae.map((e=>{var t;return{id:e.id,account_name:(null==(t=Ne.find((t=>t.id===Number(e.account))))?void 0:t.name)||"N/A",date:Pd(e.date),rawDate:e.date,reference:e.reference,transaction_type_display:e.transaction_type_display,transaction_type:e.transaction_type,description:e.description,debit:e.debit,credit:e.credit,balance:e.balance}})),columns:[{field:"date",headerName:"Date",width:120,sortComparator:(e,t,r,n)=>{const i=new Date(r.api.getCellValue(r.id,"rawDate")),s=new Date(n.api.getCellValue(n.id,"rawDate"));return i.getTime()-s.getTime()}},{field:"account_name",headerName:"Compte",width:150,renderCell:e=>t.jsx(ce,{label:e.value,size:"small",variant:"outlined",sx:{maxWidth:"100%"}})},{field:"reference",headerName:"RÃ©fÃ©rence",width:140},{field:"transaction_type_display",headerName:"Type",width:180,renderCell:e=>t.jsx(ce,{label:e.value,size:"small",color:lt(e.row.transaction_type),sx:{fontWeight:500}})},{field:"description",headerName:"Description",flex:1,minWidth:200},{field:"debit",headerName:"DÃ©bit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?t.jsx(d,{variant:"body2",sx:{color:"error.main",fontWeight:500},children:Od(e.value)}):null},{field:"credit",headerName:"CrÃ©dit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?t.jsx(d,{variant:"body2",sx:{color:"success.main",fontWeight:500},children:Od(e.value)}):null},{field:"balance",headerName:"Solde",width:140,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:e.value>=0?"success.main":"error.main",backgroundColor:e.value>=0?"rgba(46, 125, 50, 0.1)":"rgba(211, 47, 47, 0.1)",py:.5,px:1,borderRadius:1,fontSize:"0.8125rem"},children:Od(e.value)})}],getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",initialState:{pagination:{paginationModel:{pageSize:15,page:0}},sorting:{sortModel:[{field:"rawDate",sort:"desc"}]}},density:"compact",disableRowSelectionOnClick:!0,slots:{toolbar:Z},slotProps:{toolbar:{showQuickFilter:!0,quickFilterProps:{debounceMs:300}}},sx:{border:"none","& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:0}},pageSizeOptions:[10,15,25,50]}):t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[t.jsx(ic,{sx:{fontSize:60,color:"text.secondary",mb:2}}),t.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aucun mouvement trouvÃ©"}),t.jsx(d,{variant:"body2",color:"text.secondary",textAlign:"center",children:Te?`Aucun mouvement trouvÃ© pour le compte ${Te.name} avec les filtres appliquÃ©s.`:"SÃ©lectionnez un compte pour voir ses mouvements ou ajustez les filtres."})]})})]})]})]})})]}),t.jsxs(re,{open:tt,onClose:()=>rt(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[t.jsx(ne,{children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Il,{sx:{mr:1,color:"primary.main"}}),"Nouveau transfert entre comptes"]})}),t.jsx(y,{}),t.jsxs(ie,{children:[Ve&&t.jsx(U,{severity:"error",sx:{mb:3},onClose:()=>He(null),children:Ve}),t.jsxs(de,{container:!0,spacing:2,sx:{mt:.5},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:Ne,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:Ne.find((e=>e.id===Fe.from_account))||null,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{Ue({...Fe,from_account:null==t?void 0:t.id})},renderInput:e=>t.jsx(V,{...e,label:"Compte source",variant:"outlined",fullWidth:!0,required:!0})})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:pe,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:u?pe.find((e=>e.id===u.account))||null:pe.find((e=>e.id===le.account))||null,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{he({...le,account:t?t.id:null}),j(!0),T(null)},renderInput:e=>t.jsx(V,{...e,label:"Compte du client",variant:"outlined",fullWidth:!0,required:!0,error:S&&!le.account,helperText:S&&!le.account?I||"Veuillez sÃ©lectionner un compte pour le dÃ©pÃ´t":""}),disabled:!!u})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Montant",type:"text",value:Ga(Fe.amount),onChange:e=>{const t=Ha(e.target.value,Fe.amount);Ue({...Fe,amount:t})},fullWidth:!0,required:!0,error:Fe.amount<=0,helperText:qa(Fe.amount,"amount"),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(cc,{})})}})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Date du transfert",type:"date",value:Fe.transfer_date,onChange:e=>Ue({...Fe,transfer_date:e.target.value}),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"NumÃ©ro de rÃ©fÃ©rence",value:Fe.reference_number,onChange:e=>Ue({...Fe,reference_number:e.target.value}),fullWidth:!0,placeholder:"Optionnel - sera gÃ©nÃ©rÃ© automatiquement"})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",value:Fe.notes,onChange:e=>Ue({...Fe,notes:e.target.value}),fullWidth:!0,multiline:!0,rows:2,placeholder:"Raison du transfert"})})]})]}),t.jsx(y,{}),t.jsxs(se,{sx:{px:3,py:2},children:[t.jsx(M,{onClick:()=>rt(!1),variant:"outlined",children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{try{Ze(!0),He(null);const e=(e=>e.from_account?e.to_account?e.from_account===e.to_account?"Le compte source et destination doivent Ãªtre diffÃ©rents":!e.amount||e.amount<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":null:"Veuillez sÃ©lectionner le compte destination":"Veuillez sÃ©lectionner le compte source")(Fe);if(e)return void He(e);const t={...Fe,reference_number:Fe.reference_number||`TR-${Date.now()}`};await Gs.createAccountTransfer(t),nt("Transfert crÃ©Ã© avec succÃ¨s",{variant:"success"}),rt(!1),Ue({from_account:void 0,to_account:void 0,amount:0,transfer_date:(new Date).toISOString().split("T")[0],reference_number:"",notes:""}),st()}catch(e){console.error("Error creating transfer:",e),He("Erreur lors de la crÃ©ation du transfert. Veuillez rÃ©essayer.")}finally{Ze(!1)}},disabled:Ye||!Fe.from_account||!Fe.to_account||!Fe.amount,startIcon:Ye?t.jsx(f,{size:20}):t.jsx(Il,{}),children:Ye?"Traitement...":"CrÃ©er le transfert"})]})]}),t.jsxs(re,{open:ae,onClose:()=>oe(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[t.jsx(ne,{children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Xl,{sx:{mr:1,color:"primary.main"}}),"Nouveau dÃ©pÃ´t client"]})}),t.jsx(y,{}),t.jsx(ie,{children:xe?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsxs(de,{container:!0,spacing:2,sx:{mt:.5},children:[Ve&&t.jsx(de,{item:!0,xs:12,children:t.jsx(U,{severity:"error",onClose:()=>He(null),children:Ve})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:a,getOptionLabel:e=>e.name,value:a.find((e=>e.id===le.client))||null,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{he({...le,client:t?t.id:null,account:t&&t.account||null})},renderInput:e=>t.jsx(V,{...e,label:"Client",variant:"outlined",fullWidth:!0,required:!0}),disabled:!!u})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:pe,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:u?pe.find((e=>e.id===u.account))||null:pe.find((e=>e.id===le.account))||null,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{he({...le,account:t?t.id:null})},renderInput:e=>t.jsx(V,{...e,label:"Compte du client",variant:"outlined",fullWidth:!0,required:!0}),disabled:!!u})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:fe,getOptionLabel:e=>e.name,value:le.payment_method,onChange:(e,t)=>{he({...le,payment_method:t})},renderInput:e=>t.jsx(V,{...e,label:"MÃ©thode de paiement",variant:"outlined",fullWidth:!0,required:!0})})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Montant",type:"text",value:Ga(le.amount),onChange:e=>{const t=Ha(e.target.value,le.amount);he({...le,amount:t})},fullWidth:!0,required:!0,error:le.amount<=0,helperText:qa(le.amount,"amount")})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Date",type:"date",value:le.date,onChange:e=>he({...le,date:e.target.value}),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Description",value:le.description,onChange:e=>he({...le,description:e.target.value}),fullWidth:!0,multiline:!0,rows:2})})]})}),t.jsx(y,{}),t.jsxs(se,{sx:{px:3,py:2},children:[t.jsx(M,{onClick:()=>oe(!1),variant:"outlined",children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{var e,t;try{He(null);const r=(t=le,console.log("Deposit validation:",t),t.client?t.account?t.payment_method?t.amount<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":null:"Veuillez sÃ©lectionner une mÃ©thode de paiement":"Veuillez sÃ©lectionner un compte pour le dÃ©pÃ´t":"Veuillez sÃ©lectionner un client");if(r)return void He(r);const n=(null==p?void 0:p.balance)||0,i={reference:`DEP-${Date.now()}`,client:le.client,account:le.account,amount:le.amount,allocated_amount:le.amount,payment_method:(null==(e=le.payment_method)?void 0:e.id)||null,date:le.date,description:le.description||"DÃ©pÃ´t sur compte client"};await Gs.createCashReceipt(i);const s=`DÃ©pÃ´t de ${Od(le.amount)} crÃ©Ã© avec succÃ¨s`;qe(s),Xe(!0),setTimeout((()=>{Xe(!1),qe(null)}),6e3),oe(!1),he({client:(null==u?void 0:u.id)||null,account:null,amount:0,payment_method:null,date:(new Date).toISOString().split("T")[0],description:"DÃ©pÃ´t sur compte"}),u&&(Ce(n),pt(u.id))}catch(r){console.error("Error creating deposit:",r),He("Erreur lors de la crÃ©ation du dÃ©pÃ´t. Veuillez rÃ©essayer.")}},disabled:xe,startIcon:t.jsx(Xl,{}),children:"CrÃ©er le dÃ©pÃ´t"})]})]}),t.jsxs(re,{open:R,onClose:()=>N(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[t.jsxs(ne,{sx:{borderBottom:1,borderColor:"divider",pb:2,display:"flex",alignItems:"center"},children:[t.jsx(Ol,{sx:{mr:1,color:"primary.main"}}),t.jsx(d,{variant:"h6",component:"div",children:"Paiement de vente"})]}),t.jsx(ie,{children:D&&t.jsxs(c,{sx:{py:2},children:["paid"===D.payment_status?t.jsxs(U,{severity:"info",sx:{mb:3},children:[t.jsx(et,{children:"Vente dÃ©jÃ  payÃ©e"}),"Cette vente a dÃ©jÃ  Ã©tÃ© entiÃ¨rement payÃ©e. Aucun paiement supplÃ©mentaire n'est nÃ©cessaire."]}):null,t.jsxs(W,{variant:"outlined",sx:{p:2,mb:3,borderRadius:1,borderColor:"divider",backgroundColor:"background.paper"},children:[t.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,sx:{mb:2,fontWeight:"medium",borderBottom:1,pb:1,borderColor:"divider"},children:"Informations de la vente"}),t.jsxs(de,{container:!0,spacing:2,children:[t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"RÃ©fÃ©rence"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:D.reference})]}),t.jsxs(de,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Client"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:(null==u?void 0:u.name)||"N/A"})]}),t.jsx(de,{item:!0,xs:12,children:t.jsx(y,{sx:{my:1}})}),t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:Od(D.total_amount)})]}),t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"DÃ©jÃ  payÃ©"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:"success.main",children:Od(D.paid_amount)})]}),t.jsxs(de,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant restant"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:D.balance>0?"error.main":"success.main",children:Od("unpaid"===D.payment_status&&0===D.balance?D.total_amount:Math.max(0,D.balance))})]})]})]}),t.jsxs(W,{variant:"outlined",sx:{p:2,mb:3,borderRadius:1,borderColor:p&&p.balance<0?"error.main":"divider",backgroundColor:"background.paper",borderWidth:p&&p.balance<0?2:1},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[t.jsx(Jl,{sx:{mr:1,color:p&&p.balance>=0?"success.main":"error.main"}}),t.jsx(d,{variant:"h6",color:"primary",sx:{fontWeight:"medium"},children:"Compte client"})]}),t.jsxs(de,{container:!0,alignItems:"center",spacing:2,children:[t.jsxs(de,{item:!0,xs:12,sm:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Solde disponible"}),t.jsx(d,{variant:"h6",fontWeight:"medium",color:p&&p.balance>=0?"success.main":"error.main",children:p?Od(p.balance):"Chargement..."})]}),(!p||p.balance<=0)&&t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(d,{variant:"caption",color:"error",sx:{display:"flex",alignItems:"center"},children:[t.jsx(Tc,{fontSize:"small",sx:{mr:.5}}),"Solde insuffisant. Un paiement Ã  crÃ©dit sera crÃ©Ã©."]})})]})]}),t.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,sx:{mt:3,mb:2,fontWeight:"medium"},children:"DÃ©tails du paiement"}),t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(ue,{options:Ne.filter((e=>"client"!==e.account_type&&"supplier"!==e.account_type)),getOptionLabel:e=>e&&e.name?`${e.name} (${e.account_type})`:"",value:G,onChange:(e,t)=>{q(t),te(!0),X(null)},renderInput:e=>t.jsx(V,{...e,label:"Compte de l'entreprise Ã  crÃ©diter",variant:"outlined",fullWidth:!0,required:true,error:ee&&!G,helperText:ee&&!G?$:""})})}),t.jsxs(de,{item:!0,xs:12,children:[t.jsx(V,{label:"Montant du paiement",type:"text",fullWidth:!0,required:!0,value:Ga(P),onChange:e=>{const t=(r=e.target.value,Ha(r,P));var r;k(t)},error:P<=0,helperText:P<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":"",InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(cc,{color:p&&p.balance<P?"warning":"primary"})})},color:p&&p.balance<P?"warning":D&&P<D.total_amount?"info":"primary"}),t.jsx(c,{sx:{mt:3,mb:2},children:t.jsx(W,{variant:"outlined",sx:{p:2,borderRadius:1,borderColor:p&&p.balance<P?"warning.main":D&&P<D.total_amount?"info.main":"success.main",borderWidth:2,backgroundColor:p&&p.balance<P?"rgba(237, 108, 2, 0.08)":D&&P<D.total_amount?"rgba(3, 169, 244, 0.08)":"rgba(46, 125, 50, 0.08)",boxShadow:1},children:t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(c,{sx:{mr:2,mt:.5},children:p&&p.balance<P?t.jsx(Tc,{fontSize:"large",color:"warning"}):D&&P<D.total_amount?t.jsx(Ol,{fontSize:"large",color:"info"}):t.jsx(Ol,{fontSize:"large",color:"success"})}),t.jsxs(c,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:p&&p.balance<P?"Paiement Ã  crÃ©dit":D&&P<D.total_amount?"Paiement partiel":"Paiement total"}),p&&p.balance<P?t.jsxs(d,{variant:"body2",children:["Ce paiement dÃ©passera le solde disponible du client de ",Od(P-p.balance)," et crÃ©era un crÃ©dit."]}):D&&P<D.total_amount?t.jsxs(d,{variant:"body2",children:["Vous effectuez un paiement partiel de ",Od(P),". Un montant de ",Od(D.balance-P),' restera Ã  payer. Le statut de la vente sera mis Ã  jour en "Partiellement payÃ©".']}):t.jsxs(d,{variant:"body2",children:["Vous effectuez le paiement total de cette vente d'un montant de ",Od(P),'. Le statut de la vente sera mis Ã  jour en "PayÃ©".']}),t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsxs(de,{item:!0,xs:6,sm:4,children:[t.jsx(d,{variant:"caption",color:"text.secondary",children:"Montant du paiement"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:Od(P)})]}),t.jsxs(de,{item:!0,xs:6,sm:4,children:[t.jsx(d,{variant:"caption",color:"text.secondary",children:"Solde client utilisÃ©"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:p?Od(Math.min(p.balance,P)):"Chargement..."})]}),p&&p.balance<P&&t.jsxs(de,{item:!0,xs:6,sm:4,children:[t.jsx(d,{variant:"caption",color:"error.main",children:"Montant Ã  crÃ©dit"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:"error.main",children:Od(P-p.balance)})]})]})]})]})})})]}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:2,value:B,onChange:e=>L(e.target.value),placeholder:"Description du paiement",InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Ll,{color:"action"})})},helperText:"Ajoutez une description facultative pour ce paiement"})})]})]})}),t.jsx(y,{}),t.jsxs(se,{sx:{px:3,py:2,justifyContent:"space-between"},children:[t.jsx(M,{onClick:()=>N(!1),variant:"outlined",startIcon:t.jsx(Ec,{}),children:"Annuler"}),t.jsx(M,{variant:"contained",color:p&&p.balance<P?"warning":D&&P<D.total_amount?"info":"primary",onClick:async()=>{if(D&&u){if(!G)return te(!0),void X("Veuillez sÃ©lectionner le compte de lâ€™entreprise Ã  crÃ©diter.");try{z(!0),He(null),X(null);if(p&&p.balance<P){const e=p?Math.abs(p.balance-P):P;if(!window.confirm(`ATTENTION: Ce paiement dÃ©passera le solde disponible du client et crÃ©era un crÃ©dit de ${Od(e)}. Voulez-vous continuer?`))return void z(!1)}const e=await ps(D.id,{amount:P,description:B||`Paiement pour la vente ${D.reference} depuis le compte client`,company_account:(null==G?void 0:G.id)||null});let r=`Paiement de ${Od(e.payment.amount)} traitÃ© avec succÃ¨s. Nouveau solde client: ${Od(e.client_balance)}`;if(e.is_credit_payment&&(r=`âš ï¸ PAIEMENT Ã€ CRÃ‰DIT: ${r}`,nt(`Attention: Un crÃ©dit de ${Od(Math.abs(e.client_balance))} a Ã©tÃ© accordÃ© Ã  ce client`,{variant:"warning",autoHideDuration:1e4,anchorOrigin:{vertical:"top",horizontal:"center"}})),"partially_paid"===e.sale.payment_status){const n=e.sale.paid_amount,i=e.sale.total_amount,s=e.sale.remaining_amount;r+=`\nPaiement partiel: ${Od(n)} payÃ©, ${Od(s)} restant.`,nt(t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",children:"Paiement partiel enregistrÃ©"}),t.jsxs(d,{variant:"body2",children:[Od(n)," payÃ© sur ",Od(i),t.jsx("br",{}),Od(s)," restant Ã  payer"]})]}),{variant:"info",autoHideDuration:8e3,anchorOrigin:{vertical:"bottom",horizontal:"center"}})}qe(r),Xe(!0),setTimeout((()=>{Xe(!1),qe(null)}),6e3),u&&(p&&Ce(p.balance),pt(u.id)),N(!1),ut(),q(null),z(!1)}catch(e){console.error("Error processing payment:",e),He("Erreur lors du traitement du paiement. Veuillez rÃ©essayer."),z(!1)}}},disabled:F||!D||P<=0||D&&"paid"===D.payment_status,startIcon:F?t.jsx(f,{size:20}):t.jsx(Ol,{}),sx:{fontWeight:"medium",minWidth:"200px",px:3},children:F?"Traitement...":D?"paid"===D.payment_status?"Vente dÃ©jÃ  payÃ©e":P>0&&P<D.total_amount?"Effectuer un paiement partiel":p&&p.balance<P?"Effectuer le paiement Ã  crÃ©dit":"Effectuer le paiement total":"Effectuer le paiement"})]})]}),t.jsx(ze,{open:$e,autoHideDuration:6e3,onClose:()=>Xe(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:()=>Xe(!1),severity:"success",variant:"filled",sx:{width:"100%"},children:Ge})})]})});var ft};function Vd(e){const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`access-tabpanel-${i}`,"aria-labelledby":`access-tab-${i}`,...s,children:n===i&&t.jsx(c,{sx:{py:3},children:r})})}const Hd=()=>{var e;const r=h(),[n,i]=ht.useState(0),{hasPermission:s,isAdmin:o,userRole:l,userGroups:u,userPermissions:p,loading:m}=pi(),{canPerform:x}=(()=>{const{hasPermission:e}=pi();return{canPerform:t=>e(t)}})(),[y,w]=ht.useState([]),[b,v]=ht.useState(!0),[C,_]=ht.useState(null),[E,A]=ht.useState(!1),[S,I]=ht.useState(null),[T,R]=ht.useState(!1),[N,D]=ht.useState([]),[O,P]=ht.useState(!0),[B,F]=ht.useState(null),[z,H]=ht.useState(!1),[G,X]=ht.useState(null),[Z,K]=ht.useState([]),[Q,J]=ht.useState(!0),[ee,te]=ht.useState(""),[ue,he]=ht.useState(""),[pe,me]=ht.useState(""),[fe,ge]=ht.useState(""),[xe,ye]=ht.useState({pageSize:10,page:0}),[Ce,_e]=ht.useState({pageSize:10,page:0}),[Ee,Ae]=ht.useState({}),[Se,je]=ht.useState({});ht.useEffect((()=>{Ne(),ke(),He(),Ve()}),[]),ht.useEffect((()=>{console.log("Permission check for User Management:",{isAdmin:o,userRole:l,userGroups:u,userPermissions:p,permissionsLoading:m,hasChangeUserPerm:s("change_user")})}),[s,o,l,u,p,m]);const Ie=x("change_user"),Te=x("add_user"),Re=x("delete_user"),Ne=async()=>{try{v(!0);const e=await As(),t=(Array.isArray(e)?e:e.results||e).map((e=>{var t,r,n,i;return console.log(`Processing user ${e.username}, groups:`,e.groups),{...e,role:(null==(t=e.profile_data)?void 0:t.role)||(null==(r=e.profile)?void 0:r.role)||"",zone:void 0!==(null==(n=e.profile_data)?void 0:n.zone)?e.profile_data.zone:null==(i=e.profile)?void 0:i.zone,is_active:e.is_active,groups:Array.isArray(e.groups)?e.groups.map((e=>{if("object"==typeof e&&null!==e&&"id"in e&&"name"in e&&"permissions"in e)return e;if("object"==typeof e&&null!==e&&"id"in e&&"name"in e)return{...e,permissions:[]};const t="number"==typeof e?e:Number(e);return{id:t,name:Ge(t),permissions:[]}})):[]}}));console.log("Transformed users with groups:",t),w(t),_(null)}catch(e){console.error("Erreur lors du chargement des utilisateurs:",e),_("Une erreur est survenue lors du chargement des utilisateurs")}finally{v(!1)}},De=async e=>{var t,r,n,i,s;try{const a=await(async e=>{try{console.log(`Fetching user ${e} details directly from API`);const t=await Ss(e);return console.log(`Direct API response for user ${e}:`,t),t}catch(t){return console.error(`Error fetching user ${e}:`,t),null}})(e.id),o=a||e;console.log("Latest user data from API:",o);const l={...o,role:(null==(t=o.profile_data)?void 0:t.role)||(null==(r=o.profile)?void 0:r.role)||o.role||"",zone:void 0!==(null==(n=o.profile_data)?void 0:n.zone)?o.profile_data.zone:void 0!==(null==(i=o.profile)?void 0:i.zone)?null==(s=o.profile)?void 0:s.zone:o.zone,is_active:o.is_active,user:{username:o.username||"",email:o.email||"",password:"",first_name:o.first_name||"",last_name:o.last_name||"",is_active:o.is_active},group_ids:Array.isArray(o.groups)?o.groups.map((e=>"object"==typeof e&&e.id?e.id:Number(e))):[]};console.log(`User ${o.username} being edited:`,o),console.log(`Groups from user ${o.username}:`,o.groups),console.log(`Extracted group_ids for ${o.username}:`,l.group_ids),I(l),R(!1),A(!0)}catch(a){console.error("Error preparing user for edit:",a),_("Une erreur est survenue lors de la rÃ©cupÃ©ration des donnÃ©es de l'utilisateur")}},Me=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){const t=e;if(t.detail)return String(t.detail);if(t.message)return String(t.message);if(t.user&&"object"==typeof t.user){const e=t.user;if(e.username&&Array.isArray(e.username))return`Erreur de nom d'utilisateur: ${e.username[0]}`;const r=Object.entries(e).filter((([,e])=>Array.isArray(e)&&e.length>0)).map((([e,t])=>`${e}: ${t[0]}`));if(r.length>0)return`Erreurs de validation: ${r.join(", ")}`}}return null},ke=async()=>{try{P(!0);const e=await Rs();D(e),F(null)}catch(e){console.error("Erreur lors du chargement des groupes:",e),F("Une erreur est survenue lors du chargement des groupes")}finally{P(!1)}},Be=e=>{if(!G)return;const t=Ee[e];t?X((e=>{if(!e)return null;const r=Array.isArray(e.permissions)?[...e.permissions]:[];return r.includes(t)?{...e,permissions:r.filter((e=>e!==t))}:{...e,permissions:[...r,t]}})):console.warn(`No ID found for permission code: ${e}`)},Le=e=>{var t,r,n;if(console.error("Error saving group:",e),e&&"object"==typeof e&&"response"in e){const i=e,s=null==(t=i.response)?void 0:t.data;if(console.error("Backend response:",s),s&&"object"==typeof s){const e=s;if("string"==typeof e)F(String(e));else if(e.detail)F(String(e.detail));else if(e.name&&Array.isArray(e.name))F(`Erreur: ${e.name[0]}`);else if(e.permissions)if(Array.isArray(e.permissions)){e.permissions.filter((e=>{if(e&&"object"==typeof e){const t=e;return t.non_field_errors&&Array.isArray(t.non_field_errors)&&t.non_field_errors[0]&&String(t.non_field_errors[0]).includes("ensemble unique")}return!1})).length>0?F("Erreur: Des permissions en double ont Ã©tÃ© dÃ©tectÃ©es. Veuillez rÃ©essayer."):F(`Erreur de permissions: ${JSON.stringify(e.permissions)}`)}else F(`Erreur de permissions: ${String(e.permissions)}`);else{const e=null==(r=i.response)?void 0:r.status,t=null==(n=i.response)?void 0:n.statusText;F(`Erreur ${e}: ${t}`)}}else"string"==typeof s&&F(s)}else F(e&&"object"==typeof e&&"message"in e?`Erreur: ${String(e.message)}`:"Une erreur inattendue est survenue lors de la sauvegarde du groupe")},Fe=e=>{switch(e){case"admin":return"error";case"consultant":return"info";case"supervisor":return"warning";case"commercial":return"success";case"cashier":return"secondary";default:return"default"}},ze=e=>{switch(e){case"admin":return"Administrateur";case"consultant":return"Consultant";case"supervisor":return"Superviseur";case"commercial":return"Commercial";case"cashier":return"Chef de Caisse";default:return e}},[We,Ue]=ht.useState([]),Ve=async()=>{try{console.log("Fetching categorized permissions..."),Ue([]);const e=await Ps();if(console.log("Received categorized permissions:",e),!e)return console.warn("Warning: No response received for permissions!"),void F("Aucune permission n'a Ã©tÃ© reÃ§ue. Veuillez contacter l'administrateur.");if(Array.isArray(e)&&0===e.length)return console.warn("Warning: Received empty permissions array!"),void F("Aucune permission n'est disponible. Veuillez contacter l'administrateur.");const t={},r={},n=e.map((e=>(e.permissions.forEach((e=>{var n;const i=e.full_codename||((null==(n=e.content_type)?void 0:n.app_label)&&e.codename?`${e.content_type.app_label}.${e.codename}`:e.codename);e.id&&(t[e.id]=i,r[i]=e.id)})),{...e,permissions:e.permissions.map((e=>{var t;return{...e,full_codename:e.full_codename||((null==(t=e.content_type)?void 0:t.app_label)&&e.codename?`${e.content_type.app_label}.${e.codename}`:e.codename)}}))})));console.log("Permission mappings created:",{idToCode:t,codeToId:r}),Ae(r),je(t),console.log("Processed permissions:",n),F(null),Ue(n)}catch(e){console.error("Error loading permissions:",e),F("Une erreur est survenue lors du chargement des permissions"),Ue([])}},He=async()=>{try{J(!0);const e=(await Di()).map((e=>({...e,id:e.id||0,name:e.name||"Zone sans nom"})));K(e)}catch(e){console.error("Error loading zones:",e)}finally{J(!1)}},Ge=e=>{const t=N.find((t=>t.id===e));return t?t.name:"Groupe inconnu"},qe=e=>{for(const t of We){const r=t.permissions.find((t=>t.codename===e||t.full_codename===e));if(r)return`${t.name}: ${r.name}`}return e};ht.useEffect((()=>{ye((e=>({...e,page:0})))}),[ee,ue]),ht.useEffect((()=>{_e((e=>({...e,page:0})))}),[pe,fe]);const Xe=y.filter((e=>{var t,r,n;const i=e.username.toLowerCase().includes(ee.toLowerCase())||(null==(t=e.email)?void 0:t.toLowerCase().includes(ee.toLowerCase()))||!1||(null==(r=e.first_name)?void 0:r.toLowerCase().includes(ee.toLowerCase()))||!1||(null==(n=e.last_name)?void 0:n.toLowerCase().includes(ee.toLowerCase()))||!1,s=""===ue||"active"===ue&&e.is_active||"inactive"===ue&&!e.is_active;return i&&s})),Ye=N.filter((e=>{const t=e.name.toLowerCase().includes(pe.toLowerCase()),r=""===fe||"active"===fe&&e.is_active||"inactive"===fe&&!e.is_active;return t&&r})),Ze=[{field:"username",headerName:"Utilisateur",flex:1,renderCell:e=>{return e&&e.row?t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(k,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:(r=e.row,(null==r?void 0:r.username)||"")})]}):t.jsx(t.Fragment,{});var r}},{field:"email",headerName:"Email",flex:1,valueGetter:e=>e?e||"":""},{field:"role",headerName:"RÃ´le",flex:1,renderCell:e=>e&&e.row?t.jsx(ce,{icon:t.jsx(rt,{}),label:ze(e.row.role||""),color:Fe(e.row.role||""),size:"small"}):t.jsx(t.Fragment,{})},{field:"profile_data",headerName:"Zone",flex:1,valueGetter:(e,t)=>{var r,n;if(!t)return"Aucune zone";const i=t.zone||(null==(r=t.profile_data)?void 0:r.zone),s=null==(n=Z.find((e=>e.id===i)))?void 0:n.name;return((e,t)=>e?t||`Zone ${e}`:"Aucune zone")(i,s)}},{field:"groups",headerName:"Groupes",flex:1,valueGetter:(e,t)=>{return t&&t.groups?(r=t.groups)&&Array.isArray(r)?r.map((e=>(null==e?void 0:e.name)||"Groupe inconnu")).join(", "):"Aucun groupe":"Aucun groupe";var r}},{field:"is_active",headerName:"Statut",flex:1,renderCell:e=>e&&e.row?t.jsx(ce,{label:e.row.is_active?"Actif":"Inactif",color:e.row.is_active?"success":"error",size:"small",variant:"outlined"}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e&&e.row?t.jsxs(c,{children:[t.jsx(g,{color:"primary",size:"small",sx:{mr:1},onClick:()=>De(e.row),disabled:!Ie,children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:()=>(async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet utilisateur ?"))try{await Ts(e.id),w(y.filter((t=>t.id!==e.id))),_(null)}catch(t){console.error("Erreur lors de la suppression:",t),_("Une erreur est survenue lors de la suppression de l'utilisateur")}})(e.row),disabled:!Re,children:t.jsx(we,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}],Ke=[{field:"name",headerName:"Nom du groupe",flex:1,renderCell:e=>e&&e.row?t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(j,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name||""})]}):t.jsx(t.Fragment,{})},{field:"permissions",headerName:"Permissions",flex:1.5,renderCell:e=>{return e&&e.row?(r=e.row)&&r.permissions&&Array.isArray(r.permissions)&&0!==r.permissions.length?t.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(r.permissions||[]).slice(0,3).map(((e,n)=>{let i="";return i="number"==typeof e?Se[e]||`ID: ${e}`:(e=>e&&"object"==typeof e&&"code"in e?e.code:"string"==typeof e?e:"")(e),t.jsx(ce,{label:qe(i),size:"small",color:"primary",variant:"outlined"},`${r.id||"new"}-perm-${n}-${i}`)})),(r.permissions||[]).length>3&&t.jsx(ce,{label:`+${r.permissions.length-3} more`,size:"small",color:"default",variant:"outlined"})]}):t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucune"}):t.jsx(t.Fragment,{});var r}},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e&&e.row?t.jsxs(c,{sx:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(g,{color:"primary",size:"small",sx:{mr:1},onClick:()=>(e=>{console.log("Editing group:",e),console.log("Original permissions:",e.permissions);const t={...e,permissions:Array.isArray(e.permissions)?(r=e.permissions,r&&Array.isArray(r)?r.map((e=>{if("number"==typeof e)return e;if("string"==typeof e)return Ee[e]||-1;if(e&&"object"==typeof e){const t=e;if("number"==typeof t.id)return t.id;const r=t.full_codename||t.codename||t.code;if("string"==typeof r)return Ee[r]||-1}return-1})).filter((e=>-1!==e)):[]):[]};var r;console.log("Normalized permissions (as IDs) for editing:",t.permissions),X(t),H(!0),setTimeout((()=>{console.log("Checking selectedGroup state after setting for edit:",G)}),100)})(e.row),children:t.jsx(Oe,{fontSize:"small"})}),t.jsx(g,{color:"error",size:"small",onClick:()=>(async e=>{var t,r;if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce groupe ?"))try{await Os(e.id),D(N.filter((t=>t.id!==e.id))),F(null)}catch(n){console.error("Erreur lors de la suppression:",n),(null==(r=null==(t=n.response)?void 0:t.data)?void 0:r.detail)?F(n.response.data.detail):F("Une erreur est survenue lors de la suppression du groupe")}})(e.row),children:t.jsx(we,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}];return t.jsx(el,{requiredPermission:"view_user",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:r.palette.primary.main,borderBottom:`2px solid ${r.palette.primary.light}`,pb:1,width:"fit-content"},children:"Gestion des AccÃ¨s"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez les profils, les permissions et les groupes d'utilisateurs"})]}),t.jsxs(W,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(be,{value:n,onChange:(e,t)=>{i(t)},"aria-label":"access management tabs",sx:{px:3,pt:2,"& .MuiTab-root":{fontWeight:600,fontSize:"1rem"}},children:[t.jsx(ve,{icon:t.jsx(k,{}),iconPosition:"start",label:"Utilisateurs",id:"access-tab-0","aria-controls":"access-tabpanel-0"}),t.jsx(ve,{icon:t.jsx(j,{}),iconPosition:"start",label:"Groupes",id:"access-tab-1","aria-controls":"access-tabpanel-1"})]})}),t.jsx(Vd,{value:n,index:0,children:t.jsxs(c,{sx:{px:3},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom d'utilisateur ou email",variant:"outlined",size:"small",fullWidth:!0,value:ee,onChange:e=>te(e.target.value)}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"user-status-filter-label",children:"Statut"}),t.jsxs(le,{labelId:"user-status-filter-label",id:"user-status-filter",value:ue,onChange:e=>he(e.target.value),label:"Statut",children:[t.jsx(L,{value:"",children:"Tous"}),t.jsx(L,{value:"active",children:"Actifs"}),t.jsx(L,{value:"inactive",children:"Inactifs"})]})]})]}),t.jsx(M,{variant:"contained",startIcon:t.jsx(Pe,{}),onClick:()=>{I({username:"",email:"",first_name:"",last_name:"",is_active:!0,role:"",group_ids:[],zone:void 0,groups:[],permissions:[],user:{username:"",email:"",password:"",first_name:"",last_name:"",is_active:!0}}),R(!0),A(!0)},disabled:!Te,sx:{borderRadius:"20px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0,0,0,0.15)"}},children:"Nouvel utilisateur"})]}),C&&t.jsx(U,{severity:"error",sx:{mb:3},children:C}),b?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsx(c,{sx:{height:500,width:"100%"},children:t.jsx(Y,{rows:Xe,columns:Ze,pagination:!0,paginationModel:xe,onPaginationModelChange:ye,pageSizeOptions:[5,10,25],checkboxSelection:!1,disableRowSelectionOnClick:!0,loading:b,getRowId:e=>e&&void 0!==e.id?e.id:Math.random(),localeText:{noRowsLabel:"Aucun utilisateur correspondant n'a Ã©tÃ© trouvÃ©",footerRowSelected:e=>`${e} utilisateur${e>1?"s":""} sÃ©lectionnÃ©${e>1?"s":""}`,toolbarColumns:"Colonnes",toolbarFilters:"Filtres",toolbarDensity:"DensitÃ©",toolbarExport:"Exporter",filterPanelAddFilter:"Ajouter un filtre",filterPanelRemoveAll:"Supprimer tous",filterPanelOperatorAnd:"Et",filterPanelOperatorOr:"Ou",filterPanelColumns:"Colonnes",filterPanelInputLabel:"Valeur",filterPanelInputPlaceholder:"Valeur du filtre"}})})]})}),t.jsx(Vd,{value:n,index:1,children:t.jsxs(c,{sx:{px:3},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom ou description",variant:"outlined",size:"small",fullWidth:!0,value:pe,onChange:e=>me(e.target.value)}),t.jsxs(ae,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"group-status-filter-label",children:"Statut"}),t.jsxs(le,{labelId:"group-status-filter-label",id:"group-status-filter",value:fe,onChange:e=>ge(e.target.value),label:"Statut",children:[t.jsx(L,{value:"",children:"Tous"}),t.jsx(L,{value:"active",children:"Actifs"}),t.jsx(L,{value:"inactive",children:"Inactifs"})]})]})]}),t.jsx(M,{variant:"contained",startIcon:t.jsx(Pe,{}),onClick:()=>{console.log("Initializing new group with empty permissions array"),X({name:"",permissions:[]}),H(!0),setTimeout((()=>{console.log("Checking selectedGroup state after initialization:",G)}),100)},sx:{borderRadius:"20px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0,0,0,0.15)"}},children:"Nouveau groupe"})]}),B&&t.jsx(U,{severity:"error",sx:{mb:3},children:B}),O?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(f,{})}):t.jsx(c,{sx:{height:500,width:"100%"},children:t.jsx(Y,{rows:Ye,columns:Ke,pagination:!0,paginationModel:Ce,onPaginationModelChange:_e,pageSizeOptions:[5,10,25],checkboxSelection:!1,disableRowSelectionOnClick:!0,loading:O,getRowId:e=>e&&void 0!==e.id?e.id:Math.random(),localeText:{noRowsLabel:"Aucun groupe correspondant n'a Ã©tÃ© trouvÃ©",footerRowSelected:e=>`${e} groupe${e>1?"s":""} sÃ©lectionnÃ©${e>1?"s":""}`,toolbarColumns:"Colonnes",toolbarFilters:"Filtres",toolbarDensity:"DensitÃ©",toolbarExport:"Exporter",filterPanelAddFilter:"Ajouter un filtre",filterPanelRemoveAll:"Supprimer tous",filterPanelOperatorAnd:"Et",filterPanelOperatorOr:"Ou",filterPanelColumns:"Colonnes",filterPanelInputLabel:"Valeur",filterPanelInputPlaceholder:"Valeur du filtre"}})})]})})]}),t.jsxs(re,{open:E,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ne,{sx:{backgroundColor:r.palette.primary.main,color:"white",fontWeight:"bold"},children:(null==S?void 0:S.id)?"Modifier l'utilisateur":"Nouvel utilisateur"}),t.jsx(ie,{sx:{p:3,mt:1},children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(d,{variant:"subtitle1",fontWeight:"medium",sx:{mb:1},children:"Information de l'utilisateur"})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Nom d'utilisateur",fullWidth:!0,required:!0,value:(null==(e=null==S?void 0:S.user)?void 0:e.username)||"",onChange:e=>I((t=>t?{...t,user:{...t.user,username:e.target.value}}:null)),InputProps:{readOnly:!!(null==S?void 0:S.id)},helperText:(null==S?void 0:S.id)?"Le nom d'utilisateur ne peut pas Ãªtre modifiÃ©":""})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Email",type:"email",fullWidth:!0,required:!0,value:(null==S?void 0:S.user.email)||"",onChange:e=>I((t=>t?{...t,user:{...t.user,email:e.target.value}}:null))})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"PrÃ©nom",fullWidth:!0,value:(null==S?void 0:S.user.first_name)||"",onChange:e=>I((t=>t?{...t,user:{...t.user,first_name:e.target.value}}:null))})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:(null==S?void 0:S.user.last_name)||"",onChange:e=>I((t=>t?{...t,user:{...t.user,last_name:e.target.value}}:null))})}),t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Mot de passe",type:T?"text":"password",fullWidth:!0,required:!(null==S?void 0:S.id),value:(null==S?void 0:S.user.password)||"",onChange:e=>I((t=>t?{...t,user:{...t.user,password:e.target.value}}:null)),InputProps:{endAdornment:t.jsx(g,{onClick:()=>R(!T),edge:"end",children:T?t.jsx(q,{}):t.jsx($,{})})},helperText:(null==S?void 0:S.id)?"Laissez vide pour conserver le mot de passe actuel":""})}),t.jsx(de,{item:!0,xs:12,sx:{mt:2},children:t.jsx(d,{variant:"subtitle1",fontWeight:"medium",sx:{mb:1},children:"RÃ´le et permissions"})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,required:!0,children:[t.jsx(oe,{children:"RÃ´le"}),t.jsxs(le,{value:(null==S?void 0:S.role)||"",label:"RÃ´le",onChange:e=>I((t=>t?{...t,role:e.target.value,is_staff:"admin"===e.target.value}:null)),children:[t.jsx(L,{value:"",disabled:!0,children:"SÃ©lectionner un rÃ´le"}),t.jsx(L,{value:"admin",children:"Administrateur"}),t.jsx(L,{value:"consultant",children:"Consultant"}),t.jsx(L,{value:"supervisor",children:"Superviseur"}),t.jsx(L,{value:"commercial",children:"Commercial"}),t.jsx(L,{value:"cashier",children:"Chef de Caisse"})]})]})}),t.jsx(de,{item:!0,xs:12,sm:6,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Zone"}),t.jsxs(le,{value:(null==S?void 0:S.zone)||"",label:"Zone",onChange:e=>I((t=>t?{...t,zone:e.target.value?Number(e.target.value):void 0}:null)),children:[t.jsx(L,{value:"",children:"Aucune zone"}),Q?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}}),"Chargement des zones..."]}):0===Z.length?t.jsx(L,{disabled:!0,children:"Aucune zone disponible"}):Z.map((e=>t.jsx(L,{value:e.id,sx:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx($e,{sx:{mr:1,color:"text.secondary",fontSize:"1rem"}}),e.name]})},e.id)))]})]})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Groupes"}),t.jsx(le,{multiple:!0,value:(null==S?void 0:S.group_ids)||[],label:"Groupes",onChange:e=>{const t="string"==typeof e.target.value?[Number(e.target.value)]:e.target.value;console.log("Group IDs selected:",t),I((e=>e?{...e,group_ids:t}:null))},renderValue:e=>t.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.length>0?e.map((e=>t.jsx(ce,{label:Ge(e),size:"small",sx:{m:.1}},e))):t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucun groupe sÃ©lectionnÃ©"})}),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:O?t.jsxs(L,{disabled:!0,children:[t.jsx(f,{size:20,sx:{mr:1}}),"Chargement des groupes..."]}):0===N.length?t.jsx(L,{disabled:!0,children:"Aucun groupe disponible"}):N.map((e=>{var r,n;return t.jsxs(L,{value:e.id,sx:{padding:"8px 16px",display:"flex",alignItems:"center","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[t.jsx(tt,{checked:null==(r=null==S?void 0:S.group_ids)?void 0:r.includes(e.id),color:"primary",sx:{padding:"4px"}}),t.jsx(a,{primary:e.name,secondary:e.description&&e.description.length>30?`${e.description.substring(0,30)}...`:e.description,primaryTypographyProps:{fontWeight:(null==(n=null==S?void 0:S.group_ids)?void 0:n.includes(e.id))?500:"normal"}})]},e.id)}))}),!S||S.group_ids&&0!==S.group_ids.length?null:t.jsx(d,{variant:"caption",color:"warning.main",children:"Aucun groupe sÃ©lectionnÃ©. L'utilisateur n'aura pas de permissions spÃ©cifiques."}),t.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Les groupes dÃ©finissent les permissions de l'utilisateur sur le systÃ¨me."})]},`groups-select-${(null==S?void 0:S.id)||"new"}`)}),t.jsx(de,{item:!0,xs:12,sx:{mt:2},children:t.jsx(d,{variant:"subtitle1",fontWeight:"medium",sx:{mb:1},children:"Statut"})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Statut"}),t.jsxs(le,{value:(null==S?void 0:S.is_active)?"1":"0",label:"Statut",onChange:e=>I((t=>t?{...t,is_active:"1"===e.target.value,user:{...t.user,is_active:"1"===e.target.value}}:null)),children:[t.jsx(L,{value:"1",children:"Actif"}),t.jsx(L,{value:"0",children:"Inactif"})]})]})})]})}),t.jsxs(se,{sx:{p:2,pt:0},children:[t.jsx(M,{onClick:()=>A(!1),sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{var e,t,r,n,i,s,a,o,l,c,d,u,h,p;if(S)try{if(S.id){const l=S.group_ids&&Array.isArray(S.group_ids)?S.group_ids.map((e=>Number(e))):[];console.log("Group IDs for update:",l);const c={username:S.username||(null==(e=S.user)?void 0:e.username),email:S.email||(null==(t=S.user)?void 0:t.email),first_name:S.first_name||(null==(r=S.user)?void 0:r.first_name)||"",last_name:S.last_name||(null==(n=S.user)?void 0:n.last_name)||"",is_active:S.is_active,is_staff:void 0!==S.is_staff?S.is_staff:"admin"===S.role,role:S.role,zone:S.zone,is_profile_active:S.is_active,groups:l,password:(null==(i=S.user)?void 0:i.password)||""};(null==(s=S.user)?void 0:s.password)&&""!==S.user.password.trim()&&(c.password=S.user.password),console.log("Sending update user data:",c),console.log("%c Groups being sent for update:","background: #afa; color: #080;",JSON.stringify(c.groups)),Array.isArray(c.groups)||(console.error("Warning: groups is not an array before sending to backend"),c.groups=l),console.log("Final API payload:",JSON.stringify(c));const d=await Is(S.id,c);console.log("Response from server after update:",d),await Ne();const u={...d,role:(null==(a=d.profile_data)?void 0:a.role)||"",zone:void 0!==(null==(o=d.profile_data)?void 0:o.zone)?d.profile_data.zone:null,is_active:Boolean(d.is_active)};w((e=>e.map((e=>e.id===S.id?u:e))))}else{if(!(null==(l=S.user)?void 0:l.password))return void _("Le mot de passe est requis pour un nouvel utilisateur");if(!S.role)return void _("Veuillez sÃ©lectionner un rÃ´le pour l'utilisateur");const e={username:S.user.username,email:S.user.email,password:S.user.password,first_name:S.user.first_name||"",last_name:S.user.last_name||"",is_active:S.user.is_active,is_staff:void 0!==S.is_staff?S.is_staff:"admin"===S.role,role:S.role,zone:void 0!==S.zone?S.zone:null,is_profile_active:S.is_active,groups:S.group_ids&&S.group_ids.length>0?S.group_ids:[]};let t;console.log("%c VALIDATED USER DATA FOR CREATION","background: #ff8; color: #000; font-weight: bold"),console.log("Role value (required):",S.role),console.log("Zone value:",void 0!==S.zone?S.zone:"null (not specified)"),console.log("Group IDs:",S.group_ids||"empty array"),console.log("Final data for API:",e),console.log("Group IDs to be saved:",JSON.stringify(S.group_ids)),console.log("Final groups data for API:",JSON.stringify(e.groups));try{t=await js(e),console.log("API response:",t)}catch(m){throw console.error("API call failed:",m),m.response&&(console.error("Response status:",m.response.status),console.error("Response data:",m.response.data)),m}if(!t)throw new Error("No user data received from API");{const e={...t,role:(null==(c=t.profile_data)?void 0:c.role)||(null==(d=t.profile)?void 0:d.role)||"",zone:void 0!==(null==(u=t.profile_data)?void 0:u.zone)?t.profile_data.zone:null==(h=t.profile)?void 0:h.zone,is_active:t.is_active};w([...y,e])}}A(!1),I(null),_(null)}catch(f){if(console.error("Error saving user:",f),null==(p=f.response)?void 0:p.data){console.error("Backend response:",f.response.data);const e=Me(f.response.data);_(e||"Une erreur est survenue lors de la sauvegarde de l'utilisateur")}else _("Une erreur est survenue lors de la sauvegarde de l'utilisateur")}},disabled:!(null==S?void 0:S.user.username)||!(null==S?void 0:S.user.email)||!(null==S?void 0:S.role)||!(null==S?void 0:S.id)&&!(null==S?void 0:S.user.password),sx:{borderRadius:"20px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0,0,0,0.15)"}},children:(null==S?void 0:S.id)?"Modifier":"Ajouter"})]})]}),t.jsxs(re,{open:z,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ne,{sx:{backgroundColor:r.palette.primary.main,color:"white",fontWeight:"bold"},children:(null==G?void 0:G.id)?"Modifier le groupe":"Nouveau groupe"}),t.jsx(ie,{sx:{p:3,mt:1},children:t.jsxs(de,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(de,{item:!0,xs:12,children:t.jsx(V,{label:"Nom du groupe",fullWidth:!0,required:!0,value:(null==G?void 0:G.name)||"",onChange:e=>X((t=>t?{...t,name:e.target.value}:null)),error:!(null==G?void 0:G.name)&&void 0!==(null==G?void 0:G.name),helperText:(null==G?void 0:G.name)||void 0===(null==G?void 0:G.name)?"":"Le nom est requis"})}),t.jsx(de,{item:!0,xs:12,children:t.jsxs(ae,{fullWidth:!0,children:[t.jsx(oe,{children:"Permissions"}),t.jsx(le,{multiple:!0,value:(null==G?void 0:G.permissions)||[],label:"Permissions",renderValue:e=>t.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.length>0?e.map((e=>{let r=Se[e]||"",n="";for(const t of We){const i=t.permissions.find((t=>t.id===e));if(i){r=i.name,n=t.name;break}}return t.jsx(ce,{label:`${n}: ${r}`,size:"small",onDelete:()=>{const t=Se[e];t&&Be(t)},sx:{m:.1}},e)})):t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucune permission sÃ©lectionnÃ©e"})}),onChange:e=>{console.log("Select onChange triggered, but using custom togglePermission instead",e)},MenuProps:{PaperProps:{style:{maxHeight:400,width:400}}},children:We.length>0?We.map((e=>[t.jsx(nt,{sx:{backgroundColor:r.palette.primary.light,color:r.palette.primary.contrastText,fontWeight:"bold"},children:e.name},`header-${e.app}.${e.model}`),...e.permissions.map((e=>{const n=e.full_codename,i=(e=>{if(!(null==G?void 0:G.permissions)||!Array.isArray(G.permissions))return!1;const t=Ee[e];return!!t&&G.permissions.includes(t)})(n);return t.jsxs(L,{value:e.id,onClick:e=>{e.preventDefault(),Be(n)},sx:{padding:"8px 16px",borderLeft:i?`4px solid ${r.palette.primary.main}`:"none",backgroundColor:i?"rgba(0, 0, 0, 0.04)":"transparent","&:hover":{backgroundColor:i?"rgba(0, 0, 0, 0.08)":"rgba(0, 0, 0, 0.04)"},transition:"all 0.2s"},children:[t.jsx(tt,{checked:i,color:"primary",sx:{padding:"4px"},onClick:e=>e.stopPropagation(),onChange:()=>Be(n)}),t.jsx(a,{primary:e.name,secondary:n,primaryTypographyProps:{fontWeight:i?700:400,color:i?r.palette.primary.main:"inherit"}})]},n)}))])):t.jsx(L,{disabled:!0,children:"Chargement des permissions..."})}),t.jsxs(c,{sx:{mt:2,mb:1},children:[t.jsxs(d,{variant:"subtitle2",color:"text.secondary",children:["Permissions sÃ©lectionnÃ©es (",(null==(Qe=null==G?void 0:G.permissions)?void 0:Qe.length)||0,")"]}),t.jsx(c,{sx:{mt:1,p:2,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:1,maxHeight:"150px",overflowY:"auto"},children:(null==(Je=null==G?void 0:G.permissions)?void 0:Je.length)?t.jsx(de,{container:!0,spacing:1,children:G.permissions.map((e=>{let r=Se[e]||"",n="";for(const t of We){const i=t.permissions.find((t=>t.id===e));if(i){r=i.name,n=t.name;break}}return t.jsx(de,{item:!0,children:t.jsx(ce,{label:`${n}: ${r}`,onDelete:()=>{const t=Se[e];t&&Be(t)},size:"small",sx:{m:.25}})},e)}))}):t.jsx(d,{variant:"body2",color:"text.secondary",align:"center",children:"Aucune permission sÃ©lectionnÃ©e"})})]})]})})]})}),t.jsxs(se,{sx:{p:2,pt:0},children:[t.jsx(M,{onClick:()=>H(!1),sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:async()=>{if(G)try{if(!G.name)return void F("Le nom du groupe est requis");console.log("%c DEBUG GROUP SAVE","background: #ff0000; color: #ffffff; font-size: 16px; font-weight: bold;"),console.log("selectedGroup state:",JSON.parse(JSON.stringify(G))),console.log("permissions in selectedGroup:",G.permissions),console.log("permissions type:",typeof G.permissions),console.log("is permissions array?",Array.isArray(G.permissions));let t=[];G.permissions&&Array.isArray(G.permissions)?(t=[...G.permissions],console.log("Copied permissions array with length:",t.length)):(console.warn("Permissions is not an array - initializing empty array"),t=[]);const r={name:G.name,permissions:t};if(console.log("Final data for API call:",JSON.stringify(r)),G.id)try{const e=await Ds(G.id,r);console.log("Group updated successfully:",e),D(N.map((t=>t.id===G.id?e:t))),H(!1),X(null),F(null)}catch(e){Le(e)}else try{const e=await Ns(r);console.log("Group created successfully:",e),D([...N,e]),H(!1),X(null),F(null)}catch(e){Le(e)}}catch(e){Le(e)}},disabled:!(null==G?void 0:G.name),sx:{borderRadius:"20px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0,0,0,0.15)"}},children:(null==G?void 0:G.id)?"Modifier":"Ajouter"})]})]})]})});var Qe,Je};var Gd={},qd=te;Object.defineProperty(Gd,"__esModule",{value:!0});var $d=Gd.default=void 0,Xd=qd(Oa()),Yd=t;$d=Gd.default=(0,Xd.default)((0,Yd.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const Zd=()=>{const e=h(),[r,n]=ht.useState(0),[i,s]=ht.useState(!1),[l,u]=ht.useState(!1),[p,m]=ht.useState(!1),[x,b]=ht.useState(null),[v,C]=ht.useState(""),[_,E]=ht.useState({name:"",description:"",code:"",symbol:"",discount_percentage:0,is_active:!0,is_base:!1,address:"",account_type:"",account_number:"",currency:"",initial_balance:0}),[A,S]=ht.useState(!1),[j,I]=ht.useState(!1),[T,R]=ht.useState({open:!1,message:"",severity:"success"}),[N,D]=ht.useState([]),[O,P]=ht.useState(!1),[k,B]=ht.useState([]),F=ht.useMemo((()=>[{id:"expense-categories",label:"CatÃ©gories de dÃ©penses",endpoint:"expense-categories"},{id:"units",label:"UnitÃ©s de mesure",endpoint:"units-of-measure"},{id:"currencies",label:"Devises",endpoint:"currencies"},{id:"payment-methods",label:"MÃ©thodes de paiement",endpoint:"payment-methods"},{id:"accounts",label:"Comptes",endpoint:"accounts"},{id:"price-groups",label:"Groupes de prix",endpoint:"price-groups"},{id:"product-categories",label:"CatÃ©gories de produits",endpoint:"product-categories"},{id:"charge-types",label:"Types de charges",endpoint:"charge-types"},{id:"client-groups",label:"Groupes de clients",endpoint:"client-groups"},{id:"zones",label:"Zones",endpoint:"zones"}]),[]),z=ht.useCallback((async()=>{const e=F[r];if(e){P(!0);try{const t=await Fs(e.endpoint);D(Array.isArray(t)?t:[])}catch(t){console.error(`Error fetching ${e.endpoint}:`,t),R({open:!0,message:`Erreur lors du chargement des donnÃ©es: ${t.message}`,severity:"error"}),D([])}finally{P(!1)}}}),[r,F]),H=ht.useCallback((async()=>{var e;if("accounts"===(null==(e=F[r])?void 0:e.endpoint))try{const e=await Fs("currencies");B(Array.isArray(e)?e:[])}catch(t){console.error("Error fetching currencies:",t)}}),[r,F]);ht.useEffect((()=>{var e;z(),"accounts"===(null==(e=F[r])?void 0:e.endpoint)&&H()}),[r,z,H,F]);const G=()=>{var e;return(null==(e=F[r])?void 0:e.label)||""},q=()=>{var e;return(null==(e=F[r])?void 0:e.endpoint)||""},$=()=>{s(!1),u(!1),m(!1)},X=e=>{E({..._,[e.target.name]:e.target.value})},Y=async()=>{S(!0);try{const e=q();if(!e)throw new Error("No endpoint specified");i?(await zs(e,_),R({open:!0,message:`${v} ajoutÃ© avec succÃ¨s`,severity:"success"})):(await Ws(e,x.id,_),R({open:!0,message:`${v} modifiÃ© avec succÃ¨s`,severity:"success"})),z()}catch(e){console.error("Error during save operation:",e),R({open:!0,message:`Erreur: ${e.message}`,severity:"error"})}finally{S(!1),$()}},Z=()=>{R({...T,open:!1})},J=()=>{const e=q(),r=t.jsx(V,{name:"name",label:"Nom",value:_.name,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",required:!0});switch(e){case"currencies":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"code",label:"Code (ex: USD, EUR)",value:_.code,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",required:!0,inputProps:{maxLength:3},helperText:"Code Ã  3 caractÃ¨res (ex: USD, EUR)"}),t.jsx(V,{name:"symbol",label:"Symbole (ex: $, â‚¬)",value:_.symbol,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",required:!0,inputProps:{maxLength:5},helperText:"Symbole monÃ©taire (ex: $, â‚¬)"})]});case"price-groups":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"discount_percentage",label:"Pourcentage de remise",value:Ga(_.discount_percentage),onChange:e=>{const t=Ha(e.target.value,_.discount_percentage);E({..._,discount_percentage:t})},type:"text",fullWidth:!0,margin:"normal",variant:"outlined",error:_.discount_percentage<0||_.discount_percentage>100,helperText:_.discount_percentage<0?"Le pourcentage doit Ãªtre positif":_.discount_percentage>100?"Le pourcentage ne peut pas dÃ©passer 100":""}),t.jsx(V,{name:"description",label:"Description",value:_.description,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3}),t.jsx(lt,{control:t.jsx(tt,{checked:_.is_base||!1,onChange:e=>E({..._,is_base:e.target.checked}),name:"is_base"}),label:"Groupe de prix de base"})]});case"units-of-measure":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"symbol",label:"Symbole de l'unitÃ© de mesure",value:_.symbol,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",required:!0})]});case"zones":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"address",label:"Adresse",value:_.address||"",onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:2}),t.jsx(V,{name:"description",label:"Description",value:_.description,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3})]});case"accounts":return t.jsxs(t.Fragment,{children:[r,t.jsxs(ae,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(oe,{id:"account-type-label",children:"Type de compte"}),t.jsxs(le,{labelId:"account-type-label",name:"account_type",value:_.account_type,onChange:X,label:"Type de compte",children:[t.jsx(L,{value:"internal",children:"Compte Interne"}),t.jsx(L,{value:"bank",children:"Compte Bancaire"}),t.jsx(L,{value:"cash",children:"Caisse"}),t.jsx(L,{value:"client",children:"Compte Client"}),t.jsx(L,{value:"supplier",children:"Compte Fournisseur"})]})]}),t.jsxs(ae,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(oe,{id:"currency-label",children:"Devise"}),t.jsx(le,{labelId:"currency-label",name:"currency",value:_.currency,onChange:X,label:"Devise",children:k.map((e=>t.jsxs(L,{value:e.id,children:[e.name," (",e.symbol,")"]},e.id)))})]}),t.jsx(V,{name:"initial_balance",label:"Solde initial",value:Ga(_.initial_balance||0),onChange:e=>{const t=Ha(e.target.value,_.initial_balance||0);E({..._,initial_balance:t})},type:"text",fullWidth:!0,margin:"normal",variant:"outlined",error:(_.initial_balance||0)<0,helperText:qa(_.initial_balance||0,"price")}),t.jsx(V,{name:"description",label:"Description",value:_.description,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3}),t.jsx(lt,{control:t.jsx(tt,{checked:_.is_active,onChange:e=>E({..._,is_active:e.target.checked}),name:"is_active"}),label:"Actif"})]});default:return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"description",label:"Description",value:_.description,onChange:X,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3})]})}};return t.jsx(el,{requiredPermission:"change_user",fallbackPath:"/",children:t.jsxs(c,{sx:{backgroundColor:e.palette.background.default,minHeight:"100vh",p:3},children:[t.jsx(d,{variant:"h4",sx:{mb:3,fontWeight:"bold"},children:"ParamÃ¨tres du systÃ¨me"}),t.jsxs(W,{elevation:2,sx:{mb:3,p:1},children:["          ",t.jsx(be,{value:r,onChange:(e,t)=>{n(t),C(G())},indicatorColor:"primary",variant:"scrollable",scrollButtons:"auto",children:F.map((e=>t.jsx(ve,{label:e.label},e.id)))})]}),t.jsxs(K,{elevation:3,children:[t.jsx(it,{title:G(),action:t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(Pe,{}),onClick:()=>{E({name:"",description:"",code:"",symbol:"",discount_percentage:0,is_active:!0,is_base:!1,address:"",account_type:"",account_number:"",currency:"",initial_balance:0}),C(G()),"accounts"===q()&&H(),s(!0)},sx:{borderRadius:"20px"},children:"Ajouter"})}),t.jsx(Q,{children:O?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):0===N.length?t.jsx(d,{color:"textSecondary",align:"center",sx:{p:3},children:"Aucun Ã©lÃ©ment trouvÃ©"}):t.jsx(w,{children:Array.isArray(N)?N.map((e=>t.jsxs(xt.Fragment,{children:[t.jsxs(o,{children:[t.jsx(a,{primary:e.name,secondary:e.description||e.symbol||e.code}),t.jsxs(st,{children:[t.jsx(g,{edge:"end","aria-label":"edit",onClick:()=>(e=>{b(e),E({name:e.name||"",description:e.description||"",code:e.code||"",symbol:e.symbol||"",discount_percentage:e.discount_percentage||0,is_active:void 0===e.is_active||e.is_active,is_base:void 0!==e.is_base&&e.is_base,address:e.address||"",account_type:e.account_type||"",account_number:e.account_number||"",currency:e.currency||"",initial_balance:e.initial_balance||0}),C(G()),"accounts"===q()&&H(),u(!0)})(e),sx:{mr:1},children:t.jsx(Oe,{})}),t.jsx(g,{edge:"end","aria-label":"delete",onClick:()=>(e=>{b(e),C(G()),m(!0)})(e),children:t.jsx(we,{})})]})]}),t.jsx(y,{})]},e.id))):t.jsx(d,{color:"error",align:"center",children:"Erreur de format des donnÃ©es"})})})]}),t.jsxs(re,{open:i,onClose:$,maxWidth:"sm",fullWidth:!0,TransitionComponent:at,keepMounted:!1,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsxs(ne,{sx:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,fontWeight:"bold"},children:["Ajouter ",v]}),t.jsx(ie,{dividers:!0,sx:{p:3,backgroundColor:e.palette.background.paper,borderTop:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`},children:t.jsx(c,{sx:{pt:1},children:J()})}),t.jsxs(se,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:$,disabled:A,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:Y,disabled:A||!_.name||"currencies"===q()&&(!_.code||!_.symbol)||"units-of-measure"===q()&&!_.symbol||"accounts"===q()&&(!_.account_type||!_.currency),startIcon:A?t.jsx(f,{size:20}):t.jsx($d,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:A?"Sauvegarde...":"Sauvegarder"})]})]}),t.jsxs(re,{open:l,onClose:$,maxWidth:"sm",fullWidth:!0,TransitionComponent:at,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsxs(ne,{sx:{backgroundColor:e.palette.info.main,color:"#fff",fontWeight:"bold"},children:["Modifier ",v]}),t.jsx(ie,{dividers:!0,sx:{p:3,backgroundColor:e.palette.background.paper,borderTop:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`},children:t.jsx(c,{sx:{pt:1},children:J()})}),t.jsxs(se,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:$,disabled:A,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",onClick:Y,disabled:A||!_.name||"currencies"===q()&&(!_.code||!_.symbol)||"units-of-measure"===q()&&!_.symbol||"accounts"===q()&&(!_.account_type||!_.currency),startIcon:A?t.jsx(f,{size:20}):t.jsx($d,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:A?"Sauvegarde...":"Sauvegarder"})]})]}),t.jsxs(re,{open:p,onClose:$,TransitionComponent:at,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsx(ne,{sx:{backgroundColor:e.palette.error.main,color:"#fff",fontWeight:"bold"},children:"Confirmation de suppression"}),t.jsxs(ie,{sx:{p:3,mt:2,backgroundColor:e.palette.background.paper},children:[t.jsxs(Ze,{color:"text.primary",sx:{mb:2},children:["ÃŠtes-vous sÃ»r de vouloir supprimer ",t.jsx("strong",{children:null==x?void 0:x.name})," ?"]}),t.jsx(U,{severity:"error",children:"Cette action est irrÃ©versible."})]}),t.jsxs(se,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:$,disabled:j,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(M,{variant:"contained",color:"error",onClick:async()=>{I(!0);try{const e=q();if(!e)throw new Error("No endpoint specified");await Us(e,x.id),R({open:!0,message:`${v} supprimÃ© avec succÃ¨s`,severity:"success"}),z()}catch(e){console.error("Error during delete operation:",e),R({open:!0,message:`Erreur: ${e.message}`,severity:"error"})}finally{I(!1),$()}},disabled:j,startIcon:j?t.jsx(f,{size:20}):t.jsx(we,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:j?"Suppression...":"Supprimer"})]})]}),t.jsx(ze,{open:T.open,autoHideDuration:6e3,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:Z,severity:T.severity,sx:{width:"100%",boxShadow:"dark"===e.palette.mode?"0 4px 20px rgba(0,0,0,0.3)":"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2},variant:"filled",children:T.message})}),t.jsx(ot,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,backgroundColor:"dark"===e.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0.6)"},open:A,children:t.jsx(f,{color:"inherit"})})]})})},Kd=()=>{const e=pt();return null!==localStorage.getItem("access_token")?t.jsx(gt,{}):t.jsx(vt,{to:"/login",state:{from:e},replace:!0})},Qd=e=>{const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`inventory-tabpanel-${i}`,"aria-labelledby":`inventory-tab-${i}`,...s,style:{padding:"20px 0"},children:n===i&&t.jsx(c,{children:r})})},Jd=()=>{const[e,r]=ht.useState(0),[n,i]=ht.useState([]),[s,a]=ht.useState([]),[o,u]=ht.useState([]),[h,p]=ht.useState([]),[m,g]=ht.useState([]),[x,y]=ht.useState([]),[w,b]=ht.useState([]),[v,C]=ht.useState([]),[A,S]=ht.useState(!0),[j,I]=ht.useState(null),[T,R]=ht.useState(""),[N,D]=ht.useState(0),[O,P]=ht.useState(10),[k,B]=ht.useState({open:!1,message:"",severity:"info"}),[F,z]=ht.useState(!1),[W,H]=ht.useState("supply"),[G,q]=ht.useState(!1),[$,X]=ht.useState(null),[Z,K]=ht.useState({items:[],status:"pending",supplier:"",zone:"",sourceZone:"",targetZone:"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0}),[Q,J]=ht.useState(!1),[ee,te]=ht.useState(null),[ce,de]=ht.useState(!1),[ue,pe]=ht.useState(!1),[me,fe]=ht.useState({operationType:"lookup"}),[ge,xe]=ht.useState(null),[ye,Ce]=ht.useState(1),[_e,Ee]=ht.useState(null),[Se,je]=ht.useState(!1),Ie=ht.useRef(null),{hasPermission:Te}=pi(),[Re,Ne]=ht.useState(""),[Me,ke]=ht.useState(""),[Be,Le]=ht.useState(""),[Fe,We]=ht.useState(""),[Ue,Ve]=ht.useState(""),[He,Ge]=ht.useState(""),[qe,$e]=ht.useState(""),[Xe,Ye]=ht.useState(""),[Ke,Qe]=ht.useState(""),[Je,et]=ht.useState(""),[tt,rt]=ht.useState(""),[nt,it]=ht.useState(""),[st,at]=ht.useState(""),[ot,lt]=ht.useState(""),[ut,pt]=ht.useState(""),[mt,ft]=ht.useState(""),[gt,xt]=ht.useState(""),[yt,wt]=ht.useState(""),bt=e=>{Le(e.target.value)},vt=e=>{We(e.target.value)},Ct=e=>{Ve(e.target.value)},_t=e=>{Ge(e.target.value)},Et=e=>{$e(e.target.value)},At=e=>{Ye(e.target.value)},St=e=>{Qe(e.target.value)},jt=e=>{et(e.target.value)},It=e=>{rt(e.target.value)},Tt=e=>{it(e.target.value)},Rt=e=>{at(e.target.value)},Nt=e=>{lt(e.target.value)},Dt=e=>{pt(e.target.value)},Ot=(e,t)=>{var r,n,i,s;H(e),q(!!t),X(t||null);const a={items:[],status:"inventory"===e?"draft":"pending",supplier:"",zone:T||(null==(r=x[0])?void 0:r.id)||"",sourceZone:T||(null==(n=x[0])?void 0:n.id)||"",targetZone:(null==(i=x.find((e=>{var t;return e.id!==(T||(null==(t=x[0])?void 0:t.id))})))?void 0:i.id)||"",inventoryZone:T||(null==(s=x[0])?void 0:s.id)||"",currentProduct:null,currentQuantity:1,currentUnitPrice:0};t&&("supply"===e&&"supplier"in t?(a.supplier=t.supplier,a.zone=t.zone,a.status=t.status,a.items=(t.items||[]).map((e=>({id:e.id,product:e.product,quantity:e.quantity,unit_price:e.unit_price??0,total_price:e.total_price??e.quantity*(e.unit_price??0)})))):"transfer"===e&&"from_zone"in t?(a.sourceZone=t.from_zone,a.targetZone=t.to_zone,a.status=t.status,a.items=(t.items||[]).map((e=>{const t=w.find((t=>t.id===e.product)),r=(null==t?void 0:t.purchase_price)??0;return{id:e.id,product:e.product,quantity:e.quantity,unit_price:r,total_price:r*e.quantity}}))):"inventory"===e&&"zone"in t&&(a.inventoryZone=t.zone,a.status=t.status,a.items=(t.items||[]).map((e=>{const t=w.find((t=>t.id===e.product)),r=(null==t?void 0:t.purchase_price)??0,n=e.actual_quantity??0;return{id:e.id,product:e.product,quantity:n,unit_price:r,total_price:r*n}})))),K(a),xt(""),wt(""),z(!0)},Pt=()=>{z(!1),X(null),q(!1)},Mt=async()=>{try{const e=await Vi();i(e)}catch(e){console.error("Error refreshing stock data:",e),B({open:!0,message:"Ã‰chec de la mise Ã  jour du stock actuel.",severity:"warning"})}},kt=()=>Ot("supply"),Bt=()=>Ot("transfer"),Lt=()=>Ot("inventory"),Ft=e=>{const t=e.target.value;Ne(t)},zt=e=>{const t=e.target.value;ke(t)},Wt=(e,t,r)=>{te({id:e,type:t,name:r}),J(!0)},Ut=()=>{J(!1),te(null)},Vt=async e=>{try{if(!_e||!Se)return;let r=null;try{const t=JSON.parse(e);t&&t.id&&(r=t.id)}catch(t){e.includes("product-id:")?r=parseInt(e.split("product-id:")[1],10):isNaN(parseInt(e,10))||(r=parseInt(e,10))}if(!r)return void B({open:!0,message:`Invalid QR code: ${e}`,severity:"error"});await _e.pause();const n=await ki(r);xe(n),S(!1),Xt(n);new Audio("/sounds/beep-success.mp3").play().catch((()=>{}))}catch(r){console.error("Error processing scan:",r),B({open:!0,message:`Error processing scan: ${r.message}`,severity:"error"})}finally{setTimeout((()=>{_e&&Se&&_e.resume()}),2e3)}},Ht=e=>{if(!e)return;const t=Number(e.purchase_price??0),r=Number(ye??1),n={product:e.id,quantity:r,unit_price:t,total_price:t*r},i=Z.items.findIndex((t=>t.product===e.id)),s=[...Z.items];if(i>=0){const e=s[i],t=Number(e.quantity??0)+r,n=t*Number(e.unit_price??0);s[i]={...e,quantity:t,total_price:n}}else s.push(n);K((e=>({...e,items:s}))),B({open:!0,message:`Added ${r} units of ${e.name}`,severity:"success"}),Ce(1),xe(null)},Gt=e=>{console.debug("QR scan error:",e)},qt=async()=>{if(_e&&Se)try{await _e.stop(),je(!1)}catch(e){console.error("Error stopping camera:",e)}},$t=e=>{fe(e),pe(!0),setTimeout((()=>(async()=>{if(!_e||!Se)if(Ie.current)try{const e=new Qo("scanner-container");Ee(e);const t=await Qo.getCameras();t&&t.length?(await e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250},aspectRatio:1},Vt,Gt),je(!0)):B({open:!0,message:"No camera devices found",severity:"error"})}catch(e){console.error("Error starting camera:",e),B({open:!0,message:`Error starting camera: ${e.message}`,severity:"error"})}else B({open:!0,message:"Scanner container not ready",severity:"error"})})()),500)},Xt=e=>{if(e)switch(me.operationType){case"receive":case"transfer":case"count":Ht(e)}},Yt=async e=>{try{S(!0);const t=await Xi(e);Ot("supply",t)}catch(t){console.error("Error fetching supply details:",t),B({open:!0,message:`Error fetching supply details: ${t.message||"Unknown error"}`,severity:"error"})}finally{S(!1)}},Zt=async e=>{try{S(!0);const t=await Qi(e);Ot("transfer",t)}catch(t){console.error("Error fetching transfer details:",t),B({open:!0,message:`Error fetching transfer details: ${t.message||"Unknown error"}`,severity:"error"})}finally{S(!1)}},Kt=async e=>{try{S(!0);const t=await rs(e);Ot("inventory",t)}catch(t){console.error("Error fetching inventory details:",t),B({open:!0,message:`Error fetching inventory details: ${t.message||"Unknown error"}`,severity:"error"})}finally{S(!1)}},Qt=e=>{const t=w.find((t=>t.id===e));return t?t.name:"Unknown Product"},Jt=e=>{const t=x.find((t=>t.id===e));return t?t.name:"Unknown Location"},er=e=>{const t=v.find((t=>t.id===e));return t?t.name:"Unknown Supplier"},tr=e=>["pending","received","partial","cancelled"].includes(e)?e:"pending",rr=e=>["pending","partial","completed","cancelled"].includes(e)?e:"pending",nr=e=>["draft","in_progress","completed","cancelled"].includes(e)?e:"draft",ir=e=>{if(!e.items||0===e.items.length)return{totalQuantity:0,totalValue:0};return{totalQuantity:e.items.reduce(((e,t)=>e+(Number(t.quantity)||0)),0),totalValue:e.items.reduce(((e,t)=>e+(Number(t.total_price)||0)),0)}};ht.useEffect((()=>{(async()=>{S(!0);try{const[e,t,r]=await Promise.all([Di(),Mi(),zi()]);y(e),b(t),C(r),e.length>0&&R(e[0].id||""),I(null)}catch(e){console.error("Error fetching inventory data:",e),I("Failed to load inventory data. Please try again later.")}finally{S(!1)}})()}),[]),ht.useEffect((()=>{(async()=>{S(!0);try{switch(e){case 0:{const e=await Vi();i(e);break}case 1:{const e=await $i();a(e);break}case 2:{const e=await Ki();u(e);break}case 3:{const e=await ts();p(e);break}case 4:{const e=await Gi();g(e);break}}}catch(t){console.error("Error loading tab data:",t),I("Failed to load data for this tab. Please try again.")}finally{S(!1)}})()}),[e]);const sr=async()=>{try{switch(S(!0),e){case 0:await Mt();break;case 1:{const e=await $i();a(e);break}case 2:{const e=await Ki();u(e);break}case 3:{const e=await ts();p(e);break}case 4:{const e=await Gi();g(e);break}}B({open:!0,message:"Data refreshed successfully",severity:"success"})}catch(t){console.error("Error refreshing data:",t),B({open:!0,message:"Failed",severity:"error"})}finally{S(!1)}},ar=()=>{B({...k,open:!1})};return t.jsx(el,{requiredPermission:"view_stock",fallbackPath:"/",children:t.jsxs(c,{sx:{width:"100%"},children:[t.jsx(d,{variant:"h5",component:"h1",gutterBottom:!0,children:"Gestion des Stocks"}),t.jsx(c,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:t.jsx(M,{variant:"contained",color:"primary",startIcon:t.jsx(he,{}),onClick:()=>$t({operationType:"lookup"}),sx:{mr:1},children:"Scanner un Produit"})}),t.jsx(c,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:t.jsxs(be,{value:e,onChange:(e,t)=>{r(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"inventory management tabs",children:[t.jsx(ve,{label:"Stock Actuel",icon:t.jsx(E,{}),iconPosition:"start"}),t.jsx(ve,{label:"Approvisionnements",icon:t.jsx(_,{}),iconPosition:"start"}),t.jsx(ve,{label:"Transferts",icon:t.jsx(ct,{}),iconPosition:"start"}),t.jsx(ve,{label:"Inventaires",icon:t.jsx(E,{}),iconPosition:"start"}),t.jsx(ve,{label:"Historique",icon:t.jsx(dt,{}),iconPosition:"start"})]})}),t.jsx(Qd,{value:e,index:0,children:(()=>{const e=n.filter((e=>{var t;const r=He.toLowerCase(),n=null==(t=e.product_name)?void 0:t.toLowerCase().includes(r),i=!T||e.zone===T;return n&&i})),r=e.map((e=>{const t=w.find((t=>t.id===e.product)),r=(null==t?void 0:t.purchase_price)??0,n=r*e.quantity;return{...e,unit_price:r,stock_value:n}}));return t.jsxs(t.Fragment,{children:[t.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:1},children:[t.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(Fa,{label:ba,value:He,onChange:_t}),t.jsxs(za,{label:ya,value:T||"",onChange:e=>R(e.target.value),sx:{minWidth:200},children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:t.jsx(ca,{standardVariant:"secondary",startIcon:t.jsx(Ae,{}),onClick:sr,disabled:A,children:da.refresh})})]}),t.jsx(ja,{title:pa.currentStock,rows:r,loading:A,page:N,rowsPerPage:O,onPaginationChange:(e,t)=>{D(e),P(t)},columns:[{field:"product_name",headerName:pa.product,flex:1.5,width:150},{field:"zone",headerName:pa.location,flex:1,valueGetter:e=>e?Jt(e):""},{field:"quantity",headerName:pa.quantity,flex:1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.value," ",e.row.unit_symbol||"",e.value<=0&&t.jsx(l,{title:ua.out_of_stock,children:t.jsx(De,{color:"error",fontSize:"small",sx:{ml:1}})})]})},{field:"unit_price",headerName:pa.unitPrice,flex:1,renderCell:e=>{const r=e.value||0;return t.jsxs(c,{sx:{textAlign:"right"},children:[r.toLocaleString("fr-FR")," GNF"]})}},{field:"stock_value",headerName:pa.stockValue,flex:1,renderCell:e=>{const r=e.value||0;return t.jsxs(c,{sx:{textAlign:"right",fontWeight:"medium"},children:[r.toLocaleString("fr-FR")," GNF"]})}},{field:"updated_at",headerName:"DerniÃ¨re mise Ã  jour",flex:1,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):"N/A"}]})]})})()}),t.jsx(Qd,{value:e,index:1,children:(()=>{const e=s.filter((e=>{var t,r,n;const i=qe.toLowerCase(),s=null==(t=e.reference)?void 0:t.toLowerCase().includes(i),a=null==(r=er(e.supplier))?void 0:r.toLowerCase(),o=null==a?void 0:a.includes(i),l=null==(n=Jt(e.zone))?void 0:n.toLowerCase(),c=null==l?void 0:l.includes(i),d=!Xe||e.status===Xe,u=!Ke||e.zone===Ke,h=!Je||e.supplier===Je;return(s||o||c)&&d&&u&&h}));return t.jsxs(t.Fragment,{children:[t.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[t.jsx(d,{variant:"subtitle1",children:pa.supplies}),t.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(Fa,{label:va,value:qe,onChange:Et,placeholder:"RÃ©f/Fourn./Zone",size:"small"}),t.jsxs(za,{label:xa,value:Xe,onChange:At,size:"small",sx:{minWidth:150},children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),t.jsx(L,{value:"pending",children:ua.pending}),t.jsx(L,{value:"received",children:"ReÃ§u"}),t.jsx(L,{value:"partial",children:ua.partial}),t.jsx(L,{value:"cancelled",children:ua.cancelled})]}),t.jsxs(za,{label:ya,value:Ke,onChange:St,size:"small",sx:{minWidth:180},children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]}),t.jsxs(za,{label:wa,value:Je,onChange:jt,size:"small",sx:{minWidth:180},children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),v.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]}),t.jsx(ca,{standardVariant:"secondary",startIcon:t.jsx(Ae,{}),onClick:sr,disabled:A,size:"small",children:da.refresh}),Te("add_stocksupply")&&t.jsxs(ca,{standardVariant:"primary",startIcon:t.jsx(Pe,{}),onClick:kt,size:"small",children:[da.add," ",pa.supply]})]})]}),A?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):j?t.jsx(U,{severity:"error",sx:{mb:2},children:j}):t.jsx(ja,{rows:e,loading:A,page:N,rowsPerPage:O,onRowClick:e=>Yt(e.row.id),onPaginationChange:(e,t)=>{D(e),P(t)},columns:[{field:"reference",headerName:da.reference,flex:1},{field:"supplier",headerName:ga.supplier,flex:1,valueGetter:e=>e?er(e):""},{field:"zone",headerName:pa.location,flex:1,valueGetter:e=>e?Jt(e):""},{field:"date",headerName:da.date,flex:1,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):""},{field:"status",headerName:da.status,flex:1,renderCell:e=>t.jsx(Wa,{status:e.value})},{field:"totalQuantity",headerName:pa.totalQuantity,flex:1,valueGetter:(e,t)=>ir(t).totalQuantity,renderCell:e=>t.jsx(c,{sx:{textAlign:"right"},children:e.value})},{field:"merchandiseValue",headerName:pa.merchandiseValue,flex:1,valueGetter:(e,t)=>ir(t).totalValue,renderCell:e=>t.jsxs(c,{sx:{textAlign:"right"},children:[(e.value||0).toLocaleString("fr-FR")," GNF"]})},{field:"actions",headerName:da.actions,flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(l,{title:`${da.view} / ${da.edit}`,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Yt(e.row.id)},children:t.jsx(Oe,{fontSize:"small"})})}),Te("delete_stocksupply")&&"pending"===e.row.status&&t.jsx(l,{title:da.delete,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Wt(e.row.id,"supply",e.row.reference)},sx:{color:"error.main"},children:t.jsx(we,{fontSize:"small"})})})]})}]})]})})()}),t.jsx(Qd,{value:e,index:2,children:(()=>{const e=o.filter((e=>{var t,r,n;const i=tt.toLowerCase(),s=null==(t=e.reference)?void 0:t.toLowerCase().includes(i),a=null==(r=Jt(e.from_zone))?void 0:r.toLowerCase(),o=null==a?void 0:a.includes(i),l=null==(n=Jt(e.to_zone))?void 0:n.toLowerCase(),c=null==l?void 0:l.includes(i),d=!nt||e.status===nt,u=!st||e.from_zone===st,h=!ot||e.to_zone===ot;return(s||o||c)&&d&&u&&h}));return t.jsxs(t.Fragment,{children:[t.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[t.jsx(d,{variant:"subtitle1",children:"Transferts de Stock"}),t.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[" ",t.jsx(V,{label:"Rechercher (RÃ©f/Zones)",variant:"outlined",value:tt,onChange:It,size:"small"}),t.jsxs(ae,{size:"small",sx:{minWidth:150},children:[t.jsx(oe,{children:"Statut"}),t.jsxs(le,{value:nt,label:"Statut",onChange:Tt,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),t.jsx(L,{value:"pending",children:"En attente"}),t.jsx(L,{value:"completed",children:"TerminÃ©"}),t.jsx(L,{value:"partial",children:"Partiel"}),t.jsx(L,{value:"cancelled",children:"AnnulÃ©"})]})]}),t.jsxs(ae,{size:"small",sx:{minWidth:180},children:[t.jsx(oe,{children:"De Zone"}),t.jsxs(le,{value:st,label:"De Zone",onChange:Rt,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Toutes"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(ae,{size:"small",sx:{minWidth:180},children:[t.jsx(oe,{children:"Vers Zone"}),t.jsxs(le,{value:ot,label:"Vers Zone",onChange:Nt,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Toutes"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(Ae,{}),onClick:sr,disabled:A,size:"medium",children:"Actualiser"}),Te("add_stocktransfer")&&t.jsx(M,{variant:"contained",startIcon:t.jsx(Pe,{}),onClick:Bt,size:"medium",children:"Nouveau Transfert"})]})]}),A?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):j?t.jsx(U,{severity:"error",sx:{mb:2},children:j}):t.jsx(ja,{rows:e,loading:A,page:N,rowsPerPage:O,onRowClick:e=>Zt(e.row.id),onPaginationChange:(e,t)=>{D(e),P(t)},columns:[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"from_zone",headerName:"De",flex:1,valueGetter:e=>e?Jt(e):""},{field:"to_zone",headerName:"Vers",flex:1,valueGetter:e=>e?Jt(e):""},{field:"date",headerName:"Date",flex:1,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):""},{field:"status",headerName:"Statut",flex:1,renderCell:e=>t.jsx(Wa,{status:e.value})},{field:"totalQuantity",headerName:pa.totalQuantity,flex:1,valueGetter:(e,t)=>{return(r=t).items&&0!==r.items.length?r.items.reduce(((e,t)=>e+(Number(t.quantity)||0)),0):0;var r},renderCell:e=>t.jsx(c,{sx:{textAlign:"right"},children:e.value})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(l,{title:`${da.view} / ${da.edit}`,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Zt(e.row.id)},children:t.jsx(Oe,{fontSize:"small"})})}),Te("delete_stocktransfer")&&"pending"===e.row.status&&t.jsx(l,{title:da.delete,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Wt(e.row.id,"transfer",e.row.reference)},sx:{color:"error.main"},children:t.jsx(we,{fontSize:"small"})})})]})}]})]})})()}),t.jsx(Qd,{value:e,index:3,children:(()=>{const e=h.filter((e=>{var t,r;const n=Be.toLowerCase(),i=null==(t=e.reference)?void 0:t.toLowerCase().includes(n),s=null==(r=Jt(e.zone))?void 0:r.toLowerCase(),a=null==s?void 0:s.includes(n),o=!Fe||e.status===Fe,l=!Ue||e.zone===Ue;return(i||a)&&o&&l}));return t.jsxs(t.Fragment,{children:[t.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[t.jsx(d,{variant:"subtitle1",children:"Inventaires"}),t.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[" ",t.jsx(V,{label:"Rechercher (RÃ©f/Zone)",variant:"outlined",value:Be,onChange:bt,size:"small"}),t.jsxs(ae,{size:"small",sx:{minWidth:150},children:[t.jsx(oe,{children:"Statut"}),t.jsxs(le,{value:Fe,label:"Statut",onChange:vt,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),t.jsx(L,{value:"draft",children:"Brouillon"}),t.jsx(L,{value:"in_progress",children:"En cours"}),t.jsx(L,{value:"completed",children:"TerminÃ©"}),t.jsx(L,{value:"cancelled",children:"AnnulÃ©"})]})]}),t.jsxs(ae,{size:"small",sx:{minWidth:180},children:[t.jsx(oe,{children:"Emplacement"}),t.jsxs(le,{value:Ue,label:"Emplacement",onChange:Ct,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(Ae,{}),onClick:sr,disabled:A,size:"medium",children:"Actualiser"}),Te("add_inventory")&&t.jsx(M,{variant:"contained",startIcon:t.jsx(Pe,{}),onClick:Lt,size:"medium",children:"Nouvel Inventaire"})]})]}),A?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):j?t.jsx(U,{severity:"error",sx:{mb:2},children:j}):t.jsx(ja,{rows:e,loading:A,page:N,rowsPerPage:O,onRowClick:e=>Kt(e.row.id),onPaginationChange:(e,t)=>{D(e),P(t)},columns:[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"zone",headerName:"Emplacement",flex:1,valueGetter:e=>e?Jt(e):""},{field:"date",headerName:"Date",flex:1,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):""},{field:"status",headerName:"Statut",flex:1,renderCell:e=>t.jsx(Wa,{status:e.value})},{field:"totalQuantity",headerName:pa.totalQuantity,flex:1,valueGetter:(e,t)=>{return(r=t).items&&0!==r.items.length?r.items.reduce(((e,t)=>e+(Number(t.actual_quantity)||0)),0):0;var r},renderCell:e=>t.jsx(c,{sx:{textAlign:"right"},children:e.value})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(l,{title:`${da.view} / ${da.edit}`,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Kt(e.row.id)},children:t.jsx(Oe,{fontSize:"small"})})}),Te("delete_inventory")&&("draft"===e.row.status||"in_progress"===e.row.status)&&t.jsx(l,{title:da.delete,children:t.jsx(ca,{standardVariant:"action",onClick:t=>{t.stopPropagation(),Wt(e.row.id,"inventory",e.row.reference)},sx:{color:"error.main"},children:t.jsx(we,{fontSize:"small"})})})]})}]})]})})()}),t.jsx(Qd,{value:e,index:4,children:(()=>{const e={supply:"Approvisionnement",sale:"Vente",transfer_in:"EntrÃ©e par transfert",transfer_out:"Sortie par transfert",inventory:"Ajustement d'inventaire",production:"Production",return:"Retour"},r=m.filter((t=>{var r;const n=ut.toLowerCase(),i=null==(r=t.reference)?void 0:r.toLowerCase().includes(n),s=(e[t.transaction_type]||t.transaction_type).toLowerCase().includes(n),a=!Re||t.product===Re,o=!Me||t.zone===Me;return(i||s)&&a&&o}));return t.jsxs(t.Fragment,{children:[t.jsxs(c,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[t.jsx(d,{variant:"subtitle1",children:"Historique des Mouvements"}),t.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[t.jsx(V,{label:"Rechercher (RÃ©f/Type)",variant:"outlined",value:ut,onChange:Dt,size:"small"}),t.jsxs(ae,{size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"product-select-label",children:"Filtrer par Produit"}),t.jsxs(le,{labelId:"product-select-label",label:"Filtrer par Produit",value:Re,onChange:Ft,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous les Produits"})}),w.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(ae,{size:"small",sx:{minWidth:200},children:[t.jsx(oe,{id:"zone-history-select-label",children:"Filtrer par Emplacement"}),t.jsxs(le,{labelId:"zone-history-select-label",label:"Filtrer par Emplacement",value:Me,onChange:zt,children:[t.jsx(L,{value:"",children:t.jsx("em",{children:"Tous les Emplacements"})}),x.map((e=>t.jsx(L,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(M,{variant:"outlined",startIcon:t.jsx(Ae,{}),onClick:sr,disabled:A,size:"medium",children:"Actualiser"})]})]}),A?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(f,{})}):j?t.jsx(U,{severity:"error",sx:{mb:2},children:j}):t.jsx(c,{sx:{height:400,width:"100%"},children:t.jsx(Y,{rows:r,getRowId:e=>e.id||Math.random(),columns:[{field:"date",headerName:"Date",flex:1,valueFormatter:e=>e?new Date(e).toLocaleDateString():""},{field:"product",headerName:"Produit",flex:1,valueGetter:e=>e?Qt(e):""},{field:"zone",headerName:"Emplacement",flex:1,valueGetter:e=>e?Jt(e):""},{field:"transaction_type",headerName:"Type",flex:1,valueFormatter:t=>e[t]||t},{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"notes",headerName:"DÃ©tails",flex:1.2,renderCell:e=>{const r=e.value||"",n=(e,t=80)=>e?e.length>t?`${e.substring(0,t)}...`:e:"-";return"inventory"===e.row.transaction_type&&r?t.jsx(l,{title:t.jsxs(c,{sx:{maxWidth:400,p:1},children:[t.jsx(d,{variant:"subtitle2",gutterBottom:!0,color:"inherit",children:"DÃ©tails de l'inventaire"}),t.jsx(d,{variant:"body2",color:"inherit",sx:{whiteSpace:"pre-line"},children:r})]}),arrow:!0,placement:"top",enterDelay:300,leaveDelay:200,children:t.jsx(c,{sx:{fontSize:"0.875rem",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",width:"100%",cursor:"help","&:hover":{backgroundColor:"action.hover",borderRadius:1,transition:"background-color 0.2s"}},children:t.jsx(d,{variant:"body2",sx:{fontSize:"inherit",color:"text.secondary",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n(r,50)})})}):r&&"-"!==r?t.jsx(l,{title:r,arrow:!0,placement:"top",enterDelay:500,children:t.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",width:"100%",cursor:"help","&:hover":{backgroundColor:"action.hover",borderRadius:1,transition:"background-color 0.2s"}},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n(r,60)})})}):t.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",width:"100%"},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary"},children:r||"-"})})}},{field:"quantity_in",headerName:"EntrÃ©e",flex:.7,align:"right",headerAlign:"right",renderCell:e=>{if(null===e.value||void 0===e.value||""===e.value)return"";const r=e.row.unit_symbol||"";return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",color:"success.main",fontWeight:"medium"},children:["+",e.value," ",r]})}},{field:"quantity_out",headerName:"Sortie",flex:.7,align:"right",headerAlign:"right",renderCell:e=>{if(null===e.value||void 0===e.value||""===e.value)return"";const r=e.row.unit_symbol||"";return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",color:"error.main",fontWeight:"medium"},children:["-",e.value," ",r]})}},{field:"balance",headerName:"Solde",flex:.7,align:"right",headerAlign:"right",renderCell:e=>{if(null===e.value||void 0===e.value||""===e.value)return"";const r=parseFloat(e.value)>=0;return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",color:r?"text.primary":"error.main",fontWeight:"bold",backgroundColor:r?"transparent":"error.light",px:r?0:1,py:r?0:.5,borderRadius:r?0:1},children:[parseFloat(e.value).toLocaleString("fr-FR")," FG"]})}}],pagination:!0,paginationModel:{pageSize:O,page:N},onPaginationModelChange:e=>{D(e.page),P(e.pageSize)},pageSizeOptions:[5,10,25],checkboxSelection:!1,disableRowSelectionOnClick:!0,sx:{"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader:focus":{outline:"none"},boxShadow:"0 4px 20px rgba(0,0,0,0.05)",border:"none",borderRadius:2,"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.02)",borderRadius:"8px 8px 0 0"}}})})]})})()}),t.jsxs(re,{open:ue,onClose:()=>{qt(),pe(!1)},maxWidth:"sm",fullWidth:!0,children:[t.jsx(ne,{children:"Scanner un Produit"}),t.jsxs(ie,{children:[t.jsx(c,{sx:{mb:2},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Positionnez le code QR dans la vue de la camÃ©ra pour le scanner."})}),t.jsx(c,{ref:Ie,id:"scanner-container",sx:{width:"100%",height:300,mb:2,border:"1px solid #ddd",borderRadius:1,overflow:"hidden",position:"relative","& video":{objectFit:"cover"}}}),ge&&t.jsxs(c,{sx:{mt:2,p:2,border:"1px solid #ddd",borderRadius:1},children:[t.jsx(d,{variant:"subtitle1",children:"Produit scannÃ© :"}),t.jsx(d,{variant:"h6",children:ge.name}),t.jsxs(d,{variant:"body2",children:["RÃ©fÃ©rence : ",ge.reference]}),"lookup"!==me.operationType&&t.jsx(c,{sx:{mt:2},children:t.jsx(V,{label:"QuantitÃ©",type:"text",value:Ga(ye),onChange:e=>{const t=Va(e.target.value,ye);Ce(t),ft(qa(t,"quantity"))},fullWidth:!0,size:"small",error:!!mt,helperText:mt||"QuantitÃ© pour l'opÃ©ration"})}),"receive"===me.operationType&&t.jsx(M,{variant:"contained",color:"primary",sx:{mt:2},fullWidth:!0,onClick:()=>Ht(ge),children:"Ajouter Ã  l'approvisionnement"}),"transfer"===me.operationType&&t.jsx(M,{variant:"contained",color:"primary",sx:{mt:2},fullWidth:!0,onClick:()=>Ht(ge),children:"Ajouter au transfert"}),"count"===me.operationType&&t.jsx(M,{variant:"contained",color:"primary",sx:{mt:2},fullWidth:!0,onClick:()=>Ht(ge),children:"Ajouter Ã  l'inventaire"})]})]}),t.jsx(se,{children:t.jsx(M,{onClick:()=>{qt(),pe(!1)},children:"Fermer"})})]}),t.jsxs(re,{open:Q,onClose:Ut,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:"background.paper"}},children:[t.jsx(ne,{sx:{backgroundColor:"error.main",color:"#fff",fontWeight:"bold"},children:"Confirmation de suppression"}),t.jsxs(ie,{sx:{p:3,mt:2,backgroundColor:"background.paper"},children:[t.jsxs(Ze,{color:"text.primary",sx:{mb:2},children:["supply"===(null==ee?void 0:ee.type)&&t.jsxs(t.Fragment,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer l'approvisionnement ",t.jsx("strong",{children:ee.name||`#${ee.id}`})," ?"]}),"transfer"===(null==ee?void 0:ee.type)&&t.jsxs(t.Fragment,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer le transfert ",t.jsx("strong",{children:ee.name||`#${ee.id}`})," ?"]}),"inventory"===(null==ee?void 0:ee.type)&&t.jsxs(t.Fragment,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer l'inventaire ",t.jsx("strong",{children:ee.name||`#${ee.id}`})," ?"]})]}),t.jsx(U,{severity:"warning",sx:{mb:2},children:"âš ï¸ Cette action supprimera dÃ©finitivement cet Ã©lÃ©ment et ses donnÃ©es associÃ©es."}),t.jsx(U,{severity:"error",children:"Cette action est irrÃ©versible."})]}),t.jsxs(se,{sx:{p:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(M,{onClick:Ut,disabled:ce,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(M,{variant:"contained",color:"error",onClick:async()=>{if(ee)try{switch(de(!0),ee.type){case"supply":{await is(ee.id);const e=await $i();a(e);break}case"transfer":{await ss(ee.id);const e=await Ki();u(e);break}case"inventory":{await as(ee.id);const e=await ts();p(e);break}}B({open:!0,message:"Item deleted successfully",severity:"success"}),J(!1),te(null)}catch(e){console.error("Error deleting item:",e);const t=e instanceof Error?e.message:"Unknown error";B({open:!0,message:`Failed to delete item: ${t}`,severity:"error"})}finally{de(!1)}},disabled:ce,startIcon:ce?t.jsx(f,{size:20,color:"inherit"}):t.jsx(we,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:ce?"Suppression...":"Supprimer"})]})]}),t.jsx(Xa,{open:F,operationType:W,editMode:G,formData:Z,products:w,zones:x,suppliers:v,loading:A,quantityError:gt,priceError:yt,onClose:Pt,onSubmit:async()=>{switch(W){case"supply":if(!(Z.supplier?0!==Z.items.length||(B({open:!0,message:"Veuillez ajouter au moins un produit",severity:"error"}),0):(B({open:!0,message:"Veuillez sÃ©lectionner un fournisseur",severity:"error"}),0)))return;break;case"transfer":if(!(Z.sourceZone?Z.targetZone?Z.sourceZone===Z.targetZone?(B({open:!0,message:"Les emplacements source et cible doivent Ãªtre diffÃ©rents",severity:"error"}),0):0!==Z.items.length||(B({open:!0,message:"Veuillez ajouter au moins un produit",severity:"error"}),0):(B({open:!0,message:"Veuillez sÃ©lectionner un emplacement cible",severity:"error"}),0):(B({open:!0,message:"Veuillez sÃ©lectionner un emplacement source",severity:"error"}),0)))return;break;case"inventory":if(!(Z.inventoryZone?0!==Z.items.length||(B({open:!0,message:"Veuillez ajouter au moins un produit",severity:"error"}),0):(B({open:!0,message:"Veuillez sÃ©lectionner un emplacement",severity:"error"}),0)))return}try{if(S(!0),"supply"===W){const e={supplier:Z.supplier,zone:Z.zone,items:Z.items.map((e=>({product:e.product,quantity:e.quantity,unit_price:e.unit_price,total_price:e.total_price}))),status:tr(Z.status)};if($&&"supplier"in $){const t={...$,...e,supplier:""===e.supplier?$.supplier:e.supplier,zone:""===e.zone?$.zone:e.zone};await Yi($.id,t);const r=await $i();a(r),B({open:!0,message:"Approvisionnement mis Ã  jour avec succÃ¨s",severity:"success"})}else{if(""===e.supplier||""===e.zone)throw new Error("Veuillez sÃ©lectionner un fournisseur et une zone");const t=(new Date).toISOString().split("T")[0],r={...e,supplier:e.supplier,zone:e.zone,date:t};await qi(r);const n=await $i();a(n),B({open:!0,message:"Approvisionnement crÃ©Ã© avec succÃ¨s",severity:"success"})}await Mt()}else if("transfer"===W){const e={from_zone:Z.sourceZone,to_zone:Z.targetZone,items:Z.items,status:rr(Z.status)};if($&&"from_zone"in $){const t=await Ji($.id,{...$,...e,from_zone:e.from_zone,to_zone:e.to_zone});u(o.map((e=>e.id===$.id?t:e))),B({open:!0,message:"Transfert mis Ã  jour avec succÃ¨s",severity:"success"})}else{if(""===e.from_zone||""===e.to_zone)throw new Error("Veuillez sÃ©lectionner les zones source et destination");const t=(new Date).toISOString().split("T")[0],r={...e,from_zone:e.from_zone,to_zone:e.to_zone,date:t};await Zi(r);const n=await Ki();u(n),B({open:!0,message:"Transfert crÃ©Ã© avec succÃ¨s",severity:"success"})}await Mt()}else if("inventory"===W)if($&&"zone"in $){const e={id:$.id,reference:$.reference,date:$.date,zone:Z.inventoryZone,status:nr(Z.status),items:Z.items.map((e=>({product:e.product,actual_quantity:e.quantity,expected_quantity:0,difference:0})))},t=await ns($.id,e);p(h.map((e=>e.id===$.id?t:e))),B({open:!0,message:"Inventaire mis Ã  jour avec succÃ¨s",severity:"success"})}else{const e=(new Date).toISOString().split("T")[0],t={zone:Z.inventoryZone,date:e,status:nr(Z.status),items:Z.items.map((e=>({product:e.product,actual_quantity:e.quantity,expected_quantity:0,difference:0})))};await es(t);const r=await ts();p(r),B({open:!0,message:"Inventaire crÃ©Ã© avec succÃ¨s",severity:"success"})}Pt()}catch(e){console.error("Error submitting:",e),B({open:!0,message:`Erreur: ${e.message||"Une erreur est survenue"}`,severity:"error"})}finally{S(!1)}},onFormDataChange:e=>{K((t=>({...t,...e})))},onAddItem:()=>{if(!Z.currentProduct||(Z.currentQuantity??0)<=0||(Z.currentUnitPrice??0)<0)return void B({open:!0,message:"Veuillez sÃ©lectionner un produit, entrer une quantitÃ© valide (> 0) et un prix unitaire valide (>= 0).",severity:"warning"});const e=Number(Z.currentQuantity??0),t=Number(Z.currentUnitPrice??0),r=e*t,n={product:Z.currentProduct.id,quantity:e,unit_price:t,total_price:r},i=Z.items.findIndex((e=>e.product===Z.currentProduct.id)),s=[...Z.items];if(i>=0){const r=s[i],n=t,a=Number(r.quantity??0)+e,o=a*n;s[i]={...r,quantity:a,unit_price:n,total_price:o},B({open:!0,message:`QuantitÃ© de ${Z.currentProduct.name} mise Ã  jour: ${a}`,severity:"info"})}else s.push(n);K((e=>({...e,items:s,currentProduct:null,currentQuantity:1,currentUnitPrice:0}))),xt(""),wt("")},onRemoveItem:e=>{const t=[...Z.items];t.splice(e,1),K((e=>({...e,items:t})))},onOpenScanner:()=>{let e,t,r="lookup";switch(W){case"supply":r="receive",e=Z.zone;break;case"transfer":r="transfer",t=Z.sourceZone,e=Z.targetZone;break;case"inventory":r="count",e=Z.inventoryZone}$t({operationType:r,targetZone:e,sourceZone:t})},getProductName:Qt}),t.jsx(ze,{open:k.open,autoHideDuration:6e3,onClose:ar,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(U,{onClose:ar,severity:k.severity,sx:{width:"100%"},children:k.message})})]})})},eu=()=>t.jsx(Ht,{children:t.jsxs(hi,{children:[t.jsx(R,{}),t.jsx(Ct,{children:t.jsxs(_t,{children:[t.jsx(Et,{path:"/login",element:t.jsx(sa,{})}),t.jsx(Et,{element:t.jsx(Kd,{}),children:t.jsxs(Et,{element:t.jsx(ia,{}),children:[t.jsx(Et,{index:!0,element:t.jsx(Za,{})}),t.jsx(Et,{path:"sales",element:t.jsx(rl,{})}),t.jsx(Et,{path:"clients",element:t.jsx(nl,{})}),t.jsx(Et,{path:"products",element:t.jsx(sl,{})}),t.jsx(Et,{path:"suppliers",element:t.jsx(ol,{})}),t.jsx(Et,{path:"production",element:t.jsx(dl,{})}),t.jsx(Et,{path:"inventory",element:t.jsx(Jd,{})}),t.jsx(Et,{path:"treasury",element:t.jsx(Ud,{})}),t.jsx(Et,{path:"users",element:t.jsx(Hd,{})}),t.jsx(Et,{path:"settings",element:t.jsx(Zd,{})}),t.jsx(Et,{path:"*",element:t.jsx(vt,{to:"/",replace:!0})})]})})]})})]})});Wt.createRoot(document.getElementById("root")).render(t.jsx(xt.StrictMode,{children:t.jsx(eu,{})}));
