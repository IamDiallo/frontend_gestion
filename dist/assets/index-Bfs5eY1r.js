import{a as e,j as t,T as r,L as n,b as i,S as s,d as a,e as o,f as l,B as c,g as d,s as u,u as h,D as p,C as m,I as f,M as g,h as x,i as y,k as w,l as b,m as v,n as C,o as _,p as S,A as E,G as A,q as I,r as j,t as T,v as D,w as R,x as N,y as P,z as O,E as k,F as M,H as F,J as B,K as L,N as z,O as U,Q as W,R as V,U as H,V as G,W as q,X,Y as $,_ as Z,Z as Y,$ as Q,a0 as K,a1 as J,a2 as ee,a3 as te,a4 as re,a5 as ne,a6 as ie,a7 as se,a8 as ae,a9 as oe,aa as le,ab as ce,ac as de,ad as ue,ae as he,af as pe,ag as me,ah as fe,ai as ge,aj as xe,ak as ye,al as we,am as be,an as ve,ao as Ce,ap as _e,aq as Se,ar as Ee,as as Ae,at as Ie,au as je,av as Te,aw as De,ax as Re,ay as Ne,az as Pe,aA as Oe,aB as ke,aC as Me,aD as Fe,aE as Be,aF as Le,aG as ze,aH as Ue,aI as We,aJ as Ve,aK as He,aL as Ge,aM as qe,aN as Xe,aO as $e,aP as Ze,aQ as Ye,aR as Qe,aS as Ke,aT as Je,aU as et,aV as tt,aW as rt,aX as nt,aY as it,aZ as st,a_ as at,a$ as ot,b0 as lt,b1 as ct,b2 as dt,b3 as ut,b4 as ht,b5 as pt,b6 as mt,b7 as ft,b8 as gt,b9 as xt,ba as yt,bb as wt,bc as bt,bd as vt,be as Ct,bf as _t,bg as St,bh as Et,bi as At}from"./mui-DUla8TdF.js";import{d as It,r as jt,u as Tt,N as Dt,f as Rt,O as Nt,b as Pt,a as Ot,e as kt,g as Mt,h as Ft,i as Bt,B as Lt,j as zt,k as Ut}from"./vendor-BWayaJCt.js";import{R as Wt,L as Vt,C as Ht,X as Gt,Y as qt,T as Xt,a as $t,b as Zt,P as Yt,c as Qt,d as Kt,B as Jt,e as er,A as tr,f as rr}from"./charts-BkBvh4sW.js";function nr(e,t){for(var r=0;r<t.length;r++){const n=t[r];if("string"!=typeof n&&!Array.isArray(n))for(const t in n)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ir={},sr=It;ir.createRoot=sr.createRoot,ir.hydrateRoot=sr.hydrateRoot;const ar=jt.createContext({themeMode:"light",toggleColorMode:()=>{},darkMode:!1,theme:e()}),or=({children:n})=>{const i=localStorage.getItem("theme-mode"),[s,a]=jt.useState(i||"light"),o="dark"===s,l=jt.useMemo((()=>{return e({palette:{mode:t=o?"dark":"light",..."light"===t?{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"},background:{default:"#f5f5f5",paper:"#ffffff"},text:{primary:"#212121",secondary:"#757575"}}:{primary:{main:"#90caf9",light:"#e3f2fd",dark:"#42a5f5"},secondary:{main:"#ce93d8",light:"#f3e5f5",dark:"#ab47bc"},background:{default:"#121212",paper:"#1e1e1e"},text:{primary:"#e0e0e0",secondary:"#9e9e9e"}}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700},h2:{fontWeight:600},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:500},h6:{fontWeight:500},button:{fontWeight:600,textTransform:"none"}},shape:{borderRadius:8},components:{MuiButton:{styleOverrides:{root:{fontWeight:600,borderRadius:8,padding:"8px 16px",boxShadow:"light"===t?"0 4px 6px rgba(0,0,0,0.08)":"0 4px 6px rgba(0,0,0,0.25)"}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"light"===t?"0 2px 10px rgba(0,0,0,0.05)":"0 2px 10px rgba(0,0,0,0.3)"}}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}}}});var t}),[o]);jt.useEffect((()=>{localStorage.setItem("theme-mode",s)}),[s]);const c={themeMode:s,toggleColorMode:()=>{a((e=>"light"===e?"dark":"light"))},darkMode:o,theme:l};return t.jsx(ar.Provider,{value:c,children:t.jsx(r,{theme:l,children:n})})};function lr(e,t){return function(){return e.apply(t,arguments)}}const{toString:cr}=Object.prototype,{getPrototypeOf:dr}=Object,ur=(e=>t=>{const r=cr.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),hr=e=>(e=e.toLowerCase(),t=>ur(t)===e),pr=e=>t=>typeof t===e,{isArray:mr}=Array,fr=pr("undefined");const gr=hr("ArrayBuffer");const xr=pr("string"),yr=pr("function"),wr=pr("number"),br=e=>null!==e&&"object"==typeof e,vr=e=>{if("object"!==ur(e))return!1;const t=dr(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Cr=hr("Date"),_r=hr("File"),Sr=hr("Blob"),Er=hr("FileList"),Ar=hr("URLSearchParams"),[Ir,jr,Tr,Dr]=["ReadableStream","Request","Response","Headers"].map(hr);function Rr(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),mr(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(n=0;n<s;n++)a=i[n],t.call(null,e[a],a,e)}}function Nr(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Pr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Or=e=>!fr(e)&&e!==Pr;const kr=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&dr(Uint8Array)),Mr=hr("HTMLFormElement"),Fr=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Br=hr("RegExp"),Lr=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Rr(r,((r,i)=>{let s;!1!==(s=t(r,i,e))&&(n[i]=s||r)})),Object.defineProperties(e,n)};const zr=hr("AsyncFunction"),Ur=(Wr="function"==typeof setImmediate,Vr=yr(Pr.postMessage),Wr?setImmediate:Vr?(Hr=`axios@${Math.random()}`,Gr=[],Pr.addEventListener("message",(({source:e,data:t})=>{e===Pr&&t===Hr&&Gr.length&&Gr.shift()()}),!1),e=>{Gr.push(e),Pr.postMessage(Hr,"*")}):e=>setTimeout(e));var Wr,Vr,Hr,Gr;const qr="undefined"!=typeof queueMicrotask?queueMicrotask.bind(Pr):"undefined"!=typeof process&&process.nextTick||Ur,Xr={isArray:mr,isArrayBuffer:gr,isBuffer:function(e){return null!==e&&!fr(e)&&null!==e.constructor&&!fr(e.constructor)&&yr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||yr(e.append)&&("formdata"===(t=ur(e))||"object"===t&&yr(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&gr(e.buffer),t},isString:xr,isNumber:wr,isBoolean:e=>!0===e||!1===e,isObject:br,isPlainObject:vr,isReadableStream:Ir,isRequest:jr,isResponse:Tr,isHeaders:Dr,isUndefined:fr,isDate:Cr,isFile:_r,isBlob:Sr,isRegExp:Br,isFunction:yr,isStream:e=>br(e)&&yr(e.pipe),isURLSearchParams:Ar,isTypedArray:kr,isFileList:Er,forEach:Rr,merge:function e(){const{caseless:t}=Or(this)&&this||{},r={},n=(n,i)=>{const s=t&&Nr(r,i)||i;vr(r[s])&&vr(n)?r[s]=e(r[s],n):vr(n)?r[s]=e({},n):mr(n)?r[s]=n.slice():r[s]=n};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Rr(arguments[i],n);return r},extend:(e,t,r,{allOwnKeys:n}={})=>(Rr(t,((t,n)=>{r&&yr(t)?e[n]=lr(t,r):e[n]=t}),{allOwnKeys:n}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,a;const o={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],n&&!n(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==r&&dr(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:ur,kindOfTest:hr,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(mr(e))return e;let t=e.length;if(!wr(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:Mr,hasOwnProperty:Fr,hasOwnProp:Fr,reduceDescriptors:Lr,freezeMethods:e=>{Lr(e,((t,r)=>{if(yr(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];yr(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach((e=>{r[e]=!0}))};return mr(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Nr,global:Pr,isContextDefined:Or,isSpecCompliantForm:function(e){return!!(e&&yr(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(br(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=mr(e)?[]:{};return Rr(e,((e,t)=>{const s=r(e,n+1);!fr(s)&&(i[t]=s)})),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:zr,isThenable:e=>e&&(br(e)||yr(e))&&yr(e.then)&&yr(e.catch),setImmediate:Ur,asap:qr};function $r(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Xr.inherits($r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xr.toJSONObject(this.config),code:this.code,status:this.status}}});const Zr=$r.prototype,Yr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Yr[e]={value:e}})),Object.defineProperties($r,Yr),Object.defineProperty(Zr,"isAxiosError",{value:!0}),$r.from=(e,t,r,n,i,s)=>{const a=Object.create(Zr);return Xr.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),$r.call(a,e.message,t,r,n,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};function Qr(e){return Xr.isPlainObject(e)||Xr.isArray(e)}function Kr(e){return Xr.endsWith(e,"[]")?e.slice(0,-2):e}function Jr(e,t,r){return e?e.concat(t).map((function(e,t){return e=Kr(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}const en=Xr.toFlatObject(Xr,{},null,(function(e){return/^is[A-Z]/.test(e)}));function tn(e,t,r){if(!Xr.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=Xr.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Xr.isUndefined(t[e])}))).metaTokens,i=r.visitor||c,s=r.dots,a=r.indexes,o=(r.Blob||"undefined"!=typeof Blob&&Blob)&&Xr.isSpecCompliantForm(t);if(!Xr.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Xr.isDate(e))return e.toISOString();if(!o&&Xr.isBlob(e))throw new $r("Blob is not supported. Use a Buffer instead.");return Xr.isArrayBuffer(e)||Xr.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,i){let o=e;if(e&&!i&&"object"==typeof e)if(Xr.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(Xr.isArray(e)&&function(e){return Xr.isArray(e)&&!e.some(Qr)}(e)||(Xr.isFileList(e)||Xr.endsWith(r,"[]"))&&(o=Xr.toArray(e)))return r=Kr(r),o.forEach((function(e,n){!Xr.isUndefined(e)&&null!==e&&t.append(!0===a?Jr([r],n,s):null===a?r:r+"[]",l(e))})),!1;return!!Qr(e)||(t.append(Jr(i,r,s),l(e)),!1)}const d=[],u=Object.assign(en,{defaultVisitor:c,convertValue:l,isVisitable:Qr});if(!Xr.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!Xr.isUndefined(r)){if(-1!==d.indexOf(r))throw Error("Circular reference detected in "+n.join("."));d.push(r),Xr.forEach(r,(function(r,s){!0===(!(Xr.isUndefined(r)||null===r)&&i.call(t,r,Xr.isString(s)?s.trim():s,n,u))&&e(r,n?n.concat(s):[s])})),d.pop()}}(e),t}function rn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function nn(e,t){this._pairs=[],e&&tn(e,this,t)}const sn=nn.prototype;function an(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function on(e,t,r){if(!t)return e;const n=r&&r.encode||an;Xr.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let s;if(s=i?i(t,r):Xr.isURLSearchParams(t)?t.toString():new nn(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}sn.append=function(e,t){this._pairs.push([e,t])},sn.toString=function(e){const t=e?function(t){return e.call(this,t,rn)}:rn;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class ln{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Xr.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}const cn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},dn={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:nn,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},un="undefined"!=typeof window&&"undefined"!=typeof document,hn="object"==typeof navigator&&navigator||void 0,pn=un&&(!hn||["ReactNative","NativeScript","NS"].indexOf(hn.product)<0),mn="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,fn=un&&window.location.href||"http://localhost",gn={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:un,hasStandardBrowserEnv:pn,hasStandardBrowserWebWorkerEnv:mn,navigator:hn,origin:fn},Symbol.toStringTag,{value:"Module"})),...dn};function xn(e){function t(e,r,n,i){let s=e[i++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=i>=e.length;if(s=!s&&Xr.isArray(n)?n.length:s,o)return Xr.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!a;n[s]&&Xr.isObject(n[s])||(n[s]=[]);return t(e,r,n[s],i)&&Xr.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}(n[s])),!a}if(Xr.isFormData(e)&&Xr.isFunction(e.entries)){const r={};return Xr.forEachEntry(e,((e,n)=>{t(function(e){return Xr.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,r,0)})),r}return null}const yn={transitional:cn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=Xr.isObject(e);i&&Xr.isHTMLForm(e)&&(e=new FormData(e));if(Xr.isFormData(e))return n?JSON.stringify(xn(e)):e;if(Xr.isArrayBuffer(e)||Xr.isBuffer(e)||Xr.isStream(e)||Xr.isFile(e)||Xr.isBlob(e)||Xr.isReadableStream(e))return e;if(Xr.isArrayBufferView(e))return e.buffer;if(Xr.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return tn(e,new gn.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return gn.isNode&&Xr.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=Xr.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return tn(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(Xr.isString(e))try{return(t||JSON.parse)(e),Xr.trim(e)}catch(n){if("SyntaxError"!==n.name)throw n}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||yn.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Xr.isResponse(e)||Xr.isReadableStream(e))return e;if(e&&Xr.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(i){if(r){if("SyntaxError"===i.name)throw $r.from(i,$r.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:gn.classes.FormData,Blob:gn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xr.forEach(["delete","get","head","post","put","patch"],(e=>{yn.headers[e]={}}));const wn=Xr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bn=Symbol("internals");function vn(e){return e&&String(e).trim().toLowerCase()}function Cn(e){return!1===e||null==e?e:Xr.isArray(e)?e.map(Cn):String(e)}function _n(e,t,r,n,i){return Xr.isFunction(n)?n.call(this,t,r):(i&&(t=r),Xr.isString(t)?Xr.isString(n)?-1!==t.indexOf(n):Xr.isRegExp(n)?n.test(t):void 0:void 0)}let Sn=class{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=vn(t);if(!i)throw new Error("header name must be a non-empty string");const s=Xr.findKey(n,i);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=Cn(e))}const s=(e,t)=>Xr.forEach(e,((e,r)=>i(e,r,t)));if(Xr.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(Xr.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!r||t[r]&&wn[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)})),t})(e),t);else if(Xr.isHeaders(e))for(const[a,o]of e.entries())i(o,a,r);else null!=e&&i(t,e,r);return this}get(e,t){if(e=vn(e)){const r=Xr.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(Xr.isFunction(t))return t.call(this,e,r);if(Xr.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=vn(e)){const r=Xr.findKey(this,e);return!(!r||void 0===this[r]||t&&!_n(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=vn(e)){const i=Xr.findKey(r,e);!i||t&&!_n(0,r[i],i,t)||(delete r[i],n=!0)}}return Xr.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];e&&!_n(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return Xr.forEach(this,((n,i)=>{const s=Xr.findKey(r,i);if(s)return t[s]=Cn(n),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(i):String(i).trim();a!==i&&delete t[i],t[a]=Cn(n),r[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Xr.forEach(this,((r,n)=>{null!=r&&!1!==r&&(t[n]=e&&Xr.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=(this[bn]=this[bn]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=vn(e);t[n]||(!function(e,t){const r=Xr.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return Xr.isArray(e)?e.forEach(n):n(e),this}};function En(e,t){const r=this||yn,n=t||r,i=Sn.from(n.headers);let s=n.data;return Xr.forEach(e,(function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function An(e){return!(!e||!e.__CANCEL__)}function In(e,t,r){$r.call(this,null==e?"canceled":e,$r.ERR_CANCELED,t,r),this.name="CanceledError"}function jn(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new $r("Request failed with status code "+r.status,[$r.ERR_BAD_REQUEST,$r.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}Sn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Xr.reduceDescriptors(Sn.prototype,(({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}})),Xr.freezeMethods(Sn),Xr.inherits(In,$r,{__CANCEL__:!0});const Tn=(e,t,r=3)=>{let n=0;const i=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=n[a];i||(i=l),r[s]=o,n[s]=l;let d=a,u=0;for(;d!==s;)u+=r[d++],d%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let r,n,i=0,s=1e3/t;const a=(t,s=Date.now())=>{i=s,r=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),o=t-i;o>=s?a(e,t):(r=e,n||(n=setTimeout((()=>{n=null,a(r)}),s-o)))},()=>r&&a(r)]}((r=>{const s=r.loaded,a=r.lengthComputable?r.total:void 0,o=s-n,l=i(o);n=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:r,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),r)},Dn=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Rn=e=>(...t)=>Xr.asap((()=>e(...t))),Nn=gn.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,gn.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(gn.origin),gn.navigator&&/(msie|trident)/i.test(gn.navigator.userAgent)):()=>!0,Pn=gn.hasStandardBrowserEnv?{write(e,t,r,n,i,s){const a=[e+"="+encodeURIComponent(t)];Xr.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),Xr.isString(n)&&a.push("path="+n),Xr.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function On(e,t,r){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&n||0==r?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const kn=e=>e instanceof Sn?{...e}:e;function Mn(e,t){t=t||{};const r={};function n(e,t,r,n){return Xr.isPlainObject(e)&&Xr.isPlainObject(t)?Xr.merge.call({caseless:n},e,t):Xr.isPlainObject(t)?Xr.merge({},t):Xr.isArray(t)?t.slice():t}function i(e,t,r,i){return Xr.isUndefined(t)?Xr.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function s(e,t){if(!Xr.isUndefined(t))return n(void 0,t)}function a(e,t){return Xr.isUndefined(t)?Xr.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,r)=>i(kn(e),kn(t),0,!0)};return Xr.forEach(Object.keys(Object.assign({},e,t)),(function(n){const s=l[n]||i,a=s(e[n],t[n],n);Xr.isUndefined(a)&&s!==o||(r[n]=a)})),r}const Fn=e=>{const t=Mn({},e);let r,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:l}=t;if(t.headers=o=Sn.from(o),t.url=on(On(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Xr.isFormData(n))if(gn.hasStandardBrowserEnv||gn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(r=o.getContentType())){const[e,...t]=r?r.split(";").map((e=>e.trim())).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(gn.hasStandardBrowserEnv&&(i&&Xr.isFunction(i)&&(i=i(t)),i||!1!==i&&Nn(t.url))){const e=s&&a&&Pn.read(a);e&&o.set(s,e)}return t},Bn="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){const n=Fn(e);let i=n.data;const s=Sn.from(n.headers).normalize();let a,o,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let f=new XMLHttpRequest;function g(){if(!f)return;const n=Sn.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());jn((function(e){t(e),m()}),(function(e){r(e),m()}),{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f}),f=null}f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(r(new $r("Request aborted",$r.ECONNABORTED,e,f)),f=null)},f.onerror=function(){r(new $r("Network Error",$r.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||cn;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new $r(t,i.clarifyTimeoutError?$r.ETIMEDOUT:$r.ECONNABORTED,e,f)),f=null},void 0===i&&s.setContentType(null),"setRequestHeader"in f&&Xr.forEach(s.toJSON(),(function(e,t){f.setRequestHeader(t,e)})),Xr.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),u&&"json"!==u&&(f.responseType=n.responseType),p&&([l,d]=Tn(p,!0),f.addEventListener("progress",l)),h&&f.upload&&([o,c]=Tn(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{f&&(r(!t||t.type?new In(null,e,f):t),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const x=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);x&&-1===gn.protocols.indexOf(x)?r(new $r("Unsupported protocol "+x+":",$r.ERR_BAD_REQUEST,e)):f.send(i||null)}))},Ln=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const i=function(e){if(!r){r=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof $r?t:new In(t instanceof Error?t.message:t))}};let s=t&&setTimeout((()=>{s=null,i(new $r(`timeout ${t} of ms exceeded`,$r.ETIMEDOUT))}),t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:o}=n;return o.unsubscribe=()=>Xr.asap(a),o}},zn=function*(e,t){let r=e.byteLength;if(r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},Un=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},Wn=(e,t,r,n)=>{const i=async function*(e,t){for await(const r of Un(e))yield*zn(r,t)}(e,t);let s,a=0,o=e=>{s||(s=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return o(),void e.close();let s=n.byteLength;if(r){let e=a+=s;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw o(t),t}},cancel:e=>(o(e),i.return())},{highWaterMark:2})},Vn="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Hn=Vn&&"function"==typeof ReadableStream,Gn=Vn&&("function"==typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),qn=(e,...t)=>{try{return!!e(...t)}catch(r){return!1}},Xn=Hn&&qn((()=>{let e=!1;const t=new Request(gn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),$n=Hn&&qn((()=>Xr.isReadableStream(new Response("").body))),Zn={stream:$n&&(e=>e.body)};var Yn;Vn&&(Yn=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Zn[e]&&(Zn[e]=Xr.isFunction(Yn[e])?t=>t[e]():(t,r)=>{throw new $r(`Response type '${e}' is not supported`,$r.ERR_NOT_SUPPORT,r)})})));const Qn=async(e,t)=>{const r=Xr.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Xr.isBlob(e))return e.size;if(Xr.isSpecCompliantForm(e)){const t=new Request(gn.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Xr.isArrayBufferView(e)||Xr.isArrayBuffer(e)?e.byteLength:(Xr.isURLSearchParams(e)&&(e+=""),Xr.isString(e)?(await Gn(e)).byteLength:void 0)})(t):r},Kn={http:null,xhr:Bn,fetch:Vn&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:h}=Fn(e);c=c?(c+"").toLowerCase():"text";let p,m=Ln([i,s&&s.toAbortSignal()],a);const f=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Xn&&"get"!==r&&"head"!==r&&0!==(g=await Qn(d,n))){let e,r=new Request(t,{method:"POST",body:n,duplex:"half"});if(Xr.isFormData(n)&&(e=r.headers.get("content-type"))&&d.setContentType(e),r.body){const[e,t]=Dn(g,Tn(Rn(l)));n=Wn(r.body,65536,e,t)}}Xr.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,{...h,signal:m,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:i?u:void 0});let s=await fetch(p);const a=$n&&("stream"===c||"response"===c);if($n&&(o||a&&f)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=s[t]}));const t=Xr.toFiniteNumber(s.headers.get("content-length")),[r,n]=o&&Dn(t,Tn(Rn(o),!0))||[];s=new Response(Wn(s.body,65536,r,(()=>{n&&n(),f&&f()})),e)}c=c||"text";let x=await Zn[Xr.findKey(Zn,c)||"text"](s,e);return!a&&f&&f(),await new Promise(((t,r)=>{jn(t,r,{data:x,headers:Sn.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:p})}))}catch(x){if(f&&f(),x&&"TypeError"===x.name&&/fetch/i.test(x.message))throw Object.assign(new $r("Network Error",$r.ERR_NETWORK,e,p),{cause:x.cause||x});throw $r.from(x,x&&x.code,e,p)}})};Xr.forEach(Kn,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(r){}Object.defineProperty(e,"adapterName",{value:t})}}));const Jn=e=>`- ${e}`,ei=e=>Xr.isFunction(e)||null===e||!1===e,ti=e=>{e=Xr.isArray(e)?e:[e];const{length:t}=e;let r,n;const i={};for(let s=0;s<t;s++){let t;if(r=e[s],n=r,!ei(r)&&(n=Kn[(t=String(r)).toLowerCase()],void 0===n))throw new $r(`Unknown adapter '${t}'`);if(n)break;i[t||"#"+s]=n}if(!n){const e=Object.entries(i).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new $r("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Jn).join("\n"):" "+Jn(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function ri(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new In(null,e)}function ni(e){ri(e),e.headers=Sn.from(e.headers),e.data=En.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ti(e.adapter||yn.adapter)(e).then((function(t){return ri(e),t.data=En.call(e,e.transformResponse,t),t.headers=Sn.from(t.headers),t}),(function(t){return An(t)||(ri(e),t&&t.response&&(t.response.data=En.call(e,e.transformResponse,t.response),t.response.headers=Sn.from(t.response.headers))),Promise.reject(t)}))}const ii="1.8.3",si={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{si[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const ai={};si.transitional=function(e,t,r){function n(e,t){return"[Axios v1.8.3] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new $r(n(i," has been removed"+(t?" in "+t:"")),$r.ERR_DEPRECATED);return t&&!ai[i]&&(ai[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}},si.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};const oi={assertOptions:function(e,t,r){if("object"!=typeof e)throw new $r("options must be an object",$r.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const t=e[s],r=void 0===t||a(t,s,e);if(!0!==r)throw new $r("option "+s+" must be "+r,$r.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new $r("Unknown option "+s,$r.ERR_BAD_OPTION)}},validators:si},li=oi.validators;let ci=class{constructor(e){this.defaults=e,this.interceptors={request:new ln,response:new ln}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(n){}}throw r}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Mn(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;void 0!==r&&oi.assertOptions(r,{silentJSONParsing:li.transitional(li.boolean),forcedJSONParsing:li.transitional(li.boolean),clarifyTimeoutError:li.transitional(li.boolean)},!1),null!=n&&(Xr.isFunction(n)?t.paramsSerializer={serialize:n}:oi.assertOptions(n,{encode:li.function,serialize:li.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),oi.assertOptions(t,{baseUrl:li.spelling("baseURL"),withXsrfToken:li.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Xr.merge(i.common,i[t.method]);i&&Xr.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=Sn.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let d,u=0;if(!o){const e=[ni.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=a.length;let h=t;for(u=0;u<d;){const e=a[u++],t=a[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{c=ni.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return on(On((e=Mn(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Xr.forEach(["delete","get","head","options"],(function(e){ci.prototype[e]=function(t,r){return this.request(Mn(r||{},{method:e,url:t,data:(r||{}).data}))}})),Xr.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(Mn(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}ci.prototype[e]=t(),ci.prototype[e+"Form"]=t(!0)}));const di={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(di).forEach((([e,t])=>{di[t]=e}));const ui=function e(t){const r=new ci(t),n=lr(ci.prototype.request,r);return Xr.extend(n,ci.prototype,r,{allOwnKeys:!0}),Xr.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Mn(t,r))},n}(yn);ui.Axios=ci,ui.CanceledError=In,ui.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e,n,i){r.reason||(r.reason=new In(e,n,i),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e((function(e){t=e})),cancel:t}}},ui.isCancel=An,ui.VERSION=ii,ui.toFormData=tn,ui.AxiosError=$r,ui.Cancel=ui.CanceledError,ui.all=function(e){return Promise.all(e)},ui.spread=function(e){return function(t){return e.apply(null,t)}},ui.isAxiosError=function(e){return Xr.isObject(e)&&!0===e.isAxiosError},ui.mergeConfig=Mn,ui.AxiosHeaders=Sn,ui.formToJSON=e=>xn(Xr.isHTMLForm(e)?new FormData(e):e),ui.getAdapter=ti,ui.HttpStatusCode=di,ui.default=ui;const{Axios:hi,AxiosError:pi,CanceledError:mi,isCancel:fi,CancelToken:gi,VERSION:xi,all:yi,Cancel:wi,isAxiosError:bi,spread:vi,toFormData:Ci,AxiosHeaders:_i,HttpStatusCode:Si,formToJSON:Ei,getAdapter:Ai,mergeConfig:Ii}=ui,ji=jt.createContext({userPermissions:[],isAdmin:!1,userRole:null,userGroups:[],loading:!0,error:null,hasPermission:()=>!1,refreshPermissions:async()=>{}}),Ti=({children:e})=>{const[r,n]=jt.useState([]),[i,s]=jt.useState(!1),[a,o]=jt.useState(null),[l,c]=jt.useState([]),[d,u]=jt.useState(!0),[h,p]=jt.useState(null),m=async()=>{var e,t,r;try{u(!0),p(null);const e=localStorage.getItem("access_token");if(!e)return n([]),s(!1),o(null),c([]),void u(!1);const t=await ui.get("http://ec2-13-221-14-64.compute-1.amazonaws.com/api/core/users/user_permissions/",{headers:{Authorization:`Bearer ${e}`}}),{permissions:r=[],is_admin:i=!1,role:a=null,groups:l=[]}=t.data;n(r||[]),s(i||!1),o(a||null),c(l||[]),localStorage.setItem("user_permissions",JSON.stringify(r||[])),localStorage.setItem("is_admin",JSON.stringify(i||!1)),localStorage.setItem("user_role",a||""),localStorage.setItem("user_groups",JSON.stringify(l||[]))}catch(i){console.error("Error fetching permissions:",i);try{const i=localStorage.getItem("access_token");if(!i)throw new Error("No token available");const a=await ui.get("http://ec2-13-221-14-64.compute-1.amazonaws.com/api/core/users/me/",{headers:{Authorization:`Bearer ${i}`}});if(null==(e=a.data)?void 0:e.permissions){const e=a.data.permissions.map((e=>e.includes(".")?e.split(".")[1]:e));return n(e),s(a.data.is_superuser||!1),o((null==(t=a.data.profile_data)?void 0:t.role)||null),c(a.data.groups||[]),localStorage.setItem("user_permissions",JSON.stringify(e)),localStorage.setItem("is_admin",JSON.stringify(a.data.is_superuser||!1)),localStorage.setItem("user_role",(null==(r=a.data.profile_data)?void 0:r.role)||""),void localStorage.setItem("user_groups",JSON.stringify(a.data.groups||[]))}}catch(a){console.error("Fallback to /me endpoint also failed:",a)}const l=localStorage.getItem("user_permissions"),d=localStorage.getItem("is_admin"),u=localStorage.getItem("user_role"),h=localStorage.getItem("user_groups");l?(n(JSON.parse(l)),s("true"===d),o(u||null),c(h?JSON.parse(h):[])):p("Failed to load permissions")}finally{u(!1)}};jt.useEffect((()=>{m()}),[]);return t.jsx(ji.Provider,{value:{userPermissions:r,isAdmin:i,userRole:a,userGroups:l,loading:d,error:h,hasPermission:e=>{if(i)return!0;let t=e;e.includes(".")&&(t=e.split(".")[1]);const n=r.includes(t);return["view_sale","view_client","view_product","view_stock","view_cashreceipt","change_user"].includes(t)&&console.log("ðŸ” Permission Check:",{requested:e,checking:t,userPermissions:r.slice(0,15),hasAccess:n,isAdmin:i}),n},refreshPermissions:async()=>{await m()}},children:e})},Di=()=>jt.useContext(ji),Ri=({to:e,icon:r,text:c,requiredPermission:d,open:u,forceShow:h=!1})=>{const p=Tt(),{hasPermission:m,loading:f}=Di();if(f||h){const d=t.jsxs(n,{component:Dt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),f&&u?t.jsx(s,{variant:"text",width:"80%",height:24}):t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?d:t.jsx(l,{title:c,placement:"right",children:d})})}if(null===d){const s=t.jsxs(n,{component:Dt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?s:t.jsx(l,{title:c,placement:"right",children:s})})}if(!(!d||m(d)))return null;const g=t.jsxs(n,{component:Dt,to:e,sx:{minHeight:48,justifyContent:u?"initial":"center",px:2.5,borderRadius:"8px",mb:.5,"&.active":{bgcolor:"primary.light",color:"primary.contrastText","& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[t.jsx(i,{sx:{minWidth:0,mr:u?3:"auto",justifyContent:"center"},children:r}),t.jsx(a,{primary:c,sx:{opacity:u?1:0,"& .MuiTypography-root":{fontWeight:p.pathname===e?"bold":"normal"}}})]});return t.jsx(o,{disablePadding:!0,sx:{display:"block"},children:u?g:t.jsx(l,{title:c,placement:"right",children:g})})},Ni=({size:e="medium",variant:r="full",sx:n={}})=>{const i=e=>{switch(e){case"small":return"1.25rem";case"large":return"2.5rem";default:return"1.75rem"}},s=e=>{switch(e){case"small":return 32;case"large":return 56;default:return 40}};return t.jsxs(c,{sx:{display:"flex",alignItems:"center",...n},children:[t.jsx(c,{sx:{width:s(e),height:s(e),bgcolor:"primary.main",borderRadius:"8px",display:"flex",justifyContent:"center",alignItems:"center",color:"white",fontWeight:"bold",fontSize:i(e),mr:"full"===r?1:0},children:"G"}),"full"===r&&t.jsx(d,{variant:"h6",component:"div",sx:{fontWeight:"bold",fontSize:i(e),color:"primary.main"},children:"Gestion"})]})},Pi=u("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"}))),Oi=({open:e,onClose:r,variant:n,width:i})=>{const a=h(),{isAdmin:o,loading:l,refreshPermissions:u}=Di(),[j,T]=jt.useState(!0),[D,R]=jt.useState(null);jt.useEffect((()=>{!l&&j&&T(!1)}),[l,j]),jt.useEffect((()=>{const e=localStorage.getItem("current_user");e!==D&&(R(e),e&&u())}),[D,u]);const N=[{to:"/",icon:t.jsx(w,{}),text:"Tableau de bord",requiredPermission:null},{to:"/sales",icon:t.jsx(b,{}),text:"Ventes",requiredPermission:"view_sale"},{to:"/clients",icon:t.jsx(v,{}),text:"Clients",requiredPermission:"view_client"},{to:"/suppliers",icon:t.jsx(C,{}),text:"Fournisseurs",requiredPermission:"view_supplier"},{to:"/products",icon:t.jsx(_,{}),text:"Produits",requiredPermission:"view_product"},{to:"/production",icon:t.jsx(S,{}),text:"Production",requiredPermission:"view_production"},{to:"/inventory",icon:t.jsx(_,{}),text:"Inventaire",requiredPermission:"view_stock"},{divider:!0},{to:"/treasury",icon:t.jsx(E,{}),text:"TrÃ©sorerie",requiredPermission:"view_cashreceipt"},{divider:!0},{to:"/users",icon:t.jsx(A,{}),text:"Utilisateurs",requiredPermission:"view_user"},{to:"/settings",icon:t.jsx(I,{}),text:"ParamÃ¨tres",requiredPermission:"change_user"}];if(j&&l)return t.jsx(p,{sx:{width:i,flexShrink:0,"& .MuiDrawer-paper":{width:i,boxSizing:"border-box",backgroundColor:a.palette.background.paper}},variant:n,anchor:"left",open:e,onClose:r,children:t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",p:2},children:[t.jsx(m,{size:40}),t.jsx(d,{variant:"body2",sx:{mt:2},children:"Chargement..."})]})});return t.jsxs(p,{sx:{width:i,flexShrink:0,"& .MuiDrawer-paper":{width:i,boxSizing:"border-box",backgroundColor:a.palette.background.paper,borderRight:`1px solid ${a.palette.divider}`,boxShadow:a.shadows[1],borderRadius:0}},variant:n,anchor:"left",open:e,onClose:r,children:[t.jsxs(Pi,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2,py:1.5,borderRadius:0},children:[t.jsx(Ni,{variant:"full",size:"medium"}),t.jsx(f,{onClick:r,sx:{bgcolor:"transparent",color:a.palette.primary.main,"&:hover":{bgcolor:a.palette.action.hover}},children:t.jsx(g,{fontSize:"large"})})]}),t.jsx(x,{}),t.jsx(c,{sx:{p:1},children:t.jsx(y,{component:"nav","aria-label":"main navigation",sx:{p:.5},children:l?t.jsx(t.Fragment,{children:[1,2,3,4].map((r=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",px:2,py:1},children:[t.jsx(s,{variant:"circular",width:24,height:24,sx:{mr:e?3:0}}),e&&t.jsx(s,{variant:"text",width:120,height:24})]},`loading-${r}`)))}):N.map(((r,n)=>{if("divider"in r)return t.jsx(x,{sx:{my:1}},`divider-${n}`);const i=r;return i.adminOnly&&!o?null:t.jsx(Ri,{to:i.to,icon:i.icon,text:i.text,requiredPermission:i.requiredPermission,open:e},i.to)}))})})]})};!function(e){if("undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}(':root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}\n');var ki=e=>"number"==typeof e&&!isNaN(e),Mi=e=>"string"==typeof e,Fi=e=>"function"==typeof e,Bi=1,Li=()=>""+Bi++,zi=new Map,Ui=[],Wi=new Set,Vi=()=>zi.size>0;function Hi(e){if(Vi()){if(null==e||(e=>Mi(e)||ki(e))(e))zi.forEach((t=>{t.removeToast(e)}));else if(e&&("containerId"in e||"id"in e)){let t=zi.get(e.containerId);t?t.removeToast(e.id):zi.forEach((t=>{t.removeToast(e.id)}))}}else Ui=Ui.filter((t=>null!=e&&t.options.toastId!==e))}function Gi(e,t){(e=>jt.isValidElement(e)||Mi(e)||Fi(e)||ki(e))(e)&&(Vi()||Ui.push({content:e,options:t}),zi.forEach((r=>{r.buildToast(e,t)})))}function qi(e,t){zi.forEach((r=>{(null==t||null==t||!t.containerId||(null==t?void 0:t.containerId)===r.id)&&r.toggle(e,null==t?void 0:t.id)}))}function Xi(e){return e&&(Mi(e.toastId)||ki(e.toastId))?e.toastId:Li()}function $i(e,t){return Gi(e,t),t.toastId}function Zi(e,t){return{...t,type:t&&t.type||e,toastId:Xi(t)}}function Yi(e){return(t,r)=>$i(t,Zi(e,r))}function Qi(e,t){return $i(e,Zi("default",t))}Qi.loading=(e,t)=>$i(e,Zi("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),Qi.promise=function(e,{pending:t,error:r,success:n},i){let s;t&&(s=Mi(t)?Qi.loading(t,i):Qi.loading(t.render,{...i,...t}));let a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},o=(e,t,r)=>{if(null==t)return void Qi.dismiss(s);let n={type:e,...a,...i,data:r},o=Mi(t)?{render:t}:t;return s?Qi.update(s,{...n,...o}):Qi(o.render,{...n,...o}),r},l=Fi(e)?e():e;return l.then((e=>o("success",n,e))).catch((e=>o("error",r,e))),l},Qi.success=Yi("success"),Qi.info=Yi("info"),Qi.error=Yi("error"),Qi.warning=Yi("warning"),Qi.warn=Qi.warning,Qi.dark=(e,t)=>$i(e,Zi("default",{theme:"dark",...t})),Qi.dismiss=function(e){Hi(e)},Qi.clearWaitingQueue=(e={})=>{zi.forEach((t=>{t.props.limit&&(!e.containerId||t.id===e.containerId)&&t.clearQueue()}))},Qi.isActive=function(e,t){var r;if(t)return!(null==(r=zi.get(t))||!r.isToastActive(e));let n=!1;return zi.forEach((t=>{t.isToastActive(e)&&(n=!0)})),n},Qi.update=(e,t={})=>{let r=((e,{containerId:t})=>{var r;return null==(r=zi.get(t||1))?void 0:r.toasts.get(e)})(e,t);if(r){let{props:n,content:i}=r,s={delay:100,...n,...t,toastId:t.toastId||e,updateId:Li()};s.toastId!==e&&(s.staleId=e);let a=s.render||i;delete s.render,$i(a,s)}},Qi.done=e=>{Qi.update(e,{progress:1})},Qi.onChange=function(e){return Wi.add(e),()=>{Wi.delete(e)}},Qi.play=e=>qi(!0,e),Qi.pause=e=>qi(!1,e);const Ki=e=>{try{const t=e.split(".");if(3!==t.length)return null;const r=t[1];return JSON.parse(atob(r))}catch(t){return console.error("Error decoding token:",t),null}},Ji=e=>{const t=Ki(e);if(!t||!t.exp)return!0;const r=Math.floor(Date.now()/1e3);return t.exp<r},es=e=>{const t=(e=>{const t=Ki(e);if(!t||!t.exp)return-1;const r=Math.floor(Date.now()/1e3);return 1e3*(t.exp-r)})(e);return t>0&&t<12e4},ts="http://ec2-13-221-14-64.compute-1.amazonaws.com/api";console.log("Using API URL:",ts);const rs=ui.create({baseURL:ts,headers:{"Content-Type":"application/json"},withCredentials:!0});rs.interceptors.request.use((async e=>{var t,r;const n=localStorage.getItem("access_token");if(n){if(Ji(n)){console.log("Token is expired, attempting refresh before request");try{const r=localStorage.getItem("refresh_token");if(!r)throw new Error("No refresh token available");const n=await ui.post(`${ts}/token/refresh/`,{refresh:r});if(null==(t=n.data)?void 0:t.access){const t=n.data.access;localStorage.setItem("access_token",t),n.data.refresh&&localStorage.setItem("refresh_token",n.data.refresh);const r=Date.now()+9e5;return localStorage.setItem("token_expiration",r.toString()),e.headers.Authorization=`Bearer ${t}`,e}}catch(i){return console.error("Token refresh failed:",i),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiration"),Promise.reject(i)}}else if(es(n)){console.log("Token expiring soon, proactive refresh");try{const t=localStorage.getItem("refresh_token");if(t){const n=await ui.post(`${ts}/token/refresh/`,{refresh:t});if(null==(r=n.data)?void 0:r.access){const t=n.data.access;localStorage.setItem("access_token",t),n.data.refresh&&localStorage.setItem("refresh_token",n.data.refresh);const r=Date.now()+9e5;return localStorage.setItem("token_expiration",r.toString()),e.headers.Authorization=`Bearer ${t}`,e}}}catch(i){console.error("Proactive refresh failed:",i)}}e.headers.Authorization=`Bearer ${n}`}return e}),(e=>Promise.reject(e))),rs.interceptors.response.use((e=>e),(async e=>{var t;const r=e.config;if(401===(null==(t=e.response)?void 0:t.status)&&r&&!r._retry){r._retry=!0;try{const e=localStorage.getItem("refresh_token");if(!e)throw new Error("No refresh token available");const t=await ui.post(`${ts}/token/refresh/`,{refresh:e}),n=t.data.access;return localStorage.setItem("access_token",n),t.data.refresh&&localStorage.setItem("refresh_token",t.data.refresh),rs.defaults.headers.common.Authorization=`Bearer ${n}`,rs(r)}catch(n){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiration"),localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin"),window.location.pathname.includes("/login")||(Qi.error("Your session has expired. Please log in again.",{position:"top-center",autoClose:2e3}),setTimeout((()=>{window.location.href="/login"}),500)),Promise.reject(n)}}return Promise.reject(e)}));const ns={logRequest:(e,t,r)=>{console.log(`%cAPI Request: ${t.toUpperCase()} ${e}`,"background: #ded; color: #080; font-weight: bold"),r&&console.log("Request data:",r)},logResponse:(e,t)=>{console.log(`%cAPI Response from ${e}:`,"background: #dde; color: #008; font-weight: bold");const r=t;console.log("Status:",r.status),console.log("Data:",r.data)},logError:(e,t)=>{console.error(`%cAPI Error from ${e}:`,"background: #edd; color: #800; font-weight: bold",t);const r=t;r.response&&(console.error("Response data:",r.response.data),console.error("Response status:",r.response.status))}},is=async(e,t)=>{try{ns.logRequest("/token/","POST",{username:e,password:"***"});const n=await rs.post("/token/",{username:e,password:t});if(n.data&&n.data.access){localStorage.setItem("access_token",n.data.access),localStorage.setItem("refresh_token",n.data.refresh);const e=9e5,t=(new Date).getTime()+e;localStorage.setItem("token_expiration",t.toString());try{const e=await rs.get("/core/users/me/");return localStorage.setItem("current_user",JSON.stringify(e.data)),ns.logResponse("/token/",n),{...n.data,user:e.data}}catch(r){return console.error("Error fetching user data after login:",r),ns.logResponse("/token/",n),n.data}}return ns.logResponse("/token/",n),n.data}catch(r){throw ns.logError("/token/",r),console.error("Login error:",r),r}},ss=async()=>{try{if(!localStorage.getItem("access_token"))throw new Error("No access token found");ns.logRequest("/core/users/me/","GET");const e=await rs.get("/core/users/me/");return ns.logResponse("/core/users/me/",e),e.data}catch(e){throw ns.logError("/core/users/me/",e),console.error("Error fetching current user:",e),e}},as=240,os=u("main",{shouldForwardProp:e=>"open"!==e})((({theme:e,open:t})=>({flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:"-240px",...t&&{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}))),ls=u(j,{shouldForwardProp:e=>"open"!==e})((({theme:e,open:t})=>({transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),...t&&{width:"calc(100% - 240px)",marginLeft:"240px",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})}}))),cs=u("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"}))),ds=()=>{const e=h(),{toggleColorMode:r,darkMode:n}=jt.useContext(ar),i=T(e.breakpoints.down("md")),[s,a]=jt.useState(!i),[o,u]=jt.useState(null),p=Rt(),{userRole:m}=Di(),[g,y]=jt.useState({username:"",role:""});jt.useEffect((()=>{(async()=>{var e;try{const t=await ss();y({username:t.username||"Utilisateur",role:(null==(e=t.profile_data)?void 0:e.role)||m||""})}catch(t){console.error("Error fetching user info:",t),y({username:"Utilisateur",role:m||""})}})()}),[m]),jt.useEffect((()=>{a(!i)}),[i]);const w=()=>{u(null)};return t.jsxs(c,{sx:{display:"flex"},children:[t.jsx(D,{}),t.jsx(ls,{position:"fixed",open:s,sx:{boxShadow:"0 0 10px rgba(0,0,0,0.1)",borderRadius:"0"},children:t.jsxs(R,{children:[t.jsx(f,{color:"inherit","aria-label":"open drawer",onClick:()=>{a(!0)},edge:"start",sx:{mr:2,...s&&{display:"none"}},children:t.jsx(N,{})}),t.jsx(Ni,{variant:"full",sx:{flexGrow:1}}),t.jsx(l,{title:n?"Mode clair":"Mode sombre",children:t.jsx(f,{onClick:r,color:"inherit",children:n?t.jsx(P,{}):t.jsx(O,{})})}),t.jsx(k,{onClick:e=>{u(e.currentTarget)},color:"inherit",startIcon:t.jsx(M,{}),sx:{textTransform:"none",ml:1},children:g.username||"Utilisateur"}),t.jsxs(F,{anchorEl:o,open:Boolean(o),onClose:w,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsx(B,{disableRipple:!0,sx:{pointerEvents:"none",opacity:.7},children:t.jsx(d,{variant:"caption",children:(e=>{switch(e){case"admin":return"Administrateur";case"consultant":return"Consultant";case"supervisor":return"Superviseur";case"commercial":return"Commercial";case"cashier":return"Chef de Caisse";default:return e||"Utilisateur"}})(g.role)})}),t.jsx(x,{}),t.jsxs(B,{onClick:()=>{w(),p("/profile")},children:[t.jsx(M,{fontSize:"small",sx:{mr:1}}),"Mon profil"]}),t.jsx(x,{}),t.jsxs(B,{onClick:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),p("/login")},children:[t.jsx(L,{fontSize:"small",sx:{mr:1}}),"DÃ©connexion"]})]})]})}),t.jsx(Oi,{open:s,onClose:()=>{a(!1)},variant:i?"temporary":"persistent",width:as}),t.jsxs(os,{open:s,sx:{flexGrow:1,p:{xs:2,sm:3},marginLeft:i||s?0:"-240px",width:i?"100%":"auto",overflow:"auto"},children:[t.jsx(cs,{}),t.jsx(c,{children:t.jsx(Nt,{})})]})]})},us=()=>{const e=Rt(),r=Tt(),[n,i]=jt.useState(""),[s,a]=jt.useState(""),[o,l]=jt.useState(!1),[u,h]=jt.useState(null),[p,g]=jt.useState(!1);jt.useEffect((()=>{var t,n;const i=localStorage.getItem("access_token");if(i&&!Ji(i)){const i=(null==(n=null==(t=r.state)?void 0:t.from)?void 0:n.pathname)||"/";e(i)}else i&&Ji(i)&&(console.log("Token expired, clearing auth data"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiration"),localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin"))}),[r,e]);return t.jsx(z,{maxWidth:"sm",children:t.jsx(c,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:t.jsxs(U,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",borderRadius:2,width:"100%"},children:[t.jsx(Ni,{size:"large",sx:{mb:3}}),t.jsx(d,{component:"h2",variant:"h5",sx:{mb:3},children:"Connexion"}),u&&t.jsx(W,{severity:"error",sx:{mb:3,width:"100%"},children:u}),t.jsxs(c,{component:"form",onSubmit:async t=>{var i,a,o,l;if(t.preventDefault(),n.trim())if(s){g(!0),h(null);try{if(localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),await is(n,s),!localStorage.getItem("access_token"))throw console.error("Login successful but access token not stored"),new Error("Erreur d'authentification: token non reÃ§u");const t=(null==(a=null==(i=r.state)?void 0:i.from)?void 0:a.pathname)||"/";setTimeout((()=>{e(t)}),100)}catch(c){console.error("Login error:",c);const e=c instanceof Error?c.message:"Une erreur est survenue lors de la connexion. Veuillez rÃ©essayer.";if(c&&"object"==typeof c&&"response"in c){h((null==(l=null==(o=c.response)?void 0:o.data)?void 0:l.detail)||e)}else h(e)}finally{g(!1)}}else h("Veuillez entrer votre mot de passe");else h("Veuillez entrer votre nom d'utilisateur")},sx:{width:"100%"},children:[t.jsx(V,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Nom d'utilisateur",name:"username",autoComplete:"username",autoFocus:!0,value:n,onChange:e=>i(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(G,{color:"action"})})},sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:1}}}),t.jsx(V,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Mot de passe",type:o?"text":"password",id:"password",autoComplete:"current-password",value:s,onChange:e=>a(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx($,{color:"action"})}),endAdornment:t.jsx(H,{position:"end",children:t.jsx(f,{"aria-label":"toggle password visibility",onClick:()=>l(!o),edge:"end",children:o?t.jsx(q,{}):t.jsx(X,{})})})},sx:{mb:3,"& .MuiOutlinedInput-root":{borderRadius:1}}}),t.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",disabled:p,sx:{py:1.5,borderRadius:1,fontWeight:"bold",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)","&:hover":{boxShadow:"0 6px 15px rgba(0, 0, 0, 0.15)",transform:"translateY(-1px)"},transition:"all 0.2s ease"},children:p?t.jsx(m,{size:24,color:"inherit"}):"Se connecter"})]})]})})})},hs=({period:e="year",startDate:t,endDate:r})=>{const n=new URLSearchParams;return n.append("period",e),"custom"===e&&t&&r&&(n.append("start_date",t),n.append("end_date",r)),n.toString()},ps=async()=>{const e=await rs.get("/partners/clients/");return e.data.results||e.data},ms=async()=>{const e=await rs.get("/partners/suppliers/");return e.data.results||e.data},fs=async()=>{const e=await rs.get("/treasury/accounts/");return e.data.results||e.data},gs=async e=>{const t=await rs.get(`/treasury/accounts/?account_type=${e}`);return t.data.results||t.data},xs=async e=>{const t=e?`/treasury/account-statements/?account=${e}`:"/treasury/account-statements/",r=await rs.get(t);return r.data.results||r.data},ys=async(e,t)=>(await rs.get(`/treasury/account-statements/account_info/?account_id=${e}&type=${t}`)).data,ws=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"],bs=e=>null==e?0:"number"==typeof e?e:parseFloat(e)||0,vs=e=>isNaN(e)?"0 GNF":new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Cs=[{value:"today",label:"Aujourd'hui"},{value:"week",label:"Cette semaine"},{value:"month",label:"Mois en cours"},{value:"quarter",label:"Trimestre en cours"},{value:"semester",label:"Semestre en cours"},{value:"year",label:"AnnÃ©e en cours"},{value:"custom",label:"PersonnalisÃ©e"}],_s=[{value:"all",label:"Tous"},{value:"paid",label:"PayÃ©"},{value:"partial",label:"Partiellement payÃ©"},{value:"unpaid",label:"Non payÃ©"},{value:"overdue",label:"En retard"}],Ss=[{value:"all",label:"Tous"},{value:"sale",label:"Vente"},{value:"payment",label:"Paiement"},{value:"purchase",label:"Achat"},{value:"refund",label:"Remboursement"}],Es=[{value:"date_desc",label:"Plus rÃ©cent"},{value:"date_asc",label:"Plus ancien"},{value:"amount_desc",label:"Montant (dÃ©croissant)"},{value:"amount_asc",label:"Montant (croissant)"},{value:"name_asc",label:"Nom (A-Z)"},{value:"name_desc",label:"Nom (Z-A)"}],As=()=>{const[e,t]=jt.useState(!1),[r,n]=jt.useState(null),[i,s]=jt.useState(null),[a,o]=jt.useState({monthly_data:[],category_data:[],top_products:[]}),[l,c]=jt.useState([]),[d,u]=jt.useState(null),[h,p]=jt.useState([]),[m,f]=jt.useState([]),[g,x]=jt.useState([]),[y,w]=jt.useState([]),[b,v]=jt.useState([]),C=jt.useCallback((async(e,t,r)=>{try{if(!("custom"!==e||t&&r))return void console.warn("Skipping dashboard stats fetch: custom period requires start and end dates");const n=await(async(e="year",t,r)=>(await rs.get(`/dashboard/stats/?${hs({period:e,startDate:t,endDate:r})}`)).data)(e,t,r);s(n)}catch(n){throw console.error("Error fetching dashboard stats:",n),n}}),[]),_=jt.useCallback((async(e,t,r)=>{try{if(!("custom"!==e||t&&r))return void console.warn("Skipping sales report fetch: custom period requires start and end dates");const n=await(async(e="year",t,r)=>(await rs.get(`/sales/reports/?${hs({period:e,startDate:t,endDate:r})}`)).data)(e,t,r);o(n)}catch(n){throw console.error("Error fetching sales report:",n),n}}),[]),S=jt.useCallback((async(e,t,r)=>{try{if(!("custom"!==e||t&&r))return void console.warn("Skipping inventory stats fetch: custom period requires start and end dates");const n=await(async(e="year",t,r)=>(await rs.get(`/dashboard/inventory/?${hs({period:e,startDate:t,endDate:r})}`)).data)(e,t,r);if(u(n),n&&n.historical_value)p(n.historical_value);else{const e=(e=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=(new Date).getMonth();return Array.from({length:7},((n,i)=>{const s=.85+.05*i;return{name:t[(r-6+i+12)%12],value:Math.round(e*s)}}))})((null==n?void 0:n.inventory_value)||0);p(e)}}catch(n){throw console.error("Error fetching inventory stats:",n),n}}),[]),E=jt.useCallback((async()=>{try{const e=await(async()=>(await rs.get("/dashboard/low-stock/")).data)();c(e)}catch(e){throw console.error("Error fetching low stock products:",e),e}}),[]),A=jt.useCallback((async()=>{try{console.log("Starting to fetch client account statements...");const t=await ps(),r=Array.isArray(t)?t:t.results?t.results:[],n=await gs("client"),i=r.map((e=>{const t=n.find((t=>t.id===e.account)),r=t?bs(t.current_balance):0;return{id:e.id,name:e.name,balance:r,account:(null==t?void 0:t.id)||e.account,account_balance:r,last_transaction_date:void 0,phone:e.phone||"-"}})).filter((e=>e.balance>0));if(x(i),i.length>0){const t=i[0].id;try{const e=await(async e=>{var t;if(e){const r=await rs.get(`/treasury/account-statements/?client=${e}`);return{statements:(null==(t=r.data)?void 0:t.results)||r.data||[]}}return{statements:[]}})(t),r=e.statements?e.statements:Array.isArray(e)?e:[];f(r)}catch(e){console.error("Error fetching client statements:",e),f([])}}else f([])}catch(t){console.error("Error fetching account statements:",t),x([]),f([])}}),[]),I=jt.useCallback((async e=>{try{console.log("Fetching supplier account statements from API...");const t=await(async e=>{var t,r,n;const[i,s]=await Promise.all([rs.get("/partners/suppliers/"),rs.get("/treasury/accounts/?account_type=supplier")]),a=(null==(t=i.data)?void 0:t.results)||i.data||[],o=(null==(r=s.data)?void 0:r.results)||s.data||[],l=a.map((e=>{const t=o.find((t=>t.id===e.account)),r=t?Number(t.current_balance??t.balance??0):0;return{id:e.id,name:e.name,balance:r,account:(null==t?void 0:t.id)??null,account_balance:r,last_transaction_date:null==t?void 0:t.last_transaction_date,contact:e.phone||e.contact_person||"-"}}));let c=[];if(e){const t=l.find((t=>t.id===e));if(null==t?void 0:t.account){const e=await rs.get(`/treasury/account-statements/?account=${t.account}`);c=(null==(n=e.data)?void 0:n.results)||e.data||[]}}return{supplier_balances:l,supplier_transactions:c}})(e);t.supplier_balances&&w(t.supplier_balances),t.supplier_transactions?v(t.supplier_transactions):v([])}catch(t){console.error("Error fetching supplier account statements:",t),w([]),v([])}}),[]),j=jt.useCallback((async(e,r,i,s)=>{t(!0),n(null);try{switch(await C(r,i,s),e){case"sales":await _(r,i,s);break;case"products":await E();break;case"inventory":await S(r,i,s);break;case"accounts":await A();break;case"suppliers":await I()}}catch(a){console.error("Error loading dashboard data:",a),n("Une erreur est survenue lors du chargement des donnÃ©es du tableau de bord")}finally{t(!1)}}),[C,_,S,E,A,I]);return{loading:e,error:r,dashboardStats:i,reportData:a,lowStockProducts:l,inventoryStats:d,inventoryValueTrend:h,accountStatements:m,clientBalances:g,supplierBalances:y,supplierTransactions:b,fetchDashboardStats:C,fetchSalesReport:_,fetchInventoryStats:S,fetchLowStockProducts:E,fetchClientAccountStatements:A,fetchSupplierAccountStatements:I,loadAllData:j,setError:n}};function Is(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function js(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Ts(e){js(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===Z(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}var Ds={};function Rs(){return Ds}function Ns(e){if(js(1,arguments),!function(e){return js(1,arguments),e instanceof Date||"object"===Z(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!=typeof e)return!1;var t=Ts(e);return!isNaN(Number(t))}function Ps(e,t){return js(2,arguments),function(e,t){js(2,arguments);var r=Ts(e).getTime(),n=Is(t);return new Date(r+n)}(e,-Is(t))}function Os(e){js(1,arguments);var t=Ts(e),r=t.getUTCDay(),n=(r<1?7:0)+r-1;return t.setUTCDate(t.getUTCDate()-n),t.setUTCHours(0,0,0,0),t}function ks(e){js(1,arguments);var t=Ts(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var i=Os(n),s=new Date(0);s.setUTCFullYear(r,0,4),s.setUTCHours(0,0,0,0);var a=Os(s);return t.getTime()>=i.getTime()?r+1:t.getTime()>=a.getTime()?r:r-1}function Ms(e){js(1,arguments);var t=Ts(e),r=Os(t).getTime()-function(e){js(1,arguments);var t=ks(e),r=new Date(0);return r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0),Os(r)}(t).getTime();return Math.round(r/6048e5)+1}function Fs(e,t){var r,n,i,s,a,o,l,c;js(1,arguments);var d=Rs(),u=Is(null!==(r=null!==(n=null!==(i=null!==(s=null==t?void 0:t.weekStartsOn)&&void 0!==s?s:null==t||null===(a=t.locale)||void 0===a||null===(o=a.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==i?i:d.weekStartsOn)&&void 0!==n?n:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==r?r:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=Ts(e),p=h.getUTCDay(),m=(p<u?7:0)+p-u;return h.setUTCDate(h.getUTCDate()-m),h.setUTCHours(0,0,0,0),h}function Bs(e,t){var r,n,i,s,a,o,l,c;js(1,arguments);var d=Ts(e),u=d.getUTCFullYear(),h=Rs(),p=Is(null!==(r=null!==(n=null!==(i=null!==(s=null==t?void 0:t.firstWeekContainsDate)&&void 0!==s?s:null==t||null===(a=t.locale)||void 0===a||null===(o=a.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:h.firstWeekContainsDate)&&void 0!==n?n:null===(l=h.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==r?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var m=new Date(0);m.setUTCFullYear(u+1,0,p),m.setUTCHours(0,0,0,0);var f=Fs(m,t),g=new Date(0);g.setUTCFullYear(u,0,p),g.setUTCHours(0,0,0,0);var x=Fs(g,t);return d.getTime()>=f.getTime()?u+1:d.getTime()>=x.getTime()?u:u-1}function Ls(e,t){js(1,arguments);var r=Ts(e),n=Fs(r,t).getTime()-function(e,t){var r,n,i,s,a,o,l,c;js(1,arguments);var d=Rs(),u=Is(null!==(r=null!==(n=null!==(i=null!==(s=null==t?void 0:t.firstWeekContainsDate)&&void 0!==s?s:null==t||null===(a=t.locale)||void 0===a||null===(o=a.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:d.firstWeekContainsDate)&&void 0!==n?n:null===(l=d.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==r?r:1),h=Bs(e,t),p=new Date(0);return p.setUTCFullYear(h,0,u),p.setUTCHours(0,0,0,0),Fs(p,t)}(r,t).getTime();return Math.round(n/6048e5)+1}function zs(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var Us=function(e,t){var r=e.getUTCFullYear(),n=r>0?r:1-r;return zs("yy"===t?n%100:n,t.length)},Ws=function(e,t){var r=e.getUTCMonth();return"M"===t?String(r+1):zs(r+1,2)},Vs=function(e,t){return zs(e.getUTCDate(),t.length)},Hs=function(e,t){return zs(e.getUTCHours()%12||12,t.length)},Gs=function(e,t){return zs(e.getUTCHours(),t.length)},qs=function(e,t){return zs(e.getUTCMinutes(),t.length)},Xs=function(e,t){return zs(e.getUTCSeconds(),t.length)},$s=function(e,t){var r=t.length,n=e.getUTCMilliseconds();return zs(Math.floor(n*Math.pow(10,r-3)),t.length)},Zs="midnight",Ys="noon",Qs="morning",Ks="afternoon",Js="evening",ea="night",ta={G:function(e,t,r){var n=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if("yo"===t){var n=e.getUTCFullYear(),i=n>0?n:1-n;return r.ordinalNumber(i,{unit:"year"})}return Us(e,t)},Y:function(e,t,r,n){var i=Bs(e,n),s=i>0?i:1-i;return"YY"===t?zs(s%100,2):"Yo"===t?r.ordinalNumber(s,{unit:"year"}):zs(s,t.length)},R:function(e,t){return zs(ks(e),t.length)},u:function(e,t){return zs(e.getUTCFullYear(),t.length)},Q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return zs(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return zs(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){var n=e.getUTCMonth();switch(t){case"M":case"MM":return Ws(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){var n=e.getUTCMonth();switch(t){case"L":return String(n+1);case"LL":return zs(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){var i=Ls(e,n);return"wo"===t?r.ordinalNumber(i,{unit:"week"}):zs(i,t.length)},I:function(e,t,r){var n=Ms(e);return"Io"===t?r.ordinalNumber(n,{unit:"week"}):zs(n,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getUTCDate(),{unit:"date"}):Vs(e,t)},D:function(e,t,r){var n=function(e){js(1,arguments);var t=Ts(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=r-t.getTime();return Math.floor(n/864e5)+1}(e);return"Do"===t?r.ordinalNumber(n,{unit:"dayOfYear"}):zs(n,t.length)},E:function(e,t,r){var n=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){var i=e.getUTCDay(),s=(i-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return zs(s,2);case"eo":return r.ordinalNumber(s,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){var i=e.getUTCDay(),s=(i-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return zs(s,t.length);case"co":return r.ordinalNumber(s,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,r){var n=e.getUTCDay(),i=0===n?7:n;switch(t){case"i":return String(i);case"ii":return zs(i,t.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){var n,i=e.getUTCHours();switch(n=12===i?Ys:0===i?Zs:i/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){var n,i=e.getUTCHours();switch(n=i>=17?Js:i>=12?Ks:i>=4?Qs:ea,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){var n=e.getUTCHours()%12;return 0===n&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return Hs(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Gs(e,t)},K:function(e,t,r){var n=e.getUTCHours()%12;return"Ko"===t?r.ordinalNumber(n,{unit:"hour"}):zs(n,t.length)},k:function(e,t,r){var n=e.getUTCHours();return 0===n&&(n=24),"ko"===t?r.ordinalNumber(n,{unit:"hour"}):zs(n,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):qs(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Xs(e,t)},S:function(e,t){return $s(e,t)},X:function(e,t,r,n){var i=(n._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return na(i);case"XXXX":case"XX":return ia(i);default:return ia(i,":")}},x:function(e,t,r,n){var i=(n._originalDate||e).getTimezoneOffset();switch(t){case"x":return na(i);case"xxxx":case"xx":return ia(i);default:return ia(i,":")}},O:function(e,t,r,n){var i=(n._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ra(i,":");default:return"GMT"+ia(i,":")}},z:function(e,t,r,n){var i=(n._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ra(i,":");default:return"GMT"+ia(i,":")}},t:function(e,t,r,n){var i=n._originalDate||e;return zs(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,r,n){return zs((n._originalDate||e).getTime(),t.length)}};function ra(e,t){var r=e>0?"-":"+",n=Math.abs(e),i=Math.floor(n/60),s=n%60;if(0===s)return r+String(i);var a=t;return r+String(i)+a+zs(s,2)}function na(e,t){return e%60==0?(e>0?"-":"+")+zs(Math.abs(e)/60,2):ia(e,t)}function ia(e,t){var r=t||"",n=e>0?"-":"+",i=Math.abs(e);return n+zs(Math.floor(i/60),2)+r+zs(i%60,2)}var sa=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},aa=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},oa={p:aa,P:function(e,t){var r,n=e.match(/(P+)(p+)?/)||[],i=n[1],s=n[2];if(!s)return sa(e,t);switch(i){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",sa(i,t)).replace("{{time}}",aa(s,t))}},la=["D","DD"],ca=["YY","YYYY"];function da(e,t,r){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var ua={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ha(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var pa={date:ha({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ha({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ha({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ma={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function fa(e){return function(t,r){var n;if("formatting"===(null!=r&&r.context?String(r.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,s=null!=r&&r.width?String(r.width):i;n=e.formattingValues[s]||e.formattingValues[i]}else{var a=e.defaultWidth,o=null!=r&&r.width?String(r.width):e.defaultWidth;n=e.values[o]||e.values[a]}return n[e.argumentCallback?e.argumentCallback(t):t]}}function ga(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.width,i=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],s=t.match(i);if(!s)return null;var a,o=s[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r;return}(l,(function(e){return e.test(o)})):function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r;return}(l,(function(e){return e.test(o)}));return a=e.valueCallback?e.valueCallback(c):c,{value:a=r.valueCallback?r.valueCallback(a):a,rest:t.slice(o.length)}}}var xa,ya={code:"en-US",formatDistance:function(e,t,r){var n,i=ua[e];return n="string"==typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!=r&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n},formatLong:pa,formatRelative:function(e,t,r,n){return ma[e]},localize:{ordinalNumber:function(e,t){var r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:fa({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:fa({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:fa({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:fa({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:fa({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(xa={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.match(xa.matchPattern);if(!r)return null;var n=r[0],i=e.match(xa.parsePattern);if(!i)return null;var s=xa.valueCallback?xa.valueCallback(i[0]):i[0];return{value:s=t.valueCallback?t.valueCallback(s):s,rest:e.slice(n.length)}}),era:ga({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ga({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ga({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ga({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ga({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},wa=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ba=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,va=/^'([^]*?)'?$/,Ca=/''/g,_a=/[a-zA-Z]/;function Sa(e,t,r){var n,i,s,a,o,l,c,d,u,h,p;js(2,arguments);var m=String(t),f=Rs(),g=null!==(n=f.locale)&&void 0!==n?n:ya,x=Is(null!==(i=null!==(s=null!==(a=void 0)&&void 0!==a?a:f.firstWeekContainsDate)&&void 0!==s?s:null===(o=f.locale)||void 0===o||null===(l=o.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==i?i:1);if(!(x>=1&&x<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var y=Is(null!==(c=null!==(d=null!==(u=void 0)&&void 0!==u?u:f.weekStartsOn)&&void 0!==d?d:null===(h=f.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.weekStartsOn)&&void 0!==c?c:0);if(!(y>=0&&y<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!g.localize)throw new RangeError("locale must contain localize property");if(!g.formatLong)throw new RangeError("locale must contain formatLong property");var w=Ts(e);if(!Ns(w))throw new RangeError("Invalid time value");var b=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(w),v=Ps(w,b),C={firstWeekContainsDate:x,weekStartsOn:y,locale:g,_originalDate:w},_=m.match(ba).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,oa[t])(e,g.formatLong):e})).join("").match(wa).map((function(r){if("''"===r)return"'";var n=r[0];if("'"===n)return function(e){var t=e.match(va);if(!t)return e;return t[1].replace(Ca,"'")}(r);var i=ta[n];if(i)return function(e){return-1!==ca.indexOf(e)}(r)&&da(r,t,String(e)),function(e){return-1!==la.indexOf(e)}(r)&&da(r,t,String(e)),i(v,r,g.localize,C);if(n.match(_a))throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`");return r})).join("");return _}function Ea(e,t){return js(2,arguments),function(e,t){js(2,arguments);var r=Ts(e),n=Is(t);return isNaN(n)?new Date(NaN):n?(r.setDate(r.getDate()+n),r):r}(e,-Is(t))}const Aa=({selectedPeriod:e,customStartDate:r,customEndDate:n,onPeriodChange:i,onStartDateChange:s,onEndDateChange:a,searchTerm:o="",statusFilter:d="all",transactionTypeFilter:u="all",minAmount:h="",maxAmount:p="",sortOrder:m="date_desc",onSearchChange:g,onStatusChange:x,onTransactionTypeChange:y,onMinAmountChange:w,onMaxAmountChange:b,onSortOrderChange:v,onResetFilters:C,onExportData:_,dateRangeError:S,showAdvancedFilters:E=!0})=>{const[A,I]=jt.useState(!1);return t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap",alignItems:"flex-start"},children:[t.jsxs(Y,{sx:{minWidth:200},children:[t.jsx(Q,{children:"PÃ©riode"}),t.jsx(K,{value:e,onChange:e=>{i(e.target.value)},label:"PÃ©riode",children:Cs.map((e=>t.jsx(B,{value:e.value,children:e.label},e.value)))})]}),t.jsx(V,{label:"Date dÃ©but",type:"date",value:r,onChange:e=>s(e.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:180},error:!!S,disabled:"custom"!==e}),t.jsx(V,{label:"Date fin",type:"date",value:n,onChange:e=>a(e.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:180},error:!!S,disabled:"custom"!==e}),g&&t.jsx(V,{label:"Rechercher",value:o,onChange:e=>g(e.target.value),placeholder:"Nom, rÃ©fÃ©rence...",sx:{minWidth:200}}),t.jsxs(c,{sx:{display:"flex",gap:1,ml:"auto"},children:[E&&t.jsx(l,{title:"Filtres avancÃ©s",children:t.jsx(f,{onClick:()=>I(!A),color:A?"primary":"default",children:A?t.jsx(J,{}):t.jsx(ee,{})})}),C&&t.jsx(l,{title:"RÃ©initialiser les filtres",children:t.jsx(f,{onClick:C,color:"default",children:t.jsx(te,{})})}),_&&t.jsx(l,{title:"Exporter les donnÃ©es",children:t.jsx(k,{variant:"outlined",startIcon:t.jsx(re,{}),onClick:_,size:"small",children:"Exporter"})})]})]}),S&&t.jsx(W,{severity:"error",sx:{mb:2},children:S}),E&&t.jsx(ne,{in:A,children:t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap",p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[x&&t.jsxs(Y,{sx:{minWidth:180},children:[t.jsx(Q,{children:"Statut"}),t.jsx(K,{value:d,onChange:e=>{null==x||x(e.target.value)},label:"Statut",children:_s.map((e=>t.jsx(B,{value:e.value,children:e.label},e.value)))})]}),y&&t.jsxs(Y,{sx:{minWidth:180},children:[t.jsx(Q,{children:"Type de transaction"}),t.jsx(K,{value:u,onChange:e=>{null==y||y(e.target.value)},label:"Type de transaction",children:Ss.map((e=>t.jsx(B,{value:e.value,children:e.label},e.value)))})]}),w&&b&&t.jsxs(t.Fragment,{children:[t.jsx(V,{label:"Montant min",type:"number",value:h,onChange:e=>w(e.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:150},placeholder:"0"}),t.jsx(V,{label:"Montant max",type:"number",value:p,onChange:e=>b(e.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:150},placeholder:"IllimitÃ©"})]}),v&&t.jsxs(Y,{sx:{minWidth:200},children:[t.jsx(Q,{children:"Trier par"}),t.jsx(K,{value:m,onChange:e=>{null==v||v(e.target.value)},label:"Trier par",children:Es.map((e=>t.jsx(B,{value:e.value,children:e.label},e.value)))})]})]})})]})},Ia=Pt.memo((({title:e,value:r,icon:n,color:i="primary"})=>{const s=h();return t.jsx(ie,{sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.05)",transition:"all 0.3s ease",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-5px)",boxShadow:"0 8px 25px rgba(0,0,0,0.1)"},"&::after":{content:'""',position:"absolute",top:0,left:0,width:"6px",height:"100%",backgroundColor:s.palette[i].main}},children:t.jsx(se,{sx:{p:3},children:t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[t.jsxs(c,{children:[t.jsx(d,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:e}),t.jsx(d,{variant:"h4",fontWeight:700,sx:{mb:1},children:r})]}),t.jsx(ae,{sx:{bgcolor:`${s.palette[i].main}15`,color:`${i}.main`,width:56,height:56},children:n})]})})})}));Ia.displayName="StatsCard";const ja=({stats:e})=>{if(!e)return null;return t.jsx(oe,{container:!0,spacing:3,sx:{mb:3},children:t.jsxs(t.Fragment,{children:[t.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Nombre de ventes",value:e.total_sales.toString(),icon:t.jsx(le,{}),color:"primary"})}),t.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Total clients",value:e.total_clients.toString(),icon:t.jsx(v,{}),color:"secondary"})}),t.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Total produits",value:e.total_products.toString(),icon:t.jsx(ce,{}),color:"primary"})}),t.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:t.jsx(Ia,{title:"Total fournisseurs",value:e.total_suppliers.toString(),icon:t.jsx(C,{}),color:"warning"})})]})})},Ta=({reportData:e,totalRevenue:r})=>{const n=[{field:"name",headerName:"Produit",flex:1},{field:"category",headerName:"CatÃ©gorie",flex:1},{field:"revenue",headerName:"Chiffre d'affaires",flex:1,valueFormatter:e=>vs(e)},{field:"quantity",headerName:"QuantitÃ© vendue",flex:1}];return t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,lg:8,children:t.jsxs(U,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(d,{variant:"h6",children:"Ã‰volution du chiffre d'affaires"}),void 0!==r&&t.jsx(d,{variant:"h5",color:"primary",sx:{fontWeight:"bold"},children:vs(r)})]}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(Vt,{data:e.monthly_data,children:[t.jsx(Ht,{strokeDasharray:"3 3"}),t.jsx(Gt,{dataKey:"month"}),t.jsx(qt,{}),t.jsx(Xt,{formatter:e=>vs(Number(e))}),t.jsx($t,{}),t.jsx(Zt,{type:"monotone",dataKey:"amount",stroke:ws[0],name:"Chiffre d'affaires",strokeWidth:2})]})})]})}),t.jsx(oe,{item:!0,xs:12,lg:4,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Ventes par catÃ©gorie"}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(Yt,{children:[t.jsx(Qt,{data:e.category_data,cx:"50%",cy:"50%",labelLine:!1,label:e=>e.category,outerRadius:80,fill:"#8884d8",dataKey:"amount",children:e.category_data.map(((e,r)=>t.jsx(Kt,{fill:ws[r%ws.length]},`cell-${r}`)))}),t.jsx(Xt,{formatter:e=>vs(Number(e))})]})})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Top produits"}),t.jsx(c,{sx:{height:400,width:"100%"},children:t.jsx(de,{rows:e.top_products,columns:n,getRowId:e=>e.name||Math.random().toString(),pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},disableRowSelectionOnClick:!0})})]})})]})},Da=({reportData:e,lowStockProducts:r})=>{const n=[{field:"name",headerName:"Produit",flex:1},{field:"category",headerName:"CatÃ©gorie",flex:1},{field:"zone",headerName:"Zone",flex:1},{field:"current_stock",headerName:"Stock actuel",flex:.5,renderCell:e=>t.jsx(c,{sx:{color:e.value<e.row.min_stock_level?"error.main":"inherit"},children:e.value})},{field:"min_stock_level",headerName:"Seuil min",flex:.5},{field:"unit",headerName:"UnitÃ©",flex:.5}];return t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,lg:6,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Produits les plus vendus par quantitÃ©"}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(Jt,{data:e.top_products.slice(0,10),children:[t.jsx(Ht,{strokeDasharray:"3 3"}),t.jsx(Gt,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),t.jsx(qt,{}),t.jsx(Xt,{}),t.jsx($t,{}),t.jsx(er,{dataKey:"quantity",fill:ws[1],name:"QuantitÃ© vendue"})]})})]})}),t.jsx(oe,{item:!0,xs:12,lg:6,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Produits les plus vendus par chiffre d'affaires"}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(Jt,{data:e.top_products.slice(0,10),children:[t.jsx(Ht,{strokeDasharray:"3 3"}),t.jsx(Gt,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),t.jsx(qt,{}),t.jsx(Xt,{formatter:e=>vs(Number(e))}),t.jsx($t,{}),t.jsx(er,{dataKey:"revenue",fill:ws[0],name:"Chiffre d'affaires"})]})})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Produits en stock bas"}),t.jsx(c,{sx:{height:400,width:"100%"},children:t.jsx(de,{rows:r,columns:n,pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},disableRowSelectionOnClick:!0})})]})})]})},Ra=({inventoryStats:e,inventoryValueTrend:r,lowStockProducts:n})=>{const i=[{field:"name",headerName:"Produit",flex:1},{field:"category",headerName:"CatÃ©gorie",flex:1},{field:"zone",headerName:"Zone",flex:1},{field:"current_stock",headerName:"Stock actuel",flex:.5,renderCell:e=>t.jsx(c,{sx:{color:e.value<e.row.min_stock_level?"error.main":"inherit"},children:e.value})},{field:"min_stock_level",headerName:"Seuil min",flex:.5},{field:"unit",headerName:"UnitÃ©",flex:.5}];return t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,lg:8,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Ã‰volution de la valeur d'inventaire"}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(tr,{data:r,children:[t.jsx(Ht,{strokeDasharray:"3 3"}),t.jsx(Gt,{dataKey:"name"}),t.jsx(qt,{}),t.jsx(Xt,{formatter:e=>vs(Number(e))}),t.jsx($t,{}),t.jsx(rr,{type:"monotone",dataKey:"value",stroke:ws[2],fill:ws[2],fillOpacity:.6,name:"Valeur"})]})})]})}),t.jsx(oe,{item:!0,xs:12,lg:4,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Stock par zone"}),t.jsx(Wt,{width:"100%",height:300,children:t.jsxs(Yt,{children:[t.jsx(Qt,{data:(null==e?void 0:e.zone_data)||[],cx:"50%",cy:"50%",labelLine:!1,label:e=>e.zone,outerRadius:80,fill:"#8884d8",dataKey:"value",children:((null==e?void 0:e.zone_data)||[]).map(((e,r)=>t.jsx(Kt,{fill:ws[r%ws.length]},`cell-${r}`)))}),t.jsx(Xt,{})]})})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(U,{sx:{p:3},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:"Produits en stock bas"}),t.jsx(c,{sx:{height:400,width:"100%"},children:t.jsx(de,{rows:n,columns:i,pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},disableRowSelectionOnClick:!0})})]})})]})},Na=({clientBalances:e,searchTerm:r="",minAmount:n="",maxAmount:i=""})=>{const s=jt.useMemo((()=>{let t=[...e];if(r){const e=r.toLowerCase();t=t.filter((t=>t.name.toLowerCase().includes(e)))}return(n||i)&&(t=t.filter((e=>{const t=Math.abs(bs(e.balance)),r=n?parseFloat(n):0,s=i?parseFloat(i):1/0;return t>=r&&t<=s}))),t.sort(((e,t)=>bs(t.balance)-bs(e.balance))),t}),[e,r,n,i]),a=[{field:"name",headerName:"Client",flex:1.5,minWidth:200},{field:"balance",headerName:"Solde",flex:1,minWidth:120,renderCell:e=>{const r=bs(e.value);return t.jsx(ue,{label:vs(r),color:r>0?"error":r<0?"success":"default",size:"small"})}},{field:"last_transaction_date",headerName:"DerniÃ¨re transaction",flex:1,minWidth:150,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):"-"},{field:"phone",headerName:"TÃ©lÃ©phone",flex:1,minWidth:120,valueGetter:e=>e||"-"}];return t.jsxs(U,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(d,{variant:"h6",children:"Soldes clients"}),t.jsxs(d,{variant:"body2",color:"text.secondary",children:["Total: ",s.length," client(s)"]})]}),t.jsx(c,{sx:{height:"calc(100vh - 300px)",minHeight:400,width:"100%"},children:t.jsx(de,{rows:s,columns:a,pageSizeOptions:[10,25,50,100],initialState:{pagination:{paginationModel:{pageSize:25}}},disableRowSelectionOnClick:!0,autoHeight:!1,sx:{"& .MuiDataGrid-virtualScroller":{minHeight:400}}})})]})},Pa=({supplierBalances:e,searchTerm:r="",minAmount:n="",maxAmount:i=""})=>{const s=jt.useMemo((()=>{let t=[...e];if(r){const e=r.toLowerCase();t=t.filter((t=>t.name.toLowerCase().includes(e)))}return(n||i)&&(t=t.filter((e=>{const t=Math.abs(bs(e.balance)),r=n?parseFloat(n):0,s=i?parseFloat(i):1/0;return t>=r&&t<=s}))),t.sort(((e,t)=>bs(t.balance)-bs(e.balance))),t}),[e,r,n,i]),a=[{field:"name",headerName:"Fournisseur",flex:1.5,minWidth:200},{field:"balance",headerName:"Solde",flex:1,minWidth:120,renderCell:e=>{const r=bs(e.value);return t.jsx(ue,{label:vs(r),color:r>0?"success":r<0?"error":"default",size:"small"})}},{field:"last_transaction_date",headerName:"DerniÃ¨re transaction",flex:1,minWidth:150,valueFormatter:e=>e?new Date(e).toLocaleDateString("fr-FR"):"-"},{field:"contact",headerName:"Contact",flex:1,minWidth:120,valueGetter:e=>e||"-"}];return t.jsxs(U,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(d,{variant:"h6",children:"Soldes fournisseurs"}),t.jsxs(d,{variant:"body2",color:"text.secondary",children:["Total: ",s.length," fournisseur(s)"]})]}),t.jsx(c,{sx:{height:"calc(100vh - 300px)",minHeight:400,width:"100%"},children:t.jsx(de,{rows:s,columns:a,pageSizeOptions:[10,25,50,100],initialState:{pagination:{paginationModel:{pageSize:25}}},disableRowSelectionOnClick:!0,autoHeight:!1,sx:{"& .MuiDataGrid-virtualScroller":{minHeight:400}}})})]})},Oa=()=>{const{loading:e,error:r,dashboardStats:n,reportData:i,lowStockProducts:s,inventoryStats:a,inventoryValueTrend:o,clientBalances:l,supplierBalances:u,loadAllData:h,setError:p}=As(),{selectedPeriod:f,customStartDate:g,customEndDate:x,selectedTab:y,reportType:w,searchTerm:b,statusFilter:v,transactionTypeFilter:C,minAmount:_,maxAmount:S,sortOrder:E,startDate:A,endDate:I,dateRangeError:j,setSelectedPeriod:T,setCustomStartDate:D,setCustomEndDate:R,setSearchTerm:N,setStatusFilter:P,setTransactionTypeFilter:O,setMinAmount:k,setMaxAmount:M,setSortOrder:F,handleTabChange:B,resetFilters:L}=(()=>{const e=new Date,t=Sa(Ea(e,30),"yyyy-MM-dd"),r=Sa(e,"yyyy-MM-dd"),[n,i]=jt.useState("month"),[s,a]=jt.useState(t),[o,l]=jt.useState(r),[c,d]=jt.useState(0),[u,h]=jt.useState(""),[p,m]=jt.useState("all"),[f,g]=jt.useState("all"),[x,y]=jt.useState(""),[w,b]=jt.useState(""),[v,C]=jt.useState("date_desc"),{startDate:_,endDate:S}=jt.useMemo((()=>{const e=new Date;let t="",r=Sa(e,"yyyy-MM-dd");if("custom"===n)t=s,r=o;else{const r={today:0,week:7,month:30,quarter:90,semester:180,year:365}[n]||30;t=Sa(0===r?e:Ea(e,r),"yyyy-MM-dd")}return{startDate:t,endDate:r}}),[n,s,o]),{isDateRangeValid:E,dateRangeError:A}=jt.useMemo((()=>{if("custom"!==n)return{isDateRangeValid:!0,dateRangeError:null};if(!s||!o)return{isDateRangeValid:!1,dateRangeError:"Veuillez sÃ©lectionner les dates de dÃ©but et de fin"};const e=new Date(s),t=new Date(o);return e>t?{isDateRangeValid:!1,dateRangeError:"La date de dÃ©but doit Ãªtre antÃ©rieure Ã  la date de fin"}:e>new Date?{isDateRangeValid:!1,dateRangeError:"La date de dÃ©but ne peut pas Ãªtre dans le futur"}:Math.floor((t.getTime()-e.getTime())/864e5)>730?{isDateRangeValid:!1,dateRangeError:"La plage de dates ne peut pas dÃ©passer 2 ans"}:{isDateRangeValid:!0,dateRangeError:null}}),[n,s,o]),I=jt.useMemo((()=>["sales","products","inventory","accounts","suppliers"][c]||"sales"),[c]),j=jt.useCallback(((e,t)=>{d(t)}),[]),T=jt.useCallback((()=>{i("month"),a(""),l(""),h(""),m("all"),g("all"),y(""),b(""),C("date_desc")}),[]);return{selectedPeriod:n,customStartDate:s,customEndDate:o,selectedTab:c,reportType:I,searchTerm:u,statusFilter:p,transactionTypeFilter:f,minAmount:x,maxAmount:w,sortOrder:v,startDate:_,endDate:S,isDateRangeValid:E,dateRangeError:A,setSelectedPeriod:i,setCustomStartDate:a,setCustomEndDate:l,setSelectedTab:d,setSearchTerm:h,setStatusFilter:m,setTransactionTypeFilter:g,setMinAmount:y,setMaxAmount:b,setSortOrder:C,handleTabChange:j,resetFilters:T}})();jt.useEffect((()=>{h(w,f,A,I)}),[y,f,g,x,h,w,A,I]);return t.jsxs(z,{maxWidth:"xl",sx:{mt:4,mb:4},children:[t.jsxs(c,{sx:{mb:3},children:[t.jsxs(d,{variant:"h4",component:"h1",sx:{fontWeight:700,color:e=>e.palette.primary.main,borderBottom:e=>`2px solid ${e.palette.primary.light}`,pb:1,width:"fit-content",display:"flex",alignItems:"center",gap:1},children:[t.jsx(le,{sx:{fontSize:32}}),"Tableau de Bord"]}),t.jsx(d,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"Analysez vos ventes, produits, inventaire et comptes en temps rÃ©el"})]}),t.jsx(Aa,{selectedPeriod:f,customStartDate:g,customEndDate:x,onPeriodChange:T,onStartDateChange:D,onEndDateChange:R,searchTerm:b,statusFilter:v,transactionTypeFilter:C,minAmount:_,maxAmount:S,sortOrder:E,onSearchChange:N,onStatusChange:P,onTransactionTypeChange:O,onMinAmountChange:k,onMaxAmountChange:M,onSortOrderChange:F,onResetFilters:L,onExportData:()=>{try{let e=[],t="";switch(y){case 0:e=i.monthly_data||[],t=`ventes_${A}_${I}.json`;break;case 1:e=s,t=`produits_stock_bas_${(new Date).toISOString().split("T")[0]}.json`;break;case 2:e=o,t=`inventaire_${A}_${I}.json`;break;case 3:e=l,t=`comptes_clients_${(new Date).toISOString().split("T")[0]}.json`;break;case 4:e=u,t=`comptes_fournisseurs_${(new Date).toISOString().split("T")[0]}.json`}const r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}catch(e){console.error("Error exporting data:",e),p("Erreur lors de l'exportation des donnÃ©es")}},dateRangeError:j,showAdvancedFilters:!0}),r&&t.jsx(W,{severity:"error",onClose:()=>p(null),sx:{mb:3},children:r}),t.jsx(ja,{stats:n,reportType:w}),e&&t.jsx(c,{sx:{display:"flex",justifyContent:"center",my:4},children:t.jsx(m,{})}),!e&&t.jsxs(U,{sx:{width:"100%",mb:3},children:[t.jsxs(he,{value:y,onChange:B,indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto",children:[t.jsx(pe,{label:"Ventes"}),t.jsx(pe,{label:"Produits"}),t.jsx(pe,{label:"Inventaire"}),t.jsx(pe,{label:"Comptes Clients"}),t.jsx(pe,{label:"Comptes Fournisseurs"})]}),t.jsxs(c,{sx:{p:3},children:[0===y&&t.jsx(Ta,{reportData:i,totalRevenue:null==n?void 0:n.total_revenue}),1===y&&t.jsx(Da,{reportData:i,lowStockProducts:s}),2===y&&t.jsx(Ra,{inventoryStats:a,inventoryValueTrend:o,lowStockProducts:s}),3===y&&t.jsx(Na,{clientBalances:l,searchTerm:b,minAmount:_,maxAmount:S}),4===y&&t.jsx(Pa,{supplierBalances:u,searchTerm:b,minAmount:_,maxAmount:S})]})]})]})},ka=async()=>{const e=await rs.get("/core/zones/");return e.data.results||e.data},Ma=async()=>{const e=await rs.get("/settings/payment-methods/");return e.data.results||e.data},Fa=e=>({accounts:"treasury","client-groups":"partners",zones:"core"}[e]||"settings"),Ba=async e=>{const t=`/${Fa(e)}/${e}/`,r=await rs.get(t);return Array.isArray(r.data)?r.data:r.data&&r.data.results?r.data.results:[]},La=async()=>{const e=await rs.get("/inventory/products/");return e.data.results||e.data},za=async e=>{const t=e instanceof FormData?{"Content-Type":"multipart/form-data"}:{};return(await rs.post("/inventory/products/",e,{headers:t})).data},Ua=async(e,t)=>{const r=t instanceof FormData?{"Content-Type":"multipart/form-data"}:{};return(await rs.patch(`/inventory/products/${e}/`,t,{headers:r})).data},Wa=async e=>{await rs.delete(`/inventory/products/${e}/`)},Va=async e=>(await rs.get(`/inventory/products/${e}/qr_code/`,{responseType:"blob"})).data,Ha=async()=>{const e=await rs.get("/inventory/stock/");return e.data.results||e.data},Ga=async()=>{const e=await rs.get("/inventory/stock/low_stock/");return e.data.results||e.data},qa=async()=>{const e=await rs.get("/inventory/stock-cards/");return e.data.results||e.data},Xa=async e=>{const t=await rs.get(`/inventory/stock-cards/?product=${e}`);return t.data.results||t.data},$a=async()=>{const e=await rs.get("/inventory/stock-supplies/");return e.data.results||e.data},Za=async e=>(await rs.get(`/inventory/stock-supplies/${e}/`)).data,Ya=async e=>(await rs.post("/inventory/stock-supplies/",e)).data,Qa=async(e,t)=>(await rs.patch(`/inventory/stock-supplies/${e}/`,t)).data,Ka=async()=>{var e;const t=await rs.get("/inventory/stock-supplies/outstanding_by_supplier/");return Array.isArray(t.data)?t.data:(null==(e=t.data)?void 0:e.results)||[]},Ja=async()=>{const e=await rs.get("/inventory/stock-transfers/");return e.data.results||e.data},eo=async e=>(await rs.get(`/inventory/stock-transfers/${e}/`)).data,to=async e=>(await rs.post("/inventory/stock-transfers/",e)).data,ro=async(e,t)=>(await rs.patch(`/inventory/stock-transfers/${e}/`,t)).data,no=async e=>{await rs.delete(`/inventory/stock-transfers/${e}/`)},io=async()=>{const e=await rs.get("/inventory/inventories/");return e.data.results||e.data},so=async e=>(await rs.get(`/inventory/inventories/${e}/`)).data,ao=async e=>(await rs.post("/inventory/inventories/",e)).data,oo=async(e,t)=>(await rs.patch(`/inventory/inventories/${e}/`,t)).data,lo=async e=>{await rs.delete(`/inventory/inventories/${e}/`)},co=async e=>{const t=await rs.get(`/inventory/stock/?zone=${e}`);return t.data.results||t.data},uo=Ha,ho=Ga,po=qa,mo=Xa,fo=$a,go=Za,xo=Ja,yo=eo,wo=io,bo=so,vo=Ka,Co=Object.freeze(Object.defineProperty({__proto__:null,approveInventory:async e=>(await rs.post(`/inventory/inventories/${e}/approve/`)).data,approveStockReturn:async e=>(await rs.post(`/inventory/stock-returns/${e}/approve/`)).data,approveStockTransfer:async e=>(await rs.post(`/inventory/stock-transfers/${e}/approve/`)).data,checkStockAvailability:async(e,t,r)=>(await rs.get(`/inventory/stock/check_availability/?product=${e}&zone=${t}&quantity=${r}`)).data,confirmStockSupply:async e=>(await rs.post(`/inventory/stock-supplies/${e}/confirm/`)).data,createInventory:ao,createProduct:za,createStockReturn:async e=>(await rs.post("/inventory/stock-returns/",e)).data,createStockSupply:Ya,createStockTransfer:to,deleteInventory:lo,deleteProduct:Wa,deleteStockSupply:async e=>{await rs.delete(`/inventory/stock-supplies/${e}/`)},deleteStockTransfer:no,fetchInventories:io,fetchInventory:so,fetchLowStock:Ga,fetchOutstandingSupplies:Ka,fetchProduct:async e=>(await rs.get(`/inventory/products/${e}/`)).data,fetchProductQRCode:Va,fetchProducts:La,fetchStock:Ha,fetchStockCards:qa,fetchStockCardsByProduct:Xa,fetchStockReturns:async()=>{const e=await rs.get("/inventory/stock-returns/");return e.data.results||e.data},fetchStockSupplies:$a,fetchStockSupply:Za,fetchStockTransfer:eo,fetchStockTransfers:Ja,getInventories:wo,getInventory:bo,getLowStock:ho,getOutstandingSupplies:vo,getStockByZone:co,getStockCards:po,getStockCardsByProduct:mo,getStockSupplies:fo,getStockSupply:go,getStockTransfer:yo,getStockTransfers:xo,getStocks:uo,paySupplierFromAccount:async(e,t)=>(await rs.post(`/inventory/stock-supplies/${e}/pay_from_account/`,t)).data,updateInventory:oo,updateProduct:Ua,updateStockSupply:Qa,updateStockTransfer:ro},Symbol.toStringTag,{value:"Module"})),_o=async e=>(await rs.post("/sales/sales/",e)).data,So=async(e,t)=>(await rs.patch(`/sales/sales/${e}/`,t)).data,Eo=async e=>(await rs.delete(`/sales/sales/${e}/`)).data,Ao=async e=>(await rs.post("/sales/invoices/",e)).data,Io=async(e,t)=>(await rs.patch(`/sales/invoices/${e}/`,t)).data,jo=async e=>{await rs.delete(`/sales/invoices/${e}/`)},To=async e=>(await rs.post("/sales/quotes/",e)).data,Do=async(e,t)=>(await rs.patch(`/sales/quotes/${e}/`,t)).data,Ro=async e=>{await rs.delete(`/sales/quotes/${e}/`)},No=async(e,t)=>(await rs.post(`/sales/quotes/${e}/convert_to_sale/`,{zone:t})).data,Po={getAll:fs,getByType:gs,create:async e=>(await rs.post("/treasury/accounts/",e)).data,update:async(e,t)=>(await rs.patch(`/treasury/accounts/${e}/`,t)).data,delete:async e=>{await rs.delete(`/treasury/accounts/${e}/`)},getBalance:async e=>(await rs.get(`/treasury/account-statements/balance/?account_id=${e}`)).data,getInfo:ys,getStatements:xs},Oo=Object.freeze(Object.defineProperty({__proto__:null,AccountsAPI:Po,InventoryAPI:Co,api:rs,debugAPI:ns,default:rs},Symbol.toStringTag,{value:"Module"})),ko=()=>{const[e,t]=jt.useState([]),[r,n]=jt.useState([]),[i,s]=jt.useState([]),[a,o]=jt.useState([]),[l,c]=jt.useState([]),[d,u]=jt.useState([]),[h,p]=jt.useState(!0),[m,f]=jt.useState(!1),[g,x]=jt.useState(!1),[y,w]=jt.useState(null),[b,v]=jt.useState({}),[C,_]=jt.useState([]),S=jt.useCallback((async()=>{try{const e=await(async()=>{const e=await rs.get("/sales/sales/");return e.data.results||e.data})();t(e)}catch(e){throw console.error("Error fetching sales:",e),w("Erreur lors du chargement des ventes"),e}}),[]),E=jt.useCallback((async()=>{try{f(!0);const e=await(async()=>{const e=await rs.get("/sales/invoices/");return e.data.results||e.data})();n(e),f(!1)}catch(e){throw console.error("Error fetching invoices:",e),w("Erreur lors du chargement des factures"),f(!1),e}}),[]),A=jt.useCallback((async()=>{try{x(!0);const e=await(async()=>{const e=await rs.get("/sales/quotes/");return e.data.results||e.data})();s(e),x(!1)}catch(e){throw console.error("Error fetching quotes:",e),w("Erreur lors du chargement des devis"),x(!1),e}}),[]),I=jt.useCallback((async()=>{try{const e=await ps();o(e)}catch(e){throw console.error("Error fetching clients:",e),w("Erreur lors du chargement des clients"),e}}),[]),j=jt.useCallback((async()=>{try{const e=await La();c(e)}catch(e){throw console.error("Error fetching products:",e),w("Erreur lors du chargement des produits"),e}}),[]),T=jt.useCallback((async()=>{try{const e=await ka();u(e)}catch(e){throw console.error("Error fetching zones:",e),w("Erreur lors du chargement des zones"),e}}),[]),D=jt.useCallback((async e=>{try{if(!e)return;p(!0);const t=await co(e),r=l.filter((e=>{const r=t.find((t=>t.product===e.id));return r&&r.quantity>0})),n=t.reduce(((e,t)=>(e[t.product]=t.quantity,e)),{});_(r),v(n),p(!1)}catch(t){throw console.error("Error fetching stock data:",t),w("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es de stock"),p(!1),t}}),[l]),R=jt.useCallback((async()=>{try{p(!0),w(null),await Promise.all([S(),E(),A(),I(),j(),T()]),p(!1)}catch(e){console.error("Error refreshing data:",e),w("Erreur lors du chargement des donnÃ©es"),p(!1)}}),[S,E,A,I,j,T]),N=jt.useCallback((async e=>{try{const t=await _o(e);return await S(),t}catch(t){throw console.error("Error creating sale:",t),t}}),[S]),P=jt.useCallback((async(e,t)=>{try{const r=await So(e,t);return await S(),r}catch(r){throw console.error("Error updating sale:",r),r}}),[S]),O=jt.useCallback((async e=>{try{await Eo(e),await S()}catch(t){throw console.error("Error deleting sale:",t),t}}),[S]),k=jt.useCallback((async(e,t)=>{try{const r=await So(e,{status:t});return await S(),r}catch(r){throw console.error("Error updating sale status:",r),r}}),[S]),M=jt.useCallback((async e=>{try{const t=await Ao(e);return await E(),t}catch(t){throw console.error("Error creating invoice:",t),t}}),[E]),F=jt.useCallback((async(e,t)=>{try{const r=await Io(e,t);return await E(),r}catch(r){throw console.error("Error updating invoice:",r),r}}),[E]),B=jt.useCallback((async e=>{try{await jo(e),await E()}catch(t){throw console.error("Error deleting invoice:",t),t}}),[E]),L=jt.useCallback((async e=>{try{const t=await To(e);return await A(),t}catch(t){throw console.error("Error creating quote:",t),t}}),[A]),z=jt.useCallback((async(e,t)=>{try{const r=await Do(e,t);return await A(),r}catch(r){throw console.error("Error updating quote:",r),r}}),[A]),U=jt.useCallback((async e=>{try{await Ro(e),await A()}catch(t){throw console.error("Error deleting quote:",t),t}}),[A]),W=jt.useCallback((async(e,t=1)=>{try{const r=await No(e,t);return await Promise.all([S(),A()]),r}catch(r){throw console.error("Error converting quote to sale:",r),r}}),[S,A]);return{sales:e,invoices:r,quotes:i,clients:a,products:l,zones:d,loading:h,invoiceLoading:m,quoteLoading:g,error:y,availableStock:b,productsWithStock:C,fetchSales:S,fetchInvoices:E,fetchQuotes:A,fetchClients:I,fetchProducts:j,fetchZones:T,fetchProductsWithStock:D,refreshAllData:R,createSale:N,updateSale:P,deleteSale:O,updateSaleStatus:k,createInvoice:M,updateInvoice:F,deleteInvoice:B,createQuote:L,updateQuote:z,deleteQuote:U,convertQuoteToSale:W,setError:w,setLoading:p}},Mo=(e,t)=>({pageSize:t,page:e}),Fo=[5,10,25,50],Bo=e=>{const t={active:{color:"success.main",bgcolor:"success.lighter"},inactive:{color:"error.main",bgcolor:"error.lighter"},pending:{color:"warning.main",bgcolor:"warning.lighter"},draft:{color:"grey.600",bgcolor:"grey.100"},confirmed:{color:"success.main",bgcolor:"success.lighter"},cancelled:{color:"error.main",bgcolor:"error.lighter"},default:{color:"text.secondary",bgcolor:"grey.100"},success:{color:"success.main",bgcolor:"success.lighter"},error:{color:"error.main",bgcolor:"error.lighter"},warning:{color:"warning.main",bgcolor:"warning.lighter"},info:{color:"info.main",bgcolor:"info.lighter"},primary:{color:"primary.main",bgcolor:"primary.lighter"},quote:{color:"info.main",bgcolor:"info.lighter"},order:{color:"primary.main",bgcolor:"primary.lighter"},invoice:{color:"success.main",bgcolor:"success.lighter"},paid:{color:"success.main",bgcolor:"success.lighter"},unpaid:{color:"error.main",bgcolor:"error.lighter"},partial:{color:"warning.main",bgcolor:"warning.lighter"},in_stock:{color:"success.main",bgcolor:"success.lighter"},low_stock:{color:"warning.main",bgcolor:"warning.lighter"},out_of_stock:{color:"error.main",bgcolor:"error.lighter"},normal:{color:"success.main",bgcolor:"success.lighter"},faible:{color:"warning.main",bgcolor:"warning.lighter"},rupture:{color:"error.main",bgcolor:"error.lighter"},received:{color:"success.main",bgcolor:"success.lighter"},completed:{color:"success.main",bgcolor:"success.lighter"},in_progress:{color:"info.main",bgcolor:"info.lighter"}}[e.toLowerCase()]||{color:"text.secondary",bgcolor:"grey.100"};return{fontWeight:600,borderRadius:2,color:t.color,bgcolor:t.bgcolor,border:`1px solid ${t.color}`,"&:hover":{bgcolor:t.color,color:"white"},transition:"all 0.2s ease-in-out"}},Lo=({standardVariant:e="primary",variant:r="contained",sx:n,children:i,...s})=>t.jsx(k,{variant:"secondary"===e?"outlined":"action"===e||"icon"===e?"text":r,sx:[(()=>{switch(e){case"primary":default:return{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"};case"secondary":return{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"};case"action":return{borderRadius:1.5,minWidth:"auto",p:1,"&:hover":{transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"};case"icon":return{borderRadius:2,p:1,"&:hover":{backgroundColor:"action.hover",transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"}}})(),...Array.isArray(n)?n:[n]],...s,children:i}),zo=({requiredPermission:e,disabledMessage:r="You do not have permission for this action",hideOnNoPermission:n=!1,children:i,disabled:s,...a})=>{const{hasPermission:o,loading:c}=Di();if(!e||c)return t.jsx(k,{disabled:c||s,...a,children:i});const d=o(e);return!d&&n?null:d?t.jsx(k,{disabled:s,...a,children:i}):t.jsx(l,{title:r,children:t.jsx("span",{children:t.jsx(k,{disabled:!0,...a,children:i})})})},Uo={add:"Ajouter",edit:"Modifier",update:"Mettre Ã  jour",delete:"Supprimer",save:"Enregistrer",cancel:"Annuler",confirm:"Confirmer",close:"Fermer",refresh:"Actualiser",search:"Rechercher",filter:"Filtrer",view:"Voir",download:"TÃ©lÃ©charger",upload:"TÃ©lÃ©verser",import:"Importer",export:"Exporter",print:"Imprimer",scan:"Scanner",actions:"Actions",previous:"PrÃ©cÃ©dent",next:"Suivant",back:"Retour",home:"Accueil",dashboard:"Tableau de bord",loading:"Chargement...",saving:"Sauvegarde...",success:"SuccÃ¨s",error:"Erreur",warning:"Attention",info:"Information",name:"Nom",company:"Entreprise",description:"Description",date:"Date",time:"Heure",status:"Statut",type:"Type",category:"CatÃ©gorie",reference:"RÃ©fÃ©rence",quantity:"QuantitÃ©",price:"Prix",total:"Total",subtotal:"Sous-total",tax:"Taxe",client:"Client",clients:"Clients",totalAmount:"Montant Total",paidAmount:"Montant PayÃ©",remainingAmount:"Reste Ã  Payer",payment:"Paiement",viewDetails:"Voir dÃ©tails",overduePayment:"Paiement en retard",safeDeletable:"Cette vente peut Ãªtre supprimÃ©e en toute sÃ©curitÃ©",contact:"Contact",contactPerson:"Personne de contact",email:"Email",phone:"TÃ©lÃ©phone",address:"Adresse",priceGroup:"Groupe de prix",account:"Compte",coordinates:"CoordonnÃ©es",supplier:"Fournisseur",suppliers:"Fournisseurs",noData:"Aucune donnÃ©e disponible",noResults:"Aucun rÃ©sultat trouvÃ©",confirmDelete:"ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ©ment ?",unsavedChanges:"Vous avez des modifications non sauvegardÃ©es",required:"Ce champ est requis",invalid:"Valeur invalide",tooShort:"Trop court",tooLong:"Trop long",mustBePositive:"Doit Ãªtre positif",mustBeGreaterThanZero:"Doit Ãªtre supÃ©rieur Ã  zÃ©ro"},Wo={active:"Actif",inactive:"Inactif",pending:"En attente",approved:"ApprouvÃ©",rejected:"RejetÃ©",draft:"Brouillon",published:"PubliÃ©",archived:"ArchivÃ©",cancelled:"AnnulÃ©",completed:"TerminÃ©",confirmed:"ConfirmÃ©",in_stock:"En stock",low_stock:"Stock faible",out_of_stock:"Rupture de stock",normal:"Normal",faible:"Faible",rupture:"Rupture",received:"ReÃ§u",in_progress:"En cours",quote:"Devis",order:"Commande",invoice:"Facture",delivered:"LivrÃ©",shipped:"ExpÃ©diÃ©",payment_pending:"Paiement en attente",partially_paid:"Partiellement payÃ©",paid:"PayÃ©",unpaid:"Non payÃ©",partial:"Partiel",overdue:"En retard",unknown:"Inconnu",sent:"EnvoyÃ©",accepted:"AcceptÃ©",expired:"ExpirÃ©",raw_material:"MatiÃ¨re premiÃ¨re",finished_product:"Produit fini"},Vo={dashboard:"Tableau de bord",sales:"Ventes",inventory:"Inventaire",products:"Produits",clients:"Clients",suppliers:"Fournisseurs",treasury:"TrÃ©sorerie",production:"Production",userManagement:"Gestion des utilisateurs",settings:"ParamÃ¨tres",currentStock:"Stock actuel",stockSupplies:"Approvisionnements",stockTransfers:"Transferts",inventoryCount:"Inventaires",stockHistory:"Historique",quotes:"Devis",orders:"Commandes",invoices:"Factures",accounts:"Comptes",transactions:"Transactions",reports:"Rapports"},Ho={stock:"Stock",currentStock:"Stock actuel",warehouse:"EntrepÃ´t",location:"Emplacement",zone:"Zone",product:"Produit",products:"Produits",quantity:"QuantitÃ©",supply:"Approvisionnement",supplies:"Approvisionnements",transfer:"Transfert",transfers:"Transferts",inventory:"Inventaire",inventories:"Inventaires",movement:"Mouvement",movements:"Mouvements",expectedQuantity:"QuantitÃ© attendue",actualQuantity:"QuantitÃ© rÃ©elle",difference:"DiffÃ©rence",unitPrice:"Prix unitaire",totalPrice:"Prix total",stockValue:"Valeur du stock",totalQuantity:"QuantitÃ© Total",merchandiseValue:"Valeur de la marchandise",receive:"RÃ©ceptionner",count:"Compter",adjust:"Ajuster",addProduct:"Ajouter un produit",selectProduct:"SÃ©lectionner un produit",selectSupplier:"SÃ©lectionner un fournisseur",selectLocation:"SÃ©lectionner un emplacement",selectSourceLocation:"SÃ©lectionner l'emplacement source",selectTargetLocation:"SÃ©lectionner l'emplacement cible",noProductSelected:"Aucun produit sÃ©lectionnÃ©",noSupplierSelected:"Aucun fournisseur sÃ©lectionnÃ©",noLocationSelected:"Aucun emplacement sÃ©lectionnÃ©",invalidQuantity:"QuantitÃ© invalide",invalidPrice:"Prix invalide",sameSourceTarget:"L'emplacement source et cible doivent Ãªtre diffÃ©rents"},Go={quote:"Devis",quotes:"Devis",order:"Commande",orders:"Commandes",invoice:"Facture",invoices:"Factures",client:"Client",clients:"Clients",amount:"Montant",discount:"Remise",convertToOrder:"Convertir en commande",convertToInvoice:"Convertir en facture",generateInvoice:"GÃ©nÃ©rer la facture",selectClient:"SÃ©lectionner un client",addItem:"Ajouter un article"},qo={product:"Produit",products:"Produits",category:"CatÃ©gorie",categories:"CatÃ©gories",unit:"UnitÃ©",units:"UnitÃ©s",unitOfMeasure:"UnitÃ© de mesure",barcode:"Code-barres",qrCode:"Code QR",productName:"Nom du produit",productCode:"Code produit",purchasePrice:"Prix d'achat",salePrice:"Prix de vente",minStock:"Stock minimum",selectCategory:"SÃ©lectionner une catÃ©gorie",selectUnit:"SÃ©lectionner une unitÃ©"},Xo={client:"Client",clients:"Clients",supplier:"Fournisseur",suppliers:"Fournisseurs",addClient:"Ajouter un client",addSupplier:"Ajouter un fournisseur",companyName:"Nom de l'entreprise",contactPerson:"Personne de contact",email:"Email",phone:"TÃ©lÃ©phone",address:"Adresse",city:"Ville",postalCode:"Code postal",country:"Pays",selectClient:"SÃ©lectionner un client",selectSupplier:"SÃ©lectionner un fournisseur"},$o="Lignes par page",Zo="sur",Yo={fieldRequired:"Ce champ est requis",invalidEmail:"Adresse email invalide",invalidPhone:"NumÃ©ro de tÃ©lÃ©phone invalide",invalidNumber:"Nombre invalide",mustBePositive:"Doit Ãªtre un nombre positif",mustBeGreaterThanZero:"Doit Ãªtre supÃ©rieur Ã  zÃ©ro",tooShort:"Trop court",tooLong:"Trop long",saveSuccess:"Sauvegarde rÃ©ussie",deleteSuccess:"Suppression rÃ©ussie",createSuccess:"CrÃ©ation rÃ©ussie",updateSuccess:"Mise Ã  jour rÃ©ussie",saveError:"Erreur lors de la sauvegarde",deleteError:"Erreur lors de la suppression",createError:"Erreur lors de la crÃ©ation",updateError:"Erreur lors de la mise Ã  jour",loadError:"Erreur lors du chargement",unknownError:"Erreur inconnue"},Qo={today:"Aujourd'hui",yesterday:"Hier",tomorrow:"Demain",thisWeek:"Cette semaine",thisMonth:"Ce mois",thisYear:"Cette annÃ©e",monday:"Lundi",tuesday:"Mardi",wednesday:"Mercredi",thursday:"Jeudi",friday:"Vendredi",saturday:"Samedi",sunday:"Dimanche",january:"Janvier",february:"FÃ©vrier",march:"Mars",april:"Avril",may:"Mai",june:"Juin",july:"Juillet",august:"AoÃ»t",september:"Septembre",october:"Octobre",november:"Novembre",december:"DÃ©cembre"},Ko=e=>Wo[e]||e,Jo=e=>Uo[e]?Uo[e]:Wo[e]?Wo[e]:Vo[e]?Vo[e]:Ho[e]?Ho[e]:Go[e]?Go[e]:qo[e]?qo[e]:Xo[e]?Xo[e]:Yo[e]?Yo[e]:Qo[e]?Qo[e]:e,el=({title:e,loading:r=!1,noDataMessage:n=Uo.noData,page:i=0,rowsPerPage:s=10,onPaginationChange:a,showToolbar:o=!1,sx:l,rows:u,columns:h,...p})=>{const f={toolbarDensity:"DensitÃ©",toolbarDensityLabel:"DensitÃ©",toolbarDensityCompact:"Compact",toolbarDensityStandard:"Standard",toolbarDensityComfortable:"Confortable",toolbarColumns:"Colonnes",toolbarColumnsLabel:"SÃ©lectionner les colonnes",toolbarFilters:"Filtres",toolbarFiltersLabel:"Afficher les filtres",toolbarFiltersTooltipHide:"Masquer les filtres",toolbarFiltersTooltipShow:"Afficher les filtres",toolbarFiltersTooltipActive:e=>1!==e?`${e} filtres actifs`:`${e} filtre actif`,toolbarExport:"Exporter",toolbarExportLabel:"Exporter",toolbarExportCSV:"TÃ©lÃ©charger en CSV",toolbarExportPrint:"Imprimer",MuiTablePagination:{labelRowsPerPage:$o,labelDisplayedRows:({from:e,to:t,count:r})=>`${e}â€“${t} ${Zo} ${-1!==r?r:`plus de ${t}`}`},columnMenuLabel:"Menu",columnMenuShowColumns:"Afficher les colonnes",columnMenuFilter:"Filtrer",columnMenuHideColumn:"Masquer",columnMenuUnsort:"Annuler le tri",columnMenuSortAsc:"Tri croissant",columnMenuSortDesc:"Tri dÃ©croissant",filterPanelAddFilter:"Ajouter un filtre",filterPanelDeleteIconLabel:"Supprimer",filterPanelOperators:"OpÃ©rateur",filterPanelOperatorAnd:"Et",filterPanelOperatorOr:"Ou",filterPanelColumns:"Colonnes",filterPanelInputLabel:"Valeur",filterPanelInputPlaceholder:"Valeur du filtre",filterOperatorContains:"contient",filterOperatorEquals:"Ã©gale",filterOperatorStartsWith:"commence par",filterOperatorEndsWith:"finit par",filterOperatorIs:"est",filterOperatorNot:"n'est pas",filterOperatorAfter:"postÃ©rieur Ã ",filterOperatorOnOrAfter:"postÃ©rieur ou Ã©gal Ã ",filterOperatorBefore:"antÃ©rieur Ã ",filterOperatorOnOrBefore:"antÃ©rieur ou Ã©gal Ã ",filterOperatorIsEmpty:"est vide",filterOperatorIsNotEmpty:"n'est pas vide",filterOperatorIsAnyOf:"est n'importe lequel",noRowsLabel:n,noResultsOverlayLabel:Uo.noResults,errorOverlayDefaultLabel:"Une erreur est survenue.",checkboxSelectionHeaderName:"SÃ©lection",sortedAscending:"triÃ© par ordre croissant",sortedDescending:"triÃ© par ordre dÃ©croissant",columnHeaderFiltersTooltipActive:e=>1!==e?`${e} filtres actifs`:`${e} filtre actif`,columnHeaderFiltersLabel:"Afficher les filtres",columnHeaderSortIconLabel:"Trier"};return t.jsxs(c,{children:[e&&t.jsx(d,{variant:"h6",component:"h2",gutterBottom:!0,children:e}),t.jsx(c,{sx:[{height:500,width:"100%",boxShadow:2,borderRadius:2,overflow:"hidden",bgcolor:"background.paper",border:"none","& .MuiDataGrid-columnHeaders":{backgroundColor:e=>"dark"===e.palette.mode?"background.paper":"primary.lighter",color:e=>e.palette.text.primary,fontWeight:"bold",fontSize:"0.875rem"},"& .MuiDataGrid-cell":{borderBottom:"1px solid",borderColor:"divider",fontSize:"0.875rem",display:"flex",alignItems:"center"},"& .MuiDataGrid-row:hover":{backgroundColor:e=>"dark"===e.palette.mode?"action.hover":"primary.lightest",cursor:"pointer"},"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-cell:focus-within":{outline:"none"},"& .MuiDataGrid-columnHeader:focus":{outline:"none"}},...Array.isArray(l)?l:[l]],children:r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:200},children:t.jsx(m,{size:40})}):t.jsx(de,{rows:u,columns:h,loading:r,pagination:!0,paginationModel:Mo(i,s),onPaginationModelChange:e=>{a&&a(e.page,e.pageSize)},pageSizeOptions:Fo,checkboxSelection:!1,disableRowSelectionOnClick:!p.onRowClick,slots:o?{toolbar:me}:void 0,localeText:f,getRowId:e=>e.id||Math.random(),...p})})]})};var tl={},rl={};const nl=Ot(fe);var il;function sl(){return il||(il=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=nl}(rl)),rl}var al=ge;Object.defineProperty(tl,"__esModule",{value:!0});var ol=tl.default=void 0,ll=al(sl()),cl=t;ol=tl.default=(0,ll.default)((0,cl.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");const dl=({open:e,onClose:r,onConfirm:n,loading:i=!1,title:s="Confirmation de suppression",type:a="sale",item:o,confirmationInfo:l})=>t.jsxs(xe,{open:e,onClose:r,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:"background.paper"}},children:[t.jsx(ye,{sx:{backgroundColor:"error.main",color:"#fff",fontWeight:"bold"},children:s}),t.jsxs(we,{children:[t.jsxs(d,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer ","invoice"===a?"cette facture":"quote"===a?"ce devis":"cette vente"," ?"]}),(null==o?void 0:o.reference)&&t.jsxs(d,{sx:{mt:2},children:[t.jsx("strong",{children:"RÃ©fÃ©rence :"})," ",o.reference]}),l&&t.jsxs(d,{sx:{mt:2,color:"warning.main"},children:[l.willRestoreStock&&"Le stock sera restaurÃ©.",l.willRefundAmount>0&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),"Montant remboursÃ© : ",l.willRefundAmount]})]})]}),t.jsxs(be,{sx:{p:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(k,{onClick:r,disabled:i,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(k,{variant:"contained",color:"error",onClick:n,disabled:i,startIcon:i?t.jsx(m,{size:20}):t.jsx(ol,{}),sx:{borderRadius:"20px",boxShadow:"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"0 4px 10px rgba(0,0,0,0.1)"}},children:i?"Suppression...":"Supprimer"})]})]}),ul=({sx:e,size:r="small",variant:n="outlined",...i})=>t.jsx(V,{size:r,variant:n,sx:[{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:2}},"& .MuiInputLabel-root":{fontWeight:500}},...Array.isArray(e)?e:[e]],...i}),hl=({label:e,children:r,sx:n,size:i="small",...s})=>t.jsxs(Y,{size:i,sx:[{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:2}},"& .MuiInputLabel-root":{fontWeight:500}},...Array.isArray(n)?n:[n]],fullWidth:s.fullWidth,children:[e&&t.jsx(Q,{children:e}),t.jsx(K,{label:e,...s,children:r})]}),pl=({status:e,translateStatus:r=!0,size:n="small",sx:i,...s})=>{const a=r?Ko(e):e;return t.jsx(ue,{label:a,size:n,sx:[Bo(e),...Array.isArray(i)?i:[i]],...s})},ml=u(ve)((({theme:e})=>({[`&.${Ce.alternativeLabel}`]:{top:22},[`&.${Ce.active}`]:{[`& .${Ce.line}`]:{backgroundImage:`linear-gradient(95deg, ${e.palette.primary.light} 0%, ${e.palette.primary.main} 50%, ${e.palette.primary.dark} 100%)`}},[`&.${Ce.completed}`]:{[`& .${Ce.line}`]:{backgroundImage:`linear-gradient(95deg, ${e.palette.success.light} 0%, ${e.palette.success.main} 50%, ${e.palette.success.dark} 100%)`}},[`& .${Ce.line}`]:{height:3,border:0,backgroundColor:"dark"===e.palette.mode?e.palette.grey[800]:"#eaeaf0",borderRadius:1}}))),fl=u("div")((({theme:e,ownerState:t})=>({backgroundColor:"dark"===e.palette.mode?e.palette.grey[700]:"#ccc",zIndex:1,color:"#fff",width:50,height:50,display:"flex",borderRadius:"50%",justifyContent:"center",alignItems:"center",...t.active&&{backgroundImage:`linear-gradient(136deg, ${e.palette.primary.light} 0%, ${e.palette.primary.main} 50%, ${e.palette.primary.dark} 100%)`,boxShadow:"0 4px 10px 0 rgba(0,0,0,.25)"},...t.completed&&{backgroundImage:`linear-gradient(136deg, ${e.palette.success.light} 0%, ${e.palette.success.main} 50%, ${e.palette.success.dark} 100%)`},...t.cancelled&&{backgroundImage:`linear-gradient(136deg, ${e.palette.error.light} 0%, ${e.palette.error.main} 50%, ${e.palette.error.dark} 100%)`}}))),gl=e=>{const{active:r,completed:n,cancelled:i,icon:s}=e;return t.jsx(fl,{ownerState:{active:r,completed:n,cancelled:i},children:s})},xl=({status:e,reference:r,allowedTransitions:n,onStatusChange:i,isLoading:s=!1})=>{var a;const o=[{label:"Brouillon",value:"draft",icon:t.jsx(Ne,{}),description:"Vente en cours de crÃ©ation"},{label:"En attente",value:"pending",icon:t.jsx(Ne,{}),description:"Vente enregistrÃ©e en attente de confirmation"},{label:"ConfirmÃ©e",value:"confirmed",icon:t.jsx(b,{}),description:"Vente confirmÃ©e"},{label:"Paiement en attente",value:"payment_pending",icon:t.jsx(Ie,{}),description:"En attente de paiement"},{label:"PayÃ©e partiellement",value:"partially_paid",icon:t.jsx(Ie,{}),description:"Paiement partiel reÃ§u"},{label:"PayÃ©e",value:"paid",icon:t.jsx(je,{}),description:"Paiement reÃ§u"},{label:"ExpÃ©diÃ©e",value:"shipped",icon:t.jsx(C,{}),description:"Produits en cours de livraison au client"},{label:"LivrÃ©e",value:"delivered",icon:t.jsx(Te,{}),description:"Produits livrÃ©s au client"},{label:"ComplÃ©tÃ©e",value:"completed",icon:t.jsx(Te,{}),description:"Vente finalisÃ©e"}],u="cancelled"===e?-1:o.findIndex((t=>t.value===e)),h=e=>{i&&!s&&i(e)};return t.jsxs(U,{sx:{p:3,borderRadius:2,mb:3,boxShadow:3},children:[t.jsxs(c,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},borderBottom:"1px solid",borderColor:"divider",pb:2},children:[t.jsxs(c,{children:[t.jsxs(d,{variant:"subtitle1",fontWeight:"bold",sx:{fontSize:"1.1rem"},children:["Suivi de vente: ",r]}),t.jsxs(c,{sx:{display:"flex",alignItems:"center",mt:.5},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mr:1},children:"Statut actuel:"}),"cancelled"===e?t.jsx(ue,{color:"error",size:"small",label:"AnnulÃ©e"}):t.jsx(ue,{color:"completed"===e?"success":"paid"===e?"primary":"partially_paid"===e?"warning":"default",size:"small",label:(null==(a=o.find((t=>t.value===e)))?void 0:a.label)||e})]})]}),t.jsxs(c,{sx:{mt:{xs:2,sm:0}},children:[t.jsx(d,{variant:"caption",color:"text.secondary",children:"DerniÃ¨re mise Ã  jour"}),t.jsx(d,{variant:"body2",children:(new Date).toLocaleDateString()})]})]}),"cancelled"===e?t.jsxs(c,{sx:{display:"flex",alignItems:"center",bgcolor:"error.lighter",p:2,borderRadius:1,mb:2},children:[t.jsx(_e,{color:"error",sx:{fontSize:32,mr:2}}),t.jsxs(c,{children:[t.jsx(d,{fontWeight:"medium",color:"error",children:"Cette vente a Ã©tÃ© annulÃ©e"}),t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucune autre action n'est possible sur cette vente"})]})]}):t.jsx(Se,{activeStep:u,alternativeLabel:!0,connector:t.jsx(ml,{}),sx:{mb:3},children:o.map(((e,r)=>{const n={completed:r<u},i=r===u;return t.jsxs(Ee,{...n,children:["                ",t.jsxs(Ae,{StepIconComponent:()=>t.jsx(gl,{active:i,completed:r<u,icon:e.icon}),children:[t.jsx(d,{variant:"body2",color:i?"primary.main":r<u?"success.main":"text.secondary",sx:{fontWeight:i?"bold":"medium"},children:e.label}),t.jsx(d,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:e.description})]})]},e.value)}))}),"      ",u!==o.length-1&&"cancelled"!==e&&t.jsxs(c,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",gap:2,mt:2},children:[n.includes("confirmed")&&"pending"===e&&t.jsx(k,{variant:"contained",color:"primary",onClick:()=>h("confirmed"),startIcon:t.jsx(b,{}),disabled:s,size:"small",children:"Confirmer la vente"}),n.includes("payment_pending")&&"confirmed"===e&&t.jsx(k,{variant:"contained",color:"primary",onClick:()=>h("payment_pending"),startIcon:t.jsx(Ie,{}),disabled:s,size:"small",sx:{boxShadow:2},children:"Paiement en attente"}),"          ",n.includes("partially_paid")&&"payment_pending"===e&&t.jsx(k,{variant:"contained",color:"warning",onClick:()=>h("partially_paid"),startIcon:t.jsx(je,{}),disabled:s,size:"small",sx:{boxShadow:2},children:"Marquer comme payÃ©e partiellement"}),n.includes("paid")&&("payment_pending"===e||"partially_paid"===e)&&t.jsx(k,{variant:"contained",color:"success",onClick:()=>h("paid"),startIcon:t.jsx(Te,{}),disabled:s,size:"small",sx:{boxShadow:2},children:"Marquer comme payÃ©e"}),n.includes("shipped")&&"paid"===e&&t.jsx(k,{variant:"contained",color:"primary",onClick:()=>h("shipped"),startIcon:t.jsx(C,{}),disabled:s,size:"small",children:"Marquer comme expÃ©diÃ©e"}),n.includes("delivered")&&"shipped"===e&&t.jsx(k,{variant:"contained",color:"primary",onClick:()=>h("delivered"),startIcon:t.jsx(Te,{}),disabled:s,size:"small",children:"Marquer comme livrÃ©e"}),n.includes("completed")&&"delivered"===e&&t.jsx(k,{variant:"contained",color:"success",onClick:()=>h("completed"),startIcon:t.jsx(Te,{}),disabled:s,size:"small",children:"ComplÃ©ter la vente"}),n.includes("fast_track")&&"completed"!==e&&"cancelled"!==e&&t.jsx(l,{title:"Passer directement Ã  l'Ã©tape complÃ©tÃ©e",children:t.jsx(k,{variant:"outlined",color:"secondary",size:"small",onClick:()=>{["pending","confirmed","payment_pending","partially_paid"].includes(e)?(h("paid"),setTimeout((()=>{h("shipped"),setTimeout((()=>{h("delivered"),setTimeout((()=>{h("completed")}),300)}),300)}),300)):"paid"===e?(h("shipped"),setTimeout((()=>{h("delivered"),setTimeout((()=>{h("completed")}),300)}),300)):"shipped"===e&&(h("delivered"),setTimeout((()=>{h("completed")}),300))},startIcon:t.jsx(De,{}),disabled:s,children:"ComplÃ©ter rapidement"})}),n.includes("cancelled")&&"completed"!==e&&"cancelled"!==e&&t.jsx(k,{variant:"outlined",color:"error",onClick:()=>h("cancelled"),startIcon:t.jsx(_e,{}),disabled:s,size:"small",children:"Annuler la vente"})]}),"      ","completed"===e&&t.jsxs(c,{sx:{display:"flex",justifyContent:"center",mt:2,gap:2},children:[t.jsx(k,{variant:"outlined",color:"primary",size:"small",startIcon:t.jsx(Ie,{}),disabled:s,children:"Imprimer le reÃ§u"}),t.jsx(k,{variant:"outlined",color:"success",size:"small",startIcon:t.jsx(Re,{}),disabled:s,children:"Voir les dÃ©tails"})]})]})},yl=({open:e,editMode:r,contactType:n,formData:i,availableAccounts:s,loadingAccounts:a,priceGroups:o,loadingPriceGroups:l,onClose:u,onSubmit:p,onFormDataChange:m,onAccountChange:f,onPriceGroupChange:g,onCreateAccount:x})=>{const y=h(),w="client"===n,b=e=>t=>{m({...i,[e]:t.target.value})};return t.jsxs(xe,{open:e,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",minHeight:"400px"}},children:[t.jsx(ye,{sx:{backgroundColor:y.palette.primary.main,color:"white",fontWeight:"bold",py:2,px:3},children:r?w?"Modifier le client":"Modifier le fournisseur":w?"Ajouter un client":"Ajouter un fournisseur"}),t.jsx(we,{sx:{p:3,mt:1},children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(ul,{label:"Entreprise",value:i.name,onChange:b("name"),required:!0,fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(ul,{label:"Nom Prenom",value:i.contact_person||"",onChange:b("contact_person"),fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(ul,{label:"Email",value:i.email||"",onChange:b("email"),type:"email",fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(ul,{label:"TÃ©lÃ©phone",value:i.phone||"",onChange:b("phone"),fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(ul,{label:"Adresse",value:i.address||"",onChange:b("address"),multiline:!0,rows:2,fullWidth:!0})}),w&&o&&g&&t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(hl,{label:"Groupe de prix",value:i.price_group||"",onChange:e=>g(Number(e.target.value)),fullWidth:!0,children:l?t.jsx(B,{disabled:!0,children:"Chargement des groupes de prix..."}):o&&Array.isArray(o)&&0===o.length?t.jsx(B,{disabled:!0,children:"Aucun groupe de prix disponible"}):o&&Array.isArray(o)&&o.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})}),t.jsx(oe,{item:!0,xs:12,sm:w&&o?6:12,children:t.jsxs(hl,{label:w?"Compte client":"Compte fournisseur",value:i.account??"",onChange:e=>f(""===e.target.value?"":Number(e.target.value)),fullWidth:!0,children:[t.jsx(B,{value:"",children:"SÃ©lectionner un compte"}),a?t.jsx(B,{disabled:!0,children:"Chargement des comptes..."}):s&&Array.isArray(s)&&0===s.length?t.jsx(B,{disabled:!0,children:w?"Aucun compte client disponible":"Aucun compte fournisseur disponible"}):s&&Array.isArray(s)&&s.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})}),s&&Array.isArray(s)&&0===s.length&&!a&&x&&t.jsx(oe,{item:!0,xs:12,children:t.jsxs(c,{sx:{mt:1,p:2,backgroundColor:y.palette.warning.light+"20",borderRadius:2,border:`1px solid ${y.palette.warning.main}`,display:"flex",flexDirection:"column",gap:1},children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:w?"Aucun compte client disponible. Veuillez d'abord crÃ©er un compte de type client dans la section ParamÃ¨tres.":"Aucun compte fournisseur disponible. Veuillez d'abord crÃ©er un compte de type fournisseur dans la section ParamÃ¨tres."}),t.jsx(k,{variant:"outlined",size:"small",startIcon:t.jsx(I,{}),onClick:()=>{u(),x()},sx:{alignSelf:"flex-start",textTransform:"none",borderColor:y.palette.warning.main,color:y.palette.warning.main,"&:hover":{borderColor:y.palette.warning.dark,backgroundColor:y.palette.warning.light+"10"}},children:"CrÃ©er un compte dans ParamÃ¨tres"})]})})]})}),t.jsxs(be,{sx:{p:2,pt:0},children:[t.jsx(Lo,{onClick:u,children:Jo("cancel")}),t.jsx(Lo,{onClick:p,variant:"contained",disabled:!i.name,children:Jo(r?"update":"add")})]})]})},wl=(e,t)=>{if(""===e)return 0;if(/^(0|[1-9]\d*)$/.test(e)){const t=parseInt(e,10);if(!isNaN(t)&&t>=0)return t}return t??0},bl=(e,t)=>{if(""===e||/^\d*\.?\d*$/.test(e)){const t=""===e?0:parseFloat(e);if(!isNaN(t)&&t>=0)return t}return t??0},vl=e=>null==e||0===e?"":e.toString(),Cl=(e,t)=>{const r=e??0;switch(t){case"quantity":return r<1&&0!==r?"La quantitÃ© doit Ãªtre supÃ©rieure Ã  0":"";case"price":return r<0?"Le prix doit Ãªtre positif":"";case"amount":return r<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":"";case"stock":return r<0?"Le niveau doit Ãªtre positif ou zÃ©ro":"";default:return""}},_l=({productId:e,productName:r,downloadable:n=!0,width:i="150px",height:s="150px"})=>{const[a,o]=jt.useState(!0),[l,u]=jt.useState(null),[h,p]=jt.useState(null),f=jt.useRef(null);jt.useEffect((()=>(e&&(async()=>{try{o(!0),u(null);const t=await Va(e),r=URL.createObjectURL(t);f.current=r,p(r)}catch(t){console.error(`Error fetching QR code for product ${e}:`,t),u("Impossible de charger le code QR")}finally{o(!1)}})(),()=>{f.current&&(URL.revokeObjectURL(f.current),f.current=null)})),[e]);return t.jsx(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"1px dashed rgba(0, 0, 0, 0.2)",borderRadius:2,padding:2,bgcolor:"rgba(0, 0, 0, 0.02)"},children:a?t.jsx(m,{size:40}):l?t.jsx(d,{color:"error",variant:"body2",children:l}):h?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:h,alt:`QR Code pour ${r||`produit ${e}`}`,style:{width:i,height:s,marginBottom:n?"8px":"0"}}),n&&t.jsx(k,{variant:"outlined",size:"small",onClick:()=>{if(h){const t=document.createElement("a");t.href=h,t.download=`QR_${r||`Product_${e}`}_${(new Date).getTime()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},sx:{mt:1},children:"TÃ©lÃ©charger"})]}):t.jsx(d,{color:"textSecondary",children:"QR Code non disponible"})})},Sl=({sales:e,loading:r,clients:n,searchTerm:i,setSearchTerm:s,statusFilter:a,setStatusFilter:o,dateFilter:l,setDateFilter:u,onAdd:h,onEdit:p,onDelete:g})=>{const x=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1,minWidth:120},{field:"client",headerName:"Client",flex:1.5,minWidth:150,valueGetter:(e,t)=>{if(!t)return"";const r=n.find((e=>e.id===t.client));return(null==r?void 0:r.name)||"N/A"}},{field:"date",headerName:"Date",flex:1,minWidth:100,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString("fr-FR"):""},{field:"total_amount",headerName:"Montant Total",flex:1,valueGetter:(e,t)=>{return t?(r=t.total_amount,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(r)):"";var r}},{field:"status",headerName:"Statut",flex:1,valueGetter:(e,t)=>t&&t.status?Ko(t.status):"",renderCell:e=>e.row&&e.row.status?t.jsx(pl,{status:e.row.status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,minWidth:120,sortable:!1,renderCell:e=>{if(!e.row)return t.jsx(t.Fragment,{});const r="pending"===e.row.status||"cancelled"===e.row.status;return t.jsxs(c,{sx:{display:"flex",gap:.5},children:[t.jsx(f,{size:"small",color:"primary",onClick:t=>{t.stopPropagation(),p(e.row)},title:"Modifier",children:t.jsx(X,{fontSize:"small"})}),r&&t.jsx(f,{size:"small",color:"error",onClick:t=>{t.stopPropagation(),g(e.row)},title:"Supprimer",children:t.jsx(te,{fontSize:"small"})})]})}}],y=e.length,w=e.filter((e=>"pending"===e.status)).length,b=e.filter((e=>"unpaid"===e.payment_status)).length,v=e.filter((e=>"partially_paid"===e.payment_status)).length,C=e.filter((e=>"paid"===e.payment_status)).length;return t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",gap:1,mb:3,backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Ventes"}),t.jsx(d,{variant:"h6",color:"primary.main",children:y})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"En attente"}),t.jsx(d,{variant:"h6",color:"warning.main",children:w})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Non payÃ©"}),t.jsx(d,{variant:"h6",color:"error.main",children:b})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Partiellement payÃ©"}),t.jsx(d,{variant:"h6",color:"info.main",children:v})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"PayÃ©"}),t.jsx(d,{variant:"h6",color:"success.main",children:C})]})]}),t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence ou client",variant:"outlined",size:"small",fullWidth:!0,value:i,onChange:e=>s(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(X,{fontSize:"small",color:"action"})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>s(""),edge:"end",children:t.jsx(te,{fontSize:"small"})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{id:"status-filter-label",children:"Statut"}),t.jsxs(K,{labelId:"status-filter-label",id:"status-filter",value:a,onChange:e=>o(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous les statuts"}),t.jsx(B,{value:"pending",children:"En attente"}),t.jsx(B,{value:"confirmed",children:"ConfirmÃ©e"}),t.jsx(B,{value:"payment_pending",children:"Paiement en attente"}),t.jsx(B,{value:"partially_paid",children:"Partiellement payÃ©e"}),t.jsx(B,{value:"paid",children:"PayÃ©e"}),t.jsx(B,{value:"shipped",children:"ExpÃ©diÃ©e"}),t.jsx(B,{value:"delivered",children:"LivrÃ©e"}),t.jsx(B,{value:"completed",children:"TerminÃ©e"}),t.jsx(B,{value:"cancelled",children:"AnnulÃ©e"})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{id:"date-filter-label",children:"PÃ©riode"}),t.jsxs(K,{labelId:"date-filter-label",id:"date-filter",value:l,onChange:e=>u(e.target.value),label:"PÃ©riode",children:[t.jsx(B,{value:"",children:"Toutes les pÃ©riodes"}),t.jsx(B,{value:"today",children:"Aujourd'hui"}),t.jsx(B,{value:"week",children:"Cette semaine"}),t.jsx(B,{value:"month",children:"Ce mois"}),t.jsx(B,{value:"quarter",children:"Ce trimestre"}),t.jsx(B,{value:"year",children:"Cette annÃ©e"})]})]})]}),t.jsx(Pe,{direction:"row",spacing:2,children:t.jsx(zo,{requiredPermission:"sales.add_sale",variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:h,children:"Nouvelle vente"})})]}),r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:e,columns:x,loading:r,getRowId:e=>(null==e?void 0:e.id)??Math.random(),onRowClick:e=>p(e.row),showToolbar:!0})]})},El=({invoices:e,loading:r,clients:n,searchTerm:i,setSearchTerm:s,statusFilter:a,setStatusFilter:o,dateFilter:l,setDateFilter:u,onAdd:h,onEdit:p,onDelete:g,onPrint:x})=>{const y=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(e),w=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1,minWidth:120},{field:"sale",headerName:"Vente",flex:1,minWidth:120,valueGetter:(e,t)=>t&&t.sale_reference?t.sale_reference:"N/A"},{field:"client",headerName:"Client",flex:1.5,minWidth:150,valueGetter:(e,t)=>{if(!t)return"";const r=n.find((e=>e.id===t.client));return(null==r?void 0:r.name)||"N/A"}},{field:"issue_date",headerName:"Date Emission",flex:1,minWidth:110,valueGetter:(e,t)=>t&&t.issue_date?new Date(t.issue_date).toLocaleDateString("fr-FR"):""},{field:"due_date",headerName:"Date Ã‰chÃ©ance",flex:1,minWidth:120,valueGetter:(e,t)=>t&&t.due_date?new Date(t.due_date).toLocaleDateString("fr-FR"):""},{field:"amount",headerName:"Montant",flex:1,minWidth:120,valueGetter:(e,t)=>t?y(t.amount):""},{field:"balance",headerName:"Solde",flex:1,minWidth:120,valueGetter:(e,t)=>t?y(t.balance):""},{field:"status",headerName:"Statut",flex:1,minWidth:100,valueGetter:(e,t)=>t&&t.status?Ko(t.status):"",renderCell:e=>e.row&&e.row.status?t.jsx(pl,{status:e.row.status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,minWidth:120,sortable:!1,renderCell:e=>e.row?t.jsxs(c,{sx:{display:"flex",gap:.5},children:[t.jsx(f,{size:"small",color:"primary",onClick:t=>{t.stopPropagation(),p(e.row)},title:"Modifier",children:t.jsx(X,{fontSize:"small"})}),t.jsx(f,{size:"small",color:"error",onClick:t=>{t.stopPropagation(),g(e.row)},title:"Supprimer",children:t.jsx(te,{fontSize:"small"})}),t.jsx(f,{size:"small",color:"secondary",onClick:t=>{t.stopPropagation(),x(e.row)},title:"Imprimer",children:t.jsx(ke,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}],b=e.length,v=e.filter((e=>"draft"===e.status)).length,C=e.filter((e=>"sent"===e.status)).length,_=e.filter((e=>"paid"===e.status)).length,S=e.filter((e=>{if("paid"===e.status)return!1;return new Date(e.due_date)<new Date})).length;return t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",gap:1,mb:3,backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Factures"}),t.jsx(d,{variant:"h6",color:"primary.main",children:b})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Brouillon"}),t.jsx(d,{variant:"h6",color:"grey.500",children:v})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"EnvoyÃ©e"}),t.jsx(d,{variant:"h6",color:"info.main",children:C})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"PayÃ©e"}),t.jsx(d,{variant:"h6",color:"success.main",children:_})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"En retard"}),t.jsx(d,{variant:"h6",color:"error.main",children:S})]})]}),t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence ou client",variant:"outlined",size:"small",fullWidth:!0,value:i,onChange:e=>s(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(X,{fontSize:"small",color:"action"})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>s(""),edge:"end",children:t.jsx(te,{fontSize:"small"})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{id:"invoice-status-filter-label",children:"Statut"}),t.jsxs(K,{labelId:"invoice-status-filter-label",id:"invoice-status-filter",value:a,onChange:e=>o(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous les statuts"}),t.jsx(B,{value:"draft",children:"Brouillon"}),t.jsx(B,{value:"sent",children:"EnvoyÃ©e"}),t.jsx(B,{value:"paid",children:"PayÃ©e"}),t.jsx(B,{value:"overdue",children:"En retard"}),t.jsx(B,{value:"cancelled",children:"AnnulÃ©e"})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{id:"invoice-date-filter-label",children:"PÃ©riode"}),t.jsxs(K,{labelId:"invoice-date-filter-label",id:"invoice-date-filter",value:l,onChange:e=>u(e.target.value),label:"PÃ©riode",children:[t.jsx(B,{value:"",children:"Toutes les pÃ©riodes"}),t.jsx(B,{value:"today",children:"Aujourd'hui"}),t.jsx(B,{value:"week",children:"Cette semaine"}),t.jsx(B,{value:"month",children:"Ce mois"}),t.jsx(B,{value:"quarter",children:"Ce trimestre"}),t.jsx(B,{value:"year",children:"Cette annÃ©e"})]})]})]}),t.jsx(Pe,{direction:"row",spacing:2,children:t.jsx(zo,{requiredPermission:"sales.add_invoice",variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:h,children:"Nouvelle facture"})})]}),r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:e,columns:w,loading:r,getRowId:e=>(null==e?void 0:e.id)??Math.random(),onRowClick:e=>p(e.row),showToolbar:!0})]})},Al=({quotes:e,loading:r,clients:n,searchTerm:i,setSearchTerm:s,statusFilter:a,setStatusFilter:o,dateFilter:l,setDateFilter:u,onAdd:h,onEdit:p,onDelete:g,onPrint:x,onConvert:y})=>{const w=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1,minWidth:120},{field:"client",headerName:"Client",flex:1.5,minWidth:150,valueGetter:(e,t)=>{if(!t)return"";const r=n.find((e=>e.id===t.client));return(null==r?void 0:r.name)||"N/A"}},{field:"date",headerName:"Date",flex:1,minWidth:100,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString("fr-FR"):""},{field:"valid_until",headerName:"Valable jusqu'au",flex:1,minWidth:130,valueGetter:(e,t)=>t&&t.valid_until?new Date(t.valid_until).toLocaleDateString("fr-FR"):""},{field:"total_amount",headerName:"Montant Total",flex:1,minWidth:120,valueGetter:(e,t)=>{return t?(r=t.total_amount,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(r)):"";var r}},{field:"status",headerName:"Statut",flex:1,minWidth:100,valueGetter:(e,t)=>t&&t.status?Ko(t.status):"",renderCell:e=>e.row&&e.row.status?t.jsx(pl,{status:e.row.status}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1.2,minWidth:150,sortable:!1,renderCell:e=>{if(!e.row)return t.jsx(t.Fragment,{});const r=e.row;return t.jsxs(c,{sx:{display:"flex",gap:.5},children:[t.jsx(f,{size:"small",color:"primary",onClick:e=>{e.stopPropagation(),p(r)},title:"Modifier",children:t.jsx(X,{fontSize:"small"})}),t.jsx(f,{size:"small",color:"error",onClick:e=>{e.stopPropagation(),g(r)},title:"Supprimer",children:t.jsx(te,{fontSize:"small"})}),t.jsx(f,{size:"small",color:"secondary",onClick:e=>{e.stopPropagation(),x(r)},title:"Imprimer",children:t.jsx(ke,{fontSize:"small"})}),("accepted"===r.status||"sent"===r.status)&&!r.is_converted&&t.jsx(f,{size:"small",color:"success",onClick:e=>{e.stopPropagation(),y(r)},title:"Convertir en vente",children:t.jsx(Me,{fontSize:"small"})})]})}}],b=e.length,v=e.filter((e=>"draft"===e.status)).length,C=e.filter((e=>"sent"===e.status)).length,_=e.filter((e=>"accepted"===e.status)).length,S=new Date,E=e.filter((e=>{if("accepted"===e.status||"rejected"===e.status||"expired"===e.status)return!1;return new Date(e.expiry_date)<S})).length;return t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",gap:1,mb:3,backgroundColor:"background.paper",p:1.5,borderRadius:2,border:"1px solid",borderColor:"divider",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsxs(c,{sx:{textAlign:"center",px:2},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Total Devis"}),t.jsx(d,{variant:"h6",color:"primary.main",children:b})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"Brouillon"}),t.jsx(d,{variant:"h6",color:"grey.500",children:v})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"EnvoyÃ©"}),t.jsx(d,{variant:"h6",color:"info.main",children:C})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"AcceptÃ©"}),t.jsx(d,{variant:"h6",color:"success.main",children:_})]}),t.jsxs(c,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold"},children:"ExpirÃ©"}),t.jsx(d,{variant:"h6",color:"error.main",children:E})]})]}),t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"RÃ©fÃ©rence ou client",variant:"outlined",size:"small",fullWidth:!0,value:i,onChange:e=>s(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(X,{fontSize:"small",color:"action"})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>s(""),edge:"end",children:t.jsx(te,{fontSize:"small"})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{id:"quote-status-filter-label",children:"Statut"}),t.jsxs(K,{labelId:"quote-status-filter-label",id:"quote-status-filter",value:a,onChange:e=>o(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous les statuts"}),t.jsx(B,{value:"draft",children:"Brouillon"}),t.jsx(B,{value:"sent",children:"EnvoyÃ©"}),t.jsx(B,{value:"accepted",children:"AcceptÃ©"}),t.jsx(B,{value:"rejected",children:"RejetÃ©"}),t.jsx(B,{value:"cancelled",children:"AnnulÃ©"})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{id:"quote-date-filter-label",children:"PÃ©riode"}),t.jsxs(K,{labelId:"quote-date-filter-label",id:"quote-date-filter",value:l,onChange:e=>u(e.target.value),label:"PÃ©riode",children:[t.jsx(B,{value:"",children:"Toutes les pÃ©riodes"}),t.jsx(B,{value:"today",children:"Aujourd'hui"}),t.jsx(B,{value:"week",children:"Cette semaine"}),t.jsx(B,{value:"month",children:"Ce mois"}),t.jsx(B,{value:"quarter",children:"Ce trimestre"}),t.jsx(B,{value:"year",children:"Cette annÃ©e"})]})]})]}),t.jsx(Pe,{direction:"row",spacing:2,children:t.jsx(zo,{requiredPermission:"sales.add_quote",variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:h,children:"Nouveau devis"})})]}),r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:e,columns:w,loading:r,getRowId:e=>(null==e?void 0:e.id)??Math.random(),onRowClick:e=>p(e.row),showToolbar:!0})]})},Il=e=>{const t=(new Date).toISOString().split("T")[0];return{supplier:e.supplier,zone:e.zone,date:t,status:e.status||"pending",items:e.items.map((e=>({product:e.product,quantity:Number(e.quantity),unit_price:e.unit_price?Number(e.unit_price):0,total_price:e.unit_price?Number(e.unit_price)*Number(e.quantity):0})))}},jl=e=>{const t=(new Date).toISOString().split("T")[0];return{from_zone:e.sourceZone,to_zone:e.targetZone,date:t,status:e.status||"pending",items:e.items.map((e=>({product:e.product,quantity:Number(e.quantity)})))}},Tl=e=>{const t=(new Date).toISOString().split("T")[0];return{zone:e.inventoryZone,date:t,status:e.status||"draft",items:e.items.map((e=>{const t=e.theoretical_quantity||0,r=Number(e.physical_quantity);return{product:e.product,expected_quantity:t,actual_quantity:r,difference:r-t}}))}},Dl=(e,t)=>`${e} `,Rl=e=>new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),Nl=({stocks:e,loading:r,zones:n,searchTerm:i,zoneFilter:s,statusFilter:a,onSearchChange:o,onZoneFilterChange:l,onStatusFilterChange:d})=>{const u=Pt.useMemo((()=>e.filter((e=>e&&"number"==typeof e.product&&"number"==typeof e.zone&&void 0!==e.product_name))),[e]),h=[{field:"product_name",headerName:"Produit",flex:1,minWidth:250},{field:"zone_name",headerName:"Emplacement",width:150},{field:"quantity",headerName:"QuantitÃ©",width:120,type:"number",renderCell:e=>{const r=e.row.unit_symbol||"";return t.jsxs(c,{sx:{fontWeight:100,color:e.value<=0?"error.main":"text.primary"},children:[Dl(e.value)," ",r]})}},{field:"status",headerName:"Ã‰tat",width:130,renderCell:e=>{const r=e.row.quantity;let n="normal";return r<=0?n="rupture":r<=10&&(n="faible"),t.jsx(pl,{status:n})}}];return t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",overflowX:"auto",minHeight:56},children:[t.jsx(V,{label:"Rechercher",value:i,onChange:e=>o(e.target.value),variant:"outlined",size:"small",sx:{minWidth:300},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{fontSize:"small",color:"action"})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>o(""),edge:"end",children:t.jsx(te,{fontSize:"small"})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Emplacement"}),t.jsxs(K,{value:s,onChange:e=>l(e.target.value),label:"Emplacement",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{children:"Ã‰tat"}),t.jsxs(K,{value:a,onChange:e=>d(e.target.value),label:"Ã‰tat",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"normal",children:Ko("normal")}),t.jsx(B,{value:"faible",children:Ko("faible")}),t.jsx(B,{value:"rupture",children:Ko("rupture")})]})]})]})}),t.jsx(c,{sx:{flex:1},children:t.jsx(el,{rows:u,columns:h,loading:r,getRowId:e=>e.id?e.id:`${e.product}-${e.zone}`,showToolbar:!0,initialState:{sorting:{sortModel:[{field:"product_name",sort:"asc"}]}}})})]})};var Pl={},Ol=ge;Object.defineProperty(Pl,"__esModule",{value:!0});var kl=Pl.default=void 0,Ml=Ol(sl()),Fl=t;kl=Pl.default=(0,Ml.default)((0,Fl.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var Bl={},Ll=ge;Object.defineProperty(Bl,"__esModule",{value:!0});var zl=Bl.default=void 0,Ul=Ll(sl()),Wl=t;zl=Bl.default=(0,Ul.default)((0,Wl.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Vl={},Hl=ge;Object.defineProperty(Vl,"__esModule",{value:!0});var Gl=Vl.default=void 0,ql=Hl(sl()),Xl=t;Gl=Vl.default=(0,ql.default)((0,Xl.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");const $l=e=>{if(null==e)return 0;if("number"==typeof e)return Number.isFinite(e)?e:0;if("string"==typeof e){const t=e.replace(/\u00A0/g,"").replace(/\s/g,"").replace(",",".").replace(/[^\d.-]/g,""),r=Number(t);return Number.isFinite(r)?r:0}const t=Number(e);return Number.isFinite(t)?t:0},Zl=(e,t="fr-FR",r="XOF")=>{const n=$l(e);return new Intl.NumberFormat(t,{style:"currency",currency:r}).format(n)},Yl=e=>{if(!e)return"-";const t="string"==typeof e?new Date(e):e;return isNaN(t.getTime())?String(e):t.toLocaleDateString("fr-FR")},Ql=(e,t)=>{const r=window.open("","_blank");r?(r.document.write(`\n    <html lang="fr">\n      <head>\n        <meta charset="utf-8" />\n        <title>${t}</title>\n        <style>\n          /* Reset + base */\n          * { box-sizing: border-box; }\n          body { \n            font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; \n            margin: 0; \n            background: #f5f7fa; \n            padding: 24px; \n            color: #1a202c; \n          }\n          .paper { \n            max-width: 850px; \n            margin: 0 auto; \n            background: #fff; \n            padding: 40px; \n            border-radius: 12px; \n            box-shadow: 0 10px 40px rgba(15, 23, 42, 0.12); \n          }\n          .header { \n            display: flex; \n            justify-content: space-between; \n            align-items: flex-start; \n            margin-bottom: 32px; \n            padding-bottom: 24px;\n            border-bottom: 3px solid #1976d2;\n          }\n          .brand { \n            display: flex; \n            gap: 16px; \n            align-items: center; \n          }\n          .logo { \n            width: 64px; \n            height: 64px; \n            border-radius: 8px; \n            background: linear-gradient(135deg, #1976d2, #42a5f5); \n            display: inline-flex; \n            align-items: center; \n            justify-content: center; \n            color: #fff; \n            font-weight: 700; \n            font-size: 24px; \n            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);\n          }\n          .company { \n            font-size: 14px; \n            color: #4a5568; \n          }\n          .company-name { \n            font-weight: 700; \n            font-size: 18px; \n            color: #1a202c; \n            margin-bottom: 6px; \n          }\n          h1 { \n            margin: 0; \n            font-size: 28px; \n            color: #1976d2; \n            font-weight: 700;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n          }\n          .meta { \n            text-align: right; \n            font-size: 13px; \n            color: #4a5568; \n          }\n          .meta-item {\n            margin-bottom: 6px;\n          }\n          .meta-label {\n            font-weight: 600;\n            color: #2d3748;\n          }\n          .client-info {\n            background: #f7fafc;\n            padding: 20px;\n            border-radius: 8px;\n            margin-bottom: 24px;\n            border-left: 4px solid #1976d2;\n          }\n          .client-info h3 {\n            margin: 0 0 12px 0;\n            font-size: 16px;\n            color: #2d3748;\n            font-weight: 600;\n          }\n          .client-info p {\n            margin: 4px 0;\n            font-size: 14px;\n            color: #4a5568;\n          }\n          .section { \n            margin-top: 24px; \n          }\n          .section-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: #2d3748;\n            margin-bottom: 12px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #e2e8f0;\n          }\n          table { \n            width: 100%; \n            border-collapse: collapse; \n            margin-top: 12px; \n          }\n          th { \n            text-align: left; \n            font-size: 13px; \n            font-weight: 600;\n            color: #2d3748; \n            padding: 12px 14px; \n            background: #f7fafc; \n            border-bottom: 2px solid #e2e8f0; \n          }\n          td { \n            padding: 12px 14px; \n            border-bottom: 1px solid #e2e8f0; \n            font-size: 14px; \n            color: #1a202c; \n            vertical-align: top; \n          }\n          tr:last-child td {\n            border-bottom: none;\n          }\n          .line-items th, \n          .line-items td { \n            text-align: left; \n          }\n          .line-items th:last-child,\n          .line-items td:last-child {\n            text-align: right;\n          }\n          .line-items .quantity,\n          .line-items .price {\n            text-align: right;\n          }\n          .totals-section {\n            margin-top: 24px;\n            display: flex;\n            justify-content: flex-end;\n          }\n          .totals-table {\n            width: 350px;\n          }\n          .totals td { \n            padding: 10px 14px; \n            font-size: 15px;\n          }\n          .totals .label-cell {\n            font-weight: 600;\n            color: #4a5568;\n          }\n          .totals .amount-cell {\n            text-align: right;\n            font-weight: 600;\n          }\n          .total-row td {\n            padding: 14px;\n            font-size: 18px;\n            font-weight: 700;\n            background: #f7fafc;\n            border-top: 2px solid #1976d2;\n          }\n          .total-value { \n            font-weight: 700; \n            color: #1976d2; \n          }\n          .balance-due {\n            color: #dc2626 !important;\n          }\n          .paid-status {\n            color: #059669 !important;\n          }\n          .status-badge {\n            display: inline-block;\n            padding: 6px 14px;\n            border-radius: 20px;\n            font-size: 13px;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n          }\n          .status-paid {\n            background: #d1fae5;\n            color: #065f46;\n          }\n          .status-partial {\n            background: #fef3c7;\n            color: #92400e;\n          }\n          .status-unpaid {\n            background: #fee2e2;\n            color: #991b1b;\n          }\n          .status-draft {\n            background: #e5e7eb;\n            color: #374151;\n          }\n          .status-sent {\n            background: #dbeafe;\n            color: #1e40af;\n          }\n          .status-accepted {\n            background: #d1fae5;\n            color: #065f46;\n          }\n          .status-rejected {\n            background: #fee2e2;\n            color: #991b1b;\n          }\n          .notes-section {\n            margin-top: 24px;\n            padding: 16px;\n            background: #fffbeb;\n            border-left: 4px solid #f59e0b;\n            border-radius: 4px;\n          }\n          .notes-section h4 {\n            margin: 0 0 8px 0;\n            font-size: 14px;\n            color: #92400e;\n            font-weight: 600;\n          }\n          .notes-section p {\n            margin: 0;\n            font-size: 13px;\n            color: #78350f;\n            line-height: 1.5;\n          }\n          .muted { \n            color: #718096; \n            font-size: 13px; \n          }\n          .footer { \n            margin-top: 40px; \n            padding-top: 24px;\n            text-align: center; \n            font-size: 12px; \n            color: #718096; \n            border-top: 1px solid #e2e8f0;\n          }\n          .watermark {\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%) rotate(-45deg);\n            font-size: 120px;\n            color: rgba(25, 118, 210, 0.05);\n            font-weight: 900;\n            pointer-events: none;\n            z-index: 0;\n            white-space: nowrap;\n          }\n          @media print {\n            body { \n              background: #fff; \n              padding: 0; \n            }\n            .paper { \n              box-shadow: none; \n              border-radius: 0; \n              padding: 20px; \n            }\n            .watermark {\n              display: none;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="paper">\n          ${e}\n        </div>\n      </body>\n    </html>\n  `),r.document.close(),r.focus(),setTimeout((()=>{try{r.print()}catch(e){console.error("Print failed",e)}}),150)):console.warn("Unable to open print window (popup blocked?)")},Kl=({supplies:e,loading:r,zones:n,suppliers:i,searchTerm:s,statusFilter:a,zoneFilter:o,supplierFilter:d,onSearchChange:u,onStatusFilterChange:h,onZoneFilterChange:p,onSupplierFilterChange:m,onAdd:g,onEdit:x,onDelete:y})=>{const[w,b]=Pt.useState(!1),[v,C]=Pt.useState(null),[_,S]=Pt.useState(!1),E=[{field:"reference",headerName:"RÃ©fÃ©rence",width:150,renderCell:e=>e.value||"â€”"},{field:"supplier_name",headerName:"Fournisseur",flex:1,minWidth:200},{field:"zone_name",headerName:"Emplacement",width:150},{field:"date",headerName:"Date",width:120,renderCell:e=>Rl(e.value)},{field:"status",headerName:"Statut",width:140,renderCell:e=>t.jsx(pl,{status:e.value})},{field:"items_count",headerName:"Articles",width:100,type:"number",renderCell:e=>{var t;return(null==(t=e.row.items)?void 0:t.length)||0}},{field:"actions",type:"actions",headerName:"Actions",width:140,getActions:e=>[t.jsx(Be,{icon:t.jsx(l,{title:"Imprimer le bon de rÃ©ception",children:t.jsx(Gl,{})}),label:"Imprimer",onClick:()=>{var t;const r=e.row;(e=>{const t=$l(e.total_amount),r=e.status||"pending";let n="status-draft";"received"===r?n="status-accepted":"partial"===r?n="status-partial":"cancelled"===r?n="status-rejected":"pending"===r&&(n="status-sent");let i=t;e.items&&e.items.length>0&&!e.total_amount&&(i=e.items.reduce(((e,t)=>e+$l(t.total_price)),0));const s=`\n    <div class="watermark">BON DE RÃ‰CEPTION</div>\n    \n    <div class="header">\n      <div class="brand">\n        <div class="logo">G</div>\n        <div class="company">\n          <div class="company-name">Gestion</div>\n          <div class="muted">123 Rue Exemple</div>\n          <div class="muted">+33 1 23 45 67 89</div>\n          <div class="muted">contact@gestion.com</div>\n        </div>\n      </div>\n      <div class="meta">\n        <h1>BON DE RÃ‰CEPTION</h1>\n        <div class="meta-item"><span class="meta-label">NÂ°:</span> <strong>${e.reference??e.id}</strong></div>\n        <div class="meta-item"><span class="meta-label">Date:</span> ${Yl(e.date)}</div>\n        ${e.zone_name?`<div class="meta-item"><span class="meta-label">Emplacement:</span> ${e.zone_name}</div>`:""}\n      </div>\n    </div>\n\n    ${e.supplier_name?`\n    <div class="client-info">\n      <h3>Informations Fournisseur</h3>\n      <p><strong>${e.supplier_name}</strong></p>\n      ${e.supplier_phone?`<p>ðŸ“ž ${e.supplier_phone}</p>`:""}\n      ${e.supplier_email?`<p>âœ‰ï¸ ${e.supplier_email}</p>`:""}\n    </div>\n    `:""}\n\n    ${e.items&&e.items.length>0?`\n    <div class="section">\n      <h3 class="section-title">DÃ©tails de la rÃ©ception</h3>\n      <table class="line-items">\n        <thead>\n          <tr>\n            <th>Article</th>\n            <th class="quantity">QuantitÃ©</th>\n            <th class="price">Prix unitaire</th>\n            <th class="price">Montant</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.items.map((e=>`\n            <tr>\n              <td>${e.product_name||"Article"}</td>\n              <td class="quantity">${e.quantity||0}</td>\n              <td class="price">${Zl(e.unit_price)}</td>\n              <td class="price">${Zl(e.total_price)}</td>\n            </tr>\n          `)).join("")}\n        </tbody>\n      </table>\n    </div>\n    `:""}\n\n    <div class="totals-section">\n      <table class="totals-table totals">\n        <tr class="total-row">\n          <td class="label-cell">Montant total</td>\n          <td class="amount-cell total-value">${Zl(i)}</td>\n        </tr>\n        <tr>\n          <td colspan="2" style="text-align: right; padding-top: 16px;">\n            <span class="status-badge ${n}">${{pending:"En attente",received:"ReÃ§u",partial:"Partiel",cancelled:"AnnulÃ©"}[r]||r}</span>\n          </td>\n        </tr>\n      </table>\n    </div>\n\n    ${e.notes?`\n    <div class="notes-section">\n      <h4>Notes</h4>\n      <p>${e.notes}</p>\n    </div>\n    `:""}\n\n    <div style="margin-top: 48px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px;">\n      <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">\n        <div style="flex: 1;">\n          <p style="margin: 0 0 8px 0; font-size: 13px; color: #718096; font-weight: 600;">Signature du fournisseur</p>\n          <div style="border-top: 2px solid #1a202c; width: 200px; margin-top: 50px;"></div>\n          <p style="margin: 8px 0 0 0; font-size: 12px; color: #718096;">Date et signature</p>\n        </div>\n        <div style="flex: 1; text-align: right;">\n          <p style="margin: 0 0 8px 0; font-size: 13px; color: #718096; font-weight: 600;">Signature du rÃ©ceptionnaire</p>\n          <div style="border-top: 2px solid #1a202c; width: 200px; margin-top: 50px; margin-left: auto;"></div>\n          <p style="margin: 8px 0 0 0; font-size: 12px; color: #718096;">Date et signature</p>\n        </div>\n      </div>\n    </div>\n\n    <div class="footer">\n      <p><strong>Document de rÃ©ception officiel</strong></p>\n      <p class="muted">Document gÃ©nÃ©rÃ© automatiquement le ${(new Date).toLocaleString("fr-FR")}</p>\n      <p class="muted">Conservez ce document pour votre comptabilitÃ©</p>\n      <p class="muted" style="margin-top: 16px;">Contact : contact@gestion.com | +33 1 23 45 67 89</p>\n    </div>\n  `;Ql(s,`Bon de rÃ©ception ${e.reference??e.id}`)})({id:r.id,reference:r.reference,date:r.date,supplier_name:r.supplier_name,zone_name:r.zone_name,status:r.status,total_amount:r.total_amount,items:null==(t=r.items)?void 0:t.map((e=>({product_name:e.product_name,quantity:e.quantity,unit_price:e.unit_price,total_price:e.total_price})))})},color:"primary"}),t.jsx(Be,{icon:t.jsx(l,{title:"Modifier",children:t.jsx(kl,{})}),label:"Modifier",onClick:()=>x(e.row)}),t.jsx(Be,{icon:t.jsx(l,{title:"Supprimer",children:t.jsx(ol,{})}),label:"Supprimer",onClick:()=>A(e.row.id)})]}],A=e=>{C(e),b(!0)};return t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",overflowX:"auto",minHeight:56},children:[t.jsx(V,{label:"Rechercher",value:s,onChange:e=>u(e.target.value),variant:"outlined",size:"small",sx:{minWidth:300},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{fontSize:"small",color:"action"})}),endAdornment:s&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>u(""),edge:"end",children:t.jsx(te,{fontSize:"small"})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:a,onChange:e=>h(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"pending",children:Ko("pending")}),t.jsx(B,{value:"received",children:Ko("received")}),t.jsx(B,{value:"partial",children:Ko("partial")}),t.jsx(B,{value:"cancelled",children:Ko("cancelled")})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Emplacement"}),t.jsxs(K,{value:o,onChange:e=>p(""===e.target.value?"":Number(e.target.value)),label:"Emplacement",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Fournisseur"}),t.jsxs(K,{value:d,onChange:e=>m(""===e.target.value?"":Number(e.target.value)),label:"Fournisseur",children:[t.jsx(B,{value:"",children:"Tous"}),i.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(c,{sx:{flex:1,minWidth:20}}),t.jsx(Lo,{variant:"contained",size:"small",onClick:g,startIcon:t.jsx(zl,{}),sx:{whiteSpace:"nowrap"},children:"Nouvelle RÃ©ception"})]})}),t.jsx(c,{sx:{flex:1},children:t.jsx(el,{rows:e,columns:E,loading:r,showToolbar:!0,onRowDoubleClick:e=>x(e.row),initialState:{sorting:{sortModel:[{field:"date",sort:"desc"}]}}})}),t.jsx(dl,{open:w,onClose:()=>{b(!1),C(null)},onConfirm:async()=>{if(v){S(!0);try{await y(v),b(!1),C(null)}catch(e){console.error("Error deleting supply:",e)}finally{S(!1)}}},title:"Supprimer la rÃ©ception",message:"ÃŠtes-vous sÃ»r de vouloir supprimer cette rÃ©ception ? Cette action est irrÃ©versible.",loading:_})]})},Jl=({transfers:e,loading:r,zones:n,searchTerm:i,statusFilter:s,fromZoneFilter:a,toZoneFilter:o,onSearchChange:d,onStatusFilterChange:u,onFromZoneFilterChange:h,onToZoneFilterChange:p,onAdd:m,onEdit:g,onDelete:x})=>{const[y,w]=Pt.useState(!1),[b,v]=Pt.useState(null),[C,_]=Pt.useState(!1),S=[{field:"reference",headerName:"RÃ©fÃ©rence",width:150,renderCell:e=>e.value||"â€”"},{field:"from_zone_name",headerName:"De",flex:1,minWidth:150},{field:"to_zone_name",headerName:"Vers",flex:1,minWidth:150},{field:"date",headerName:"Date",width:120,renderCell:e=>Rl(e.value)},{field:"status",headerName:"Statut",width:140,renderCell:e=>t.jsx(pl,{status:e.value})},{field:"items_count",headerName:"Articles",width:100,type:"number",renderCell:e=>{var t;return(null==(t=e.row.items)?void 0:t.length)||0}},{field:"actions",type:"actions",headerName:"Actions",width:100,getActions:e=>[t.jsx(Be,{icon:t.jsx(l,{title:"Modifier",children:t.jsx(kl,{})}),label:"Modifier",onClick:()=>g(e.row),disabled:"completed"===e.row.status}),t.jsx(Be,{icon:t.jsx(l,{title:"Supprimer",children:t.jsx(ol,{})}),label:"Supprimer",onClick:()=>E(e.row.id),disabled:"completed"===e.row.status})]}],E=e=>{v(e),w(!0)};return t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",overflowX:"auto",minHeight:56},children:[t.jsx(V,{label:"Rechercher",value:i,onChange:e=>d(e.target.value),variant:"outlined",size:"small",sx:{minWidth:300},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>d(""),edge:"end",children:t.jsx(te,{})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:s,onChange:e=>u(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"pending",children:Ko("pending")}),t.jsx(B,{value:"completed",children:Ko("completed")}),t.jsx(B,{value:"cancelled",children:Ko("cancelled")})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"De (Source)"}),t.jsxs(K,{value:a,onChange:e=>h(""===e.target.value?"":Number(e.target.value)),label:"De (Source)",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Vers (Destination)"}),t.jsxs(K,{value:o,onChange:e=>p(""===e.target.value?"":Number(e.target.value)),label:"Vers (Destination)",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(c,{sx:{flex:1,minWidth:20}}),t.jsx(Lo,{variant:"contained",size:"small",onClick:m,startIcon:t.jsx(zl,{}),sx:{whiteSpace:"nowrap"},children:"Nouveau Transfert"})]})}),t.jsx(c,{sx:{flex:1},children:t.jsx(el,{rows:e,columns:S,loading:r,showToolbar:!0,onRowDoubleClick:e=>g(e.row),initialState:{sorting:{sortModel:[{field:"date",sort:"desc"}]}}})}),t.jsx(dl,{open:y,onClose:()=>{w(!1),v(null)},onConfirm:async()=>{if(b){_(!0);try{await x(b),w(!1),v(null)}catch(e){console.error("Error deleting transfer:",e)}finally{_(!1)}}},title:"Supprimer le transfert",message:"ÃŠtes-vous sÃ»r de vouloir supprimer ce transfert ? Cette action est irrÃ©versible.",loading:C})]})},ec=({inventories:e,loading:r,zones:n,searchTerm:i,statusFilter:s,zoneFilter:a,onSearchChange:o,onStatusFilterChange:u,onZoneFilterChange:h,onAdd:p,onEdit:m,onDelete:g})=>{const[x,y]=Pt.useState(!1),[w,b]=Pt.useState(null),[v,C]=Pt.useState(!1),_=[{field:"reference",headerName:"RÃ©fÃ©rence",width:150,renderCell:e=>e.value||"â€”"},{field:"zone_name",headerName:"Emplacement",flex:1,minWidth:200},{field:"date",headerName:"Date",width:120,renderCell:e=>Rl(e.value)},{field:"status",headerName:"Statut",width:140,renderCell:e=>t.jsx(pl,{status:e.value})},{field:"items_count",headerName:"Articles",width:100,type:"number",renderCell:e=>{var t;return(null==(t=e.row.items)?void 0:t.length)||0}},{field:"variance",headerName:"Ã‰cart",width:120,renderCell:e=>{const r=(e.row.items||[]).reduce(((e,t)=>{var r,n;return e+(r=t.expected_quantity,n=t.actual_quantity,r-n)}),0);return t.jsxs(d,{sx:{fontWeight:500,color:0===r?"success.main":r<0?"error.main":"warning.main"},children:[r>0?"+":"",r]})}},{field:"actions",type:"actions",headerName:"Actions",width:100,getActions:e=>[t.jsx(Be,{icon:t.jsx(l,{title:"Modifier",children:t.jsx(kl,{})}),label:"Modifier",onClick:()=>m(e.row),disabled:"completed"===e.row.status||"cancelled"===e.row.status}),t.jsx(Be,{icon:t.jsx(l,{title:"Supprimer",children:t.jsx(ol,{})}),label:"Supprimer",onClick:()=>S(e.row.id),disabled:"completed"===e.row.status})]}],S=e=>{b(e),y(!0)};return t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",overflowX:"auto",minHeight:56},children:[t.jsx(V,{label:"Rechercher",value:i,onChange:e=>o(e.target.value),variant:"outlined",size:"small",sx:{minWidth:300},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>o(""),edge:"end",children:t.jsx(te,{})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:180},children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:s,onChange:e=>u(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"draft",children:Ko("draft")}),t.jsx(B,{value:"in_progress",children:Ko("in_progress")}),t.jsx(B,{value:"completed",children:Ko("completed")}),t.jsx(B,{value:"cancelled",children:Ko("cancelled")})]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Emplacement"}),t.jsxs(K,{value:a,onChange:e=>h(""===e.target.value?"":Number(e.target.value)),label:"Emplacement",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsx(c,{sx:{flex:1,minWidth:20}}),t.jsx(Lo,{variant:"contained",size:"small",onClick:p,startIcon:t.jsx(zl,{}),sx:{whiteSpace:"nowrap"},children:"Nouvel Inventaire"})]})}),t.jsx(c,{sx:{flex:1},children:t.jsx(el,{rows:e,columns:_,loading:r,showToolbar:!0,onRowDoubleClick:e=>m(e.row),initialState:{sorting:{sortModel:[{field:"date",sort:"desc"}]}}})}),t.jsx(dl,{open:x,onClose:()=>{y(!1),b(null)},onConfirm:async()=>{if(w){C(!0);try{await g(w),y(!1),b(null)}catch(e){console.error("Error deleting inventory:",e)}finally{C(!1)}}},title:"Supprimer l'inventaire",message:"ÃŠtes-vous sÃ»r de vouloir supprimer cet inventaire ? Cette action est irrÃ©versible.",loading:v})]})},tc=({stockCards:e,loading:r,zones:n,searchTerm:i,zoneFilter:s,typeFilter:a,onSearchChange:o,onZoneFilterChange:u,onTypeFilterChange:h})=>{const p=[{field:"date",headerName:"Date",width:120,renderCell:e=>Rl(e.value)},{field:"product_name",headerName:"Produit",flex:1,minWidth:200},{field:"zone_name",headerName:"Emplacement",width:150},{field:"transaction_type",headerName:"Type",width:180,valueGetter:(e,t)=>t&&t.transaction_type?(e=>{switch(e){case"supply":return"Approvisionnement";case"sale":return"Vente";case"transfer_in":return"EntrÃ©e par transfert";case"transfer_out":return"Sortie par transfert";case"inventory":return"Ajustement d'inventaire";case"production":return"Production";case"return":return"Retour";default:return e}})(t.transaction_type):"",renderCell:e=>{const r=e.value;let n="",i="default";switch(r){case"supply":n="Approvisionnement",i="success";break;case"sale":n="Vente",i="error";break;case"transfer_in":n="EntrÃ©e par transfert",i="info";break;case"transfer_out":n="Sortie par transfert",i="warning";break;case"inventory":n="Ajustement d'inventaire",i="warning";break;case"production":n="Production",i="success";break;case"return":n="Retour",i="info";break;default:n=r,i="default"}return t.jsx(pl,{label:n,status:i})}},{field:"reference",headerName:"RÃ©fÃ©rence",width:130,renderCell:e=>e.value||"â€”"},{field:"notes",headerName:"DÃ©tails",flex:1.2,minWidth:200,renderCell:e=>{const r=e.value||"",n=e.row.transaction_type,i=e.row.reference||"",s=(e,t=50)=>e?e.length>t?`${e.substring(0,t)}...`:e:"â€”";if("supply"===n&&i){const e=`Supply received: ${i}`,n=r||e;return t.jsx(l,{title:t.jsx(c,{sx:{maxWidth:400,p:1},children:t.jsx(d,{variant:"body2",color:"inherit",sx:{whiteSpace:"pre-line"},children:n})}),arrow:!0,placement:"top",enterDelay:300,children:t.jsx(c,{sx:{display:"flex",alignItems:"center",width:"100%",cursor:"help","&:hover":{backgroundColor:"action.hover",borderRadius:1,transition:"background-color 0.2s"}},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s(e,40)})})})}return"inventory"===n&&r?t.jsx(l,{title:t.jsxs(c,{sx:{maxWidth:400,p:1},children:[t.jsx(d,{variant:"subtitle2",gutterBottom:!0,color:"inherit",children:"DÃ©tails de l'inventaire"}),t.jsx(d,{variant:"body2",color:"inherit",sx:{whiteSpace:"pre-line"},children:r})]}),arrow:!0,placement:"top",enterDelay:300,children:t.jsx(c,{sx:{display:"flex",alignItems:"center",width:"100%",cursor:"help","&:hover":{backgroundColor:"action.hover",borderRadius:1,transition:"background-color 0.2s"}},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s(r,50)})})}):r&&"â€”"!==r?t.jsx(l,{title:r,arrow:!0,placement:"top",enterDelay:500,children:t.jsx(c,{sx:{display:"flex",alignItems:"center",width:"100%",cursor:"help","&:hover":{backgroundColor:"action.hover",borderRadius:1,transition:"background-color 0.2s"}},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s(r,60)})})}):t.jsx(c,{sx:{display:"flex",alignItems:"center",width:"100%"},children:t.jsx(d,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.secondary"},children:r||"â€”"})})}},{field:"quantity_in",headerName:"EntrÃ©e",width:120,align:"right",headerAlign:"right",renderCell:e=>{if(null===e.value||void 0===e.value||0===e.value)return"";const r=e.row.unit_symbol||"";return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",color:"success.main",fontWeight:"medium"},children:["+",Dl(e.value)," ",r]})}},{field:"quantity_out",headerName:"Sortie",width:120,align:"right",headerAlign:"right",renderCell:e=>{if(null===e.value||void 0===e.value||0===e.value)return"";const r=e.row.unit_symbol||"";return t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",color:"error.main",fontWeight:"medium"},children:["-",Dl(e.value)," ",r]})}}];return t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(c,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",flexWrap:"nowrap",overflowX:"auto",minHeight:56},children:[t.jsx(V,{label:"Rechercher",value:i,onChange:e=>o(e.target.value),variant:"outlined",size:"small",sx:{minWidth:300},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})}),endAdornment:i&&t.jsx(H,{position:"end",children:t.jsx(f,{size:"small",onClick:()=>o(""),edge:"end",children:t.jsx(te,{})})})}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:220},children:[t.jsx(Q,{children:"Emplacement"}),t.jsxs(K,{value:s,onChange:e=>u(e.target.value),label:"Emplacement",children:[t.jsx(B,{value:"",children:"Tous"}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:240},children:[t.jsx(Q,{children:"Type"}),t.jsxs(K,{value:a,onChange:e=>h(e.target.value),label:"Type",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"supply",children:"Approvisionnement"}),t.jsx(B,{value:"sale",children:"Vente"}),t.jsx(B,{value:"transfer_in",children:"EntrÃ©e par transfert"}),t.jsx(B,{value:"transfer_out",children:"Sortie par transfert"}),t.jsx(B,{value:"inventory",children:"Ajustement d'inventaire"}),t.jsx(B,{value:"production",children:"Production"}),t.jsx(B,{value:"return",children:"Retour"})]})]}),t.jsx(c,{sx:{flex:1}})]})}),t.jsx(c,{sx:{flex:1},children:t.jsx(el,{rows:e,columns:p,loading:r,showToolbar:!0,initialState:{sorting:{sortModel:[{field:"date",sort:"desc"}]}}})})]})};var rc={},nc=ge;Object.defineProperty(rc,"__esModule",{value:!0});var ic=rc.default=void 0,sc=nc(sl()),ac=t;ic=rc.default=(0,sc.default)((0,ac.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var oc={},lc=ge;Object.defineProperty(oc,"__esModule",{value:!0});var cc=oc.default=void 0,dc=lc(sl()),uc=t;cc=oc.default=(0,dc.default)((0,uc.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");const hc=({scanner:e,stockError:r})=>{const{qrState:n,closeScanner:i,setScannedQuantity:s,addScannedProduct:a,clearError:o,startScanning:l,stopScanning:u}=e,h="qr-scanner-preview",p=jt.useRef(!1);jt.useEffect((()=>{if(n.isOpen&&!n.isScanning&&!n.scannedProduct&&!n.permissionDenied&&!p.current){p.current=!0;(()=>{requestAnimationFrame((()=>{document.getElementById(h)?l(h):setTimeout((()=>{document.getElementById(h)?l(h):(console.error(`Element with id ${h} not found`),p.current=!1)}),200)}))})()}}),[n.isOpen,n.isScanning,n.scannedProduct,n.permissionDenied,l,h]),jt.useEffect((()=>{n.isOpen||(p.current=!1,n.isScanning&&u())}),[n.isOpen,n.isScanning,u]);const m=()=>{n.isScanning&&u(),p.current=!1,i()};return t.jsxs(xe,{open:n.isOpen,onClose:m,maxWidth:"sm",fullWidth:!0,children:[t.jsxs(ye,{children:["Scanner Code-Barres",t.jsx(f,{"aria-label":"fermer",onClick:m,sx:{position:"absolute",right:8,top:8},children:t.jsx(ic,{})})]}),t.jsxs(we,{children:[n.permissionDenied&&t.jsxs(W,{severity:"error",sx:{mb:2},children:[t.jsx(d,{variant:"body2",gutterBottom:!0,fontWeight:"bold",children:n.error||"AccÃ¨s Ã  la camÃ©ra refusÃ©"}),t.jsx(d,{variant:"caption",display:"block",sx:{mt:1},children:"Pour utiliser le scanner:"}),t.jsxs(d,{variant:"caption",component:"div",sx:{mt:.5,pl:2},children:["1. Cliquez sur l'icÃ´ne de camÃ©ra dans la barre d'adresse",t.jsx("br",{}),'2. SÃ©lectionnez "Autoriser"',t.jsx("br",{}),"3. Rechargez la page et rÃ©essayez"]})]}),!n.scannedProduct&&!n.error&&!n.permissionDenied&&t.jsxs(c,{sx:{mb:2},children:[t.jsx("div",{id:h,style:{width:"100%",minHeight:"300px"}}),n.isScanning&&t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:"Positionnez le code-barres dans le cadre"})]}),n.error&&t.jsx(W,{severity:"error",sx:{mb:2},action:t.jsx(Lo,{size:"small",onClick:()=>{o(),p.current=!1,l(h)},children:"RÃ©essayer"}),children:n.error}),n.scannedProduct&&t.jsxs(c,{sx:{mb:2},children:[t.jsx(Le,{in:!0,children:t.jsx(W,{severity:"success",sx:{mb:2},icon:t.jsx(cc,{fontSize:"inherit"}),children:"Produit trouvÃ© !"})}),t.jsx(ze,{in:!0,timeout:300,children:t.jsxs(c,{sx:{p:2,bgcolor:"background.default",borderRadius:1,mb:2},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,children:n.scannedProduct.name}),t.jsxs(d,{variant:"body2",color:"text.secondary",children:["RÃ©fÃ©rence: ",n.scannedProduct.reference]}),n.scannedProduct.description&&t.jsx(d,{variant:"body2",color:"text.secondary",children:n.scannedProduct.description})]})}),r&&t.jsx(W,{severity:"warning",sx:{mb:2},children:r}),t.jsx(V,{label:"QuantitÃ©",type:"number",value:n.scannedQuantity,onChange:e=>{const t=parseFloat(e.target.value);!isNaN(t)&&t>0&&s(t)},fullWidth:!0,inputProps:{min:1,step:.01}})]}),!n.isScanning&&!n.scannedProduct&&!n.error&&!n.permissionDenied&&t.jsxs(c,{sx:{textAlign:"center",py:4},children:[t.jsx(d,{color:"text.secondary",gutterBottom:!0,children:"Initialisation de la camÃ©ra..."}),t.jsx(d,{variant:"caption",color:"text.secondary",children:"Si demandÃ©, veuillez autoriser l'accÃ¨s Ã  la camÃ©ra"})]})]}),t.jsxs(be,{sx:{p:2,gap:1},children:[t.jsx(Lo,{variant:"outlined",onClick:m,children:"Annuler"}),n.permissionDenied&&t.jsx(Lo,{variant:"contained",onClick:()=>{window.location.reload()},children:"Recharger la page"}),n.scannedProduct&&t.jsx(Lo,{variant:"contained",onClick:()=>{a(),i()},children:"Ajouter"})]})]})},pc={};var mc={},fc=ge;Object.defineProperty(mc,"__esModule",{value:!0});var gc=mc.default=void 0,xc=fc(sl()),yc=t;gc=mc.default=(0,xc.default)((0,yc.jsx)("path",{d:"M9.5 6.5v3h-3v-3zM11 5H5v6h6zm-1.5 9.5v3h-3v-3zM11 13H5v6h6zm6.5-6.5v3h-3v-3zM19 5h-6v6h6zm-6 8h1.5v1.5H13zm1.5 1.5H16V16h-1.5zM16 13h1.5v1.5H16zm-3 3h1.5v1.5H13zm1.5 1.5H16V19h-1.5zM16 16h1.5v1.5H16zm1.5-1.5H19V16h-1.5zm0 3H19V19h-1.5zM22 7h-2V4h-3V2h5zm0 15v-5h-2v3h-3v2zM2 22h5v-2H4v-3H2zM2 2v5h2V4h3V2z"}),"QrCodeScanner");const wc=({dialog:e,products:r,zones:n,suppliers:i,isViewMode:s=!1,onOpenScanner:a,onSubmit:o})=>{const{dialogOpen:l,dialogOperation:u,editMode:p,dialogFormData:m,dialogQuantityError:g,dialogPriceError:x,closeDialog:y,setFormData:w,addItem:b,removeItem:v,validateForm:C,getFormDataForSubmit:_}=e,[S,E]=Pt.useState(r);Pt.useEffect((()=>{(async()=>{if("transfer"===u&&m.sourceZone)try{const{InventoryAPI:e}=await function(e,t){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in pc)return;pc[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,n&&i.setAttribute("nonce",n),document.head.appendChild(i),t?new Promise(((t,r)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)}))}((async()=>{const{InventoryAPI:e}=await Promise.resolve().then((()=>Oo));return{InventoryAPI:e}}),void 0),t=await e.getStockByZone(Number(m.sourceZone)),n=r.filter((e=>t.some((t=>t.product===e.id&&t.quantity>0))));E(n)}catch(e){console.error("Error filtering products:",e),E(r)}else E(r)})()}),[u,m.sourceZone,r]);const A=h(),I=(e,t)=>{w({[e]:t})},j=!m.currentProduct||(m.currentQuantity??0)<=0||(m.currentUnitPrice??0)<0||!!g||!!x,T=e=>null==e||isNaN(e)?"0 GNF":new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),D=e=>{const t=r.find((t=>t.id===e));return(null==t?void 0:t.name)||"Produit inconnu"},R=!!(()=>{if(0===m.items.length)return"Veuillez ajouter au moins un produit";switch(u){case"supply":if(!m.supplier)return"Veuillez sÃ©lectionner un fournisseur";if(!m.zone)return"Veuillez sÃ©lectionner un emplacement";break;case"transfer":if(!m.sourceZone)return"Veuillez sÃ©lectionner un emplacement source";if(!m.targetZone)return"Veuillez sÃ©lectionner un emplacement cible";if(m.sourceZone===m.targetZone)return"Les emplacements source et cible doivent Ãªtre diffÃ©rents";break;case"inventory":if(!m.inventoryZone)return"Veuillez sÃ©lectionner un emplacement"}return null})();return t.jsxs(xe,{open:l,onClose:y,maxWidth:"md",fullWidth:!0,children:[t.jsxs(ye,{children:[(()=>{if(p)switch(u){case"supply":return"Modifier la RÃ©ception";case"transfer":return"Modifier le Transfert";case"inventory":return"Modifier l'Inventaire";default:return"Modifier"}else switch(u){case"supply":return"Nouvelle RÃ©ception";case"transfer":return"Nouveau Transfert";case"inventory":return"Nouvel Inventaire";default:return"Nouvelle OpÃ©ration"}})(),t.jsx(f,{"aria-label":"fermer",onClick:y,sx:{position:"absolute",right:8,top:8},children:t.jsx(ic,{})})]}),t.jsx(we,{sx:{padding:A.spacing(2),paddingTop:`${A.spacing(1)} !important`},children:t.jsxs(oe,{container:!0,spacing:2,children:["supply"===u&&t.jsxs(t.Fragment,{children:[t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Fournisseur"}),t.jsxs(K,{label:"Fournisseur",value:m.supplier||"",onChange:e=>I("supplier",e.target.value),children:[t.jsx(B,{value:"",children:t.jsx("em",{children:"SÃ©lectionner un fournisseur"})}),i.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Emplacement"}),t.jsx(K,{label:"Emplacement",value:m.zone||"",onChange:e=>I("zone",e.target.value),children:n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})})]}),"transfer"===u&&t.jsxs(t.Fragment,{children:[t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Emplacement Source"}),t.jsxs(K,{label:"Emplacement Source",value:m.sourceZone||"",onChange:e=>I("sourceZone",e.target.value),children:[t.jsx(B,{value:"",children:t.jsx("em",{children:"SÃ©lectionner l'emplacement source"})}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Emplacement Cible"}),t.jsxs(K,{label:"Emplacement Cible",value:m.targetZone||"",onChange:e=>I("targetZone",e.target.value),children:[t.jsx(B,{value:"",children:t.jsx("em",{children:"SÃ©lectionner l'emplacement cible"})}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})})]}),"inventory"===u&&t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Emplacement"}),t.jsxs(K,{label:"Emplacement",value:m.inventoryZone||"",onChange:e=>I("inventoryZone",e.target.value),children:[t.jsx(B,{value:"",children:t.jsx("em",{children:"SÃ©lectionner un emplacement"})}),n.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:s,children:[t.jsx(Q,{children:"Statut"}),t.jsx(K,{label:"Statut",value:(()=>{const e=m.status;return e||("inventory"===u?"draft":"pending")})(),onChange:e=>I("status",e.target.value),MenuProps:{PaperProps:{style:{maxHeight:300}}},children:(()=>{switch(u){case"supply":return[t.jsx(B,{value:"pending",children:"En attente"},"pending"),t.jsx(B,{value:"received",children:"ReÃ§u"},"received"),t.jsx(B,{value:"partial",children:"Partiel"},"partial"),t.jsx(B,{value:"cancelled",children:"AnnulÃ©"},"cancelled")];case"transfer":return[t.jsx(B,{value:"pending",children:"En attente"},"pending"),t.jsx(B,{value:"partial",children:"Partiel"},"partial"),t.jsx(B,{value:"completed",children:"TerminÃ©"},"completed"),t.jsx(B,{value:"cancelled",children:"AnnulÃ©"},"cancelled")];case"inventory":return[t.jsx(B,{value:"draft",children:"Brouillon"},"draft"),t.jsx(B,{value:"in_progress",children:"En cours"},"in_progress"),t.jsx(B,{value:"completed",children:"TerminÃ©"},"completed"),t.jsx(B,{value:"cancelled",children:"AnnulÃ©"},"cancelled")];default:return[]}})()},`status-select-${u}`)]})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:t.jsx(d,{variant:"subtitle1",children:"inventory"===u?"Produits et QuantitÃ©s":"Produits"})}),!s&&t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[t.jsx(Ue,{options:S,getOptionLabel:e=>e.name,value:m.currentProduct,onChange:(e,t)=>{((e,t)=>{const r=m.items.find((e=>e.product===(null==t?void 0:t.id)));w({currentProduct:t,currentUnitPrice:(null==r?void 0:r.unit_price)??(null==t?void 0:t.purchase_price)??0,currentQuantity:(null==r?void 0:r.quantity)??1})})(0,t)},renderInput:e=>t.jsx(V,{...e,label:"Produit",variant:"outlined",fullWidth:!0}),renderOption:(e,r)=>jt.createElement("li",{...e,key:`product-${r.id}`},t.jsxs(c,{sx:{width:"100%"},children:[t.jsx(d,{variant:"body1",children:r.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["RÃ©f: ",r.reference," â€¢ Prix: ",T("supply"===u?r.purchase_price:r.selling_price)]})]})),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"text",value:vl(m.currentQuantity),onChange:e=>(e=>{const t=wl(e,m.currentQuantity);I("currentQuantity",t)})(e.target.value),sx:{width:120},error:!!g,helperText:g,size:"small"}),"supply"===u&&t.jsx(V,{label:"Prix Unitaire",type:"text",value:vl(m.currentUnitPrice),onChange:e=>(e=>{const t=bl(e,m.currentUnitPrice);I("currentUnitPrice",t)})(e.target.value),sx:{width:120},error:!!x,helperText:x,size:"small"}),t.jsx(Lo,{variant:"contained",onClick:()=>{m.currentProduct&&m.currentQuantity>0&&b()},disabled:j,sx:{height:"fit-content",px:3},children:"Ajouter"}),a&&t.jsx(Lo,{variant:"outlined",startIcon:t.jsx(gc,{}),onClick:a,sx:{height:"fit-content"},children:"Scanner"})]}),m.items.length>0?t.jsx(We,{component:U,variant:"outlined",children:t.jsxs(Ve,{size:"small",children:[t.jsx(He,{children:t.jsxs(Ge,{children:[t.jsx(qe,{children:"Produit"}),t.jsx(qe,{align:"right",children:"inventory"===u?"QuantitÃ© comptÃ©e":"QuantitÃ©"}),"supply"===u&&t.jsxs(t.Fragment,{children:[t.jsx(qe,{align:"right",children:"Prix Unitaire"}),t.jsx(qe,{align:"right",children:"Prix Total"})]}),t.jsx(qe,{align:"right",children:"Actions"})]})}),t.jsxs(Xe,{children:[m.items.map(((e,r)=>t.jsxs(Ge,{children:[t.jsx(qe,{children:D(e.product)}),t.jsx(qe,{align:"right",children:Number(e.quantity)||0}),"supply"===u&&t.jsxs(t.Fragment,{children:[t.jsx(qe,{align:"right",children:T(Number(e.unit_price)||0)}),t.jsx(qe,{align:"right",children:T(Number(e.total_price)||0)})]}),t.jsx(qe,{align:"right",children:!s&&t.jsx(f,{size:"small",color:"error",onClick:()=>v(r),children:t.jsx(ol,{fontSize:"small"})})})]},r))),t.jsxs(Ge,{children:[t.jsx(qe,{sx:{fontWeight:"bold"},children:"Total"}),t.jsx(qe,{align:"right",sx:{fontWeight:"bold"},children:m.items.reduce(((e,t)=>e+(Number(t.quantity)||0)),0)}),"supply"===u&&t.jsxs(t.Fragment,{children:[t.jsx(qe,{align:"right"}),t.jsx(qe,{align:"right",sx:{fontWeight:"bold"},children:T(m.items.reduce(((e,t)=>e+(Number(t.total_price)||0)),0))})]}),t.jsx(qe,{align:"right"})]})]})]})}):t.jsxs(W,{severity:"info",sx:{mt:2},children:["Aucun produit ajoutÃ©. Utilisez le formulaire ci-dessus pour ajouter des produits Ã ","supply"===u&&" cet approvisionnement","transfer"===u&&" ce transfert","inventory"===u&&" cet inventaire","."]})]})]})}),t.jsxs(be,{sx:{p:2,gap:1},children:[t.jsx(Lo,{variant:"outlined",onClick:y,children:s?"Fermer":"Annuler"}),!s&&t.jsx(Lo,{variant:"contained",onClick:async()=>{var t;if(C()){const n=_();if(n&&o)try{const r=null==(t=e.selectedItem)?void 0:t.id;await o(u,p,n,r),y()}catch(r){console.error("Error submitting form:",r)}else n&&y()}},disabled:R,children:p?"Mettre Ã  jour":"CrÃ©er"})]})]})};var bc,vc;(vc=bc||(bc={}))[vc.QR_CODE=0]="QR_CODE",vc[vc.AZTEC=1]="AZTEC",vc[vc.CODABAR=2]="CODABAR",vc[vc.CODE_39=3]="CODE_39",vc[vc.CODE_93=4]="CODE_93",vc[vc.CODE_128=5]="CODE_128",vc[vc.DATA_MATRIX=6]="DATA_MATRIX",vc[vc.MAXICODE=7]="MAXICODE",vc[vc.ITF=8]="ITF",vc[vc.EAN_13=9]="EAN_13",vc[vc.EAN_8=10]="EAN_8",vc[vc.PDF_417=11]="PDF_417",vc[vc.RSS_14=12]="RSS_14",vc[vc.RSS_EXPANDED=13]="RSS_EXPANDED",vc[vc.UPC_A=14]="UPC_A",vc[vc.UPC_E=15]="UPC_E",vc[vc.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var Cc,_c,Sc,Ec,Ac=new Map([[bc.QR_CODE,"QR_CODE"],[bc.AZTEC,"AZTEC"],[bc.CODABAR,"CODABAR"],[bc.CODE_39,"CODE_39"],[bc.CODE_93,"CODE_93"],[bc.CODE_128,"CODE_128"],[bc.DATA_MATRIX,"DATA_MATRIX"],[bc.MAXICODE,"MAXICODE"],[bc.ITF,"ITF"],[bc.EAN_13,"EAN_13"],[bc.EAN_8,"EAN_8"],[bc.PDF_417,"PDF_417"],[bc.RSS_14,"RSS_14"],[bc.RSS_EXPANDED,"RSS_EXPANDED"],[bc.UPC_A,"UPC_A"],[bc.UPC_E,"UPC_E"],[bc.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function Ic(e){return Object.values(bc).includes(e)}(_c=Cc||(Cc={}))[_c.UNKNOWN=0]="UNKNOWN",_c[_c.URL=1]="URL",(Ec=Sc||(Sc={}))[Ec.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",Ec[Ec.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE";var jc,Tc,Dc=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[Sc.SCAN_TYPE_CAMERA,Sc.SCAN_TYPE_FILE],e}(),Rc=function(){function e(e,t){this.format=e,this.formatName=t}return e.prototype.toString=function(){return this.formatName},e.create=function(t){if(!Ac.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new e(t,Ac.get(t))},e}(),Nc=function(){function e(){}return e.createFromText=function(e){return{decodedText:e,result:{text:e}}},e.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},e}();(Tc=jc||(jc={}))[Tc.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",Tc[Tc.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",Tc[Tc.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR";var Pc=function(){function e(){}return e.createFrom=function(e){return{errorMessage:e,type:jc.UNKWOWN_ERROR}},e}(),Oc=function(){function e(e){this.verbose=e}return e.prototype.log=function(e){this.verbose&&console.log(e)},e.prototype.warn=function(e){this.verbose&&console.warn(e)},e.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},e.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},e}();function kc(e){return null==e}var Mc=function(){function e(){}return e.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},e.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),Fc=function(){function e(){}return e.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e){var r=typeof e;return t.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(r,"."),!0),!1}for(var n=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),i=0,s=Object.keys(e);i<s.length;i++){var a=s[i];if(n.has(a))return t.logError("".concat(a," is not supported videoConstaints."),!0),!1}return!0},e}(),Bc={exports:{}};!function(e){function t(e){return null==e}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var r=Object.setPrototypeOf;r?r(e,t):e.__proto__=t}function s(e,t){void 0===t&&(t=e.constructor);var r=Error.captureStackTrace;r&&r(e,t)}var a,o,l=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this;return Object.defineProperty(n,"name",{value:r.name,enumerable:!1}),i(n,r.prototype),s(n),n}return n(t,e),t}(Error);class c extends l{constructor(e=void 0){super(e),this.message=e}getKind(){return this.constructor.kind}}c.kind="Exception";class d extends c{}d.kind="ArgumentException";class u extends c{}u.kind="IllegalArgumentException";class h{constructor(e){if(this.binarizer=e,null===e)throw new u("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,r,n){const i=this.binarizer.getLuminanceSource().crop(e,t,r,n);return new h(this.binarizer.createBinarizer(i))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new h(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new h(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch(e){return""}}}class p extends c{static getChecksumInstance(){return new p}}p.kind="ChecksumException";class m{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class f{static arraycopy(e,t,r,n,i){for(;i--;)r[n++]=e[t++]}static currentTimeMillis(){return Date.now()}}class g extends c{}g.kind="IndexOutOfBoundsException";class x extends g{constructor(e=void 0,t=void 0){super(t),this.index=e,this.message=t}}x.kind="ArrayIndexOutOfBoundsException";class y{static fill(e,t){for(let r=0,n=e.length;r<n;r++)e[r]=t}static fillWithin(e,t,r,n){y.rangeCheck(e.length,t,r);for(let i=t;i<r;i++)e[i]=n}static rangeCheck(e,t,r){if(t>r)throw new u("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new x(t);if(r>e)throw new x(r)}static asList(...e){return e}static create(e,t,r){return Array.from({length:e}).map((e=>Array.from({length:t}).fill(r)))}static createInt32Array(e,t,r){return Array.from({length:e}).map((e=>Int32Array.from({length:t}).fill(r)))}static equals(e,t){if(!e)return!1;if(!t)return!1;if(!e.length)return!1;if(!t.length)return!1;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}static hashCode(e){if(null===e)return 0;let t=1;for(const r of e)t=31*t+r;return t}static fillUint8Array(e,t){for(let r=0;r!==e.length;r++)e[r]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)}static copyOfRange(e,t,r){const n=r-t,i=new Int32Array(n);return f.arraycopy(e,t,i,0,n),i}static binarySearch(e,t,r){void 0===r&&(r=y.numberComparator);let n=0,i=e.length-1;for(;n<=i;){const s=i+n>>1,a=r(t,e[s]);if(a>0)n=s+1;else{if(!(a<0))return s;i=s-1}}return-n-1}static numberComparator(e,t){return e-t}}class w{static numberOfTrailingZeros(e){let t;if(0===e)return 32;let r=31;return t=e<<16,0!==t&&(r-=16,e=t),t=e<<8,0!==t&&(r-=8,e=t),t=e<<4,0!==t&&(r-=4,e=t),t=e<<2,0!==t&&(r-=2,e=t),r-(e<<1>>>31)}static numberOfLeadingZeros(e){if(0===e)return 32;let t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,e+=e>>>8,63&(e+=e>>>16)}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t=void 0){return parseInt(e,t)}}w.MIN_VALUE_32_BITS=-2147483648,w.MAX_VALUE=Number.MAX_SAFE_INTEGER;class b{constructor(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=null==t?b.makeArray(e):t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>32*this.bits.length){const t=b.makeArray(e);f.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return!!(this.bits[Math.floor(e/32)]&1<<(31&e))}set(e){this.bits[Math.floor(e/32)]|=1<<(31&e)}flip(e){this.bits[Math.floor(e/32)]^=1<<(31&e)}getNextSet(e){const t=this.size;if(e>=t)return t;const r=this.bits;let n=Math.floor(e/32),i=r[n];i&=~((1<<(31&e))-1);const s=r.length;for(;0===i;){if(++n===s)return t;i=r[n]}const a=32*n+w.numberOfTrailingZeros(i);return a>t?t:a}getNextUnset(e){const t=this.size;if(e>=t)return t;const r=this.bits;let n=Math.floor(e/32),i=~r[n];i&=~((1<<(31&e))-1);const s=r.length;for(;0===i;){if(++n===s)return t;i=~r[n]}const a=32*n+w.numberOfTrailingZeros(i);return a>t?t:a}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new u;if(t===e)return;t--;const r=Math.floor(e/32),n=Math.floor(t/32),i=this.bits;for(let s=r;s<=n;s++){const a=(2<<(s<n?31:31&t))-(1<<(s>r?0:31&e));i[s]|=a}}clear(){const e=this.bits.length,t=this.bits;for(let r=0;r<e;r++)t[r]=0}isRange(e,t,r){if(t<e||e<0||t>this.size)throw new u;if(t===e)return!0;t--;const n=Math.floor(e/32),i=Math.floor(t/32),s=this.bits;for(let a=n;a<=i;a++){const o=(2<<(a<i?31:31&t))-(1<<(a>n?0:31&e))&4294967295;if((s[a]&o)!==(r?o:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(e,t){if(t<0||t>32)throw new u("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let r=t;r>0;r--)this.appendBit(1==(e>>r-1&1))}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let r=0;r<t;r++)this.appendBit(e.get(r))}xor(e){if(this.size!==e.size)throw new u("Sizes don't match");const t=this.bits;for(let r=0,n=t.length;r<n;r++)t[r]^=e.bits[r]}toBytes(e,t,r,n){for(let i=0;i<n;i++){let n=0;for(let t=0;t<8;t++)this.get(e)&&(n|=1<<7-t),e++;t[r+i]=n}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,n=this.bits;for(let i=0;i<r;i++){let r=n[i];r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16&65535|(65535&r)<<16,e[t-i]=r}if(this.size!==32*r){const t=32*r-this.size;let n=e[0]>>>t;for(let i=1;i<r;i++){const r=e[i];n|=r<<32-t,e[i-1]=n,n=r>>>t}e[r-1]=n}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof b))return!1;const t=e;return this.size===t.size&&y.equals(this.bits,t.bits)}hashCode(){return 31*this.size+y.hashCode(this.bits)}toString(){let e="";for(let t=0,r=this.size;t<r;t++)7&t||(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new b(this.size,this.bits.slice())}}(o=a||(a={}))[o.OTHER=0]="OTHER",o[o.PURE_BARCODE=1]="PURE_BARCODE",o[o.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",o[o.TRY_HARDER=3]="TRY_HARDER",o[o.CHARACTER_SET=4]="CHARACTER_SET",o[o.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",o[o.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",o[o.ASSUME_GS1=7]="ASSUME_GS1",o[o.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",o[o.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",o[o.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS";var v,C,_=a;class S extends c{static getFormatInstance(){return new S}}S.kind="FormatException",(C=v||(v={}))[C.Cp437=0]="Cp437",C[C.ISO8859_1=1]="ISO8859_1",C[C.ISO8859_2=2]="ISO8859_2",C[C.ISO8859_3=3]="ISO8859_3",C[C.ISO8859_4=4]="ISO8859_4",C[C.ISO8859_5=5]="ISO8859_5",C[C.ISO8859_6=6]="ISO8859_6",C[C.ISO8859_7=7]="ISO8859_7",C[C.ISO8859_8=8]="ISO8859_8",C[C.ISO8859_9=9]="ISO8859_9",C[C.ISO8859_10=10]="ISO8859_10",C[C.ISO8859_11=11]="ISO8859_11",C[C.ISO8859_13=12]="ISO8859_13",C[C.ISO8859_14=13]="ISO8859_14",C[C.ISO8859_15=14]="ISO8859_15",C[C.ISO8859_16=15]="ISO8859_16",C[C.SJIS=16]="SJIS",C[C.Cp1250=17]="Cp1250",C[C.Cp1251=18]="Cp1251",C[C.Cp1252=19]="Cp1252",C[C.Cp1256=20]="Cp1256",C[C.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",C[C.UTF8=22]="UTF8",C[C.ASCII=23]="ASCII",C[C.Big5=24]="Big5",C[C.GB18030=25]="GB18030",C[C.EUC_KR=26]="EUC_KR";class E{constructor(e,t,r,...n){this.valueIdentifier=e,this.name=r,this.values="number"==typeof t?Int32Array.from([t]):t,this.otherEncodingNames=n,E.VALUE_IDENTIFIER_TO_ECI.set(e,this),E.NAME_TO_ECI.set(r,this);const i=this.values;for(let s=0,a=i.length;s!==a;s++){const e=i[s];E.VALUES_TO_ECI.set(e,this)}for(const s of n)E.NAME_TO_ECI.set(s,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new S("incorect value");const t=E.VALUES_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}static getCharacterSetECIByName(e){const t=E.NAME_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}equals(e){if(!(e instanceof E))return!1;const t=e;return this.getName()===t.getName()}}E.VALUE_IDENTIFIER_TO_ECI=new Map,E.VALUES_TO_ECI=new Map,E.NAME_TO_ECI=new Map,E.Cp437=new E(v.Cp437,Int32Array.from([0,2]),"Cp437"),E.ISO8859_1=new E(v.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),E.ISO8859_2=new E(v.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),E.ISO8859_3=new E(v.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),E.ISO8859_4=new E(v.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),E.ISO8859_5=new E(v.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),E.ISO8859_6=new E(v.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),E.ISO8859_7=new E(v.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),E.ISO8859_8=new E(v.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),E.ISO8859_9=new E(v.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),E.ISO8859_10=new E(v.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),E.ISO8859_11=new E(v.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),E.ISO8859_13=new E(v.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),E.ISO8859_14=new E(v.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),E.ISO8859_15=new E(v.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),E.ISO8859_16=new E(v.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),E.SJIS=new E(v.SJIS,20,"SJIS","Shift_JIS"),E.Cp1250=new E(v.Cp1250,21,"Cp1250","windows-1250"),E.Cp1251=new E(v.Cp1251,22,"Cp1251","windows-1251"),E.Cp1252=new E(v.Cp1252,23,"Cp1252","windows-1252"),E.Cp1256=new E(v.Cp1256,24,"Cp1256","windows-1256"),E.UnicodeBigUnmarked=new E(v.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),E.UTF8=new E(v.UTF8,26,"UTF8","UTF-8"),E.ASCII=new E(v.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),E.Big5=new E(v.Big5,28,"Big5"),E.GB18030=new E(v.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),E.EUC_KR=new E(v.EUC_KR,30,"EUC_KR","EUC-KR");class A extends c{}A.kind="UnsupportedOperationException";class I{static decode(e,t){const r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)}static shouldDecodeOnFallback(e){return!I.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){const r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):"undefined"==typeof TextEncoder?this.encodeFallback(e):(new TextEncoder).encode(e)}static isBrowser(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(e){return"string"==typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof E?e:E.getCharacterSetECIByName(e)}static decodeFallback(e,t){const r=this.encodingCharacterSet(t);if(I.isDecodeFallbackSupported(r)){let t="";for(let r=0,n=e.length;r<n;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+="%"+n}return decodeURIComponent(t)}if(r.equals(E.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new A(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(E.UTF8)||e.equals(E.ISO8859_1)||e.equals(E.ASCII)}static encodeFallback(e){const t=btoa(unescape(encodeURIComponent(e))).split(""),r=[];for(let n=0;n<t.length;n++)r.push(t[n].charCodeAt(0));return new Uint8Array(r)}}class j{static castAsNonUtf8Char(e,t=null){const r=t?t.getName():this.ISO88591;return I.decode(new Uint8Array([e]),r)}static guessEncoding(e,t){if(null!=t&&void 0!==t.get(_.CHARACTER_SET))return t.get(_.CHARACTER_SET).toString();const r=e.length;let n=!0,i=!0,s=!0,a=0,o=0,l=0,c=0,d=0,u=0,h=0,p=0,m=0,f=0,g=0;const x=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let y=0;y<r&&(n||i||s);y++){const t=255&e[y];s&&(a>0?128&t?a--:s=!1:128&t&&(64&t?(a++,32&t?(a++,16&t?(a++,8&t?s=!1:c++):l++):o++):s=!1)),n&&(t>127&&t<160?n=!1:t>159&&(t<192||215===t||247===t)&&g++),i&&(d>0?t<64||127===t||t>252?i=!1:d--:128===t||160===t||t>239?i=!1:t>160&&t<224?(u++,p=0,h++,h>m&&(m=h)):t>127?(d++,h=0,p++,p>f&&(f=p)):(h=0,p=0))}return s&&a>0&&(s=!1),i&&d>0&&(i=!1),s&&(x||o+l+c>0)?j.UTF8:i&&(j.ASSUME_SHIFT_JIS||m>=3||f>=3)?j.SHIFT_JIS:n&&i?2===m&&2===u||10*g>=r?j.SHIFT_JIS:j.ISO88591:n?j.ISO88591:i?j.SHIFT_JIS:s?j.UTF8:j.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let r=-1;function n(e,n,i,s,a,o){if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[r],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(i),u=i&&i[0]+""=="0"?"0":" ";for(;l.length<d;)l=void 0!==n?l+u:u+l;return l}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,n)}static getBytes(e,t){return I.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}j.SHIFT_JIS=E.SJIS.getName(),j.GB2312="GB2312",j.ISO88591=E.ISO8859_1.getName(),j.EUC_JP="EUC_JP",j.UTF8=E.UTF8.getName(),j.PLATFORM_DEFAULT_ENCODING=j.UTF8,j.ASSUME_SHIFT_JIS=!1;class T{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return"string"==typeof e?this.value+=e.toString():this.encoding?this.value+=j.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,r){for(let n=t;t<t+r;n++)this.append(e[n]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class D{constructor(e,t,r,n){if(this.width=e,this.height=t,this.rowSize=r,this.bits=n,null==t&&(t=e),this.height=t,e<1||t<1)throw new u("Both dimensions must be greater than 0");null==r&&(r=Math.floor((e+31)/32)),this.rowSize=r,null==n&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,r=e[0].length,n=new D(r,t);for(let i=0;i<t;i++){const t=e[i];for(let e=0;e<r;e++)t[e]&&n.set(e,i)}return n}static parseFromString(e,t,r){if(null===e)throw new u("stringRepresentation cannot be null");const n=new Array(e.length);let i=0,s=0,a=-1,o=0,l=0;for(;l<e.length;)if("\n"===e.charAt(l)||"\r"===e.charAt(l)){if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new u("row lengths do not match");s=i,o++}l++}else if(e.substring(l,l+t.length)===t)l+=t.length,n[i]=!0,i++;else{if(e.substring(l,l+r.length)!==r)throw new u("illegal character encountered: "+e.substring(l));l+=r.length,n[i]=!1,i++}if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new u("row lengths do not match");o++}const c=new D(a,o);for(let d=0;d<i;d++)n[d]&&c.set(Math.floor(d%a),Math.floor(d/a));return c}get(e,t){const r=t*this.rowSize+Math.floor(e/32);return!!(this.bits[r]>>>(31&e)&1)}set(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(31&e)&4294967295}unset(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(31&e)&4294967295)}flip(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(31&e)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new u("input matrix dimensions do not match");const t=new b(Math.floor(this.width/32)+1),r=this.rowSize,n=this.bits;for(let i=0,s=this.height;i<s;i++){const s=i*r,a=e.getRow(i,t).getBitArray();for(let e=0;e<r;e++)n[s+e]^=a[e]}}clear(){const e=this.bits,t=e.length;for(let r=0;r<t;r++)e[r]=0}setRegion(e,t,r,n){if(t<0||e<0)throw new u("Left and top must be nonnegative");if(n<1||r<1)throw new u("Height and width must be at least 1");const i=e+r,s=t+n;if(s>this.height||i>this.width)throw new u("The region must fit inside the matrix");const a=this.rowSize,o=this.bits;for(let l=t;l<s;l++){const t=l*a;for(let r=e;r<i;r++)o[t+Math.floor(r/32)]|=1<<(31&r)&4294967295}}getRow(e,t){null==t||t.getSize()<this.width?t=new b(this.width):t.clear();const r=this.rowSize,n=this.bits,i=e*r;for(let s=0;s<r;s++)t.setBulk(32*s,n[i+s]);return t}setRow(e,t){f.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let r=new b(e),n=new b(e);for(let i=0,s=Math.floor((t+1)/2);i<s;i++)r=this.getRow(i,r),n=this.getRow(t-1-i,n),r.reverse(),n.reverse(),this.setRow(i,n),this.setRow(t-1-i,r)}getEnclosingRectangle(){const e=this.width,t=this.height,r=this.rowSize,n=this.bits;let i=e,s=t,a=-1,o=-1;for(let l=0;l<t;l++)for(let e=0;e<r;e++){const t=n[l*r+e];if(0!==t){if(l<s&&(s=l),l>o&&(o=l),32*e<i){let r=0;for(;!(t<<31-r&4294967295);)r++;32*e+r<i&&(i=32*e+r)}if(32*e+31>a){let r=31;for(;t>>>r===0;)r--;32*e+r>a&&(a=32*e+r)}}}return a<i||o<s?null:Int32Array.from([i,s,a-i+1,o-s+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let r=0;for(;r<t.length&&0===t[r];)r++;if(r===t.length)return null;const n=r/e;let i=r%e*32;const s=t[r];let a=0;for(;!(s<<31-a&4294967295);)a++;return i+=a,Int32Array.from([i,n])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let r=t.length-1;for(;r>=0&&0===t[r];)r--;if(r<0)return null;const n=Math.floor(r/e);let i=32*Math.floor(r%e);const s=t[r];let a=31;for(;s>>>a===0;)a--;return i+=a,Int32Array.from([i,n])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof D))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&y.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+y.hashCode(this.bits),e}toString(e="X ",t="  ",r="\n"){return this.buildToString(e,t,r)}buildToString(e,t,r){let n=new T;for(let i=0,s=this.height;i<s;i++){for(let r=0,s=this.width;r<s;r++)n.append(this.get(r,i)?e:t);n.append(r)}return n.toString()}clone(){return new D(this.width,this.height,this.rowSize,this.bits.slice())}}class R extends c{static getNotFoundInstance(){return new R}}R.kind="NotFoundException";class N extends m{constructor(e){super(e),this.luminances=N.EMPTY,this.buckets=new Int32Array(N.LUMINANCE_BUCKETS)}getBlackRow(e,t){const r=this.getLuminanceSource(),n=r.getWidth();null==t||t.getSize()<n?t=new b(n):t.clear(),this.initArrays(n);const i=r.getRow(e,this.luminances),s=this.buckets;for(let o=0;o<n;o++)s[(255&i[o])>>N.LUMINANCE_SHIFT]++;const a=N.estimateBlackPoint(s);if(n<3)for(let o=0;o<n;o++)(255&i[o])<a&&t.set(o);else{let e=255&i[0],r=255&i[1];for(let s=1;s<n-1;s++){const n=255&i[s+1];(4*r-e-n)/2<a&&t.set(s),e=r,r=n}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight(),n=new D(t,r);this.initArrays(t);const i=this.buckets;for(let o=1;o<5;o++){const n=Math.floor(r*o/5),s=e.getRow(n,this.luminances),a=Math.floor(4*t/5);for(let e=Math.floor(t/5);e<a;e++)i[(255&s[e])>>N.LUMINANCE_SHIFT]++}const s=N.estimateBlackPoint(i),a=e.getMatrix();for(let o=0;o<r;o++){const e=o*t;for(let r=0;r<t;r++)(255&a[e+r])<s&&n.set(r,o)}return n}createBinarizer(e){return new N(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let r=0;r<N.LUMINANCE_BUCKETS;r++)t[r]=0}static estimateBlackPoint(e){const t=e.length;let r=0,n=0,i=0;for(let c=0;c<t;c++)e[c]>i&&(n=c,i=e[c]),e[c]>r&&(r=e[c]);let s=0,a=0;for(let c=0;c<t;c++){const t=c-n,r=e[c]*t*t;r>a&&(s=c,a=r)}if(n>s){const e=n;n=s,s=e}if(s-n<=t/16)throw new R;let o=s-1,l=-1;for(let c=s-1;c>n;c--){const t=c-n,i=t*t*(s-c)*(r-e[c]);i>l&&(o=c,l=i)}return o<<N.LUMINANCE_SHIFT}}N.LUMINANCE_BITS=5,N.LUMINANCE_SHIFT=8-N.LUMINANCE_BITS,N.LUMINANCE_BUCKETS=1<<N.LUMINANCE_BITS,N.EMPTY=Uint8ClampedArray.from([0]);class P extends N{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight();if(t>=P.MINIMUM_DIMENSION&&r>=P.MINIMUM_DIMENSION){const n=e.getMatrix();let i=t>>P.BLOCK_SIZE_POWER;0!==(t&P.BLOCK_SIZE_MASK)&&i++;let s=r>>P.BLOCK_SIZE_POWER;0!==(r&P.BLOCK_SIZE_MASK)&&s++;const a=P.calculateBlackPoints(n,i,s,t,r),o=new D(t,r);P.calculateThresholdForBlock(n,i,s,t,r,a,o),this.matrix=o}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new P(e)}static calculateThresholdForBlock(e,t,r,n,i,s,a){const o=i-P.BLOCK_SIZE,l=n-P.BLOCK_SIZE;for(let c=0;c<r;c++){let i=c<<P.BLOCK_SIZE_POWER;i>o&&(i=o);const d=P.cap(c,2,r-3);for(let r=0;r<t;r++){let o=r<<P.BLOCK_SIZE_POWER;o>l&&(o=l);const c=P.cap(r,2,t-3);let u=0;for(let e=-2;e<=2;e++){const t=s[d+e];u+=t[c-2]+t[c-1]+t[c]+t[c+1]+t[c+2]}const h=u/25;P.thresholdBlock(e,o,i,h,n,a)}}}static cap(e,t,r){return e<t?t:e>r?r:e}static thresholdBlock(e,t,r,n,i,s){for(let a=0,o=r*i+t;a<P.BLOCK_SIZE;a++,o+=i)for(let i=0;i<P.BLOCK_SIZE;i++)(255&e[o+i])<=n&&s.set(t+i,r+a)}static calculateBlackPoints(e,t,r,n,i){const s=i-P.BLOCK_SIZE,a=n-P.BLOCK_SIZE,o=new Array(r);for(let l=0;l<r;l++){o[l]=new Int32Array(t);let r=l<<P.BLOCK_SIZE_POWER;r>s&&(r=s);for(let i=0;i<t;i++){let t=i<<P.BLOCK_SIZE_POWER;t>a&&(t=a);let s=0,c=255,d=0;for(let i=0,a=r*n+t;i<P.BLOCK_SIZE;i++,a+=n){for(let t=0;t<P.BLOCK_SIZE;t++){const r=255&e[a+t];s+=r,r<c&&(c=r),r>d&&(d=r)}if(d-c>P.MIN_DYNAMIC_RANGE)for(i++,a+=n;i<P.BLOCK_SIZE;i++,a+=n)for(let t=0;t<P.BLOCK_SIZE;t++)s+=255&e[a+t]}let u=s>>2*P.BLOCK_SIZE_POWER;if(d-c<=P.MIN_DYNAMIC_RANGE&&(u=c/2,l>0&&i>0)){const e=(o[l-1][i]+2*o[l][i-1]+o[l-1][i-1])/4;c<e&&(u=e)}o[l][i]=u}}return o}}P.BLOCK_SIZE_POWER=3,P.BLOCK_SIZE=1<<P.BLOCK_SIZE_POWER,P.BLOCK_SIZE_MASK=P.BLOCK_SIZE-1,P.MINIMUM_DIMENSION=5*P.BLOCK_SIZE,P.MIN_DYNAMIC_RANGE=24;class O{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,r,n){throw new A("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new A("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new A("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new T;for(let r=0;r<this.height;r++){const n=this.getRow(r,e);for(let e=0;e<this.width;e++){const r=255&n[e];let i;i=r<64?"#":r<128?"+":r<192?".":" ",t.append(i)}t.append("\n")}return t.toString()}}class k extends O{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const r=this.delegate.getRow(e,t),n=this.getWidth();for(let i=0;i<n;i++)r[i]=255-(255&r[i]);return r}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(t);for(let n=0;n<t;n++)r[n]=255-(255&e[n]);return r}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,r,n){return new k(this.delegate.crop(e,t,r,n))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new k(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new k(this.delegate.rotateCounterClockwise45())}}class M extends O{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=M.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return M.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,r){const n=new Uint8ClampedArray(t*r);for(let i=0,s=0,a=e.length;i<a;i+=4,s++){let t;t=0===e[i+3]?255:306*e[i]+601*e[i+1]+117*e[i+2]+512>>10,n[s]=t}return n}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth(),n=e*r;return null===t?t=this.buffer.slice(n,n+r):(t.length<r&&(t=new Uint8ClampedArray(r)),t.set(this.buffer.slice(n,n+r))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,r,n){return super.crop(e,t,r,n),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),r=t.getContext("2d"),n=e*M.DEGREE_TO_RADIANS,i=this.canvas.width,s=this.canvas.height,a=Math.ceil(Math.abs(Math.cos(n))*i+Math.abs(Math.sin(n))*s),o=Math.ceil(Math.abs(Math.sin(n))*i+Math.abs(Math.cos(n))*s);return t.width=a,t.height=o,r.translate(a/2,o/2),r.rotate(n),r.drawImage(this.canvas,i/-2,s/-2),this.buffer=M.makeBufferFromCanvasImageData(t),this}invert(){return new k(this)}}M.DEGREE_TO_RADIANS=Math.PI/180;class F{constructor(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var B,L,z=(globalThis||kt||self||window?(globalThis||kt||self||window||void 0).__awaiter:void 0)||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){e.done?r(e.value):i(e.value).then(a,o)}l((n=n.apply(e,t||[])).next())}))};class U{constructor(e,t=500,r){this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!=typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return z(this,void 0,void 0,(function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const r of e){const e="video"===r.kind?"videoinput":r.kind;if("videoinput"!==e)continue;const n={deviceId:r.deviceId||r.id,label:r.label||`Video device ${t.length+1}`,kind:e,groupId:r.groupId};t.push(n)}return t}))}getVideoInputDevices(){return z(this,void 0,void 0,(function*(){return(yield this.listVideoInputDevices()).map((e=>new F(e.deviceId,e.label)))}))}findDeviceById(e){return z(this,void 0,void 0,(function*(){const t=yield this.listVideoInputDevices();return t?t.find((t=>t.deviceId===e)):null}))}decodeFromInputVideoDevice(e,t){return z(this,void 0,void 0,(function*(){return yield this.decodeOnceFromVideoDevice(e,t)}))}decodeOnceFromVideoDevice(e,t){return z(this,void 0,void 0,(function*(){let r;this.reset(),r=e?{deviceId:{exact:e}}:{facingMode:"environment"};const n={video:r};return yield this.decodeOnceFromConstraints(n,t)}))}decodeOnceFromConstraints(e,t){return z(this,void 0,void 0,(function*(){const r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(r,t)}))}decodeOnceFromStream(e,t){return z(this,void 0,void 0,(function*(){this.reset();const r=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(r)}))}decodeFromInputVideoDeviceContinuously(e,t,r){return z(this,void 0,void 0,(function*(){return yield this.decodeFromVideoDevice(e,t,r)}))}decodeFromVideoDevice(e,t,r){return z(this,void 0,void 0,(function*(){let n;n=e?{deviceId:{exact:e}}:{facingMode:"environment"};const i={video:n};return yield this.decodeFromConstraints(i,t,r)}))}decodeFromConstraints(e,t,r){return z(this,void 0,void 0,(function*(){const n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(n,t,r)}))}decodeFromStream(e,t,r){return z(this,void 0,void 0,(function*(){this.reset();const n=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(n,r)}))}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return z(this,void 0,void 0,(function*(){const r=this.prepareVideoElement(t);return this.addVideoSource(r,e),this.videoElement=r,this.stream=e,yield this.playVideoOnLoadAsync(r),r}))}playVideoOnLoadAsync(e){return new Promise(((t,r)=>this.playVideoOnLoad(e,(()=>t()))))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return z(this,void 0,void 0,(function*(){if(this.isVideoPlaying(e))console.warn("Trying to play video that is already playing.");else try{yield e.play()}catch(t){console.warn("It was not possible to play the video.")}}))}getMediaElement(e,t){const r=document.getElementById(e);if(!r)throw new d(`element with id '${e}' not found`);if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new d(`element with id '${e}' must be an ${t} element`);return r}decodeFromImage(e,t){if(!e&&!t)throw new d("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,r){if(void 0===e&&void 0===t)throw new d("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)}decodeFromImageElement(e){if(!e)throw new d("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);let r;return this.imageElement=t,r=this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t),r}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)}_decodeFromVideoElementSetup(e){if(!e)throw new d("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const r=this._decodeOnLoadImage(t);return t.src=e,r}decodeFromVideoUrl(e){if(!e)throw new d("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r}decodeFromVideoUrlContinuously(e,t){if(!e)throw new d("An URL must be provided.");this.reset();const r=this.prepareVideoElement(),n=this.decodeFromVideoElementContinuously(r,t);return r.src=e,n}_decodeOnLoadImage(e){return new Promise(((t,r)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,r),e.addEventListener("load",this.imageLoadedListener)}))}_decodeOnLoadVideo(e){return z(this,void 0,void 0,(function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)}))}_decodeOnLoadVideoContinuously(e,t){return z(this,void 0,void 0,(function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)}))}isImageLoaded(e){return!!e.complete&&0!==e.naturalWidth}prepareImageElement(e){let t;return void 0===e&&(t=document.createElement("img"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return e||"undefined"==typeof document||(t=document.createElement("video"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,r=!0){this._stopAsyncDecode=!1;const n=(i,s)=>{if(this._stopAsyncDecode)return s(new R("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{i(this.decode(e))}catch(a){if(t&&a instanceof R||(a instanceof p||a instanceof S)&&r)return setTimeout(n,this._timeBetweenDecodingAttempts,i,s);s(a)}};return new Promise(((e,t)=>n(e,t)))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const r=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const n=this.decode(e);t(n,null),setTimeout(r,this.timeBetweenScansMillis)}catch(n){t(null,n),(n instanceof p||n instanceof S||n instanceof R)&&setTimeout(r,this._timeBetweenDecodingAttempts)}};r()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return 0!==e.videoWidth}drawFrameOnCanvas(e,t,r){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,r=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),r=new M(t),n=new P(r);return new h(n)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const t=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=t}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let r,n;return void 0!==e&&(e instanceof HTMLVideoElement?(r=e.videoWidth,n=e.videoHeight):e instanceof HTMLImageElement&&(r=e.naturalWidth||e.width,n=e.naturalHeight||e.height)),t.style.width=r+"px",t.style.height=n+"px",t.width=r,t.height=n,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach((e=>e.stop())),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch(r){e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")}}class W{constructor(e,t,r=(null==t?0:8*t.length),n,i,s=f.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=n,this.format=i,this.timestamp=s,this.text=e,this.rawBytes=t,this.numBits=null==r?null==t?0:8*t.length:r,this.resultPoints=n,this.format=i,this.resultMetadata=null,this.timestamp=null==s?f.currentTimeMillis():s}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){const r=new Array(t.length+e.length);f.arraycopy(t,0,r,0,t.length),f.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}}getTimestamp(){return this.timestamp}toString(){return this.text}}(L=B||(B={}))[L.AZTEC=0]="AZTEC",L[L.CODABAR=1]="CODABAR",L[L.CODE_39=2]="CODE_39",L[L.CODE_93=3]="CODE_93",L[L.CODE_128=4]="CODE_128",L[L.DATA_MATRIX=5]="DATA_MATRIX",L[L.EAN_8=6]="EAN_8",L[L.EAN_13=7]="EAN_13",L[L.ITF=8]="ITF",L[L.MAXICODE=9]="MAXICODE",L[L.PDF_417=10]="PDF_417",L[L.QR_CODE=11]="QR_CODE",L[L.RSS_14=12]="RSS_14",L[L.RSS_EXPANDED=13]="RSS_EXPANDED",L[L.UPC_A=14]="UPC_A",L[L.UPC_E=15]="UPC_E",L[L.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var V,H,G=B;(H=V||(V={}))[H.OTHER=0]="OTHER",H[H.ORIENTATION=1]="ORIENTATION",H[H.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",H[H.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",H[H.ISSUE_NUMBER=4]="ISSUE_NUMBER",H[H.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",H[H.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",H[H.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",H[H.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",H[H.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",H[H.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY";var q,X,$,Z,Y,Q,K,J,ee,te,re,ne=V;class ie{constructor(e,t,r,n,i=-1,s=-1){this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=n,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=s,this.numBits=null==e?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class se{exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class ae{constructor(e,t){if(0===t.length)throw new u;this.field=e;const r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-e),f.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);const t=this.coefficients;let r;if(1===e){r=0;for(let e=0,n=t.length;e!==n;e++){const n=t[e];r=se.addOrSubtract(r,n)}return r}r=t[0];const n=t.length,i=this.field;for(let s=1;s<n;s++)r=se.addOrSubtract(i.multiply(e,r),t[s]);return r}addOrSubtract(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){const e=t;t=r,r=e}let n=new Int32Array(r.length);const i=r.length-t.length;f.arraycopy(r,0,n,0,i);for(let s=i;s<r.length;s++)n[s]=se.addOrSubtract(t[s-i],r[s]);return new ae(this.field,n)}multiply(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1),a=this.field;for(let o=0;o<r;o++){const e=t[o];for(let t=0;t<i;t++)s[o+t]=se.addOrSubtract(s[o+t],a.multiply(e,n[t]))}return new ae(a,s)}multiplyScalar(e){if(0===e)return this.field.getZero();if(1===e)return this;const t=this.coefficients.length,r=this.field,n=new Int32Array(t),i=this.coefficients;for(let s=0;s<t;s++)n[s]=r.multiply(i[s],e);return new ae(r,n)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return this.field.getZero();const r=this.coefficients,n=r.length,i=new Int32Array(n+e),s=this.field;for(let a=0;a<n;a++)i[a]=s.multiply(r[a],t);return new ae(s,i)}divide(e){if(!this.field.equals(e.field))throw new u("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new u("Divide by 0");const t=this.field;let r=t.getZero(),n=this;const i=e.getCoefficient(e.getDegree()),s=t.inverse(i);for(;n.getDegree()>=e.getDegree()&&!n.isZero();){const i=n.getDegree()-e.getDegree(),a=t.multiply(n.getCoefficient(n.getDegree()),s),o=e.multiplyByMonomial(i,a),l=t.buildMonomial(i,a);r=r.addOrSubtract(l),n=n.addOrSubtract(o)}return[r,n]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);if(0!==r){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),0===t||1!==r){const t=this.field.log(r);0===t?e+="1":1===t?e+="a":(e+="a^",e+=t)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e}}class oe extends c{}oe.kind="ArithmeticException";class le extends se{constructor(e,t,r){super(),this.primitive=e,this.size=t,this.generatorBase=r;const n=new Int32Array(t);let i=1;for(let a=0;a<t;a++)n[a]=i,i*=2,i>=t&&(i^=e,i&=t-1);this.expTable=n;const s=new Int32Array(t);for(let a=0;a<t-1;a++)s[n[a]]=a;this.logTable=s,this.zero=new ae(this,Int32Array.from([0])),this.one=new ae(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;const r=new Int32Array(e+1);return r[0]=t,new ae(this,r)}inverse(e){if(0===e)throw new oe;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+w.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}le.AZTEC_DATA_12=new le(4201,4096,1),le.AZTEC_DATA_10=new le(1033,1024,1),le.AZTEC_DATA_6=new le(67,64,1),le.AZTEC_PARAM=new le(19,16,1),le.QR_CODE_FIELD_256=new le(285,256,0),le.DATA_MATRIX_FIELD_256=new le(301,256,1),le.AZTEC_DATA_8=le.DATA_MATRIX_FIELD_256,le.MAXICODE_FIELD_64=le.AZTEC_DATA_6;class ce extends c{}ce.kind="ReedSolomonException";class de extends c{}de.kind="IllegalStateException";class ue{constructor(e){this.field=e}decode(e,t){const r=this.field,n=new ae(r,e),i=new Int32Array(t);let s=!0;for(let h=0;h<t;h++){const e=n.evaluateAt(r.exp(h+r.getGeneratorBase()));i[i.length-1-h]=e,0!==e&&(s=!1)}if(s)return;const a=new ae(r,i),o=this.runEuclideanAlgorithm(r.buildMonomial(t,1),a,t),l=o[0],c=o[1],d=this.findErrorLocations(l),u=this.findErrorMagnitudes(c,d);for(let h=0;h<d.length;h++){const t=e.length-1-r.log(d[h]);if(t<0)throw new ce("Bad error location");e[t]=le.addOrSubtract(e[t],u[h])}}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){const r=e;e=t,t=r}const n=this.field;let i=e,s=t,a=n.getZero(),o=n.getOne();for(;s.getDegree()>=(r/2|0);){let e=i,t=a;if(i=s,a=o,i.isZero())throw new ce("r_{i-1} was zero");s=e;let r=n.getZero();const l=i.getCoefficient(i.getDegree()),c=n.inverse(l);for(;s.getDegree()>=i.getDegree()&&!s.isZero();){const e=s.getDegree()-i.getDegree(),t=n.multiply(s.getCoefficient(s.getDegree()),c);r=r.addOrSubtract(n.buildMonomial(e,t)),s=s.addOrSubtract(i.multiplyByMonomial(e,t))}if(o=r.multiply(a).addOrSubtract(t),s.getDegree()>=i.getDegree())throw new de("Division algorithm failed to reduce polynomial?")}const l=o.getCoefficient(0);if(0===l)throw new ce("sigmaTilde(0) was zero");const c=n.inverse(l);return[o.multiplyScalar(c),s.multiplyScalar(c)]}findErrorLocations(e){const t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);const r=new Int32Array(t);let n=0;const i=this.field;for(let s=1;s<i.getSize()&&n<t;s++)0===e.evaluateAt(s)&&(r[n]=i.inverse(s),n++);if(n!==t)throw new ce("Error locator degree does not match number of roots");return r}findErrorMagnitudes(e,t){const r=t.length,n=new Int32Array(r),i=this.field;for(let s=0;s<r;s++){const a=i.inverse(t[s]);let o=1;for(let e=0;e<r;e++)if(s!==e){const r=i.multiply(t[e],a),n=1&r?-2&r:1|r;o=i.multiply(o,n)}n[s]=i.multiply(e.evaluateAt(a),i.inverse(o)),0!==i.getGeneratorBase()&&(n[s]=i.multiply(n[s],a))}return n}}(K=q||(q={}))[K.UPPER=0]="UPPER",K[K.LOWER=1]="LOWER",K[K.MIXED=2]="MIXED",K[K.DIGIT=3]="DIGIT",K[K.PUNCT=4]="PUNCT",K[K.BINARY=5]="BINARY";class he{decode(e){this.ddata=e;let t=e.getBits(),r=this.extractBits(t),n=this.correctBits(r),i=he.convertBoolArrayToByteArray(n),s=he.getEncodedData(n),a=new ie(i,s,null,null);return a.setNumBits(n.length),a}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,r=q.UPPER,n=q.UPPER,i="",s=0;for(;s<t;)if(n===q.BINARY){if(t-s<5)break;let a=he.readCode(e,s,5);if(s+=5,0===a){if(t-s<11)break;a=he.readCode(e,s,11)+31,s+=11}for(let r=0;r<a;r++){if(t-s<8){s=t;break}const r=he.readCode(e,s,8);i+=j.castAsNonUtf8Char(r),s+=8}n=r}else{let a=n===q.DIGIT?4:5;if(t-s<a)break;let o=he.readCode(e,s,a);s+=a;let l=he.getCharacter(n,o);l.startsWith("CTRL_")?(r=n,n=he.getTable(l.charAt(5)),"L"===l.charAt(6)&&(r=n)):(i+=l,n=r)}return i}static getTable(e){switch(e){case"L":return q.LOWER;case"P":return q.PUNCT;case"M":return q.MIXED;case"D":return q.DIGIT;case"B":return q.BINARY;default:return q.UPPER}}static getCharacter(e,t){switch(e){case q.UPPER:return he.UPPER_TABLE[t];case q.LOWER:return he.LOWER_TABLE[t];case q.MIXED:return he.MIXED_TABLE[t];case q.PUNCT:return he.PUNCT_TABLE[t];case q.DIGIT:return he.DIGIT_TABLE[t];default:throw new de("Bad table")}}correctBits(e){let t,r;this.ddata.getNbLayers()<=2?(r=6,t=le.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(r=8,t=le.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(r=10,t=le.AZTEC_DATA_10):(r=12,t=le.AZTEC_DATA_12);let n=this.ddata.getNbDatablocks(),i=e.length/r;if(i<n)throw new S;let s=e.length%r,a=new Int32Array(i);for(let h=0;h<i;h++,s+=r)a[h]=he.readCode(e,s,r);try{new ue(t).decode(a,i-n)}catch(u){throw new S(u)}let o=(1<<r)-1,l=0;for(let h=0;h<n;h++){let e=a[h];if(0===e||e===o)throw new S;1!==e&&e!==o-1||l++}let c=new Array(n*r-l),d=0;for(let h=0;h<n;h++){let e=a[h];if(1===e||e===o-1)c.fill(e>1,d,d+r-1),d+=r-1;else for(let t=r-1;t>=0;--t)c[d++]=!!(e&1<<t)}return c}extractBits(e){let t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),n=(t?11:14)+4*r,i=new Int32Array(n),s=new Array(this.totalBitsInLayer(r,t));if(t)for(let a=0;a<i.length;a++)i[a]=a;else{let e=n+1+2*w.truncDivision(w.truncDivision(n,2)-1,15),t=n/2,r=w.truncDivision(e,2);for(let n=0;n<t;n++){let e=n+w.truncDivision(n,15);i[t-n-1]=r-e-1,i[t+n]=r+e+1}}for(let a=0,o=0;a<r;a++){let l=4*(r-a)+(t?9:12),c=2*a,d=n-1-c;for(let t=0;t<l;t++){let r=2*t;for(let n=0;n<2;n++)s[o+r+n]=e.get(i[c+n],i[c+t]),s[o+2*l+r+n]=e.get(i[c+t],i[d-n]),s[o+4*l+r+n]=e.get(i[d-n],i[d-t]),s[o+6*l+r+n]=e.get(i[d-t],i[c+n])}o+=8*l}return s}static readCode(e,t,r){let n=0;for(let i=t;i<t+r;i++)n<<=1,e[i]&&(n|=1);return n}static readByte(e,t){let r=e.length-t;return r>=8?he.readCode(e,t,8):he.readCode(e,t,r)<<8-r}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let r=0;r<t.length;r++)t[r]=he.readByte(e,8*r);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}he.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],he.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],he.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],he.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],he.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class pe{constructor(){}static round(e){return NaN===e?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,r,n){const i=e-r,s=t-n;return Math.sqrt(i*i+s*s)}static sum(e){let t=0;for(let r=0,n=e.length;r!==n;r++)t+=e[r];return t}}class me{static floatToIntBits(e){return e}}me.MAX_VALUE=Number.MAX_SAFE_INTEGER;class fe{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof fe){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*me.floatToIntBits(this.x)+me.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),r=this.distance(e[1],e[2]),n=this.distance(e[0],e[2]);let i,s,a;if(r>=t&&r>=n?(s=e[0],i=e[1],a=e[2]):n>=r&&n>=t?(s=e[1],i=e[0],a=e[2]):(s=e[2],i=e[0],a=e[1]),this.crossProductZ(i,s,a)<0){const e=i;i=a,a=e}e[0]=i,e[1]=s,e[2]=a}static distance(e,t){return pe.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,r){const n=t.x,i=t.y;return(r.x-n)*(e.y-i)-(r.y-i)*(e.x-n)}}class ge{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class xe extends ge{constructor(e,t,r,n,i){super(e,t),this.compact=r,this.nbDatablocks=n,this.nbLayers=i}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class ye{constructor(e,t,r,n){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==t&&(t=ye.INIT_SIZE),null==r&&(r=e.getWidth()/2|0),null==n&&(n=e.getHeight()/2|0);const i=t/2|0;if(this.leftInit=r-i,this.rightInit=r+i,this.upInit=n-i,this.downInit=n+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new R}detect(){let e=this.leftInit,t=this.rightInit,r=this.upInit,n=this.downInit,i=!1,s=!0,a=!1,o=!1,l=!1,c=!1,d=!1;const u=this.width,h=this.height;for(;s;){s=!1;let p=!0;for(;(p||!o)&&t<u;)p=this.containsBlackPoint(r,n,t,!1),p?(t++,s=!0,o=!0):o||t++;if(t>=u){i=!0;break}let m=!0;for(;(m||!l)&&n<h;)m=this.containsBlackPoint(e,t,n,!0),m?(n++,s=!0,l=!0):l||n++;if(n>=h){i=!0;break}let f=!0;for(;(f||!c)&&e>=0;)f=this.containsBlackPoint(r,n,e,!1),f?(e--,s=!0,c=!0):c||e--;if(e<0){i=!0;break}let g=!0;for(;(g||!d)&&r>=0;)g=this.containsBlackPoint(e,t,r,!0),g?(r--,s=!0,d=!0):d||r--;if(r<0){i=!0;break}s&&(a=!0)}if(!i&&a){const i=t-e;let s=null;for(let t=1;null===s&&t<i;t++)s=this.getBlackPointOnSegment(e,n-t,e+t,n);if(null==s)throw new R;let a=null;for(let t=1;null===a&&t<i;t++)a=this.getBlackPointOnSegment(e,r+t,e+t,r);if(null==a)throw new R;let o=null;for(let e=1;null===o&&e<i;e++)o=this.getBlackPointOnSegment(t,r+e,t-e,r);if(null==o)throw new R;let l=null;for(let e=1;null===l&&e<i;e++)l=this.getBlackPointOnSegment(t,n-e,t-e,n);if(null==l)throw new R;return this.centerEdges(l,s,o,a)}throw new R}getBlackPointOnSegment(e,t,r,n){const i=pe.round(pe.distance(e,t,r,n)),s=(r-e)/i,a=(n-t)/i,o=this.image;for(let l=0;l<i;l++){const r=pe.round(e+l*s),n=pe.round(t+l*a);if(o.get(r,n))return new fe(r,n)}return null}centerEdges(e,t,r,n){const i=e.getX(),s=e.getY(),a=t.getX(),o=t.getY(),l=r.getX(),c=r.getY(),d=n.getX(),u=n.getY(),h=ye.CORR;return i<this.width/2?[new fe(d-h,u+h),new fe(a+h,o+h),new fe(l-h,c-h),new fe(i+h,s-h)]:[new fe(d+h,u+h),new fe(a+h,o-h),new fe(l-h,c+h),new fe(i-h,s-h)]}containsBlackPoint(e,t,r,n){const i=this.image;if(n){for(let s=e;s<=t;s++)if(i.get(s,r))return!0}else for(let s=e;s<=t;s++)if(i.get(r,s))return!0;return!1}}ye.INIT_SIZE=10,ye.CORR=1;class we{static checkAndNudgePoints(e,t){const r=e.getWidth(),n=e.getHeight();let i=!0;for(let s=0;s<t.length&&i;s+=2){const e=Math.floor(t[s]),a=Math.floor(t[s+1]);if(e<-1||e>r||a<-1||a>n)throw new R;i=!1,-1===e?(t[s]=0,i=!0):e===r&&(t[s]=r-1,i=!0),-1===a?(t[s+1]=0,i=!0):a===n&&(t[s+1]=n-1,i=!0)}i=!0;for(let s=t.length-2;s>=0&&i;s-=2){const e=Math.floor(t[s]),a=Math.floor(t[s+1]);if(e<-1||e>r||a<-1||a>n)throw new R;i=!1,-1===e?(t[s]=0,i=!0):e===r&&(t[s]=r-1,i=!0),-1===a?(t[s+1]=0,i=!0):a===n&&(t[s+1]=n-1,i=!0)}}}class be{constructor(e,t,r,n,i,s,a,o,l){this.a11=e,this.a21=t,this.a31=r,this.a12=n,this.a22=i,this.a32=s,this.a13=a,this.a23=o,this.a33=l}static quadrilateralToQuadrilateral(e,t,r,n,i,s,a,o,l,c,d,u,h,p,m,f){const g=be.quadrilateralToSquare(e,t,r,n,i,s,a,o);return be.squareToQuadrilateral(l,c,d,u,h,p,m,f).times(g)}transformPoints(e){const t=e.length,r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33;for(let u=0;u<t;u+=2){const t=e[u],h=e[u+1],p=i*t+o*h+d;e[u]=(r*t+s*h+l)/p,e[u+1]=(n*t+a*h+c)/p}}transformPointsWithValues(e,t){const r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,c=this.a32,d=this.a33,u=e.length;for(let h=0;h<u;h++){const u=e[h],p=t[h],m=i*u+o*p+d;e[h]=(r*u+s*p+l)/m,t[h]=(n*u+a*p+c)/m}}static squareToQuadrilateral(e,t,r,n,i,s,a,o){const l=e-r+i-a,c=t-n+s-o;if(0===l&&0===c)return new be(r-e,i-r,e,n-t,s-n,t,0,0,1);{const d=r-i,u=a-i,h=n-s,p=o-s,m=d*p-u*h,f=(l*p-u*c)/m,g=(d*c-l*h)/m;return new be(r-e+f*r,a-e+g*a,e,n-t+f*n,o-t+g*o,t,f,g,1)}}static quadrilateralToSquare(e,t,r,n,i,s,a,o){return be.squareToQuadrilateral(e,t,r,n,i,s,a,o).buildAdjoint()}buildAdjoint(){return new be(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new be(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class ve extends we{sampleGrid(e,t,r,n,i,s,a,o,l,c,d,u,h,p,m,f,g,x,y){const w=be.quadrilateralToQuadrilateral(n,i,s,a,o,l,c,d,u,h,p,m,f,g,x,y);return this.sampleGridWithTransform(e,t,r,w)}sampleGridWithTransform(e,t,r,n){if(t<=0||r<=0)throw new R;const i=new D(t,r),s=new Float32Array(2*t);for(let o=0;o<r;o++){const t=s.length,r=o+.5;for(let e=0;e<t;e+=2)s[e]=e/2+.5,s[e+1]=r;n.transformPoints(s),we.checkAndNudgePoints(e,s);try{for(let r=0;r<t;r+=2)e.get(Math.floor(s[r]),Math.floor(s[r+1]))&&i.set(r/2,o)}catch(a){throw new R}}return i}}class Ce{static setGridSampler(e){Ce.gridSampler=e}static getInstance(){return Ce.gridSampler}}Ce.gridSampler=new ve;class _e{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new fe(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Se{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){let e=r[0];r[0]=r[2],r[2]=e}this.extractParameters(r);let n=this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),i=this.getMatrixCornerPoints(r);return new xe(n,i,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new R;let t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);let n=0;for(let s=0;s<4;s++){let e=r[(this.shift+s)%4];this.compact?(n<<=7,n+=e>>1&127):(n<<=10,n+=(e>>2&992)+(e>>1&31))}let i=this.getCorrectedParameterData(n,this.compact);this.compact?(this.nbLayers=1+(i>>6),this.nbDataBlocks=1+(63&i)):(this.nbLayers=1+(i>>11),this.nbDataBlocks=1+(2047&i))}getRotation(e,t){let r=0;e.forEach(((e,n,i)=>{r=(e>>t-2<<1)+(1&e)+(r<<3)})),r=((1&r)<<11)+(r>>1);for(let n=0;n<4;n++)if(w.bitCount(r^this.EXPECTED_CORNER_BITS[n])<=2)return n;throw new R}getCorrectedParameterData(e,t){let r,n;t?(r=7,n=2):(r=10,n=4);let i=r-n,s=new Int32Array(r);for(let l=r-1;l>=0;--l)s[l]=15&e,e>>=4;try{new ue(le.AZTEC_PARAM).decode(s,i)}catch(o){throw new R}let a=0;for(let l=0;l<n;l++)a=(a<<4)+s[l];return a}getBullsEyeCorners(e){let t=e,r=e,n=e,i=e,s=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let e=this.getFirstDifferent(t,s,1,-1),a=this.getFirstDifferent(r,s,1,1),o=this.getFirstDifferent(n,s,-1,1),l=this.getFirstDifferent(i,s,-1,-1);if(this.nbCenterLayers>2){let r=this.distancePoint(l,e)*this.nbCenterLayers/(this.distancePoint(i,t)*(this.nbCenterLayers+2));if(r<.75||r>1.25||!this.isWhiteOrBlackRectangle(e,a,o,l))break}t=e,r=a,n=o,i=l,s=!s}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new R;this.compact=5===this.nbCenterLayers;let a=new fe(t.getX()+.5,t.getY()-.5),o=new fe(r.getX()+.5,r.getY()+.5),l=new fe(n.getX()-.5,n.getY()+.5),c=new fe(i.getX()-.5,i.getY()-.5);return this.expandSquare([a,o,l,c],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,r,n;try{let i=new ye(this.image).detect();e=i[0],t=i[1],r=i[2],n=i[3]}catch(a){let i=this.image.getWidth()/2,s=this.image.getHeight()/2;e=this.getFirstDifferent(new _e(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new _e(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new _e(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new _e(i-7,s-7),!1,-1,-1).toResultPoint()}let i=pe.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=pe.round((e.getY()+n.getY()+t.getY()+r.getY())/4);try{let a=new ye(this.image,15,i,s).detect();e=a[0],t=a[1],r=a[2],n=a[3]}catch(a){e=this.getFirstDifferent(new _e(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new _e(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new _e(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new _e(i-7,s-7),!1,-1,-1).toResultPoint()}return i=pe.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=pe.round((e.getY()+n.getY()+t.getY()+r.getY())/4),new _e(i,s)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,r,n,i){let s=Ce.getInstance(),a=this.getDimension(),o=a/2-this.nbCenterLayers,l=a/2+this.nbCenterLayers;return s.sampleGrid(e,a,a,o,o,l,o,l,l,o,l,t.getX(),t.getY(),r.getX(),r.getY(),n.getX(),n.getY(),i.getX(),i.getY())}sampleLine(e,t,r){let n=0,i=this.distanceResultPoint(e,t),s=i/r,a=e.getX(),o=e.getY(),l=s*(t.getX()-e.getX())/i,c=s*(t.getY()-e.getY())/i;for(let d=0;d<r;d++)this.image.get(pe.round(a+d*l),pe.round(o+d*c))&&(n|=1<<r-d-1);return n}isWhiteOrBlackRectangle(e,t,r,n){let i=3;e=new _e(e.getX()-i,e.getY()+i),t=new _e(t.getX()-i,t.getY()-i),r=new _e(r.getX()+i,r.getY()-i),n=new _e(n.getX()+i,n.getY()+i);let s=this.getColor(n,e);if(0===s)return!1;let a=this.getColor(e,t);return a===s&&(a=this.getColor(t,r),a===s&&(a=this.getColor(r,n),a===s))}getColor(e,t){let r=this.distancePoint(e,t),n=(t.getX()-e.getX())/r,i=(t.getY()-e.getY())/r,s=0,a=e.getX(),o=e.getY(),l=this.image.get(e.getX(),e.getY()),c=Math.ceil(r);for(let u=0;u<c;u++)a+=n,o+=i,this.image.get(pe.round(a),pe.round(o))!==l&&s++;let d=s/r;return d>.1&&d<.9?0:d<=.1===l?1:-1}getFirstDifferent(e,t,r,n){let i=e.getX()+r,s=e.getY()+n;for(;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r,s+=n;for(i-=r,s-=n;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r;for(i-=r;this.isValid(i,s)&&this.image.get(i,s)===t;)s+=n;return s-=n,new _e(i,s)}expandSquare(e,t,r){let n=r/(2*t),i=e[0].getX()-e[2].getX(),s=e[0].getY()-e[2].getY(),a=(e[0].getX()+e[2].getX())/2,o=(e[0].getY()+e[2].getY())/2,l=new fe(a+n*i,o+n*s),c=new fe(a-n*i,o-n*s);return i=e[1].getX()-e[3].getX(),s=e[1].getY()-e[3].getY(),a=(e[1].getX()+e[3].getX())/2,o=(e[1].getY()+e[3].getY())/2,[l,new fe(a+n*i,o+n*s),c,new fe(a-n*i,o-n*s)]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=pe.round(e.getX()),r=pe.round(e.getY());return this.isValid(t,r)}distancePoint(e,t){return pe.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return pe.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(w.truncDivision(this.nbLayers-4,8)+1)+15}}class Ee{decode(e,t=null){let r=null,n=new Se(e.getBlackMatrix()),i=null,s=null;try{let e=n.detectMirror(!1);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=(new he).decode(e)}catch(c){r=c}if(null==s)try{let e=n.detectMirror(!0);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=(new he).decode(e)}catch(c){if(null!=r)throw r;throw c}let a=new W(s.getText(),s.getRawBytes(),s.getNumBits(),i,G.AZTEC,f.currentTimeMillis()),o=s.getByteSegments();null!=o&&a.putMetadata(ne.BYTE_SEGMENTS,o);let l=s.getECLevel();return null!=l&&a.putMetadata(ne.ERROR_CORRECTION_LEVEL,l),a}reportFoundResultPoints(e,t){if(null!=e){let r=e.get(_.NEED_RESULT_POINT_CALLBACK);null!=r&&t.forEach(((e,t,n)=>{r.foundPossibleResultPoint(e)}))}}reset(){}}class Ae extends U{constructor(e=500){super(new Ee,e)}}class Ie{decode(e,t){try{return this.doDecode(e,t)}catch(r){if(t&&!0===t.get(_.TRY_HARDER)&&e.isRotateSupported()){const r=e.rotateCounterClockwise(),n=this.doDecode(r,t),i=n.getResultMetadata();let s=270;null!==i&&!0===i.get(ne.ORIENTATION)&&(s+=i.get(ne.ORIENTATION)%360),n.putMetadata(ne.ORIENTATION,s);const a=n.getResultPoints();if(null!==a){const e=r.getHeight();for(let t=0;t<a.length;t++)a[t]=new fe(e-a[t].getY()-1,a[t].getX())}return n}throw new R}}reset(){}doDecode(e,t){const r=e.getWidth(),n=e.getHeight();let i=new b(r);const s=t&&!0===t.get(_.TRY_HARDER),a=Math.max(1,n>>(s?8:5));let o;o=s?n:15;const l=Math.trunc(n/2);for(let u=0;u<o;u++){const s=Math.trunc((u+1)/2),o=l+a*(1&u?-s:s);if(o<0||o>=n)break;try{i=e.getBlackRow(o,i)}catch(c){continue}for(let e=0;e<2;e++){if(1===e&&(i.reverse(),t&&!0===t.get(_.NEED_RESULT_POINT_CALLBACK))){const e=new Map;t.forEach(((t,r)=>e.set(r,t))),e.delete(_.NEED_RESULT_POINT_CALLBACK),t=e}try{const n=this.decodeRow(o,i,t);if(1===e){n.putMetadata(ne.ORIENTATION,180);const e=n.getResultPoints();null!==e&&(e[0]=new fe(r-e[0].getX()-1,e[0].getY()),e[1]=new fe(r-e[1].getX()-1,e[1].getY()))}return n}catch(d){}}}throw new R}static recordPattern(e,t,r){const n=r.length;for(let l=0;l<n;l++)r[l]=0;const i=e.getSize();if(t>=i)throw new R;let s=!e.get(t),a=0,o=t;for(;o<i;){if(e.get(o)!==s)r[a]++;else{if(++a===n)break;r[a]=1,s=!s}o++}if(a!==n&&(a!==n-1||o!==i))throw new R}static recordPatternInReverse(e,t,r){let n=r.length,i=e.get(t);for(;t>0&&n>=0;)e.get(--t)!==i&&(n--,i=!i);if(n>=0)throw new R;Ie.recordPattern(e,t+1,r)}static patternMatchVariance(e,t,r){const n=e.length;let i=0,s=0;for(let l=0;l<n;l++)i+=e[l],s+=t[l];if(i<s)return Number.POSITIVE_INFINITY;const a=i/s;r*=a;let o=0;for(let l=0;l<n;l++){const n=e[l],i=t[l]*a,s=n>i?n-i:i-n;if(s>r)return Number.POSITIVE_INFINITY;o+=s}return o/i}}class je extends Ie{static findStartPattern(e){const t=e.getSize(),r=e.getNextSet(0);let n=0,i=Int32Array.from([0,0,0,0,0,0]),s=r,a=!1;const o=6;for(let l=r;l<t;l++)if(e.get(l)!==a)i[n]++;else{if(n===o-1){let t=je.MAX_AVG_VARIANCE,r=-1;for(let e=je.CODE_START_A;e<=je.CODE_START_C;e++){const n=Ie.patternMatchVariance(i,je.CODE_PATTERNS[e],je.MAX_INDIVIDUAL_VARIANCE);n<t&&(t=n,r=e)}if(r>=0&&e.isRange(Math.max(0,s-(l-s)/2),s,!1))return Int32Array.from([s,l,r]);s+=i[0]+i[1],i=i.slice(2,i.length-1),i[n-1]=0,i[n]=0,n--}else n++;i[n]=1,a=!a}throw new R}static decodeCode(e,t,r){Ie.recordPattern(e,r,t);let n=je.MAX_AVG_VARIANCE,i=-1;for(let s=0;s<je.CODE_PATTERNS.length;s++){const e=je.CODE_PATTERNS[s],r=this.patternMatchVariance(t,e,je.MAX_INDIVIDUAL_VARIANCE);r<n&&(n=r,i=s)}if(i>=0)return i;throw new R}decodeRow(e,t,r){const n=r&&!0===r.get(_.ASSUME_GS1),i=je.findStartPattern(t),s=i[2];let a=0;const o=new Uint8Array(20);let l;switch(o[a++]=s,s){case je.CODE_START_A:l=je.CODE_CODE_A;break;case je.CODE_START_B:l=je.CODE_CODE_B;break;case je.CODE_START_C:l=je.CODE_CODE_C;break;default:throw new S}let c=!1,d=!1,u="",h=i[0],m=i[1];const f=Int32Array.from([0,0,0,0,0,0]);let g=0,x=0,y=s,w=0,b=!0,v=!1,C=!1;for(;!c;){const e=d;switch(d=!1,g=x,x=je.decodeCode(t,f,m),o[a++]=x,x!==je.CODE_STOP&&(b=!0),x!==je.CODE_STOP&&(w++,y+=w*x),h=m,m+=f.reduce(((e,t)=>e+t),0),x){case je.CODE_START_A:case je.CODE_START_B:case je.CODE_START_C:throw new S}switch(l){case je.CODE_CODE_A:if(x<64)u+=C===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),C=!1;else if(x<96)u+=C===v?String.fromCharCode(x-64):String.fromCharCode(x+64),C=!1;else switch(x!==je.CODE_STOP&&(b=!1),x){case je.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case je.CODE_FNC_2:case je.CODE_FNC_3:break;case je.CODE_FNC_4_A:!v&&C?(v=!0,C=!1):v&&C?(v=!1,C=!1):C=!0;break;case je.CODE_SHIFT:d=!0,l=je.CODE_CODE_B;break;case je.CODE_CODE_B:l=je.CODE_CODE_B;break;case je.CODE_CODE_C:l=je.CODE_CODE_C;break;case je.CODE_STOP:c=!0}break;case je.CODE_CODE_B:if(x<96)u+=C===v?String.fromCharCode(" ".charCodeAt(0)+x):String.fromCharCode(" ".charCodeAt(0)+x+128),C=!1;else switch(x!==je.CODE_STOP&&(b=!1),x){case je.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case je.CODE_FNC_2:case je.CODE_FNC_3:break;case je.CODE_FNC_4_B:!v&&C?(v=!0,C=!1):v&&C?(v=!1,C=!1):C=!0;break;case je.CODE_SHIFT:d=!0,l=je.CODE_CODE_A;break;case je.CODE_CODE_A:l=je.CODE_CODE_A;break;case je.CODE_CODE_C:l=je.CODE_CODE_C;break;case je.CODE_STOP:c=!0}break;case je.CODE_CODE_C:if(x<100)x<10&&(u+="0"),u+=x;else switch(x!==je.CODE_STOP&&(b=!1),x){case je.CODE_FNC_1:n&&(0===u.length?u+="]C1":u+=String.fromCharCode(29));break;case je.CODE_CODE_A:l=je.CODE_CODE_A;break;case je.CODE_CODE_B:l=je.CODE_CODE_B;break;case je.CODE_STOP:c=!0}}e&&(l=l===je.CODE_CODE_A?je.CODE_CODE_B:je.CODE_CODE_A)}const E=m-h;if(m=t.getNextUnset(m),!t.isRange(m,Math.min(t.getSize(),m+(m-h)/2),!1))throw new R;if(y-=w*g,y%103!==g)throw new p;const A=u.length;if(0===A)throw new R;A>0&&b&&(u=l===je.CODE_CODE_C?u.substring(0,A-2):u.substring(0,A-1));const I=(i[1]+i[0])/2,j=h+E/2,T=o.length,D=new Uint8Array(T);for(let p=0;p<T;p++)D[p]=o[p];const N=[new fe(I,e),new fe(j,e)];return new W(u,D,0,N,G.CODE_128,(new Date).getTime())}}je.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],je.MAX_AVG_VARIANCE=.25,je.MAX_INDIVIDUAL_VARIANCE=.7,je.CODE_SHIFT=98,je.CODE_CODE_C=99,je.CODE_CODE_B=100,je.CODE_CODE_A=101,je.CODE_FNC_1=102,je.CODE_FNC_2=97,je.CODE_FNC_3=96,je.CODE_FNC_4_A=101,je.CODE_FNC_4_B=100,je.CODE_START_A=103,je.CODE_START_B=104,je.CODE_START_C=105,je.CODE_STOP=106;class Te extends Ie{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,r){let n=this.counters;n.fill(0),this.decodeRowResult="";let i,s,a=Te.findAsteriskPattern(t,n),o=t.getNextSet(a[1]),l=t.getSize();do{Te.recordPattern(t,o,n);let e=Te.toNarrowWidePattern(n);if(e<0)throw new R;i=Te.patternToChar(e),this.decodeRowResult+=i,s=o;for(let t of n)o+=t;o=t.getNextSet(o)}while("*"!==i);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let c,d=0;for(let p of n)d+=p;if(o!==l&&2*(o-s-d)<d)throw new R;if(this.usingCheckDigit){let e=this.decodeRowResult.length-1,t=0;for(let r=0;r<e;r++)t+=Te.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(r));if(this.decodeRowResult.charAt(e)!==Te.ALPHABET_STRING.charAt(t%43))throw new p;this.decodeRowResult=this.decodeRowResult.substring(0,e)}if(0===this.decodeRowResult.length)throw new R;c=this.extendedMode?Te.decodeExtended(this.decodeRowResult):this.decodeRowResult;let u=(a[1]+a[0])/2,h=s+d/2;return new W(c,null,0,[new fe(u,e),new fe(h,e)],G.CODE_39,(new Date).getTime())}static findAsteriskPattern(e,t){let r=e.getSize(),n=e.getNextSet(0),i=0,s=n,a=!1,o=t.length;for(let l=n;l<r;l++)if(e.get(l)!==a)t[i]++;else{if(i===o-1){if(this.toNarrowWidePattern(t)===Te.ASTERISK_ENCODING&&e.isRange(Math.max(0,s-Math.floor((l-s)/2)),s,!1))return[s,l];s+=t[0]+t[1],t.copyWithin(0,2,2+i-1),t[i-1]=0,t[i]=0,i--}else i++;t[i]=1,a=!a}throw new R}static toNarrowWidePattern(e){let t,r=e.length,n=0;do{let i=2147483647;for(let t of e)t<i&&t>n&&(i=t);n=i,t=0;let s=0,a=0;for(let o=0;o<r;o++){let i=e[o];i>n&&(a|=1<<r-1-o,t++,s+=i)}if(3===t){for(let i=0;i<r&&t>0;i++){let r=e[i];if(r>n&&(t--,2*r>=s))return-1}return a}}while(t>3);return-1}static patternToChar(e){for(let t=0;t<Te.CHARACTER_ENCODINGS.length;t++)if(Te.CHARACTER_ENCODINGS[t]===e)return Te.ALPHABET_STRING.charAt(t);if(e===Te.ASTERISK_ENCODING)return"*";throw new R}static decodeExtended(e){let t=e.length,r="";for(let n=0;n<t;n++){let t=e.charAt(n);if("+"===t||"$"===t||"%"===t||"/"===t){let i=e.charAt(n+1),s="\0";switch(t){case"+":if(!(i>="A"&&i<="Z"))throw new S;s=String.fromCharCode(i.charCodeAt(0)+32);break;case"$":if(!(i>="A"&&i<="Z"))throw new S;s=String.fromCharCode(i.charCodeAt(0)-64);break;case"%":if(i>="A"&&i<="E")s=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")s=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")s=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)s="\0";else if("V"===i)s="@";else if("W"===i)s="`";else{if("X"!==i&&"Y"!==i&&"Z"!==i)throw new S;s=""}break;case"/":if(i>="A"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)-32);else{if("Z"!==i)throw new S;s=":"}}r+=s,n++}else r+=t}return r}}Te.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Te.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Te.ASTERISK_ENCODING=148;class De extends Ie{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,r){let n=this.decodeStart(t),i=this.decodeEnd(t),s=new T;De.decodeMiddle(t,n[1],i[0],s);let a=s.toString(),o=null;null!=r&&(o=r.get(_.ALLOWED_LENGTHS)),null==o&&(o=De.DEFAULT_ALLOWED_LENGTHS);let l=a.length,c=!1,d=0;for(let h of o){if(l===h){c=!0;break}h>d&&(d=h)}if(!c&&l>d&&(c=!0),!c)throw new S;const u=[new fe(n[1],e),new fe(i[0],e)];return new W(a,null,0,u,G.ITF,(new Date).getTime())}static decodeMiddle(e,t,r,n){let i=new Int32Array(10),s=new Int32Array(5),a=new Int32Array(5);for(i.fill(0),s.fill(0),a.fill(0);t<r;){Ie.recordPattern(e,t,i);for(let e=0;e<5;e++){let t=2*e;s[e]=i[t],a[e]=i[t+1]}let r=De.decodeDigit(s);n.append(r.toString()),r=this.decodeDigit(a),n.append(r.toString()),i.forEach((function(e){t+=e}))}}decodeStart(e){let t=De.skipWhiteSpace(e),r=De.findGuardPattern(e,t,De.START_PATTERN);return this.narrowLineWidth=(r[1]-r[0])/4,this.validateQuietZone(e,r[0]),r}validateQuietZone(e,t){let r=10*this.narrowLineWidth;r=r<t?r:t;for(let n=t-1;r>0&&n>=0&&!e.get(n);n--)r--;if(0!==r)throw new R}static skipWhiteSpace(e){const t=e.getSize(),r=e.getNextSet(0);if(r===t)throw new R;return r}decodeEnd(e){e.reverse();try{let r,n=De.skipWhiteSpace(e);try{r=De.findGuardPattern(e,n,De.END_PATTERN_REVERSED[0])}catch(t){t instanceof R&&(r=De.findGuardPattern(e,n,De.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,r[0]);let i=r[0];return r[0]=e.getSize()-r[1],r[1]=e.getSize()-i,r}finally{e.reverse()}}static findGuardPattern(e,t,r){let n=r.length,i=new Int32Array(n),s=e.getSize(),a=!1,o=0,l=t;i.fill(0);for(let c=t;c<s;c++)if(e.get(c)!==a)i[o]++;else{if(o===n-1){if(Ie.patternMatchVariance(i,r,De.MAX_INDIVIDUAL_VARIANCE)<De.MAX_AVG_VARIANCE)return[l,c];l+=i[0]+i[1],f.arraycopy(i,2,i,0,o-1),i[o-1]=0,i[o]=0,o--}else o++;i[o]=1,a=!a}throw new R}static decodeDigit(e){let t=De.MAX_AVG_VARIANCE,r=-1,n=De.PATTERNS.length;for(let i=0;i<n;i++){let n=De.PATTERNS[i],s=Ie.patternMatchVariance(e,n,De.MAX_INDIVIDUAL_VARIANCE);s<t?(t=s,r=i):s===t&&(r=-1)}if(r>=0)return r%10;throw new R}}De.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],De.MAX_AVG_VARIANCE=.38,De.MAX_INDIVIDUAL_VARIANCE=.5,De.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],De.START_PATTERN=Int32Array.from([1,1,1,1]),De.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Re extends Ie{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t,r=!1,n=0,i=Int32Array.from([0,0,0]);for(;!r;){i=Int32Array.from([0,0,0]),t=Re.findGuardPattern(e,n,!1,this.START_END_PATTERN,i);let s=t[0];n=t[1];let a=s-(n-s);a>=0&&(r=e.isRange(a,s,!1))}return t}static checkChecksum(e){return Re.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return Re.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;r+=t}return(1e3-r)%10}static decodeEnd(e,t){return Re.findGuardPattern(e,t,!1,Re.START_END_PATTERN,new Int32Array(Re.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,r,n){return this.findGuardPattern(e,t,r,n,new Int32Array(n.length))}static findGuardPattern(e,t,r,n,i){let s=e.getSize(),a=0,o=t=r?e.getNextUnset(t):e.getNextSet(t),l=n.length,c=r;for(let d=t;d<s;d++)if(e.get(d)!==c)i[a]++;else{if(a===l-1){if(Ie.patternMatchVariance(i,n,Re.MAX_INDIVIDUAL_VARIANCE)<Re.MAX_AVG_VARIANCE)return Int32Array.from([o,d]);o+=i[0]+i[1];let e=i.slice(2,i.length-1);for(let t=0;t<a-1;t++)i[t]=e[t];i[a-1]=0,i[a]=0,a--}else a++;i[a]=1,c=!c}throw new R}static decodeDigit(e,t,r,n){this.recordPattern(e,r,t);let i=this.MAX_AVG_VARIANCE,s=-1,a=n.length;for(let o=0;o<a;o++){let e=n[o],r=Ie.patternMatchVariance(t,e,Re.MAX_INDIVIDUAL_VARIANCE);r<i&&(i=r,s=o)}if(s>=0)return s;throw new R}}Re.MAX_AVG_VARIANCE=.48,Re.MAX_INDIVIDUAL_VARIANCE=.7,Re.START_END_PATTERN=Int32Array.from([1,1,1]),Re.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Re.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Re.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Ne{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=Ne.parseExtensionString(s),o=[new fe((r[0]+r[1])/2,e),new fe(i,e)],l=new W(s,null,0,o,G.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let l=0;l<5&&s<i;l++){let t=Re.decodeDigit(e,n,s,Re.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<4-l),4!==l&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(5!==r.length)throw new R;let o=this.determineCheckDigit(a);if(Ne.extensionChecksum(r.toString())!==o)throw new R;return s}static extensionChecksum(e){let t=e.length,r=0;for(let n=t-2;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);r*=3;for(let n=t-1;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);return r*=3,r%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new R}static parseExtensionString(e){if(5!==e.length)return null;let t=Ne.parseExtension5String(e);return null==t?null:new Map([[ne.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="Â£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}let r=parseInt(e.substring(1)),n=r%100;return t+(r/100).toString()+"."+(n<10?"0"+n:n.toString())}}class Pe{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=Pe.parseExtensionString(s),o=[new fe((r[0]+r[1])/2,e),new fe(i,e)],l=new W(s,null,0,o,G.UPC_EAN_EXTENSION,(new Date).getTime());return null!=a&&l.putAllMetadata(a),l}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let o=0;o<2&&s<i;o++){let t=Re.decodeDigit(e,n,s,Re.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<1-o),1!==o&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(2!==r.length)throw new R;if(parseInt(r.toString())%4!==a)throw new R;return s}static parseExtensionString(e){return 2!==e.length?null:new Map([[ne.ISSUE_NUMBER,parseInt(e)]])}}class Oe{static decodeRow(e,t,r){let n=Re.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new Ne).decodeRow(e,t,n)}catch(i){return(new Pe).decodeRow(e,t,n)}}}Oe.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class ke extends Re{constructor(){super(),this.decodeRowStringBuffer="",ke.L_AND_G_PATTERNS=ke.L_PATTERNS.map((e=>Int32Array.from(e)));for(let e=10;e<20;e++){let t=ke.L_PATTERNS[e-10],r=new Int32Array(t.length);for(let e=0;e<t.length;e++)r[e]=t[t.length-e-1];ke.L_AND_G_PATTERNS[e]=r}}decodeRow(e,t,r){let n=ke.findStartGuardPattern(t),i=null==r?null:r.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=i){const t=new fe((n[0]+n[1])/2,e);i.foundPossibleResultPoint(t)}let s=this.decodeMiddle(t,n,this.decodeRowStringBuffer),a=s.rowOffset,o=s.resultString;if(null!=i){const t=new fe(a,e);i.foundPossibleResultPoint(t)}let l=this.decodeEnd(t,a);if(null!=i){const t=new fe((l[0]+l[1])/2,e);i.foundPossibleResultPoint(t)}let c=l[1],d=c+(c-l[0]);if(d>=t.getSize()||!t.isRange(c,d,!1))throw new R;let u=o.toString();if(u.length<8)throw new S;if(!ke.checkChecksum(u))throw new p;let h=(n[1]+n[0])/2,m=(l[1]+l[0])/2,f=this.getBarcodeFormat(),g=[new fe(h,e),new fe(m,e)],x=new W(u,null,0,g,f,(new Date).getTime()),y=0;try{let r=Oe.decodeRow(e,t,l[1]);x.putMetadata(ne.UPC_EAN_EXTENSION,r.getText()),x.putAllMetadata(r.getResultMetadata()),x.addResultPoints(r.getResultPoints()),y=r.getText().length}catch(b){}let w=null==r?null:r.get(_.ALLOWED_EAN_EXTENSIONS);if(null!=w){let e=!1;for(let t in w)if(y.toString()===t){e=!0;break}if(!e)throw new R}return x}decodeEnd(e,t){return ke.findGuardPattern(e,t,!1,ke.START_END_PATTERN,new Int32Array(ke.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return ke.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return ke.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;r+=t}return(1e3-r)%10}}class Me extends ke{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let o=0;o<6&&s<i;o++){let t=ke.decodeDigit(e,n,s,ke.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<5-o)}r=Me.determineFirstDigit(r,a),s=ke.findGuardPattern(e,s,!0,ke.MIDDLE_PATTERN,new Int32Array(ke.MIDDLE_PATTERN.length).fill(0))[1];for(let o=0;o<6&&s<i;o++){let t=ke.decodeDigit(e,n,s,ke.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return G.EAN_13}static determineFirstDigit(e,t){for(let r=0;r<10;r++)if(t===this.FIRST_DIGIT_ENCODINGS[r])return e=String.fromCharCode("0".charCodeAt(0)+r)+e;throw new R}}Me.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Fe extends ke{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){const n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1];for(let a=0;a<4&&s<i;a++){let t=ke.decodeDigit(e,n,s,ke.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}s=ke.findGuardPattern(e,s,!0,ke.MIDDLE_PATTERN,new Int32Array(ke.MIDDLE_PATTERN.length).fill(0))[1];for(let a=0;a<4&&s<i;a++){let t=ke.decodeDigit(e,n,s,ke.L_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of n)s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return G.EAN_8}}class Be extends ke{constructor(){super(...arguments),this.ean13Reader=new Me}getBarcodeFormat(){return G.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,r){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,r))}decodeMiddle(e,t,r){return this.ean13Reader.decodeMiddle(e,t,r)}maybeReturnResult(e){let t=e.getText();if("0"===t.charAt(0)){let r=new W(t.substring(1),null,null,e.getResultPoints(),G.UPC_A);return null!=e.getResultMetadata()&&r.putAllMetadata(e.getResultMetadata()),r}throw new R}reset(){this.ean13Reader.reset()}}class Le extends ke{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,r){const n=this.decodeMiddleCounters.map((e=>e));n[0]=0,n[1]=0,n[2]=0,n[3]=0;const i=e.getSize();let s=t[1],a=0;for(let o=0;o<6&&s<i;o++){const t=Le.decodeDigit(e,n,s,Le.L_AND_G_PATTERNS);r+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of n)s+=e;t>=10&&(a|=1<<5-o)}return{rowOffset:s,resultString:Le.determineNumSysAndCheckDigit(r,a)}}decodeEnd(e,t){return Le.findGuardPatternWithoutCounters(e,t,!0,Le.MIDDLE_END_PATTERN)}checkChecksum(e){return ke.checkChecksum(Le.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let r=0;r<=1;r++)for(let n=0;n<10;n++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[r][n])return String.fromCharCode("0".charCodeAt(0)+r)+e+String.fromCharCode("0".charCodeAt(0)+n);throw R.getNotFoundInstance()}getBarcodeFormat(){return G.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map((e=>e.charCodeAt(0))),r=new T;r.append(e.charAt(0));let n=t[5];switch(n){case 0:case 1:case 2:r.appendChars(t,0,2),r.append(n),r.append("0000"),r.appendChars(t,2,3);break;case 3:r.appendChars(t,0,3),r.append("00000"),r.appendChars(t,3,2);break;case 4:r.appendChars(t,0,4),r.append("00000"),r.append(t[4]);break;default:r.appendChars(t,0,5),r.append("0000"),r.append(n)}return e.length>=8&&r.append(e.charAt(7)),r.toString()}}Le.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Le.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ze extends Ie{constructor(e){super();let r=null==e?null:e.get(_.POSSIBLE_FORMATS),n=[];t(r)?(n.push(new Me),n.push(new Be),n.push(new Fe),n.push(new Le)):(r.indexOf(G.EAN_13)>-1&&n.push(new Me),r.indexOf(G.UPC_A)>-1&&n.push(new Be),r.indexOf(G.EAN_8)>-1&&n.push(new Fe),r.indexOf(G.UPC_E)>-1&&n.push(new Le)),this.readers=n}decodeRow(e,t,r){for(let i of this.readers)try{const n=i.decodeRow(e,t,r),s=n.getBarcodeFormat()===G.EAN_13&&"0"===n.getText().charAt(0),a=null==r?null:r.get(_.POSSIBLE_FORMATS),o=null==a||a.includes(G.UPC_A);if(s&&o){const e=n.getRawBytes(),t=new W(n.getText().substring(1),e,e?e.length:null,n.getResultPoints(),G.UPC_A);return t.putAllMetadata(n.getResultMetadata()),t}return n}catch(n){}throw new R}reset(){for(let e of this.readers)e.reset()}}class Ue extends Ie{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let r=0;r<t.length;r++)if(Ie.patternMatchVariance(e,t[r],Ue.MAX_INDIVIDUAL_VARIANCE)<Ue.MAX_AVG_VARIANCE)return r;throw new R}static count(e){return pe.sum(new Int32Array(e))}static increment(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]>n&&(n=t[i],r=i);e[r]++}static decrement(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]<n&&(n=t[i],r=i);e[r]--}static isFinderPattern(e){let t=e[0]+e[1],r=t/(t+e[2]+e[3]);if(r>=Ue.MIN_FINDER_PATTERN_RATIO&&r<=Ue.MAX_FINDER_PATTERN_RATIO){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n of e)n>r&&(r=n),n<t&&(t=n);return r<10*t}return!1}}Ue.MAX_AVG_VARIANCE=.2,Ue.MAX_INDIVIDUAL_VARIANCE=.45,Ue.MIN_FINDER_PATTERN_RATIO=9.5/12,Ue.MAX_FINDER_PATTERN_RATIO=12.5/14;class We{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof We))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Ve{constructor(e,t,r,n,i){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new fe(r,i)),this.resultPoints.push(new fe(n,i))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Ve))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class He{constructor(){}static getRSSvalue(e,t,r){let n=0;for(let o of e)n+=o;let i=0,s=0,a=e.length;for(let o=0;o<a-1;o++){let l;for(l=1,s|=1<<o;l<e[o];l++,s&=~(1<<o)){let e=He.combins(n-l-1,a-o-2);if(r&&0===s&&n-l-(a-o-1)>=a-o-1&&(e-=He.combins(n-l-(a-o),a-o-2)),a-o-1>1){let r=0;for(let e=n-l-(a-o-2);e>t;e--)r+=He.combins(n-l-e-1,a-o-3);e-=r*(a-1-o)}else n-l>t&&e--;i+=e}n-=l}return i}static combins(e,t){let r,n;e-t>t?(n=t,r=e-t):(n=e-t,r=t);let i=1,s=1;for(let a=e;a>r;a--)i*=a,s<=n&&(i/=s,s++);for(;s<=n;)i/=s,s++;return i}}class Ge{static buildBitArray(e){let t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);let r=new b(12*t),n=0,i=e[0].getRightChar().getValue();for(let s=11;s>=0;--s)i&1<<s&&r.set(n),n++;for(let s=1;s<e.length;++s){let t=e[s],i=t.getLeftChar().getValue();for(let e=11;e>=0;--e)i&1<<e&&r.set(n),n++;if(null!=t.getRightChar()){let e=t.getRightChar().getValue();for(let t=11;t>=0;--t)e&1<<t&&r.set(n),n++}}return r}}class qe{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Xe{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class $e extends Xe{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===$e.FNC1}}$e.FNC1="$";class Ze extends Xe{constructor(e,t,r){super(e),r?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Ye extends Xe{constructor(e,t,r){if(super(e),t<0||t>10||r<0||r>10)throw new S;this.firstDigit=t,this.secondDigit=r}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Ye.FNC1}isSecondDigitFNC1(){return this.secondDigit===Ye.FNC1}isAnyFNC1(){return this.firstDigit===Ye.FNC1||this.secondDigit===Ye.FNC1}}Ye.FNC1=10;class Qe{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new R;let t=e.substring(0,2);for(let i of Qe.TWO_DIGIT_DATA_LENGTH)if(i[0]===t)return i[1]===Qe.VARIABLE_LENGTH?Qe.processVariableAI(2,i[2],e):Qe.processFixedAI(2,i[1],e);if(e.length<3)throw new R;let r=e.substring(0,3);for(let i of Qe.THREE_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Qe.VARIABLE_LENGTH?Qe.processVariableAI(3,i[2],e):Qe.processFixedAI(3,i[1],e);for(let i of Qe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Qe.VARIABLE_LENGTH?Qe.processVariableAI(4,i[2],e):Qe.processFixedAI(4,i[1],e);if(e.length<4)throw new R;let n=e.substring(0,4);for(let i of Qe.FOUR_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Qe.VARIABLE_LENGTH?Qe.processVariableAI(4,i[2],e):Qe.processFixedAI(4,i[1],e);throw new R}static processFixedAI(e,t,r){if(r.length<e)throw new R;let n=r.substring(0,e);if(r.length<e+t)throw new R;let i=r.substring(e,e+t),s=r.substring(e+t),a="("+n+")"+i,o=Qe.parseFieldsInGeneralPurpose(s);return null==o?a:a+o}static processVariableAI(e,t,r){let n,i=r.substring(0,e);n=r.length<e+t?r.length:e+t;let s=r.substring(e,n),a=r.substring(n),o="("+i+")"+s,l=Qe.parseFieldsInGeneralPurpose(a);return null==l?o:o+l}}Qe.VARIABLE_LENGTH=[],Qe.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Qe.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Qe.VARIABLE_LENGTH,20],["22",Qe.VARIABLE_LENGTH,29],["30",Qe.VARIABLE_LENGTH,8],["37",Qe.VARIABLE_LENGTH,8],["90",Qe.VARIABLE_LENGTH,30],["91",Qe.VARIABLE_LENGTH,30],["92",Qe.VARIABLE_LENGTH,30],["93",Qe.VARIABLE_LENGTH,30],["94",Qe.VARIABLE_LENGTH,30],["95",Qe.VARIABLE_LENGTH,30],["96",Qe.VARIABLE_LENGTH,30],["97",Qe.VARIABLE_LENGTH,3],["98",Qe.VARIABLE_LENGTH,30],["99",Qe.VARIABLE_LENGTH,30]],Qe.THREE_DIGIT_DATA_LENGTH=[["240",Qe.VARIABLE_LENGTH,30],["241",Qe.VARIABLE_LENGTH,30],["242",Qe.VARIABLE_LENGTH,6],["250",Qe.VARIABLE_LENGTH,30],["251",Qe.VARIABLE_LENGTH,30],["253",Qe.VARIABLE_LENGTH,17],["254",Qe.VARIABLE_LENGTH,20],["400",Qe.VARIABLE_LENGTH,30],["401",Qe.VARIABLE_LENGTH,30],["402",17],["403",Qe.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Qe.VARIABLE_LENGTH,20],["421",Qe.VARIABLE_LENGTH,15],["422",3],["423",Qe.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Qe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Qe.VARIABLE_LENGTH,15],["391",Qe.VARIABLE_LENGTH,18],["392",Qe.VARIABLE_LENGTH,15],["393",Qe.VARIABLE_LENGTH,18],["703",Qe.VARIABLE_LENGTH,30]],Qe.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Qe.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Qe.VARIABLE_LENGTH,20],["8003",Qe.VARIABLE_LENGTH,30],["8004",Qe.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Qe.VARIABLE_LENGTH,30],["8008",Qe.VARIABLE_LENGTH,12],["8018",18],["8020",Qe.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Qe.VARIABLE_LENGTH,70],["8200",Qe.VARIABLE_LENGTH,70]];class Ke{constructor(e){this.buffer=new T,this.information=e}decodeAllCodes(e,t){let r=t,n=null;for(;;){let t=this.decodeGeneralPurposeField(r,n),i=Qe.parseFieldsInGeneralPurpose(t.getNewString());if(null!=i&&e.append(i),n=t.isRemaining()?""+t.getRemainingValue():null,r===t.getNewPosition())break;r=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return new Ye(this.information.getSize(),0===t?Ye.FNC1:t-1,Ye.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new Ye(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return Ke.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,r){let n=0;for(let i=0;i<r;++i)e.get(t+i)&&(n|=1<<r-i-1);return n}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let r=this.parseBlocks();return null!=r&&r.isRemaining()?new Ze(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new Ze(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let r=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),r===this.current.getPosition()&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return t=e.isSecondDigitFNC1()?new Ze(this.current.getPosition(),this.buffer.toString()):new Ze(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new qe(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let e=new Ze(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new qe(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Ze(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new qe(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Ze(this.current.getPosition(),this.buffer.toString());return new qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new qe(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,8);return n>=232&&n<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new $e(e+5,$e.FNC1);if(t>=5&&t<15)return new $e(e+5,"0"+(t-5));let r,n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<90)return new $e(e+7,""+(n+1));if(n>=90&&n<116)return new $e(e+7,""+(n+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:r="!";break;case 233:r='"';break;case 234:r="%";break;case 235:r="&";break;case 236:r="'";break;case 237:r="(";break;case 238:r=")";break;case 239:r="*";break;case 240:r="+";break;case 241:r=",";break;case 242:r="-";break;case 243:r=".";break;case 244:r="/";break;case 245:r=":";break;case 246:r=";";break;case 247:r="<";break;case 248:r="=";break;case 249:r=">";break;case 250:r="?";break;case 251:r="_";break;case 252:r=" ";break;default:throw new S}return new $e(e+8,r)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new $e(e+5,$e.FNC1);if(t>=5&&t<15)return new $e(e+5,"0"+(t-5));let r,n=this.extractNumericValueFromBitArray(e,6);if(n>=32&&n<58)return new $e(e+6,""+(n+33));switch(n){case 58:r="*";break;case 59:r=",";break;case 60:r="-";break;case 61:r=".";break;case 62:r="/";break;default:throw new de("Decoding invalid alphanumeric value: "+n)}return new $e(e+6,r)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class Je{constructor(e){this.information=e,this.generalDecoder=new Ke(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class et extends Je{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let r=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,r)}encodeCompressedGtinWithoutAI(e,t,r){for(let n=0;n<4;++n){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*n,10);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r)}et.appendCheckDigit(e,r)}static appendCheckDigit(e,t){let r=0;for(let n=0;n<13;n++){let i=e.charAt(n+t).charCodeAt(0)-"0".charCodeAt(0);r+=1&n?i:3*i}r=10-r%10,10===r&&(r=0),e.append(r)}}et.GTIN_SIZE=40;class tt extends et{constructor(e){super(e)}parseInformation(){let e=new T;e.append("(01)");let t=e.length(),r=this.getGeneralDecoder().extractNumericValueFromBitArray(tt.HEADER_SIZE,4);return e.append(r),this.encodeCompressedGtinWithoutAI(e,tt.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,tt.HEADER_SIZE+44)}}tt.HEADER_SIZE=4;class rt extends Je{constructor(e){super(e)}parseInformation(){let e=new T;return this.getGeneralDecoder().decodeAllCodes(e,rt.HEADER_SIZE)}}rt.HEADER_SIZE=5;class nt extends et{constructor(e){super(e)}encodeCompressedWeight(e,t,r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,r);this.addWeightCode(e,n);let i=this.checkWeight(n),s=1e5;for(let a=0;a<5;++a)i/s===0&&e.append("0"),s/=10;e.append(i)}}class it extends nt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=it.HEADER_SIZE+nt.GTIN_SIZE+it.WEIGHT_SIZE)throw new R;let e=new T;return this.encodeCompressedGtin(e,it.HEADER_SIZE),this.encodeCompressedWeight(e,it.HEADER_SIZE+nt.GTIN_SIZE,it.WEIGHT_SIZE),e.toString()}}it.HEADER_SIZE=5,it.WEIGHT_SIZE=15;class st extends it{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class at extends it{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class ot extends et{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<ot.HEADER_SIZE+et.GTIN_SIZE)throw new R;let e=new T;this.encodeCompressedGtin(e,ot.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(ot.HEADER_SIZE+et.GTIN_SIZE,ot.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let r=this.getGeneralDecoder().decodeGeneralPurposeField(ot.HEADER_SIZE+et.GTIN_SIZE+ot.LAST_DIGIT_SIZE,null);return e.append(r.getNewString()),e.toString()}}ot.HEADER_SIZE=8,ot.LAST_DIGIT_SIZE=2;class lt extends et{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<lt.HEADER_SIZE+et.GTIN_SIZE)throw new R;let e=new T;this.encodeCompressedGtin(e,lt.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(lt.HEADER_SIZE+et.GTIN_SIZE,lt.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let r=this.getGeneralDecoder().extractNumericValueFromBitArray(lt.HEADER_SIZE+et.GTIN_SIZE+lt.LAST_DIGIT_SIZE,lt.FIRST_THREE_DIGITS_SIZE);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r);let n=this.getGeneralDecoder().decodeGeneralPurposeField(lt.HEADER_SIZE+et.GTIN_SIZE+lt.LAST_DIGIT_SIZE+lt.FIRST_THREE_DIGITS_SIZE,null);return e.append(n.getNewString()),e.toString()}}lt.HEADER_SIZE=8,lt.LAST_DIGIT_SIZE=2,lt.FIRST_THREE_DIGITS_SIZE=10;class ct extends nt{constructor(e,t,r){super(e),this.dateCode=r,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=ct.HEADER_SIZE+ct.GTIN_SIZE+ct.WEIGHT_SIZE+ct.DATE_SIZE)throw new R;let e=new T;return this.encodeCompressedGtin(e,ct.HEADER_SIZE),this.encodeCompressedWeight(e,ct.HEADER_SIZE+ct.GTIN_SIZE,ct.WEIGHT_SIZE),this.encodeCompressedDate(e,ct.HEADER_SIZE+ct.GTIN_SIZE+ct.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,ct.DATE_SIZE);if(38400==r)return;e.append("("),e.append(this.dateCode),e.append(")");let n=r%32;r/=32;let i=r%12+1;r/=12;let s=r;s/10==0&&e.append("0"),e.append(s),i/10==0&&e.append("0"),e.append(i),n/10==0&&e.append("0"),e.append(n)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}function dt(e){try{if(e.get(1))return new tt(e);if(!e.get(2))return new rt(e);switch(Ke.extractNumericValueFromBitArray(e,1,4)){case 4:return new st(e);case 5:return new at(e)}switch(Ke.extractNumericValueFromBitArray(e,1,5)){case 12:return new ot(e);case 13:return new lt(e)}switch(Ke.extractNumericValueFromBitArray(e,1,7)){case 56:return new ct(e,"310","11");case 57:return new ct(e,"320","11");case 58:return new ct(e,"310","13");case 59:return new ct(e,"320","13");case 60:return new ct(e,"310","15");case 61:return new ct(e,"320","15");case 62:return new ct(e,"310","17");case 63:return new ct(e,"320","17")}}catch(t){throw console.log(t),new de("unknown decoder: "+e)}}ct.HEADER_SIZE=8,ct.WEIGHT_SIZE=20,ct.DATE_SIZE=16;class ut{constructor(e,t,r,n){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=n}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof ut&&ut.equalsOrNull(e.leftchar,t.leftchar)&&ut.equalsOrNull(e.rightchar,t.rightchar)&&ut.equalsOrNull(e.finderpattern,t.finderpattern)}static equalsOrNull(e,t){return null===e?null===t:ut.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class ht{constructor(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof ht&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed}checkEqualitity(e,t){if(!e||!t)return;let r;return e.forEach(((e,n)=>{t.forEach((t=>{e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(r=!0)}))})),r}}class pt extends Ue{constructor(e){super(...arguments),this.pairs=new Array(pt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===e}decodeRow(e,t,r){this.pairs.length=0,this.startFromEven=!1;try{return pt.constructResult(this.decodeRow2pairs(e,t))}catch(n){this.verbose&&console.log(n)}return this.pairs.length=0,this.startFromEven=!0,pt.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let r,n=!1;for(;!n;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(i){if(i instanceof R){if(!this.pairs.length)throw new R;n=!0}}if(this.checkChecksum())return this.pairs;if(r=!!this.rows.length,this.storeRow(e,!1),r){let e=this.checkRowsBoolean(!1);if(null!=e)return e;if(e=this.checkRowsBoolean(!0),null!=e)return e}throw new R}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(r){this.verbose&&console.log(r)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let n=t;n<this.rows.length;n++){let t=this.rows[n];this.pairs.length=0;for(let r of e)this.pairs.push(r.getPairs());if(this.pairs.push(t.getPairs()),!pt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let i=new Array(e);i.push(t);try{return this.checkRows(i,n+1)}catch(r){this.verbose&&console.log(r)}}throw new R}static isValidSequence(e){for(let t of pt.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let r=!0;for(let n=0;n<e.length;n++)if(e[n].getFinderPattern().getValue()!=t[n]){r=!1;break}if(r)return!0}return!1}storeRow(e,t){let r=0,n=!1,i=!1;for(;r<this.rows.length;){let t=this.rows[r];if(t.getRowNumber()>e){i=t.isEquivalent(this.pairs);break}n=t.isEquivalent(this.pairs),r++}i||n||pt.isPartialRow(this.pairs,this.rows)||(this.rows.push(r,new ht(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let r of t)if(r.getPairs().length!==e.length)for(let t of r.getPairs())for(let r of e)if(ut.equals(t,r))break}static isPartialRow(e,t){for(let r of t){let t=!0;for(let n of e){let e=!1;for(let t of r.getPairs())if(n.equals(t)){e=!0;break}if(!e){t=!1;break}}if(t)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=dt(Ge.buildBitArray(e)).parseInformation(),r=e[0].getFinderPattern().getResultPoints(),n=e[e.length-1].getFinderPattern().getResultPoints(),i=[r[0],r[1],n[0],n[1]];return new W(t,null,null,i,G.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),r=e.getRightChar();if(null==r)return!1;let n=r.getChecksumPortion(),i=2;for(let s=1;s<this.pairs.size();++s){let e=this.pairs.get(s);n+=e.getLeftChar().getChecksumPortion(),i++;let t=e.getRightChar();null!=t&&(n+=t.getChecksumPortion(),i++)}return n%=211,211*(i-4)+n==t.getValue()}static getNextSecondBar(e,t){let r;return e.get(t)?(r=e.getNextUnset(t),r=e.getNextSet(r)):(r=e.getNextSet(t),r=e.getNextUnset(r)),r}retrieveNextPair(e,t,r){let n,i=t.length%2==0;this.startFromEven&&(i=!i);let s=!0,a=-1;do{this.findNextPair(e,t,a),n=this.parseFoundFinderPattern(e,r,i),null==n?a=pt.getNextSecondBar(e,this.startEnd[0]):s=!1}while(s);let o,l=this.decodeDataCharacter(e,n,i,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new R;try{o=this.decodeDataCharacter(e,n,i,!1)}catch(c){o=null,this.verbose&&console.log(c)}return new ut(l,o,n,!0)}isEmptyPair(e){return 0===e.length}findNextPair(e,t,r){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i,s=e.getSize();i=r>=0?r:this.isEmptyPair(t)?0:t[t.length-1].getFinderPattern().getStartEnd()[1];let a=t.length%2!=0;this.startFromEven&&(a=!a);let o=!1;for(;i<s&&(o=!e.get(i),o);)i++;let l=0,c=i;for(let d=i;d<s;d++)if(e.get(d)!=o)n[l]++;else{if(3==l){if(a&&pt.reverseCounters(n),pt.isFinderPattern(n))return this.startEnd[0]=c,void(this.startEnd[1]=d);a&&pt.reverseCounters(n),c+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,l--}else l++;n[l]=1,o=!o}throw new R}static reverseCounters(e){let t=e.length;for(let r=0;r<t/2;++r){let n=e[r];e[r]=e[t-r-1],e[t-r-1]=n}}parseFoundFinderPattern(e,t,r){let n,i,s;if(r){let t=this.startEnd[0]-1;for(;t>=0&&!e.get(t);)t--;t++,n=this.startEnd[0]-t,i=t,s=this.startEnd[1]}else i=this.startEnd[0],s=e.getNextUnset(this.startEnd[1]+1),n=s-this.startEnd[1];let a,o=this.getDecodeFinderCounters();f.arraycopy(o,0,o,1,o.length-1),o[0]=n;try{a=this.parseFinderValue(o,pt.FINDER_PATTERNS)}catch(l){return null}return new Ve(a,[i,s],i,s,t)}decodeDataCharacter(e,t,r,n){let i=this.getDataCharacterCounters();for(let S=0;S<i.length;S++)i[S]=0;if(n)pt.recordPatternInReverse(e,t.getStartEnd()[0],i);else{pt.recordPattern(e,t.getStartEnd()[1],i);for(let e=0,t=i.length-1;e<t;e++,t--){let r=i[e];i[e]=i[t],i[t]=r}}let s=17,a=pe.sum(new Int32Array(i))/s,o=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(a-o)/o>.3)throw new R;let l=this.getOddCounts(),c=this.getEvenCounts(),d=this.getOddRoundingErrors(),u=this.getEvenRoundingErrors();for(let S=0;S<i.length;S++){let e=1*i[S]/a,t=e+.5;if(t<1){if(e<.3)throw new R;t=1}else if(t>8){if(e>8.7)throw new R;t=8}let r=S/2;1&S?(c[r]=t,u[r]=e-t):(l[r]=t,d[r]=e-t)}this.adjustOddEvenCounts(s);let h=4*t.getValue()+(r?0:2)+(n?0:1)-1,p=0,m=0;for(let S=l.length-1;S>=0;S--){if(pt.isNotA1left(t,r,n)){let e=pt.WEIGHTS[h][2*S];m+=l[S]*e}p+=l[S]}let f=0;for(let S=c.length-1;S>=0;S--)if(pt.isNotA1left(t,r,n)){let e=pt.WEIGHTS[h][2*S+1];f+=c[S]*e}let g=m+f;if(1&p||p>13||p<4)throw new R;let x=(13-p)/2,y=pt.SYMBOL_WIDEST[x],w=9-y,b=He.getRSSvalue(l,y,!0),v=He.getRSSvalue(c,w,!1),C=pt.EVEN_TOTAL_SUBSET[x],_=pt.GSUM[x];return new We(b*C+v+_,g)}static isNotA1left(e,t,r){return!(0==e.getValue()&&t&&r)}adjustOddEvenCounts(e){let t=pe.sum(new Int32Array(this.getOddCounts())),r=pe.sum(new Int32Array(this.getEvenCounts())),n=!1,i=!1;t>13?i=!0:t<4&&(n=!0);let s=!1,a=!1;r>13?a=!0:r<4&&(s=!0);let o=t+r-e,l=!(1&~t),c=!(1&r);if(1==o)if(l){if(c)throw new R;i=!0}else{if(!c)throw new R;a=!0}else if(-1==o)if(l){if(c)throw new R;n=!0}else{if(!c)throw new R;s=!0}else{if(0!=o)throw new R;if(l){if(!c)throw new R;t<r?(n=!0,a=!0):(i=!0,s=!0)}else if(c)throw new R}if(n){if(i)throw new R;pt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&pt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),s){if(a)throw new R;pt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}a&&pt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}pt.SYMBOL_WIDEST=[7,5,4,3,1],pt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],pt.GSUM=[0,348,1388,2948,3988],pt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],pt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],pt.FINDER_PAT_A=0,pt.FINDER_PAT_B=1,pt.FINDER_PAT_C=2,pt.FINDER_PAT_D=3,pt.FINDER_PAT_E=4,pt.FINDER_PAT_F=5,pt.FINDER_PATTERN_SEQUENCES=[[pt.FINDER_PAT_A,pt.FINDER_PAT_A],[pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B],[pt.FINDER_PAT_A,pt.FINDER_PAT_C,pt.FINDER_PAT_B,pt.FINDER_PAT_D],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_C],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_D,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_E,pt.FINDER_PAT_B,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_D],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_E],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F],[pt.FINDER_PAT_A,pt.FINDER_PAT_A,pt.FINDER_PAT_B,pt.FINDER_PAT_B,pt.FINDER_PAT_C,pt.FINDER_PAT_D,pt.FINDER_PAT_D,pt.FINDER_PAT_E,pt.FINDER_PAT_E,pt.FINDER_PAT_F,pt.FINDER_PAT_F]],pt.MAX_PAIRS=11;class mt extends We{constructor(e,t,r){super(e,t),this.count=0,this.finderPattern=r}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ft extends Ue{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,r){const n=this.decodePair(t,!1,e,r);ft.addOrTally(this.possibleLeftPairs,n),t.reverse();let i=this.decodePair(t,!0,e,r);ft.addOrTally(this.possibleRightPairs,i),t.reverse();for(let s of this.possibleLeftPairs)if(s.getCount()>1)for(let e of this.possibleRightPairs)if(e.getCount()>1&&ft.checkChecksum(s,e))return ft.constructResult(s,e);throw new R}static addOrTally(e,t){if(null==t)return;let r=!1;for(let n of e)if(n.getValue()===t.getValue()){n.incrementCount(),r=!0;break}r||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let r=4537077*e.getValue()+t.getValue(),n=new String(r).toString(),i=new T;for(let l=13-n.length;l>0;l--)i.append("0");i.append(n);let s=0;for(let l=0;l<13;l++){let e=i.charAt(l).charCodeAt(0)-"0".charCodeAt(0);s+=1&l?e:3*e}s=10-s%10,10===s&&(s=0),i.append(s.toString());let a=e.getFinderPattern().getResultPoints(),o=t.getFinderPattern().getResultPoints();return new W(i.toString(),null,0,[a[0],a[1],o[0],o[1]],G.RSS_14,(new Date).getTime())}static checkChecksum(e,t){let r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n}decodePair(e,t,r,n){try{let i=this.findFinderPattern(e,t),s=this.parseFoundFinderPattern(e,r,t,i),a=null==n?null:n.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=a){let n=(i[0]+i[1])/2;t&&(n=e.getSize()-1-n),a.foundPossibleResultPoint(new fe(n,r))}let o=this.decodeDataCharacter(e,s,!0),l=this.decodeDataCharacter(e,s,!1);return new mt(1597*o.getValue()+l.getValue(),o.getChecksumPortion()+4*l.getChecksumPortion(),s)}catch(i){return null}}decodeDataCharacter(e,t,r){let n=this.getDataCharacterCounters();for(let f=0;f<n.length;f++)n[f]=0;if(r)Ie.recordPatternInReverse(e,t.getStartEnd()[0],n);else{Ie.recordPattern(e,t.getStartEnd()[1]+1,n);for(let e=0,t=n.length-1;e<t;e++,t--){let r=n[e];n[e]=n[t],n[t]=r}}let i=r?16:15,s=pe.sum(new Int32Array(n))/i,a=this.getOddCounts(),o=this.getEvenCounts(),l=this.getOddRoundingErrors(),c=this.getEvenRoundingErrors();for(let f=0;f<n.length;f++){let e=n[f]/s,t=Math.floor(e+.5);t<1?t=1:t>8&&(t=8);let r=Math.floor(f/2);1&f?(o[r]=t,c[r]=e-t):(a[r]=t,l[r]=e-t)}this.adjustOddEvenCounts(r,i);let d=0,u=0;for(let f=a.length-1;f>=0;f--)u*=9,u+=a[f],d+=a[f];let h=0,p=0;for(let f=o.length-1;f>=0;f--)h*=9,h+=o[f],p+=o[f];let m=u+3*h;if(r){if(1&d||d>12||d<4)throw new R;let e=(12-d)/2,t=ft.OUTSIDE_ODD_WIDEST[e],r=9-t,n=He.getRSSvalue(a,t,!1),i=He.getRSSvalue(o,r,!0),s=ft.OUTSIDE_EVEN_TOTAL_SUBSET[e],l=ft.OUTSIDE_GSUM[e];return new We(n*s+i+l,m)}{if(1&p||p>10||p<4)throw new R;let e=(10-p)/2,t=ft.INSIDE_ODD_WIDEST[e],r=9-t,n=He.getRSSvalue(a,t,!0),i=He.getRSSvalue(o,r,!1),s=ft.INSIDE_ODD_TOTAL_SUBSET[e],l=ft.INSIDE_GSUM[e];return new We(i*s+n+l,m)}}findFinderPattern(e,t){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let n=e.getSize(),i=!1,s=0;for(;s<n&&(i=!e.get(s),t!==i);)s++;let a=0,o=s;for(let l=s;l<n;l++)if(e.get(l)!==i)r[a]++;else{if(3===a){if(Ue.isFinderPattern(r))return[o,l];o+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,i=!i}throw new R}parseFoundFinderPattern(e,t,r,n){let i=e.get(n[0]),s=n[0]-1;for(;s>=0&&i!==e.get(s);)s--;s++;const a=n[0]-s,o=this.getDecodeFinderCounters(),l=new Int32Array(o.length);f.arraycopy(o,0,l,1,o.length-1),l[0]=a;const c=this.parseFinderValue(l,ft.FINDER_PATTERNS);let d=s,u=n[1];return r&&(d=e.getSize()-1-d,u=e.getSize()-1-u),new Ve(c,[s,n[1]],d,u,t)}adjustOddEvenCounts(e,t){let r=pe.sum(new Int32Array(this.getOddCounts())),n=pe.sum(new Int32Array(this.getEvenCounts())),i=!1,s=!1,a=!1,o=!1;e?(r>12?s=!0:r<4&&(i=!0),n>12?o=!0:n<4&&(a=!0)):(r>11?s=!0:r<5&&(i=!0),n>10?o=!0:n<4&&(a=!0));let l=r+n-t,c=(1&r)==(e?1:0),d=!(1&~n);if(1===l)if(c){if(d)throw new R;s=!0}else{if(!d)throw new R;o=!0}else if(-1===l)if(c){if(d)throw new R;i=!0}else{if(!d)throw new R;a=!0}else{if(0!==l)throw new R;if(c){if(!d)throw new R;r<n?(i=!0,o=!0):(s=!0,a=!0)}else if(d)throw new R}if(i){if(s)throw new R;Ue.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&Ue.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new R;Ue.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&Ue.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ft.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ft.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ft.OUTSIDE_GSUM=[0,161,961,2015,2715],ft.INSIDE_GSUM=[0,336,1036,1516],ft.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ft.INSIDE_ODD_WIDEST=[2,4,6,8],ft.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class gt extends Ie{constructor(e,t){super(),this.readers=[],this.verbose=!0===t;const r=e?e.get(_.POSSIBLE_FORMATS):null,n=e&&void 0!==e.get(_.ASSUME_CODE_39_CHECK_DIGIT);r?((r.includes(G.EAN_13)||r.includes(G.UPC_A)||r.includes(G.EAN_8)||r.includes(G.UPC_E))&&this.readers.push(new ze(e)),r.includes(G.CODE_39)&&this.readers.push(new Te(n)),r.includes(G.CODE_128)&&this.readers.push(new je),r.includes(G.ITF)&&this.readers.push(new De),r.includes(G.RSS_14)&&this.readers.push(new ft),r.includes(G.RSS_EXPANDED)&&this.readers.push(new pt(this.verbose))):(this.readers.push(new ze(e)),this.readers.push(new Te),this.readers.push(new ze(e)),this.readers.push(new je),this.readers.push(new De),this.readers.push(new ft),this.readers.push(new pt(this.verbose)))}decodeRow(e,t,r){for(let i=0;i<this.readers.length;i++)try{return this.readers[i].decodeRow(e,t,r)}catch(n){}throw new R}reset(){this.readers.forEach((e=>e.reset()))}}class xt extends U{constructor(e=500,t){super(new gt(t),e,t)}}class yt{constructor(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class wt{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class bt{constructor(e,t,r,n,i,s){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=n,this.dataRegionSizeColumns=i,this.ecBlocks=s;let a=0;const o=s.getECCodewords(),l=s.getECBlocks();for(let c of l)a+=c.getCount()*(c.getDataCodewords()+o);this.totalCodewords=a}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if(1&e||1&t)throw new S;for(let r of bt.VERSIONS)if(r.symbolSizeRows===e&&r.symbolSizeColumns===t)return r;throw new S}toString(){return""+this.versionNumber}static buildVersions(){return[new bt(1,10,10,8,8,new yt(5,new wt(1,3))),new bt(2,12,12,10,10,new yt(7,new wt(1,5))),new bt(3,14,14,12,12,new yt(10,new wt(1,8))),new bt(4,16,16,14,14,new yt(12,new wt(1,12))),new bt(5,18,18,16,16,new yt(14,new wt(1,18))),new bt(6,20,20,18,18,new yt(18,new wt(1,22))),new bt(7,22,22,20,20,new yt(20,new wt(1,30))),new bt(8,24,24,22,22,new yt(24,new wt(1,36))),new bt(9,26,26,24,24,new yt(28,new wt(1,44))),new bt(10,32,32,14,14,new yt(36,new wt(1,62))),new bt(11,36,36,16,16,new yt(42,new wt(1,86))),new bt(12,40,40,18,18,new yt(48,new wt(1,114))),new bt(13,44,44,20,20,new yt(56,new wt(1,144))),new bt(14,48,48,22,22,new yt(68,new wt(1,174))),new bt(15,52,52,24,24,new yt(42,new wt(2,102))),new bt(16,64,64,14,14,new yt(56,new wt(2,140))),new bt(17,72,72,16,16,new yt(36,new wt(4,92))),new bt(18,80,80,18,18,new yt(48,new wt(4,114))),new bt(19,88,88,20,20,new yt(56,new wt(4,144))),new bt(20,96,96,22,22,new yt(68,new wt(4,174))),new bt(21,104,104,24,24,new yt(56,new wt(6,136))),new bt(22,120,120,18,18,new yt(68,new wt(6,175))),new bt(23,132,132,20,20,new yt(62,new wt(8,163))),new bt(24,144,144,22,22,new yt(62,new wt(8,156),new wt(2,155))),new bt(25,8,18,6,16,new yt(7,new wt(1,5))),new bt(26,8,32,6,14,new yt(11,new wt(1,10))),new bt(27,12,26,10,24,new yt(14,new wt(1,16))),new bt(28,12,36,10,16,new yt(18,new wt(1,22))),new bt(29,16,36,14,16,new yt(24,new wt(1,32))),new bt(30,16,48,14,22,new yt(28,new wt(1,49)))]}}bt.VERSIONS=bt.buildVersions();class vt{constructor(e){const t=e.getHeight();if(t<8||t>144||1&t)throw new S;this.version=vt.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new D(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),r=e.getWidth();return bt.getVersionForDimensions(t,r)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,r=4,n=0;const i=this.mappingBitMatrix.getHeight(),s=this.mappingBitMatrix.getWidth();let a=!1,o=!1,l=!1,c=!1;do{if(r!==i||0!==n||a)if(r===i-2&&0===n&&3&s&&!o)e[t++]=255&this.readCorner2(i,s),r-=2,n+=2,o=!0;else if(r!==i+4||2!==n||7&s||l)if(r!==i-2||0!==n||4!=(7&s)||c){do{r<i&&n>=0&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r-=2,n+=2}while(r>=0&&n<s);r+=1,n+=3;do{r>=0&&n<s&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r+=2,n-=2}while(r<i&&n>=0);r+=3,n+=1}else e[t++]=255&this.readCorner4(i,s),r-=2,n+=2,c=!0;else e[t++]=255&this.readCorner3(i,s),r-=2,n+=2,l=!0;else e[t++]=255&this.readCorner1(i,s),r-=2,n+=2,a=!0}while(r<i||n<s);if(t!==this.version.getTotalCodewords())throw new S;return e}readModule(e,t,r,n){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=n,e+=4-(n+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,r,n){let i=0;return this.readModule(e-2,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-2,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t,r,n)&&(i|=1),i<<=1,this.readModule(e,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e,t,r,n)&&(i|=1),i}readCorner1(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}readCorner2(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner3(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner4(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new u("Dimension of bitMatrix must match the version size");const n=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),s=t/n|0,a=r/i|0,o=new D(a*i,s*n);for(let l=0;l<s;++l){const t=l*n;for(let r=0;r<a;++r){const s=r*i;for(let a=0;a<n;++a){const c=l*(n+2)+1+a,d=t+a;for(let t=0;t<i;++t){const n=r*(i+2)+1+t;if(e.get(n,c)){const e=s+t;o.set(e,d)}}}}}return o}}class Ct{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const r=t.getECBlocks();let n=0;const i=r.getECBlocks();for(let u of i)n+=u.getCount();const s=new Array(n);let a=0;for(let u of i)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=r.getECCodewords()+e;s[a++]=new Ct(e,new Uint8Array(t))}const o=s[0].codewords.length-r.getECCodewords(),l=o-1;let c=0;for(let u=0;u<l;u++)for(let t=0;t<a;t++)s[t].codewords[u]=e[c++];const d=24===t.getVersionNumber(),h=d?8:a;for(let u=0;u<h;u++)s[u].codewords[o-1]=e[c++];const p=s[0].codewords.length;for(let u=o;u<p;u++)for(let t=0;t<a;t++){const r=d?(t+8)%a:t,n=d&&r>7?u-1:u;s[r].codewords[n]=e[c++]}if(c!==e.length)throw new u;return s}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class _t{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new u(""+e);let t=0,r=this.bitOffset,n=this.byteOffset;const i=this.bytes;if(r>0){const s=8-r,a=e<s?e:s,o=s-a,l=255>>8-a<<o;t=(i[n]&l)>>o,e-=a,r+=a,8===r&&(r=0,n++)}if(e>0){for(;e>=8;)t=t<<8|255&i[n],n++,e-=8;if(e>0){const s=8-e,a=255>>s<<s;t=t<<e|(i[n]&a)>>s,r+=e}}return this.bitOffset=r,this.byteOffset=n,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}(J=X||(X={}))[J.PAD_ENCODE=0]="PAD_ENCODE",J[J.ASCII_ENCODE=1]="ASCII_ENCODE",J[J.C40_ENCODE=2]="C40_ENCODE",J[J.TEXT_ENCODE=3]="TEXT_ENCODE",J[J.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",J[J.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",J[J.BASE256_ENCODE=6]="BASE256_ENCODE";class St{static decode(e){const t=new _t(e),r=new T,n=new T,i=new Array;let s=X.ASCII_ENCODE;do{if(s===X.ASCII_ENCODE)s=this.decodeAsciiSegment(t,r,n);else{switch(s){case X.C40_ENCODE:this.decodeC40Segment(t,r);break;case X.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case X.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case X.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case X.BASE256_ENCODE:this.decodeBase256Segment(t,r,i);break;default:throw new S}s=X.ASCII_ENCODE}}while(s!==X.PAD_ENCODE&&t.available()>0);return n.length()>0&&r.append(n.toString()),new ie(e,r.toString(),0===i.length?null:i,null)}static decodeAsciiSegment(e,t,r){let n=!1;do{let i=e.readBits(8);if(0===i)throw new S;if(i<=128)return n&&(i+=128),t.append(String.fromCharCode(i-1)),X.ASCII_ENCODE;if(129===i)return X.PAD_ENCODE;if(i<=229){const e=i-130;e<10&&t.append("0"),t.append(""+e)}else switch(i){case 230:return X.C40_ENCODE;case 231:return X.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:n=!0;break;case 236:t.append("[)>05"),r.insert(0,"");break;case 237:t.append("[)>06"),r.insert(0,"");break;case 238:return X.ANSIX12_ENCODE;case 239:return X.TEXT_ENCODE;case 240:return X.EDIFACT_ENCODE;default:if(254!==i||0!==e.available())throw new S}}while(e.available()>0);return X.ASCII_ENCODE}static decodeC40Segment(e,t){let r=!1;const n=[];let i=0;do{if(8===e.available())return;const s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){const s=n[e];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.C40_BASIC_SET_CHARS.length))throw new S;{const e=this.C40_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}}break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.C40_SHIFT2_SET_CHARS.length){const e=this.C40_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new S}i=0;break;case 3:r?(t.append(String.fromCharCode(s+224)),r=!1):t.append(String.fromCharCode(s+96)),i=0;break;default:throw new S}}}while(e.available()>0)}static decodeTextSegment(e,t){let r=!1,n=[],i=0;do{if(8===e.available())return;const s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){const s=n[e];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.TEXT_BASIC_SET_CHARS.length))throw new S;{const e=this.TEXT_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}}break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.TEXT_SHIFT2_SET_CHARS.length){const e=this.TEXT_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append(String.fromCharCode(29));break;case 30:r=!0;break;default:throw new S}i=0;break;case 3:if(!(s<this.TEXT_SHIFT3_SET_CHARS.length))throw new S;{const e=this.TEXT_SHIFT3_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e),i=0}break;default:throw new S}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const r=[];do{if(8===e.available())return;const n=e.readBits(8);if(254===n)return;this.parseTwoBytes(n,e.readBits(8),r);for(let e=0;e<3;e++){const n=r[e];switch(n){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(n<14)t.append(String.fromCharCode(n+44));else{if(!(n<40))throw new S;t.append(String.fromCharCode(n+51))}}}}while(e.available()>0)}static parseTwoBytes(e,t,r){let n=(e<<8)+t-1,i=Math.floor(n/1600);r[0]=i,n-=1600*i,i=Math.floor(n/40),r[1]=i,r[2]=n-40*i}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let r=0;r<4;r++){let r=e.readBits(6);if(31===r){const t=8-e.getBitOffset();return void(8!==t&&e.readBits(t))}32&r||(r|=64),t.append(String.fromCharCode(r))}}while(e.available()>0)}static decodeBase256Segment(e,t,r){let n=1+e.getByteOffset();const i=this.unrandomize255State(e.readBits(8),n++);let s;if(s=0===i?e.available()/8|0:i<250?i:250*(i-249)+this.unrandomize255State(e.readBits(8),n++),s<0)throw new S;const a=new Uint8Array(s);for(let l=0;l<s;l++){if(e.available()<8)throw new S;a[l]=this.unrandomize255State(e.readBits(8),n++)}r.push(a);try{t.append(I.decode(a,j.ISO88591))}catch(o){throw new de("Platform does not support required encoding: "+o.message)}}static unrandomize255State(e,t){const r=e-(149*t%255+1);return r>=0?r:r+256}}St.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],St.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],St.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],St.TEXT_SHIFT2_SET_CHARS=St.C40_SHIFT2_SET_CHARS,St.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class Et{constructor(){this.rsDecoder=new ue(le.DATA_MATRIX_FIELD_256)}decode(e){const t=new vt(e),r=t.getVersion(),n=t.readCodewords(),i=Ct.getDataBlocks(n,r);let s=0;for(let l of i)s+=l.getNumDataCodewords();const a=new Uint8Array(s),o=i.length;for(let l=0;l<o;l++){const e=i[l],t=e.getCodewords(),r=e.getNumDataCodewords();this.correctErrors(t,r);for(let n=0;n<r;n++)a[n*o+l]=t[n]}return St.decode(a)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(n){throw new p}for(let i=0;i<t;i++)e[i]=r[i]}}class At{constructor(e){this.image=e,this.rectangleDetector=new ye(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new R;t=this.shiftToModuleCenter(t);const r=t[0],n=t[1],i=t[2],s=t[3];let a=this.transitionsBetween(r,s)+1,o=this.transitionsBetween(i,s)+1;1&~a||(a+=1),1&~o||(o+=1),4*a<7*o&&4*o<7*a&&(a=o=Math.max(a,o));let l=At.sampleGrid(this.image,r,n,i,s,a,o);return new ge(l,[r,n,i,s])}static shiftPoint(e,t,r){let n=(t.getX()-e.getX())/(r+1),i=(t.getY()-e.getY())/(r+1);return new fe(e.getX()+n,e.getY()+i)}static moveAway(e,t,r){let n=e.getX(),i=e.getY();return n<t?n-=1:n+=1,i<r?i-=1:i+=1,new fe(n,i)}detectSolid1(e){let t=e[0],r=e[1],n=e[3],i=e[2],s=this.transitionsBetween(t,r),a=this.transitionsBetween(r,n),o=this.transitionsBetween(n,i),l=this.transitionsBetween(i,t),c=s,d=[i,t,r,n];return c>a&&(c=a,d[0]=t,d[1]=r,d[2]=n,d[3]=i),c>o&&(c=o,d[0]=r,d[1]=n,d[2]=i,d[3]=t),c>l&&(d[0]=n,d[1]=i,d[2]=t,d[3]=r),d}detectSolid2(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=At.shiftPoint(r,n,4*(s+1)),o=At.shiftPoint(n,r,4*(s+1));return this.transitionsBetween(a,t)<this.transitionsBetween(o,i)?(e[0]=t,e[1]=r,e[2]=n,e[3]=i):(e[0]=r,e[1]=n,e[2]=i,e[3]=t),e}correctTopRight(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=this.transitionsBetween(r,i),o=At.shiftPoint(t,r,4*(a+1)),l=At.shiftPoint(n,r,4*(s+1));s=this.transitionsBetween(o,i),a=this.transitionsBetween(l,i);let c=new fe(i.getX()+(n.getX()-r.getX())/(s+1),i.getY()+(n.getY()-r.getY())/(s+1)),d=new fe(i.getX()+(t.getX()-r.getX())/(a+1),i.getY()+(t.getY()-r.getY())/(a+1));return this.isValid(c)?this.isValid(d)?this.transitionsBetween(o,c)+this.transitionsBetween(l,c)>this.transitionsBetween(o,d)+this.transitionsBetween(l,d)?c:d:c:this.isValid(d)?d:null}shiftToModuleCenter(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i)+1,a=this.transitionsBetween(n,i)+1,o=At.shiftPoint(t,r,4*a),l=At.shiftPoint(n,r,4*s);s=this.transitionsBetween(o,i)+1,a=this.transitionsBetween(l,i)+1,1&~s||(s+=1),1&~a||(a+=1);let c,d,u=(t.getX()+r.getX()+n.getX()+i.getX())/4,h=(t.getY()+r.getY()+n.getY()+i.getY())/4;return t=At.moveAway(t,u,h),r=At.moveAway(r,u,h),n=At.moveAway(n,u,h),i=At.moveAway(i,u,h),o=At.shiftPoint(t,r,4*a),o=At.shiftPoint(o,i,4*s),c=At.shiftPoint(r,t,4*a),c=At.shiftPoint(c,n,4*s),l=At.shiftPoint(n,i,4*a),l=At.shiftPoint(l,r,4*s),d=At.shiftPoint(i,n,4*a),d=At.shiftPoint(d,t,4*s),[o,c,l,d]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,r,n,i,s,a){return Ce.getInstance().sampleGrid(e,s,a,.5,.5,s-.5,.5,s-.5,a-.5,.5,a-.5,t.getX(),t.getY(),i.getX(),i.getY(),n.getX(),n.getY(),r.getX(),r.getY())}transitionsBetween(e,t){let r=Math.trunc(e.getX()),n=Math.trunc(e.getY()),i=Math.trunc(t.getX()),s=Math.trunc(t.getY()),a=Math.abs(s-n)>Math.abs(i-r);if(a){let e=r;r=n,n=e,e=i,i=s,s=e}let o=Math.abs(i-r),l=Math.abs(s-n),c=-o/2,d=n<s?1:-1,u=r<i?1:-1,h=0,p=this.image.get(a?n:r,a?r:n);for(let m=r,f=n;m!==i;m+=u){let e=this.image.get(a?f:m,a?m:f);if(e!==p&&(h++,p=e),c+=l,c>0){if(f===s)break;f+=d,c-=o}}return h}}class It{constructor(){this.decoder=new Et}decode(e,t=null){let r,n;if(null!=t&&t.has(_.PURE_BARCODE)){const t=It.extractPureBits(e.getBlackMatrix());r=this.decoder.decode(t),n=It.NO_POINTS}else{const t=new At(e.getBlackMatrix()).detect();r=this.decoder.decode(t.getBits()),n=t.getPoints()}const i=r.getRawBytes(),s=new W(r.getText(),i,8*i.length,n,G.DATA_MATRIX,f.currentTimeMillis()),a=r.getByteSegments();null!=a&&s.putMetadata(ne.BYTE_SEGMENTS,a);const o=r.getECLevel();return null!=o&&s.putMetadata(ne.ERROR_CORRECTION_LEVEL,o),s}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null==t||null==r)throw new R;const n=this.moduleSize(t,e);let i=t[1];const s=r[1];let a=t[0];const o=(r[0]-a+1)/n,l=(s-i+1)/n;if(o<=0||l<=0)throw new R;const c=n/2;i+=c,a+=c;const d=new D(o,l);for(let u=0;u<l;u++){const t=i+u*n;for(let r=0;r<o;r++)e.get(a+r*n,t)&&d.set(r,u)}return d}static moduleSize(e,t){const r=t.getWidth();let n=e[0];const i=e[1];for(;n<r&&t.get(n,i);)n++;if(n===r)throw new R;const s=n-e[0];if(0===s)throw new R;return s}}It.NO_POINTS=[];class jt extends U{constructor(e=500){super(new It,e)}}(ee=$||($={}))[ee.L=0]="L",ee[ee.M=1]="M",ee[ee.Q=2]="Q",ee[ee.H=3]="H";class Tt{constructor(e,t,r){this.value=e,this.stringValue=t,this.bits=r,Tt.FOR_BITS.set(r,this),Tt.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return Tt.L;case"M":return Tt.M;case"Q":return Tt.Q;case"H":return Tt.H;default:throw new d(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof Tt))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=Tt.FOR_BITS.size)throw new u;return Tt.FOR_BITS.get(e)}}Tt.FOR_BITS=new Map,Tt.FOR_VALUE=new Map,Tt.L=new Tt($.L,"L",1),Tt.M=new Tt($.M,"M",0),Tt.Q=new Tt($.Q,"Q",3),Tt.H=new Tt($.H,"H",2);class Dt{constructor(e){this.errorCorrectionLevel=Tt.forBits(e>>3&3),this.dataMask=7&e}static numBitsDiffering(e,t){return w.bitCount(e^t)}static decodeFormatInformation(e,t){const r=Dt.doDecodeFormatInformation(e,t);return null!==r?r:Dt.doDecodeFormatInformation(e^Dt.FORMAT_INFO_MASK_QR,t^Dt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let r=Number.MAX_SAFE_INTEGER,n=0;for(const i of Dt.FORMAT_INFO_DECODE_LOOKUP){const s=i[0];if(s===e||s===t)return new Dt(i[1]);let a=Dt.numBitsDiffering(e,s);a<r&&(n=i[1],r=a),e!==t&&(a=Dt.numBitsDiffering(t,s),a<r&&(n=i[1],r=a))}return r<=3?new Dt(n):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof Dt))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}Dt.FORMAT_INFO_MASK_QR=21522,Dt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Rt{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const r of t)e+=r.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Nt{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Pt{constructor(e,t,...r){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=r;let n=0;const i=r[0].getECCodewordsPerBlock(),s=r[0].getECBlocks();for(const a of s)n+=a.getCount()*(a.getDataCodewords()+i);this.totalCodewords=n}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!=1)throw new S;try{return this.getVersionForNumber((e-17)/4)}catch(t){throw new S}}static getVersionForNumber(e){if(e<1||e>40)throw new u;return Pt.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,r=0;for(let n=0;n<Pt.VERSION_DECODE_INFO.length;n++){const i=Pt.VERSION_DECODE_INFO[n];if(i===e)return Pt.getVersionForNumber(n+7);const s=Dt.numBitsDiffering(e,i);s<t&&(r=n+7,t=s)}return t<=3?Pt.getVersionForNumber(r):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new D(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const r=this.alignmentPatternCenters.length;for(let n=0;n<r;n++){const e=this.alignmentPatternCenters[n]-2;for(let i=0;i<r;i++)0===n&&(0===i||i===r-1)||n===r-1&&0===i||t.setRegion(this.alignmentPatternCenters[i]-2,e,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}Pt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Pt.VERSIONS=[new Pt(1,new Int32Array(0),new Rt(7,new Nt(1,19)),new Rt(10,new Nt(1,16)),new Rt(13,new Nt(1,13)),new Rt(17,new Nt(1,9))),new Pt(2,Int32Array.from([6,18]),new Rt(10,new Nt(1,34)),new Rt(16,new Nt(1,28)),new Rt(22,new Nt(1,22)),new Rt(28,new Nt(1,16))),new Pt(3,Int32Array.from([6,22]),new Rt(15,new Nt(1,55)),new Rt(26,new Nt(1,44)),new Rt(18,new Nt(2,17)),new Rt(22,new Nt(2,13))),new Pt(4,Int32Array.from([6,26]),new Rt(20,new Nt(1,80)),new Rt(18,new Nt(2,32)),new Rt(26,new Nt(2,24)),new Rt(16,new Nt(4,9))),new Pt(5,Int32Array.from([6,30]),new Rt(26,new Nt(1,108)),new Rt(24,new Nt(2,43)),new Rt(18,new Nt(2,15),new Nt(2,16)),new Rt(22,new Nt(2,11),new Nt(2,12))),new Pt(6,Int32Array.from([6,34]),new Rt(18,new Nt(2,68)),new Rt(16,new Nt(4,27)),new Rt(24,new Nt(4,19)),new Rt(28,new Nt(4,15))),new Pt(7,Int32Array.from([6,22,38]),new Rt(20,new Nt(2,78)),new Rt(18,new Nt(4,31)),new Rt(18,new Nt(2,14),new Nt(4,15)),new Rt(26,new Nt(4,13),new Nt(1,14))),new Pt(8,Int32Array.from([6,24,42]),new Rt(24,new Nt(2,97)),new Rt(22,new Nt(2,38),new Nt(2,39)),new Rt(22,new Nt(4,18),new Nt(2,19)),new Rt(26,new Nt(4,14),new Nt(2,15))),new Pt(9,Int32Array.from([6,26,46]),new Rt(30,new Nt(2,116)),new Rt(22,new Nt(3,36),new Nt(2,37)),new Rt(20,new Nt(4,16),new Nt(4,17)),new Rt(24,new Nt(4,12),new Nt(4,13))),new Pt(10,Int32Array.from([6,28,50]),new Rt(18,new Nt(2,68),new Nt(2,69)),new Rt(26,new Nt(4,43),new Nt(1,44)),new Rt(24,new Nt(6,19),new Nt(2,20)),new Rt(28,new Nt(6,15),new Nt(2,16))),new Pt(11,Int32Array.from([6,30,54]),new Rt(20,new Nt(4,81)),new Rt(30,new Nt(1,50),new Nt(4,51)),new Rt(28,new Nt(4,22),new Nt(4,23)),new Rt(24,new Nt(3,12),new Nt(8,13))),new Pt(12,Int32Array.from([6,32,58]),new Rt(24,new Nt(2,92),new Nt(2,93)),new Rt(22,new Nt(6,36),new Nt(2,37)),new Rt(26,new Nt(4,20),new Nt(6,21)),new Rt(28,new Nt(7,14),new Nt(4,15))),new Pt(13,Int32Array.from([6,34,62]),new Rt(26,new Nt(4,107)),new Rt(22,new Nt(8,37),new Nt(1,38)),new Rt(24,new Nt(8,20),new Nt(4,21)),new Rt(22,new Nt(12,11),new Nt(4,12))),new Pt(14,Int32Array.from([6,26,46,66]),new Rt(30,new Nt(3,115),new Nt(1,116)),new Rt(24,new Nt(4,40),new Nt(5,41)),new Rt(20,new Nt(11,16),new Nt(5,17)),new Rt(24,new Nt(11,12),new Nt(5,13))),new Pt(15,Int32Array.from([6,26,48,70]),new Rt(22,new Nt(5,87),new Nt(1,88)),new Rt(24,new Nt(5,41),new Nt(5,42)),new Rt(30,new Nt(5,24),new Nt(7,25)),new Rt(24,new Nt(11,12),new Nt(7,13))),new Pt(16,Int32Array.from([6,26,50,74]),new Rt(24,new Nt(5,98),new Nt(1,99)),new Rt(28,new Nt(7,45),new Nt(3,46)),new Rt(24,new Nt(15,19),new Nt(2,20)),new Rt(30,new Nt(3,15),new Nt(13,16))),new Pt(17,Int32Array.from([6,30,54,78]),new Rt(28,new Nt(1,107),new Nt(5,108)),new Rt(28,new Nt(10,46),new Nt(1,47)),new Rt(28,new Nt(1,22),new Nt(15,23)),new Rt(28,new Nt(2,14),new Nt(17,15))),new Pt(18,Int32Array.from([6,30,56,82]),new Rt(30,new Nt(5,120),new Nt(1,121)),new Rt(26,new Nt(9,43),new Nt(4,44)),new Rt(28,new Nt(17,22),new Nt(1,23)),new Rt(28,new Nt(2,14),new Nt(19,15))),new Pt(19,Int32Array.from([6,30,58,86]),new Rt(28,new Nt(3,113),new Nt(4,114)),new Rt(26,new Nt(3,44),new Nt(11,45)),new Rt(26,new Nt(17,21),new Nt(4,22)),new Rt(26,new Nt(9,13),new Nt(16,14))),new Pt(20,Int32Array.from([6,34,62,90]),new Rt(28,new Nt(3,107),new Nt(5,108)),new Rt(26,new Nt(3,41),new Nt(13,42)),new Rt(30,new Nt(15,24),new Nt(5,25)),new Rt(28,new Nt(15,15),new Nt(10,16))),new Pt(21,Int32Array.from([6,28,50,72,94]),new Rt(28,new Nt(4,116),new Nt(4,117)),new Rt(26,new Nt(17,42)),new Rt(28,new Nt(17,22),new Nt(6,23)),new Rt(30,new Nt(19,16),new Nt(6,17))),new Pt(22,Int32Array.from([6,26,50,74,98]),new Rt(28,new Nt(2,111),new Nt(7,112)),new Rt(28,new Nt(17,46)),new Rt(30,new Nt(7,24),new Nt(16,25)),new Rt(24,new Nt(34,13))),new Pt(23,Int32Array.from([6,30,54,78,102]),new Rt(30,new Nt(4,121),new Nt(5,122)),new Rt(28,new Nt(4,47),new Nt(14,48)),new Rt(30,new Nt(11,24),new Nt(14,25)),new Rt(30,new Nt(16,15),new Nt(14,16))),new Pt(24,Int32Array.from([6,28,54,80,106]),new Rt(30,new Nt(6,117),new Nt(4,118)),new Rt(28,new Nt(6,45),new Nt(14,46)),new Rt(30,new Nt(11,24),new Nt(16,25)),new Rt(30,new Nt(30,16),new Nt(2,17))),new Pt(25,Int32Array.from([6,32,58,84,110]),new Rt(26,new Nt(8,106),new Nt(4,107)),new Rt(28,new Nt(8,47),new Nt(13,48)),new Rt(30,new Nt(7,24),new Nt(22,25)),new Rt(30,new Nt(22,15),new Nt(13,16))),new Pt(26,Int32Array.from([6,30,58,86,114]),new Rt(28,new Nt(10,114),new Nt(2,115)),new Rt(28,new Nt(19,46),new Nt(4,47)),new Rt(28,new Nt(28,22),new Nt(6,23)),new Rt(30,new Nt(33,16),new Nt(4,17))),new Pt(27,Int32Array.from([6,34,62,90,118]),new Rt(30,new Nt(8,122),new Nt(4,123)),new Rt(28,new Nt(22,45),new Nt(3,46)),new Rt(30,new Nt(8,23),new Nt(26,24)),new Rt(30,new Nt(12,15),new Nt(28,16))),new Pt(28,Int32Array.from([6,26,50,74,98,122]),new Rt(30,new Nt(3,117),new Nt(10,118)),new Rt(28,new Nt(3,45),new Nt(23,46)),new Rt(30,new Nt(4,24),new Nt(31,25)),new Rt(30,new Nt(11,15),new Nt(31,16))),new Pt(29,Int32Array.from([6,30,54,78,102,126]),new Rt(30,new Nt(7,116),new Nt(7,117)),new Rt(28,new Nt(21,45),new Nt(7,46)),new Rt(30,new Nt(1,23),new Nt(37,24)),new Rt(30,new Nt(19,15),new Nt(26,16))),new Pt(30,Int32Array.from([6,26,52,78,104,130]),new Rt(30,new Nt(5,115),new Nt(10,116)),new Rt(28,new Nt(19,47),new Nt(10,48)),new Rt(30,new Nt(15,24),new Nt(25,25)),new Rt(30,new Nt(23,15),new Nt(25,16))),new Pt(31,Int32Array.from([6,30,56,82,108,134]),new Rt(30,new Nt(13,115),new Nt(3,116)),new Rt(28,new Nt(2,46),new Nt(29,47)),new Rt(30,new Nt(42,24),new Nt(1,25)),new Rt(30,new Nt(23,15),new Nt(28,16))),new Pt(32,Int32Array.from([6,34,60,86,112,138]),new Rt(30,new Nt(17,115)),new Rt(28,new Nt(10,46),new Nt(23,47)),new Rt(30,new Nt(10,24),new Nt(35,25)),new Rt(30,new Nt(19,15),new Nt(35,16))),new Pt(33,Int32Array.from([6,30,58,86,114,142]),new Rt(30,new Nt(17,115),new Nt(1,116)),new Rt(28,new Nt(14,46),new Nt(21,47)),new Rt(30,new Nt(29,24),new Nt(19,25)),new Rt(30,new Nt(11,15),new Nt(46,16))),new Pt(34,Int32Array.from([6,34,62,90,118,146]),new Rt(30,new Nt(13,115),new Nt(6,116)),new Rt(28,new Nt(14,46),new Nt(23,47)),new Rt(30,new Nt(44,24),new Nt(7,25)),new Rt(30,new Nt(59,16),new Nt(1,17))),new Pt(35,Int32Array.from([6,30,54,78,102,126,150]),new Rt(30,new Nt(12,121),new Nt(7,122)),new Rt(28,new Nt(12,47),new Nt(26,48)),new Rt(30,new Nt(39,24),new Nt(14,25)),new Rt(30,new Nt(22,15),new Nt(41,16))),new Pt(36,Int32Array.from([6,24,50,76,102,128,154]),new Rt(30,new Nt(6,121),new Nt(14,122)),new Rt(28,new Nt(6,47),new Nt(34,48)),new Rt(30,new Nt(46,24),new Nt(10,25)),new Rt(30,new Nt(2,15),new Nt(64,16))),new Pt(37,Int32Array.from([6,28,54,80,106,132,158]),new Rt(30,new Nt(17,122),new Nt(4,123)),new Rt(28,new Nt(29,46),new Nt(14,47)),new Rt(30,new Nt(49,24),new Nt(10,25)),new Rt(30,new Nt(24,15),new Nt(46,16))),new Pt(38,Int32Array.from([6,32,58,84,110,136,162]),new Rt(30,new Nt(4,122),new Nt(18,123)),new Rt(28,new Nt(13,46),new Nt(32,47)),new Rt(30,new Nt(48,24),new Nt(14,25)),new Rt(30,new Nt(42,15),new Nt(32,16))),new Pt(39,Int32Array.from([6,26,54,82,110,138,166]),new Rt(30,new Nt(20,117),new Nt(4,118)),new Rt(28,new Nt(40,47),new Nt(7,48)),new Rt(30,new Nt(43,24),new Nt(22,25)),new Rt(30,new Nt(10,15),new Nt(67,16))),new Pt(40,Int32Array.from([6,30,58,86,114,142,170]),new Rt(30,new Nt(19,118),new Nt(6,119)),new Rt(28,new Nt(18,47),new Nt(31,48)),new Rt(30,new Nt(34,24),new Nt(34,25)),new Rt(30,new Nt(20,15),new Nt(61,16)))],(te=Z||(Z={}))[te.DATA_MASK_000=0]="DATA_MASK_000",te[te.DATA_MASK_001=1]="DATA_MASK_001",te[te.DATA_MASK_010=2]="DATA_MASK_010",te[te.DATA_MASK_011=3]="DATA_MASK_011",te[te.DATA_MASK_100=4]="DATA_MASK_100",te[te.DATA_MASK_101=5]="DATA_MASK_101",te[te.DATA_MASK_110=6]="DATA_MASK_110",te[te.DATA_MASK_111=7]="DATA_MASK_111";class Ot{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let r=0;r<t;r++)for(let n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)}}Ot.values=new Map([[Z.DATA_MASK_000,new Ot(Z.DATA_MASK_000,((e,t)=>!(e+t&1)))],[Z.DATA_MASK_001,new Ot(Z.DATA_MASK_001,((e,t)=>!(1&e)))],[Z.DATA_MASK_010,new Ot(Z.DATA_MASK_010,((e,t)=>t%3==0))],[Z.DATA_MASK_011,new Ot(Z.DATA_MASK_011,((e,t)=>(e+t)%3==0))],[Z.DATA_MASK_100,new Ot(Z.DATA_MASK_100,((e,t)=>!(Math.floor(e/2)+Math.floor(t/3)&1)))],[Z.DATA_MASK_101,new Ot(Z.DATA_MASK_101,((e,t)=>e*t%6==0))],[Z.DATA_MASK_110,new Ot(Z.DATA_MASK_110,((e,t)=>e*t%6<3))],[Z.DATA_MASK_111,new Ot(Z.DATA_MASK_111,((e,t)=>!(e+t+e*t%3&1)))]]);class Mt{constructor(e){const t=e.getHeight();if(t<21||1!=(3&t))throw new S;this.bitMatrix=e}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let e=0;for(let i=0;i<6;i++)e=this.copyBit(i,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let i=5;i>=0;i--)e=this.copyBit(8,i,e);const t=this.bitMatrix.getHeight();let r=0;const n=t-7;for(let i=t-1;i>=n;i--)r=this.copyBit(8,i,r);for(let i=t-8;i<t;i++)r=this.copyBit(i,8,r);if(this.parsedFormatInfo=Dt.decodeFormatInformation(e,r),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new S}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return Pt.getVersionForNumber(t);let r=0;const n=e-11;for(let s=5;s>=0;s--)for(let t=e-9;t>=n;t--)r=this.copyBit(t,s,r);let i=Pt.decodeVersionInformation(r);if(null!==i&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;r=0;for(let s=5;s>=0;s--)for(let t=e-9;t>=n;t--)r=this.copyBit(s,t,r);if(i=Pt.decodeVersionInformation(r),null!==i&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;throw new S}copyBit(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),r=Ot.values.get(e.getDataMask()),n=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,n);const i=t.buildFunctionPattern();let s=!0;const a=new Uint8Array(t.getTotalCodewords());let o=0,l=0,c=0;for(let d=n-1;d>0;d-=2){6===d&&d--;for(let e=0;e<n;e++){const t=s?n-1-e:e;for(let e=0;e<2;e++)i.get(d-e,t)||(c++,l<<=1,this.bitMatrix.get(d-e,t)&&(l|=1),8===c&&(a[o++]=l,c=0,l=0))}s=!s}if(o!==t.getTotalCodewords())throw new S;return a}remask(){if(null===this.parsedFormatInfo)return;const e=Ot.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,r=e.getWidth();t<r;t++)for(let n=t+1,i=e.getHeight();n<i;n++)e.get(t,n)!==e.get(n,t)&&(e.flip(n,t),e.flip(t,n))}}class Ft{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,r){if(e.length!==t.getTotalCodewords())throw new u;const n=t.getECBlocksForLevel(r);let i=0;const s=n.getECBlocks();for(const u of s)i+=u.getCount();const a=new Array(i);let o=0;for(const u of s)for(let e=0;e<u.getCount();e++){const e=u.getDataCodewords(),t=n.getECCodewordsPerBlock()+e;a[o++]=new Ft(e,new Uint8Array(t))}const l=a[0].codewords.length;let c=a.length-1;for(;c>=0&&a[c].codewords.length!==l;)c--;c++;const d=l-n.getECCodewordsPerBlock();let h=0;for(let u=0;u<d;u++)for(let t=0;t<o;t++)a[t].codewords[u]=e[h++];for(let u=c;u<o;u++)a[u].codewords[d]=e[h++];const p=a[0].codewords.length;for(let u=d;u<p;u++)for(let t=0;t<o;t++){const r=t<c?u:u+1;a[t].codewords[r]=e[h++]}return a}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}(re=Y||(Y={}))[re.TERMINATOR=0]="TERMINATOR",re[re.NUMERIC=1]="NUMERIC",re[re.ALPHANUMERIC=2]="ALPHANUMERIC",re[re.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",re[re.BYTE=4]="BYTE",re[re.ECI=5]="ECI",re[re.KANJI=6]="KANJI",re[re.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",re[re.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",re[re.HANZI=9]="HANZI";class Bt{constructor(e,t,r,n){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=r,this.bits=n,Bt.FOR_BITS.set(n,this),Bt.FOR_VALUE.set(e,this)}static forBits(e){const t=Bt.FOR_BITS.get(e);if(void 0===t)throw new u;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let r;return r=t<=9?0:t<=26?1:2,this.characterCountBitsForVersions[r]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof Bt))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}Bt.FOR_BITS=new Map,Bt.FOR_VALUE=new Map,Bt.TERMINATOR=new Bt(Y.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Bt.NUMERIC=new Bt(Y.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Bt.ALPHANUMERIC=new Bt(Y.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Bt.STRUCTURED_APPEND=new Bt(Y.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Bt.BYTE=new Bt(Y.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Bt.ECI=new Bt(Y.ECI,"ECI",Int32Array.from([0,0,0]),7),Bt.KANJI=new Bt(Y.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Bt.FNC1_FIRST_POSITION=new Bt(Y.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Bt.FNC1_SECOND_POSITION=new Bt(Y.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Bt.HANZI=new Bt(Y.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Lt{static decode(e,t,r,n){const i=new _t(e);let s=new T;const a=new Array;let o=-1,l=-1;try{let e,r=null,c=!1;do{if(i.available()<4)e=Bt.TERMINATOR;else{const t=i.readBits(4);e=Bt.forBits(t)}switch(e){case Bt.TERMINATOR:break;case Bt.FNC1_FIRST_POSITION:case Bt.FNC1_SECOND_POSITION:c=!0;break;case Bt.STRUCTURED_APPEND:if(i.available()<16)throw new S;o=i.readBits(8),l=i.readBits(8);break;case Bt.ECI:const d=Lt.parseECIValue(i);if(r=E.getCharacterSetECIByValue(d),null===r)throw new S;break;case Bt.HANZI:const u=i.readBits(4),h=i.readBits(e.getCharacterCountBits(t));u===Lt.GB2312_SUBSET&&Lt.decodeHanziSegment(i,s,h);break;default:const p=i.readBits(e.getCharacterCountBits(t));switch(e){case Bt.NUMERIC:Lt.decodeNumericSegment(i,s,p);break;case Bt.ALPHANUMERIC:Lt.decodeAlphanumericSegment(i,s,p,c);break;case Bt.BYTE:Lt.decodeByteSegment(i,s,p,r,a,n);break;case Bt.KANJI:Lt.decodeKanjiSegment(i,s,p);break;default:throw new S}}}while(e!==Bt.TERMINATOR)}catch(c){throw new S}return new ie(e,s.toString(),0===a.length?null:a,null===r?null:r.toString(),o,l)}static decodeHanziSegment(e,t,r){if(13*r>e.available())throw new S;const n=new Uint8Array(2*r);let i=0;for(;r>0;){const t=e.readBits(13);let s=t/96<<8&4294967295|t%96;s+=s<959?41377:42657,n[i]=s>>8&255,n[i+1]=255&s,i+=2,r--}try{t.append(I.decode(n,j.GB2312))}catch(s){throw new S(s)}}static decodeKanjiSegment(e,t,r){if(13*r>e.available())throw new S;const n=new Uint8Array(2*r);let i=0;for(;r>0;){const t=e.readBits(13);let s=t/192<<8&4294967295|t%192;s+=s<7936?33088:49472,n[i]=s>>8,n[i+1]=s,i+=2,r--}try{t.append(I.decode(n,j.SHIFT_JIS))}catch(s){throw new S(s)}}static decodeByteSegment(e,t,r,n,i,s){if(8*r>e.available())throw new S;const a=new Uint8Array(r);for(let c=0;c<r;c++)a[c]=e.readBits(8);let o;o=null===n?j.guessEncoding(a,s):n.getName();try{t.append(I.decode(a,o))}catch(l){throw new S(l)}i.push(a)}static toAlphaNumericChar(e){if(e>=Lt.ALPHANUMERIC_CHARS.length)throw new S;return Lt.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,r,n){const i=t.length();for(;r>1;){if(e.available()<11)throw new S;const n=e.readBits(11);t.append(Lt.toAlphaNumericChar(Math.floor(n/45))),t.append(Lt.toAlphaNumericChar(n%45)),r-=2}if(1===r){if(e.available()<6)throw new S;t.append(Lt.toAlphaNumericChar(e.readBits(6)))}if(n)for(let s=i;s<t.length();s++)"%"===t.charAt(s)&&(s<t.length()-1&&"%"===t.charAt(s+1)?t.deleteCharAt(s+1):t.setCharAt(s,String.fromCharCode(29)))}static decodeNumericSegment(e,t,r){for(;r>=3;){if(e.available()<10)throw new S;const n=e.readBits(10);if(n>=1e3)throw new S;t.append(Lt.toAlphaNumericChar(Math.floor(n/100))),t.append(Lt.toAlphaNumericChar(Math.floor(n/10)%10)),t.append(Lt.toAlphaNumericChar(n%10)),r-=3}if(2===r){if(e.available()<7)throw new S;const r=e.readBits(7);if(r>=100)throw new S;t.append(Lt.toAlphaNumericChar(Math.floor(r/10))),t.append(Lt.toAlphaNumericChar(r%10))}else if(1===r){if(e.available()<4)throw new S;const r=e.readBits(4);if(r>=10)throw new S;t.append(Lt.toAlphaNumericChar(r))}}static parseECIValue(e){const t=e.readBits(8);if(!(128&t))return 127&t;if(128==(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192==(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new S}}Lt.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Lt.GB2312_SUBSET=1;class zt{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||null===e||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class Ut{constructor(){this.rsDecoder=new ue(le.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(D.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const r=new Mt(e);let n=null;try{return this.decodeBitMatrixParser(r,t)}catch(i){n=i}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();const e=this.decodeBitMatrixParser(r,t);return e.setOther(new zt(!0)),e}catch(i){if(null!==n)throw n;throw i}}decodeBitMatrixParser(e,t){const r=e.readVersion(),n=e.readFormatInformation().getErrorCorrectionLevel(),i=e.readCodewords(),s=Ft.getDataBlocks(i,r,n);let a=0;for(const c of s)a+=c.getNumDataCodewords();const o=new Uint8Array(a);let l=0;for(const c of s){const e=c.getCodewords(),t=c.getNumDataCodewords();this.correctErrors(e,t);for(let r=0;r<t;r++)o[l++]=e[r]}return Lt.decode(o,r,n,t)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(n){throw new p}for(let i=0;i<t;i++)e[i]=r[i]}}class Wt extends fe{constructor(e,t,r){super(e,t),this.estimatedModuleSize=r}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const n=(this.getX()+t)/2,i=(this.getY()+e)/2,s=(this.estimatedModuleSize+r)/2;return new Wt(n,i,s)}}class Vt{constructor(e,t,r,n,i,s,a){this.image=e,this.startX=t,this.startY=r,this.width=n,this.height=i,this.moduleSize=s,this.resultPointCallback=a,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,r=e+this.width,n=this.startY+t/2,i=new Int32Array(3),s=this.image;for(let a=0;a<t;a++){const t=n+(1&a?-Math.floor((a+1)/2):Math.floor((a+1)/2));i[0]=0,i[1]=0,i[2]=0;let o=e;for(;o<r&&!s.get(o,t);)o++;let l=0;for(;o<r;){if(s.get(o,t))if(1===l)i[1]++;else if(2===l){if(this.foundPatternCross(i)){const e=this.handlePossibleCenter(i,t,o);if(null!==e)return e}i[0]=i[2],i[1]=1,i[2]=0,l=1}else i[++l]++;else 1===l&&l++,i[l]++;o++}if(this.foundPatternCross(i)){const e=this.handlePossibleCenter(i,t,r);if(null!==e)return e}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new R}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,r=t/2;for(let n=0;n<3;n++)if(Math.abs(t-e[n])>=r)return!1;return!0}crossCheckVertical(e,t,r,n){const i=this.image,s=i.getHeight(),a=this.crossCheckStateCount;a[0]=0,a[1]=0,a[2]=0;let o=e;for(;o>=0&&i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&!i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o)&&a[1]<=r;)a[1]++,o++;if(o===s||a[1]>r)return NaN;for(;o<s&&!i.get(t,o)&&a[2]<=r;)a[2]++,o++;if(a[2]>r)return NaN;const l=a[0]+a[1]+a[2];return 5*Math.abs(l-n)>=2*n?NaN:this.foundPatternCross(a)?Vt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r){const n=e[0]+e[1]+e[2],i=Vt.centerFromEnd(e,r),s=this.crossCheckVertical(t,i,2*e[1],n);if(!isNaN(s)){const t=(e[0]+e[1]+e[2])/3;for(const e of this.possibleCenters)if(e.aboutEquals(t,s,i))return e.combineEstimate(s,i,t);const r=new Wt(i,s,t);this.possibleCenters.push(r),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(r)}return null}}class Ht extends fe{constructor(e,t,r,n){super(e,t),this.estimatedModuleSize=r,this.count=n,void 0===n&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const n=this.count+1,i=(this.count*this.getX()+t)/n,s=(this.count*this.getY()+e)/n,a=(this.count*this.estimatedModuleSize+r)/n;return new Ht(i,s,a,n)}}class Gt{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class qt{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=null!=e&&void 0!==e.get(_.TRY_HARDER),r=null!=e&&void 0!==e.get(_.PURE_BARCODE),n=this.image,i=n.getHeight(),s=n.getWidth();let a=Math.floor(3*i/(4*qt.MAX_MODULES));(a<qt.MIN_SKIP||t)&&(a=qt.MIN_SKIP);let o=!1;const l=new Int32Array(5);for(let d=a-1;d<i&&!o;d+=a){l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0;let e=0;for(let t=0;t<s;t++)if(n.get(t,d))1&~e||e++,l[e]++;else if(1&e)l[e]++;else if(4===e)if(qt.foundPatternCross(l)){if(!0!==this.handlePossibleCenter(l,d,t,r)){l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;continue}if(a=2,!0===this.hasSkipped)o=this.haveMultiplyConfirmedCenters();else{const e=this.findRowSkip();e>l[2]&&(d+=e-l[2]-a,t=s-1)}e=0,l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0}else l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,e=3;else l[++e]++;qt.foundPatternCross(l)&&!0===this.handlePossibleCenter(l,d,s,r)&&(a=l[0],this.hasSkipped&&(o=this.haveMultiplyConfirmedCenters()))}const c=this.selectBestPatterns();return fe.orderBestPatterns(c),new Gt(c)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let i=0;i<5;i++){const r=e[i];if(0===r)return!1;t+=r}if(t<7)return!1;const r=t/7,n=r/2;return Math.abs(r-e[0])<n&&Math.abs(r-e[1])<n&&Math.abs(3*r-e[2])<3*n&&Math.abs(r-e[3])<n&&Math.abs(r-e[4])<n}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,r,n){const i=this.getCrossCheckStateCount();let s=0;const a=this.image;for(;e>=s&&t>=s&&a.get(t-s,e-s);)i[2]++,s++;if(e<s||t<s)return!1;for(;e>=s&&t>=s&&!a.get(t-s,e-s)&&i[1]<=r;)i[1]++,s++;if(e<s||t<s||i[1]>r)return!1;for(;e>=s&&t>=s&&a.get(t-s,e-s)&&i[0]<=r;)i[0]++,s++;if(i[0]>r)return!1;const o=a.getHeight(),l=a.getWidth();for(s=1;e+s<o&&t+s<l&&a.get(t+s,e+s);)i[2]++,s++;if(e+s>=o||t+s>=l)return!1;for(;e+s<o&&t+s<l&&!a.get(t+s,e+s)&&i[3]<r;)i[3]++,s++;if(e+s>=o||t+s>=l||i[3]>=r)return!1;for(;e+s<o&&t+s<l&&a.get(t+s,e+s)&&i[4]<r;)i[4]++,s++;if(i[4]>=r)return!1;const c=i[0]+i[1]+i[2]+i[3]+i[4];return Math.abs(c-n)<2*n&&qt.foundPatternCross(i)}crossCheckVertical(e,t,r,n){const i=this.image,s=i.getHeight(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&i.get(t,o);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(t,o)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(t,o)&&a[4]<r;)a[4]++,o++;if(a[4]>=r)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-n)>=2*n?NaN:qt.foundPatternCross(a)?qt.centerFromEnd(a,o):NaN}crossCheckHorizontal(e,t,r,n){const i=this.image,s=i.getWidth(),a=this.getCrossCheckStateCount();let o=e;for(;o>=0&&i.get(o,t);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(o,t)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(o,t)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(o,t);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(o,t)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(o,t)&&a[4]<r;)a[4]++,o++;if(a[4]>=r)return NaN;const l=a[0]+a[1]+a[2]+a[3]+a[4];return 5*Math.abs(l-n)>=n?NaN:qt.foundPatternCross(a)?qt.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r,n){const i=e[0]+e[1]+e[2]+e[3]+e[4];let s=qt.centerFromEnd(e,r),a=this.crossCheckVertical(t,Math.floor(s),e[2],i);if(!isNaN(a)&&(s=this.crossCheckHorizontal(Math.floor(s),Math.floor(a),e[2],i),!isNaN(s)&&(!n||this.crossCheckDiagonal(Math.floor(a),Math.floor(s),e[2],i)))){const e=i/7;let t=!1;const r=this.possibleCenters;for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i.aboutEquals(e,a,s)){r[n]=i.combineEstimate(a,s,e),t=!0;break}}if(!t){const t=new Ht(s,a,e);r.push(t),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(t)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(const t of this.possibleCenters)if(t.getCount()>=qt.CENTER_QUORUM){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-t.getX())-Math.abs(e.getY()-t.getY()))/2);e=t}return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const r=this.possibleCenters.length;for(const s of this.possibleCenters)s.getCount()>=qt.CENTER_QUORUM&&(e++,t+=s.getEstimatedModuleSize());if(e<3)return!1;const n=t/r;let i=0;for(const s of this.possibleCenters)i+=Math.abs(s.getEstimatedModuleSize()-n);return i<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new R;const t=this.possibleCenters;let r;if(e>3){let n=0,i=0;for(const e of this.possibleCenters){const t=e.getEstimatedModuleSize();n+=t,i+=t*t}r=n/e;let s=Math.sqrt(i/e-r*r);t.sort(((e,t)=>{const n=Math.abs(t.getEstimatedModuleSize()-r),i=Math.abs(e.getEstimatedModuleSize()-r);return n<i?-1:n>i?1:0}));const a=Math.max(.2*r,s);for(let e=0;e<t.length&&t.length>3;e++){const n=t[e];Math.abs(n.getEstimatedModuleSize()-r)>a&&(t.splice(e,1),e--)}}if(t.length>3){let e=0;for(const r of t)e+=r.getEstimatedModuleSize();r=e/t.length,t.sort(((e,t)=>{if(t.getCount()===e.getCount()){const n=Math.abs(t.getEstimatedModuleSize()-r),i=Math.abs(e.getEstimatedModuleSize()-r);return n<i?1:n>i?-1:0}return t.getCount()-e.getCount()})),t.splice(3)}return[t[0],t[1],t[2]]}}qt.CENTER_QUORUM=2,qt.MIN_SKIP=3,qt.MAX_MODULES=57;class Xt{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=null==e?null:e.get(_.NEED_RESULT_POINT_CALLBACK);const t=new qt(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)}processFinderPatternInfo(e){const t=e.getTopLeft(),r=e.getTopRight(),n=e.getBottomLeft(),i=this.calculateModuleSize(t,r,n);if(i<1)throw new R("No pattern found in proccess finder.");const s=Xt.computeDimension(t,r,n,i),a=Pt.getProvisionalVersionForDimension(s),o=a.getDimensionForVersion()-7;let l=null;if(a.getAlignmentPatternCenters().length>0){const e=r.getX()-t.getX()+n.getX(),s=r.getY()-t.getY()+n.getY(),a=1-3/o,c=Math.floor(t.getX()+a*(e-t.getX())),d=Math.floor(t.getY()+a*(s-t.getY()));for(let t=4;t<=16;t<<=1)try{l=this.findAlignmentInRegion(i,c,d,t);break}catch(h){if(!(h instanceof R))throw h}}const c=Xt.createTransform(t,r,n,l,s),d=Xt.sampleGrid(this.image,c,s);let u;return u=null===l?[n,t,r]:[n,t,r,l],new ge(d,u)}static createTransform(e,t,r,n,i){const s=i-3.5;let a,o,l,c;return null!==n?(a=n.getX(),o=n.getY(),l=s-3,c=l):(a=t.getX()-e.getX()+r.getX(),o=t.getY()-e.getY()+r.getY(),l=s,c=s),be.quadrilateralToQuadrilateral(3.5,3.5,s,3.5,l,c,3.5,s,e.getX(),e.getY(),t.getX(),t.getY(),a,o,r.getX(),r.getY())}static sampleGrid(e,t,r){return Ce.getInstance().sampleGridWithTransform(e,r,r,t)}static computeDimension(e,t,r,n){const i=pe.round(fe.distance(e,t)/n),s=pe.round(fe.distance(e,r)/n);let a=Math.floor((i+s)/2)+7;switch(3&a){case 0:a++;break;case 2:a--;break;case 3:throw new R("Dimensions could be not found.")}return a}calculateModuleSize(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2}calculateModuleSizeOneWay(e,t){const r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?n/7:isNaN(n)?r/7:(r+n)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,r,n){let i=this.sizeOfBlackWhiteBlackRun(e,t,r,n),s=1,a=e-(r-e);a<0?(s=e/(e-a),a=0):a>=this.image.getWidth()&&(s=(this.image.getWidth()-1-e)/(a-e),a=this.image.getWidth()-1);let o=Math.floor(t-(n-t)*s);return s=1,o<0?(s=t/(t-o),o=0):o>=this.image.getHeight()&&(s=(this.image.getHeight()-1-t)/(o-t),o=this.image.getHeight()-1),a=Math.floor(e+(a-e)*s),i+=this.sizeOfBlackWhiteBlackRun(e,t,a,o),i-1}sizeOfBlackWhiteBlackRun(e,t,r,n){const i=Math.abs(n-t)>Math.abs(r-e);if(i){let i=e;e=t,t=i,i=r,r=n,n=i}const s=Math.abs(r-e),a=Math.abs(n-t);let o=-s/2;const l=e<r?1:-1,c=t<n?1:-1;let d=0;const u=r+l;for(let h=e,p=t;h!==u;h+=l){const r=i?p:h,l=i?h:p;if(1===d===this.image.get(r,l)){if(2===d)return pe.distance(h,p,e,t);d++}if(o+=a,o>0){if(p===n)break;p+=c,o-=s}}return 2===d?pe.distance(r+l,n,e,t):NaN}findAlignmentInRegion(e,t,r,n){const i=Math.floor(n*e),s=Math.max(0,t-i),a=Math.min(this.image.getWidth()-1,t+i);if(a-s<3*e)throw new R("Alignment top exceeds estimated module size.");const o=Math.max(0,r-i),l=Math.min(this.image.getHeight()-1,r+i);if(l-o<3*e)throw new R("Alignment bottom exceeds estimated module size.");return new Vt(this.image,s,o,a-s,l-o,e,this.resultPointCallback).find()}}class $t{constructor(){this.decoder=new Ut}getDecoder(){return this.decoder}decode(e,t){let r,n;if(null!=t&&void 0!==t.get(_.PURE_BARCODE)){const i=$t.extractPureBits(e.getBlackMatrix());r=this.decoder.decodeBitMatrix(i,t),n=$t.NO_POINTS}else{const i=new Xt(e.getBlackMatrix()).detect(t);r=this.decoder.decodeBitMatrix(i.getBits(),t),n=i.getPoints()}r.getOther()instanceof zt&&r.getOther().applyMirroredCorrection(n);const i=new W(r.getText(),r.getRawBytes(),void 0,n,G.QR_CODE,void 0),s=r.getByteSegments();null!==s&&i.putMetadata(ne.BYTE_SEGMENTS,s);const a=r.getECLevel();return null!==a&&i.putMetadata(ne.ERROR_CORRECTION_LEVEL,a),r.hasStructuredAppend()&&(i.putMetadata(ne.STRUCTURED_APPEND_SEQUENCE,r.getStructuredAppendSequenceNumber()),i.putMetadata(ne.STRUCTURED_APPEND_PARITY,r.getStructuredAppendParity())),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null===t||null===r)throw new R;const n=this.moduleSize(t,e);let i=t[1],s=r[1],a=t[0],o=r[0];if(a>=o||i>=s)throw new R;if(s-i!==o-a&&(o=a+(s-i),o>=e.getWidth()))throw new R;const l=Math.round((o-a+1)/n),c=Math.round((s-i+1)/n);if(l<=0||c<=0)throw new R;if(c!==l)throw new R;const d=Math.floor(n/2);i+=d,a+=d;const u=a+Math.floor((l-1)*n)-o;if(u>0){if(u>d)throw new R;a-=u}const h=i+Math.floor((c-1)*n)-s;if(h>0){if(h>d)throw new R;i-=h}const p=new D(l,c);for(let m=0;m<c;m++){const t=i+Math.floor(m*n);for(let r=0;r<l;r++)e.get(a+Math.floor(r*n),t)&&p.set(r,m)}return p}static moduleSize(e,t){const r=t.getHeight(),n=t.getWidth();let i=e[0],s=e[1],a=!0,o=0;for(;i<n&&s<r;){if(a!==t.get(i,s)){if(5===++o)break;a=!a}i++,s++}if(i===n||s===r)throw new R;return(i-e[0])/7}}$t.NO_POINTS=new Array;class Zt{PDF417Common(){}static getBitCountSum(e){return pe.sum(e)}static toIntArray(e){if(null==e||!e.length)return Zt.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let r=0;for(const n of e)t[r++]=n;return t}static getCodeword(e){const t=y.binarySearch(Zt.SYMBOL_TABLE,262143&e);return t<0?-1:(Zt.CODEWORD_TABLE[t]-1)%Zt.NUMBER_OF_CODEWORDS}}Zt.NUMBER_OF_CODEWORDS=929,Zt.MAX_CODEWORDS_IN_BARCODE=Zt.NUMBER_OF_CODEWORDS-1,Zt.MIN_ROWS_IN_BARCODE=3,Zt.MAX_ROWS_IN_BARCODE=90,Zt.MODULES_IN_CODEWORD=17,Zt.MODULES_IN_STOP_PATTERN=18,Zt.BARS_IN_MODULE=8,Zt.EMPTY_INT_ARRAY=new Int32Array([]),Zt.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Zt.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Yt{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class Qt{static detectMultiple(e,t,r){let n=e.getBlackMatrix(),i=Qt.detect(r,n);return i.length||(n=n.clone(),n.rotate180(),i=Qt.detect(r,n)),new Yt(n,i)}static detect(e,t){const r=new Array;let n=0,i=0,s=!1;for(;n<t.getHeight();){const a=Qt.findVertices(t,n,i);if(null!=a[0]||null!=a[3]){if(s=!0,r.push(a),!e)break;null!=a[2]?(i=Math.trunc(a[2].getX()),n=Math.trunc(a[2].getY())):(i=Math.trunc(a[4].getX()),n=Math.trunc(a[4].getY()))}else{if(!s)break;s=!1,i=0;for(const e of r)null!=e[1]&&(n=Math.trunc(Math.max(n,e[1].getY()))),null!=e[3]&&(n=Math.max(n,Math.trunc(e[3].getY())));n+=Qt.ROW_STEP}}return r}static findVertices(e,t,r){const n=e.getHeight(),i=e.getWidth(),s=new Array(8);return Qt.copyToResult(s,Qt.findRowsWithPattern(e,n,i,t,r,Qt.START_PATTERN),Qt.INDEXES_START_PATTERN),null!=s[4]&&(r=Math.trunc(s[4].getX()),t=Math.trunc(s[4].getY())),Qt.copyToResult(s,Qt.findRowsWithPattern(e,n,i,t,r,Qt.STOP_PATTERN),Qt.INDEXES_STOP_PATTERN),s}static copyToResult(e,t,r){for(let n=0;n<r.length;n++)e[r[n]]=t[n]}static findRowsWithPattern(e,t,r,n,i,s){const a=new Array(4);let o=!1;const l=new Int32Array(s.length);for(;n<t;n+=Qt.ROW_STEP){let t=Qt.findGuardPattern(e,i,n,r,!1,s,l);if(null!=t){for(;n>0;){const a=Qt.findGuardPattern(e,i,--n,r,!1,s,l);if(null==a){n++;break}t=a}a[0]=new fe(t[0],n),a[1]=new fe(t[1],n),o=!0;break}}let c=n+1;if(o){let n=0,i=Int32Array.from([Math.trunc(a[0].getX()),Math.trunc(a[1].getX())]);for(;c<t;c++){const t=Qt.findGuardPattern(e,i[0],c,r,!1,s,l);if(null!=t&&Math.abs(i[0]-t[0])<Qt.MAX_PATTERN_DRIFT&&Math.abs(i[1]-t[1])<Qt.MAX_PATTERN_DRIFT)i=t,n=0;else{if(n>Qt.SKIPPED_ROW_COUNT_MAX)break;n++}}c-=n+1,a[2]=new fe(i[0],c),a[3]=new fe(i[1],c)}return c-n<Qt.BARCODE_MIN_HEIGHT&&y.fill(a,null),a}static findGuardPattern(e,t,r,n,i,s,a){y.fillWithin(a,0,a.length,0);let o=t,l=0;for(;e.get(o,r)&&o>0&&l++<Qt.MAX_PIXEL_DRIFT;)o--;let c=o,d=0,u=s.length;for(let h=i;c<n;c++)if(e.get(c,r)!==h)a[d]++;else{if(d===u-1){if(Qt.patternMatchVariance(a,s,Qt.MAX_INDIVIDUAL_VARIANCE)<Qt.MAX_AVG_VARIANCE)return new Int32Array([o,c]);o+=a[0]+a[1],f.arraycopy(a,2,a,0,d-1),a[d-1]=0,a[d]=0,d--}else d++;a[d]=1,h=!h}return d===u-1&&Qt.patternMatchVariance(a,s,Qt.MAX_INDIVIDUAL_VARIANCE)<Qt.MAX_AVG_VARIANCE?new Int32Array([o,c-1]):null}static patternMatchVariance(e,t,r){let n=e.length,i=0,s=0;for(let l=0;l<n;l++)i+=e[l],s+=t[l];if(i<s)return 1/0;let a=i/s;r*=a;let o=0;for(let l=0;l<n;l++){let n=e[l],i=t[l]*a,s=n>i?n-i:i-n;if(s>r)return 1/0;o+=s}return o/i}}Qt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Qt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Qt.MAX_AVG_VARIANCE=.42,Qt.MAX_INDIVIDUAL_VARIANCE=.8,Qt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Qt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Qt.MAX_PIXEL_DRIFT=3,Qt.MAX_PATTERN_DRIFT=5,Qt.SKIPPED_ROW_COUNT_MAX=25,Qt.ROW_STEP=5,Qt.BARCODE_MIN_HEIGHT=10;class Kt{constructor(e,t){if(0===t.length)throw new u;this.field=e;let r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-e),f.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);if(1===e){let e=0;for(let t of this.coefficients)e=this.field.add(e,t);return e}let t=this.coefficients[0],r=this.coefficients.length;for(let n=1;n<r;n++)t=this.field.add(this.field.multiply(e,t),this.coefficients[n]);return t}add(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){let e=t;t=r,r=e}let n=new Int32Array(r.length),i=r.length-t.length;f.arraycopy(r,0,n,0,i);for(let s=i;s<r.length;s++)n[s]=this.field.add(t[s-i],r[s]);return new Kt(this.field,n)}subtract(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof Kt?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new u("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new Kt(this.field,new Int32Array([0]));let t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1);for(let a=0;a<r;a++){let e=t[a];for(let t=0;t<i;t++)s[a+t]=this.field.add(s[a+t],this.field.multiply(e,n[t]))}return new Kt(this.field,s)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=this.field.subtract(0,this.coefficients[r]);return new Kt(this.field,t)}multiplyScalar(e){if(0===e)return new Kt(this.field,new Int32Array([0]));if(1===e)return this;let t=this.coefficients.length,r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=this.field.multiply(this.coefficients[n],e);return new Kt(this.field,r)}multiplyByMonomial(e,t){if(e<0)throw new u;if(0===t)return new Kt(this.field,new Int32Array([0]));let r=this.coefficients.length,n=new Int32Array(r+e);for(let i=0;i<r;i++)n[i]=this.field.multiply(this.coefficients[i],t);return new Kt(this.field,n)}toString(){let e=new T;for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);0!==r&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),0!==t&&1===r||e.append(r),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class Jt{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(0===e)throw new u;return this.logTable[e]}inverse(e){if(0===e)throw new oe;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class er extends Jt{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let r=1;for(let n=0;n<e;n++)this.expTable[n]=r,r=r*t%e;for(let n=0;n<e-1;n++)this.logTable[this.expTable[n]]=n;this.zero=new Kt(this,new Int32Array([0])),this.one=new Kt(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new u;if(0===t)return this.zero;let r=new Int32Array(e+1);return r[0]=t,new Kt(this,r)}}er.PDF417_GF=new er(Zt.NUMBER_OF_CODEWORDS,3);class tr{constructor(){this.field=er.PDF417_GF}decode(e,t,r){let n=new Kt(this.field,e),i=new Int32Array(t),s=!1;for(let p=t;p>0;p--){let e=n.evaluateAt(this.field.exp(p));i[t-p]=e,0!==e&&(s=!0)}if(!s)return 0;let a=this.field.getOne();if(null!=r)for(const p of r){let t=this.field.exp(e.length-1-p),r=new Kt(this.field,new Int32Array([this.field.subtract(0,t),1]));a=a.multiply(r)}let o=new Kt(this.field,i),l=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),o,t),c=l[0],d=l[1],u=this.findErrorLocations(c),h=this.findErrorMagnitudes(d,c,u);for(let m=0;m<u.length;m++){let t=e.length-1-this.field.log(u[m]);if(t<0)throw p.getChecksumInstance();e[t]=this.field.subtract(e[t],h[m])}return u.length}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){let r=e;e=t,t=r}let n=e,i=t,s=this.field.getZero(),a=this.field.getOne();for(;i.getDegree()>=Math.round(r/2);){let e=n,t=s;if(n=i,s=a,n.isZero())throw p.getChecksumInstance();i=e;let r=this.field.getZero(),o=n.getCoefficient(n.getDegree()),l=this.field.inverse(o);for(;i.getDegree()>=n.getDegree()&&!i.isZero();){let e=i.getDegree()-n.getDegree(),t=this.field.multiply(i.getCoefficient(i.getDegree()),l);r=r.add(this.field.buildMonomial(e,t)),i=i.subtract(n.multiplyByMonomial(e,t))}a=r.multiply(s).subtract(t).negative()}let o=a.getCoefficient(0);if(0===o)throw p.getChecksumInstance();let l=this.field.inverse(o);return[a.multiply(l),i.multiply(l)]}findErrorLocations(e){let t=e.getDegree(),r=new Int32Array(t),n=0;for(let i=1;i<this.field.getSize()&&n<t;i++)0===e.evaluateAt(i)&&(r[n]=this.field.inverse(i),n++);if(n!==t)throw p.getChecksumInstance();return r}findErrorMagnitudes(e,t,r){let n=t.getDegree(),i=new Int32Array(n);for(let l=1;l<=n;l++)i[n-l]=this.field.multiply(l,t.getCoefficient(l));let s=new Kt(this.field,i),a=r.length,o=new Int32Array(a);for(let l=0;l<a;l++){let t=this.field.inverse(r[l]),n=this.field.subtract(0,e.evaluateAt(t)),i=this.field.inverse(s.evaluateAt(t));o[l]=this.field.multiply(n,i)}return o}}class rr{constructor(e,t,r,n,i){e instanceof rr?this.constructor_2(e):this.constructor_1(e,t,r,n,i)}constructor_1(e,t,r,n,i){const s=null==t||null==r,a=null==n||null==i;if(s&&a)throw new R;s?(t=new fe(0,n.getY()),r=new fe(0,i.getY())):a&&(n=new fe(e.getWidth()-1,t.getY()),i=new fe(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=n,this.bottomRight=i,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(n.getX(),i.getX())),this.minY=Math.trunc(Math.min(t.getY(),n.getY())),this.maxY=Math.trunc(Math.max(r.getY(),i.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return null==e?t:null==t?e:new rr(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,r){let n=this.topLeft,i=this.bottomLeft,s=this.topRight,a=this.bottomRight;if(e>0){let t=r?this.topLeft:this.topRight,i=Math.trunc(t.getY()-e);i<0&&(i=0);let a=new fe(t.getX(),i);r?n=a:s=a}if(t>0){let e=r?this.bottomLeft:this.bottomRight,n=Math.trunc(e.getY()+t);n>=this.image.getHeight()&&(n=this.image.getHeight()-1);let s=new fe(e.getX(),n);r?i=s:a=s}return new rr(this.image,n,i,s,a)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class nr{constructor(e,t,r,n){this.columnCount=e,this.errorCorrectionLevel=n,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class ir{constructor(){this.buffer=""}static form(e,t){let r=-1;function n(e,n,i,s,a,o){if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let l,c=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(c||16);break;case"d":l=parseFloat(parseInt(t[r],c||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(c);let d=parseInt(i),u=i&&i[0]+""=="0"?"0":" ";for(;l.length<d;)l=void 0!==n?l+u:u+l;return l}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(i,n)}format(e,...t){this.buffer+=ir.form(e,t)}toString(){return this.buffer}}class sr{constructor(e){this.boundingBox=new rr(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(null!=t)return t;for(let r=1;r<sr.MAX_NEARBY_DISTANCE;r++){let n=this.imageRowToCodewordIndex(e)-r;if(n>=0&&(t=this.codewords[n],null!=t))return t;if(n=this.imageRowToCodewordIndex(e)+r,n<this.codewords.length&&(t=this.codewords[n],null!=t))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new ir;let t=0;for(const r of this.codewords)null!=r?e.format("%3d: %3d|%3d%n",t++,r.getRowNumber(),r.getValue()):e.format("%3d:    |   %n",t++);return e.toString()}}sr.MAX_NEARBY_DISTANCE=5;class ar{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[r,n]of this.values.entries()){const i={getKey:()=>r,getValue:()=>n};i.getValue()>e?(e=i.getValue(),t=[],t.push(i.getKey())):i.getValue()===e&&t.push(i.getKey())}return Zt.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class or extends sr{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())null!=e&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let r=this.getBoundingBox(),n=this._isLeft?r.getTopLeft():r.getTopRight(),i=this._isLeft?r.getBottomLeft():r.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.imageRowToCodewordIndex(Math.trunc(i.getY())),o=-1,l=1,c=0;for(let d=s;d<a;d++){if(null==t[d])continue;let r=t[d],n=r.getRowNumber()-o;if(0===n)c++;else if(1===n)l=Math.max(l,c),c=1,o=r.getRowNumber();else if(n<0||r.getRowNumber()>=e.getRowCount()||n>d)t[d]=null;else{let e;e=l>2?(l-2)*n:n;let i=e>=d;for(let r=1;r<=e&&!i;r++)i=null!=t[d-r];i?t[d]=null:(o=r.getRowNumber(),c=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(null==e)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let r of this.getCodewords())if(null!=r){let e=r.getRowNumber();if(e>=t.length)continue;t[e]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),r=this._isLeft?t.getTopLeft():t.getTopRight(),n=this._isLeft?t.getBottomLeft():t.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(r.getY())),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.getCodewords(),o=-1;for(let l=i;l<s;l++){if(null==a[l])continue;let t=a[l];t.setRowNumberAsRowIndicatorColumn();let r=t.getRowNumber()-o;0===r||(1===r?o=t.getRowNumber():t.getRowNumber()>=e.getRowCount()?a[l]=null:o=t.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new ar,r=new ar,n=new ar,i=new ar;for(let a of e){if(null==a)continue;a.setRowNumberAsRowIndicatorColumn();let e=a.getValue()%30,s=a.getRowNumber();switch(this._isLeft||(s+=2),s%3){case 0:r.setValue(3*e+1);break;case 1:i.setValue(e/3),n.setValue(e%3);break;case 2:t.setValue(e+1)}}if(0===t.getValue().length||0===r.getValue().length||0===n.getValue().length||0===i.getValue().length||t.getValue()[0]<1||r.getValue()[0]+n.getValue()[0]<Zt.MIN_ROWS_IN_BARCODE||r.getValue()[0]+n.getValue()[0]>Zt.MAX_ROWS_IN_BARCODE)return null;let s=new nr(t.getValue()[0],r.getValue()[0],n.getValue()[0],i.getValue()[0]);return this.removeIncorrectCodewords(e,s),s}removeIncorrectCodewords(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(null==e[r])continue;let i=n.getValue()%30,s=n.getRowNumber();if(s>t.getRowCount())e[r]=null;else switch(this._isLeft||(s+=2),s%3){case 0:3*i+1!==t.getRowCountUpperPart()&&(e[r]=null);break;case 1:Math.trunc(i/3)===t.getErrorCorrectionLevel()&&i%3===t.getRowCountLowerPart()||(e[r]=null);break;case 2:i+1!==t.getColumnCount()&&(e[r]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class lr{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e,t=Zt.MAX_CODEWORDS_IN_BARCODE;do{e=t,t=this.adjustRowNumbersAndGetCount()}while(t>0&&t<e);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(0===e)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let e=this.detectionResultColumns[t].getCodewords();for(let r=0;r<e.length;r++)null!=e[r]&&(e[r].hasValidRowNumber()||this.adjustRowNumbers(t,r,e))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<e.length;r++)if(null!=e[r]&&null!=t[r]&&e[r].getRowNumber()===t[r].getRowNumber())for(let t=1;t<=this.barcodeColumnCount;t++){let n=this.detectionResultColumns[t].getCodewords()[r];null!=n&&(n.setRowNumber(e[r].getRowNumber()),n.hasValidRowNumber()||(this.detectionResultColumns[t].getCodewords()[r]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=this.barcodeColumnCount+1;t>0&&i<this.ADJUST_ROW_NUMBER_SKIP;t--){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=lr.adjustRowNumberIfValid(n,i,s),s.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=1;t<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;t++){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=lr.adjustRowNumberIfValid(n,i,s),s.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,r){return null==r||r.hasValidRowNumber()||(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,r){if(!this.detectionResultColumns[e-1])return;let n=r[t],i=this.detectionResultColumns[e-1].getCodewords(),s=i;null!=this.detectionResultColumns[e+1]&&(s=this.detectionResultColumns[e+1].getCodewords());let a=new Array(14);a[2]=i[t],a[3]=s[t],t>0&&(a[0]=r[t-1],a[4]=i[t-1],a[5]=s[t-1]),t>1&&(a[8]=r[t-2],a[10]=i[t-2],a[11]=s[t-2]),t<r.length-1&&(a[1]=r[t+1],a[6]=i[t+1],a[7]=s[t+1]),t<r.length-2&&(a[9]=r[t+2],a[12]=i[t+2],a[13]=s[t+2]);for(let o of a)if(lr.adjustRowNumber(n,o))return}static adjustRowNumber(e,t){return!(null==t||!t.hasValidRowNumber()||t.getBucket()!==e.getBucket()||(e.setRowNumber(t.getRowNumber()),0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new ir;for(let r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(let e=0;e<this.barcodeColumnCount+2;e++){if(null==this.detectionResultColumns[e]){t.format("    |   ");continue}let n=this.detectionResultColumns[e].getCodewords()[r];null!=n?t.format(" %3d|%3d",n.getRowNumber(),n.getValue()):t.format("    |   ")}t.format("%n")}return t.toString()}}class cr{constructor(e,t,r,n){this.rowNumber=cr.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(r),this.value=Math.trunc(n)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==cr.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}cr.BARCODE_ROW_UNKNOWN=-1;class dr{static initialize(){for(let e=0;e<Zt.SYMBOL_TABLE.length;e++){let t=Zt.SYMBOL_TABLE[e],r=1&t;for(let n=0;n<Zt.BARS_IN_MODULE;n++){let i=0;for(;(1&t)===r;)i+=1,t>>=1;r=1&t,dr.RATIOS_TABLE[e]||(dr.RATIOS_TABLE[e]=new Array(Zt.BARS_IN_MODULE)),dr.RATIOS_TABLE[e][Zt.BARS_IN_MODULE-n-1]=Math.fround(i/Zt.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=dr.getDecodedCodewordValue(dr.sampleBitCounts(e));return-1!==t?t:dr.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=pe.sum(e),r=new Int32Array(Zt.BARS_IN_MODULE),n=0,i=0;for(let s=0;s<Zt.MODULES_IN_CODEWORD;s++){let a=t/(2*Zt.MODULES_IN_CODEWORD)+s*t/Zt.MODULES_IN_CODEWORD;i+e[n]<=a&&(i+=e[n],n++),r[n]++}return r}static getDecodedCodewordValue(e){let t=dr.getBitValue(e);return-1===Zt.getCodeword(t)?-1:t}static getBitValue(e){let t=0;for(let r=0;r<e.length;r++)for(let n=0;n<e[r];n++)t=t<<1|(r%2==0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=pe.sum(e),r=new Array(Zt.BARS_IN_MODULE);if(t>1)for(let s=0;s<r.length;s++)r[s]=Math.fround(e[s]/t);let n=me.MAX_VALUE,i=-1;this.bSymbolTableReady||dr.initialize();for(let s=0;s<dr.RATIOS_TABLE.length;s++){let e=0,t=dr.RATIOS_TABLE[s];for(let i=0;i<Zt.BARS_IN_MODULE;i++){let s=Math.fround(t[i]-r[i]);if(e+=Math.fround(s*s),e>=n)break}e<n&&(n=e,i=Zt.SYMBOL_TABLE[s])}return i}}dr.bSymbolTableReady=!1,dr.RATIOS_TABLE=new Array(Zt.SYMBOL_TABLE.length).map((e=>new Array(Zt.BARS_IN_MODULE)));class ur{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class hr{static parseLong(e,t=void 0){return parseInt(e,t)}}class pr extends c{}pr.kind="NullPointerException";class mr{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,r){if(null==e)throw new pr;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new g;if(0!==r)for(let n=0;n<r;n++)this.write(e[t+n])}flush(){}close(){}}class fr extends c{}class gr extends mr{constructor(e=32){if(super(),this.count=0,e<0)throw new u("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new fr;t=w.MAX_VALUE}this.buf=y.copyOfUint8Array(this.buf,t)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,r){if(t<0||t>e.length||r<0||t+r-e.length>0)throw new g;this.ensureCapacity(this.count+r),f.arraycopy(e,t,this.buf,this.count,r),this.count+=r}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return y.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?"string"==typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}function xr(){if("undefined"!=typeof window)return window.BigInt||null;if(void 0!==kt)return kt.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let yr;function wr(e){if(void 0===yr&&(yr=xr()),null===yr)throw new Error("BigInt is not supported!");return yr(e)}function br(){let e=[];e[0]=wr(1);let t=wr(900);e[1]=t;for(let r=2;r<16;r++)e[r]=e[r-1]*t;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(Q||(Q={}));class vr{static decode(e,t){let r=new T(""),n=E.ISO8859_1;r.enableDecoding(n);let i=1,s=e[i++],a=new ur;for(;i<e[0];){switch(s){case vr.TEXT_COMPACTION_MODE_LATCH:i=vr.textCompaction(e,i,r);break;case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:i=vr.byteCompaction(s,e,n,i,r);break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[i++]);break;case vr.NUMERIC_COMPACTION_MODE_LATCH:i=vr.numericCompaction(e,i,r);break;case vr.ECI_CHARSET:E.getCharacterSetECIByValue(e[i++]);break;case vr.ECI_GENERAL_PURPOSE:i+=2;break;case vr.ECI_USER_DEFINED:i++;break;case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=vr.decodeMacroBlock(e,i,a);break;case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:throw new S;default:i--,i=vr.textCompaction(e,i,r)}if(!(i<e.length))throw S.getFormatInstance();s=e[i++]}if(0===r.length())throw S.getFormatInstance();let o=new ie(null,r.toString(),null,t);return o.setOther(a),o}static decodeMacroBlock(e,t,r){if(t+vr.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw S.getFormatInstance();let n=new Int32Array(vr.NUMBER_OF_SEQUENCE_CODEWORDS);for(let a=0;a<vr.NUMBER_OF_SEQUENCE_CODEWORDS;a++,t++)n[a]=e[t];r.setSegmentIndex(w.parseInt(vr.decodeBase900toBase10(n,vr.NUMBER_OF_SEQUENCE_CODEWORDS)));let i=new T;t=vr.textCompaction(e,t,i),r.setFileId(i.toString());let s=-1;for(e[t]===vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(s=t+1);t<e[0];)switch(e[t]){case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let n=new T;t=vr.textCompaction(e,t+1,n),r.setFileName(n.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let i=new T;t=vr.textCompaction(e,t+1,i),r.setSender(i.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let s=new T;t=vr.textCompaction(e,t+1,s),r.setAddressee(s.toString());break;case vr.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let a=new T;t=vr.numericCompaction(e,t+1,a),r.setSegmentCount(w.parseInt(a.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let o=new T;t=vr.numericCompaction(e,t+1,o),r.setTimestamp(hr.parseLong(o.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let l=new T;t=vr.numericCompaction(e,t+1,l),r.setChecksum(w.parseInt(l.toString()));break;case vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let c=new T;t=vr.numericCompaction(e,t+1,c),r.setFileSize(hr.parseLong(c.toString()));break;default:throw S.getFormatInstance()}break;case vr.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw S.getFormatInstance()}if(-1!==s){let n=t-s;r.isLastSegment()&&n--,r.setOptionalData(y.copyOfRange(e,s,s+n))}return t}static textCompaction(e,t,r){let n=new Int32Array(2*(e[0]-t)),i=new Int32Array(2*(e[0]-t)),s=0,a=!1;for(;t<e[0]&&!a;){let r=e[t++];if(r<vr.TEXT_COMPACTION_MODE_LATCH)n[s]=r/30,n[s+1]=r%30,s+=2;else switch(r){case vr.TEXT_COMPACTION_MODE_LATCH:n[s++]=vr.TEXT_COMPACTION_MODE_LATCH;break;case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:t--,a=!0;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n[s]=vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,r=e[t++],i[s]=r,s++}}return vr.decodeTextCompaction(n,i,s,r),t}static decodeTextCompaction(e,t,r,n){let i=Q.ALPHA,s=Q.ALPHA,a=0;for(;a<r;){let r=e[a],o="";switch(i){case Q.ALPHA:if(r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case vr.LL:i=Q.LOWER;break;case vr.ML:i=Q.MIXED;break;case vr.PS:s=i,i=Q.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}break;case Q.LOWER:if(r<26)o=String.fromCharCode(97+r);else switch(r){case 26:o=" ";break;case vr.AS:s=i,i=Q.ALPHA_SHIFT;break;case vr.ML:i=Q.MIXED;break;case vr.PS:s=i,i=Q.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}break;case Q.MIXED:if(r<vr.PL)o=vr.MIXED_CHARS[r];else switch(r){case vr.PL:i=Q.PUNCT;break;case 26:o=" ";break;case vr.LL:i=Q.LOWER;break;case vr.AL:i=Q.ALPHA;break;case vr.PS:s=i,i=Q.PUNCT_SHIFT;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}break;case Q.PUNCT:if(r<vr.PAL)o=vr.PUNCT_CHARS[r];else switch(r){case vr.PAL:i=Q.ALPHA;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}break;case Q.ALPHA_SHIFT:if(i=s,r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}break;case Q.PUNCT_SHIFT:if(i=s,r<vr.PAL)o=vr.PUNCT_CHARS[r];else switch(r){case vr.PAL:i=Q.ALPHA;break;case vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case vr.TEXT_COMPACTION_MODE_LATCH:i=Q.ALPHA}}""!==o&&n.append(o),a++}}static byteCompaction(e,t,r,n,i){let s=new gr,a=0,o=0,l=!1;switch(e){case vr.BYTE_COMPACTION_MODE_LATCH:let e=new Int32Array(6),r=t[n++];for(;n<t[0]&&!l;)switch(e[a++]=r,o=900*o+r,r=t[n++],r){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:n--,l=!0;break;default:if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(wr(o)>>wr(8*(5-e))));o=0,a=0}}n===t[0]&&r<vr.TEXT_COMPACTION_MODE_LATCH&&(e[a++]=r);for(let t=0;t<a;t++)s.write(e[t]);break;case vr.BYTE_COMPACTION_MODE_LATCH_6:for(;n<t[0]&&!l;){let e=t[n++];if(e<vr.TEXT_COMPACTION_MODE_LATCH)a++,o=900*o+e;else switch(e){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.NUMERIC_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:n--,l=!0}if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(wr(o)>>wr(8*(5-e))));o=0,a=0}}}return i.append(I.decode(s.toByteArray(),r)),n}static numericCompaction(e,t,r){let n=0,i=!1,s=new Int32Array(vr.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!i;){let a=e[t++];if(t===e[0]&&(i=!0),a<vr.TEXT_COMPACTION_MODE_LATCH)s[n]=a,n++;else switch(a){case vr.TEXT_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH:case vr.BYTE_COMPACTION_MODE_LATCH_6:case vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case vr.MACRO_PDF417_TERMINATOR:t--,i=!0}(n%vr.MAX_NUMERIC_CODEWORDS===0||a===vr.NUMERIC_COMPACTION_MODE_LATCH||i)&&n>0&&(r.append(vr.decodeBase900toBase10(s,n)),n=0)}return t}static decodeBase900toBase10(e,t){let r=wr(0);for(let i=0;i<t;i++)r+=vr.EXP900[t-i-1]*wr(e[i]);let n=r.toString();if("1"!==n.charAt(0))throw new S;return n.substring(1)}}vr.TEXT_COMPACTION_MODE_LATCH=900,vr.BYTE_COMPACTION_MODE_LATCH=901,vr.NUMERIC_COMPACTION_MODE_LATCH=902,vr.BYTE_COMPACTION_MODE_LATCH_6=924,vr.ECI_USER_DEFINED=925,vr.ECI_GENERAL_PURPOSE=926,vr.ECI_CHARSET=927,vr.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,vr.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,vr.MACRO_PDF417_TERMINATOR=922,vr.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,vr.MAX_NUMERIC_CODEWORDS=15,vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,vr.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,vr.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,vr.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,vr.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,vr.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,vr.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,vr.PL=25,vr.LL=27,vr.AS=27,vr.ML=28,vr.AL=28,vr.PS=29,vr.PAL=29,vr.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",vr.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",vr.EXP900=xr()?br():[],vr.NUMBER_OF_SEQUENCE_CODEWORDS=2;class Cr{constructor(){}static decode(e,t,r,n,i,s,a){let o,l=new rr(e,t,r,n,i),c=null,d=null;for(let p=!0;;p=!1){if(null!=t&&(c=Cr.getRowIndicatorColumn(e,l,t,!0,s,a)),null!=n&&(d=Cr.getRowIndicatorColumn(e,l,n,!1,s,a)),o=Cr.merge(c,d),null==o)throw R.getNotFoundInstance();let r=o.getBoundingBox();if(!p||null==r||!(r.getMinY()<l.getMinY()||r.getMaxY()>l.getMaxY()))break;l=r}o.setBoundingBox(l);let u=o.getBarcodeColumnCount()+1;o.setDetectionResultColumn(0,c),o.setDetectionResultColumn(u,d);let h=null!=c;for(let p=1;p<=u;p++){let t,r=h?p:u-p;if(void 0!==o.getDetectionResultColumn(r))continue;t=0===r||r===u?new or(l,0===r):new sr(l),o.setDetectionResultColumn(r,t);let n=-1,i=n;for(let c=l.getMinY();c<=l.getMaxY();c++){if(n=Cr.getStartColumn(o,r,c,h),n<0||n>l.getMaxX()){if(-1===i)continue;n=i}let d=Cr.detectCodeword(e,l.getMinX(),l.getMaxX(),h,n,c,s,a);null!=d&&(t.setCodeword(c,d),i=n,s=Math.min(s,d.getWidth()),a=Math.max(a,d.getWidth()))}}return Cr.createDecoderResult(o)}static merge(e,t){if(null==e&&null==t)return null;let r=Cr.getBarcodeMetadata(e,t);if(null==r)return null;let n=rr.merge(Cr.adjustBoundingBox(e),Cr.adjustBoundingBox(t));return new lr(r,n)}static adjustBoundingBox(e){if(null==e)return null;let t=e.getRowHeights();if(null==t)return null;let r=Cr.getMax(t),n=0;for(let a of t)if(n+=r-a,a>0)break;let i=e.getCodewords();for(let a=0;n>0&&null==i[a];a++)n--;let s=0;for(let a=t.length-1;a>=0&&(s+=r-t[a],!(t[a]>0));a--);for(let a=i.length-1;s>0&&null==i[a];a--)s--;return e.getBoundingBox().addMissingRows(n,s,e.isLeft())}static getMax(e){let t=-1;for(let r of e)t=Math.max(t,r);return t}static getBarcodeMetadata(e,t){let r,n;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(n=t.getBarcodeMetadata())?r:r.getColumnCount()!==n.getColumnCount()&&r.getErrorCorrectionLevel()!==n.getErrorCorrectionLevel()&&r.getRowCount()!==n.getRowCount()?null:r}static getRowIndicatorColumn(e,t,r,n,i,s){let a=new or(t,n);for(let o=0;o<2;o++){let l=0===o?1:-1,c=Math.trunc(Math.trunc(r.getX()));for(let o=Math.trunc(Math.trunc(r.getY()));o<=t.getMaxY()&&o>=t.getMinY();o+=l){let t=Cr.detectCodeword(e,0,e.getWidth(),n,c,o,i,s);null!=t&&(a.setCodeword(o,t),c=n?t.getStartX():t.getEndX())}}return a}static adjustCodewordCount(e,t){let r=t[0][1],n=r.getValue(),i=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-Cr.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===n.length){if(i<1||i>Zt.MAX_CODEWORDS_IN_BARCODE)throw R.getNotFoundInstance();r.setValue(i)}else n[0]!==i&&r.setValue(i)}static createDecoderResult(e){let t=Cr.createBarcodeMatrix(e);Cr.adjustCodewordCount(e,t);let r=new Array,n=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),i=[],s=new Array;for(let o=0;o<e.getBarcodeRowCount();o++)for(let a=0;a<e.getBarcodeColumnCount();a++){let l=t[o][a+1].getValue(),c=o*e.getBarcodeColumnCount()+a;0===l.length?r.push(c):1===l.length?n[c]=l[0]:(s.push(c),i.push(l))}let a=new Array(i.length);for(let o=0;o<a.length;o++)a[o]=i[o];return Cr.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),n,Zt.toIntArray(r),Zt.toIntArray(s),a)}static createDecoderResultFromAmbiguousValues(e,t,r,n,i){let s=new Int32Array(n.length),a=100;for(;a-- >0;){for(let e=0;e<s.length;e++)t[n[e]]=i[e][s[e]];try{return Cr.decodeCodewords(t,e,r)}catch(o){if(!(o instanceof p))throw o}if(0===s.length)throw p.getChecksumInstance();for(let e=0;e<s.length;e++){if(s[e]<i[e].length-1){s[e]++;break}if(s[e]=0,e===s.length-1)throw p.getChecksumInstance()}}throw p.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},(()=>new Array(e.getBarcodeColumnCount()+2)));for(let n=0;n<t.length;n++)for(let e=0;e<t[n].length;e++)t[n][e]=new ar;let r=0;for(let n of e.getDetectionResultColumns()){if(null!=n)for(let e of n.getCodewords())if(null!=e){let n=e.getRowNumber();if(n>=0){if(n>=t.length)continue;t[n][r].setValue(e.getValue())}}r++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,r,n){let i=n?1:-1,s=null;if(Cr.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodeword(r)),null!=s)return n?s.getEndX():s.getStartX();if(s=e.getDetectionResultColumn(t).getCodewordNearby(r),null!=s)return n?s.getStartX():s.getEndX();if(Cr.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodewordNearby(r)),null!=s)return n?s.getEndX():s.getStartX();let a=0;for(;Cr.isValidBarcodeColumn(e,t-i);){t-=i;for(let r of e.getDetectionResultColumn(t).getCodewords())if(null!=r)return(n?r.getEndX():r.getStartX())+i*a*(r.getEndX()-r.getStartX());a++}return n?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,r,n,i,s,a,o){i=Cr.adjustCodewordStartColumn(e,t,r,n,i,s);let l,c=Cr.getModuleBitCount(e,t,r,n,i,s);if(null==c)return null;let d=pe.sum(c);if(n)l=i+d;else{for(let e=0;e<c.length/2;e++){let t=c[e];c[e]=c[c.length-1-e],c[c.length-1-e]=t}l=i,i=l-d}if(!Cr.checkCodewordSkew(d,a,o))return null;let u=dr.getDecodedValue(c),h=Zt.getCodeword(u);return-1===h?null:new cr(i,l,Cr.getCodewordBucketNumber(u),h)}static getModuleBitCount(e,t,r,n,i,s){let a=i,o=new Int32Array(8),l=0,c=n?1:-1,d=n;for(;(n?a<r:a>=t)&&l<o.length;)e.get(a,s)===d?(o[l]++,a+=c):(l++,d=!d);return l===o.length||a===(n?r:t)&&l===o.length-1?o:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,r,n,i,s){let a=i,o=n?-1:1;for(let l=0;l<2;l++){for(;(n?a>=t:a<r)&&n===e.get(a,s);){if(Math.abs(i-a)>Cr.CODEWORD_SKEW_SIZE)return i;a+=o}o=-o,n=!n}return a}static checkCodewordSkew(e,t,r){return t-Cr.CODEWORD_SKEW_SIZE<=e&&e<=r+Cr.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,r){if(0===e.length)throw S.getFormatInstance();let n=1<<t+1,i=Cr.correctErrors(e,r,n);Cr.verifyCodewordCount(e,n);let s=vr.decode(e,""+t);return s.setErrorsCorrected(i),s.setErasures(r.length),s}static correctErrors(e,t,r){if(null!=t&&t.length>r/2+Cr.MAX_ERRORS||r<0||r>Cr.MAX_EC_CODEWORDS)throw p.getChecksumInstance();return Cr.errorCorrection.decode(e,r,t)}static verifyCodewordCount(e,t){if(e.length<4)throw S.getFormatInstance();let r=e[0];if(r>e.length)throw S.getFormatInstance();if(0===r){if(!(t<e.length))throw S.getFormatInstance();e[0]=e.length-t}}static getBitCountForCodeword(e){let t=new Int32Array(8),r=0,n=t.length-1;for(;!((1&e)!==r&&(r=1&e,n--,n<0));)t[n]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return Cr.getCodewordBucketNumber(Cr.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new ir;for(let r=0;r<e.length;r++){t.format("Row %2d: ",r);for(let n=0;n<e[r].length;n++){let i=e[r][n];0===i.getValue().length?t.format("        ",null):t.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}t.format("%n")}return t.toString()}}Cr.CODEWORD_SKEW_SIZE=2,Cr.MAX_ERRORS=3,Cr.MAX_EC_CODEWORDS=512,Cr.errorCorrection=new tr;class _r{decode(e,t=null){let r=_r.decode(e,t,!1);if(null==r||0===r.length||null==r[0])throw R.getNotFoundInstance();return r[0]}decodeMultiple(e,t=null){try{return _r.decode(e,t,!0)}catch(r){if(r instanceof S||r instanceof p)throw R.getNotFoundInstance();throw r}}static decode(e,t,r){const n=new Array,i=Qt.detectMultiple(e,t,r);for(const s of i.getPoints()){const e=Cr.decode(i.getBits(),s[4],s[5],s[6],s[7],_r.getMinCodewordWidth(s),_r.getMaxCodewordWidth(s)),t=new W(e.getText(),e.getRawBytes(),void 0,s,G.PDF_417);t.putMetadata(ne.ERROR_CORRECTION_LEVEL,e.getECLevel());const r=e.getOther();null!=r&&t.putMetadata(ne.PDF417_EXTRA_METADATA,r),n.push(t)}return n.map((e=>e))}static getMaxWidth(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return null==e||null==t?w.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(_r.getMaxWidth(e[0],e[4]),_r.getMaxWidth(e[6],e[2])*Zt.MODULES_IN_CODEWORD/Zt.MODULES_IN_STOP_PATTERN),Math.max(_r.getMaxWidth(e[1],e[5]),_r.getMaxWidth(e[7],e[3])*Zt.MODULES_IN_CODEWORD/Zt.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(_r.getMinWidth(e[0],e[4]),_r.getMinWidth(e[6],e[2])*Zt.MODULES_IN_CODEWORD/Zt.MODULES_IN_STOP_PATTERN),Math.min(_r.getMinWidth(e[1],e[5]),_r.getMinWidth(e[7],e[3])*Zt.MODULES_IN_CODEWORD/Zt.MODULES_IN_STOP_PATTERN)))}reset(){}}class Sr extends c{}Sr.kind="ReaderException";class Er{constructor(e,t){this.verbose=!0===e,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const r=!t(e)&&!0===e.get(_.TRY_HARDER),n=t(e)?null:e.get(_.POSSIBLE_FORMATS),i=new Array;if(!t(n)){const t=n.some((e=>e===G.UPC_A||e===G.UPC_E||e===G.EAN_13||e===G.EAN_8||e===G.CODABAR||e===G.CODE_39||e===G.CODE_93||e===G.CODE_128||e===G.ITF||e===G.RSS_14||e===G.RSS_EXPANDED));t&&!r&&i.push(new gt(e,this.verbose)),n.includes(G.QR_CODE)&&i.push(new $t),n.includes(G.DATA_MATRIX)&&i.push(new It),n.includes(G.AZTEC)&&i.push(new Ee),n.includes(G.PDF_417)&&i.push(new _r),t&&r&&i.push(new gt(e,this.verbose))}0===i.length&&(r||i.push(new gt(e,this.verbose)),i.push(new $t),i.push(new It),i.push(new Ee),i.push(new _r),r&&i.push(new gt(e,this.verbose))),this.readers=i}reset(){if(null!==this.readers)for(const e of this.readers)e.reset()}decodeInternal(e){if(null===this.readers)throw new Sr("No readers where selected, nothing can be read.");for(const r of this.readers)try{return r.decode(e,this.hints)}catch(t){if(t instanceof Sr)continue}throw new R("No MultiFormat Readers were able to detect the code.")}}class Ar extends U{constructor(e=null,t=500){const r=new Er;r.setHints(e),super(r,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class Ir extends U{constructor(e=500){super(new _r,e)}}class jr extends U{constructor(e=500){super(new $t,e)}}var Tr,Dr;(Dr=Tr||(Tr={}))[Dr.ERROR_CORRECTION=0]="ERROR_CORRECTION",Dr[Dr.CHARACTER_SET=1]="CHARACTER_SET",Dr[Dr.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",Dr[Dr.MIN_SIZE=3]="MIN_SIZE",Dr[Dr.MAX_SIZE=4]="MAX_SIZE",Dr[Dr.MARGIN=5]="MARGIN",Dr[Dr.PDF417_COMPACT=6]="PDF417_COMPACT",Dr[Dr.PDF417_COMPACTION=7]="PDF417_COMPACTION",Dr[Dr.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",Dr[Dr.AZTEC_LAYERS=9]="AZTEC_LAYERS",Dr[Dr.QR_VERSION=10]="QR_VERSION";var Rr=Tr;class Nr{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new ae(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let r=t[t.length-1];const n=this.field;for(let i=t.length;i<=e;i++){const e=r.multiply(new ae(n,Int32Array.from([1,n.exp(i-1+n.getGeneratorBase())])));t.push(e),r=e}}return t[e]}encode(e,t){if(0===t)throw new u("No error correction bytes");const r=e.length-t;if(r<=0)throw new u("No data bytes provided");const n=this.buildGenerator(t),i=new Int32Array(r);f.arraycopy(e,0,i,0,r);let s=new ae(this.field,i);s=s.multiplyByMonomial(t,1);const a=s.divide(n)[1].getCoefficients(),o=t-a.length;for(let l=0;l<o;l++)e[r+l]=0;f.arraycopy(a,0,e,r+o,a.length)}}class Pr{constructor(){}static applyMaskPenaltyRule1(e){return Pr.applyMaskPenaltyRule1Internal(e,!0)+Pr.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let s=0;s<i-1;s++){const e=r[s];for(let i=0;i<n-1;i++){const n=e[i];n===e[i+1]&&n===r[s+1][i]&&n===r[s+1][i+1]&&t++}}return Pr.N2*t}static applyMaskPenaltyRule3(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let s=0;s<i;s++)for(let e=0;e<n;e++){const a=r[s];e+6<n&&1===a[e]&&0===a[e+1]&&1===a[e+2]&&1===a[e+3]&&1===a[e+4]&&0===a[e+5]&&1===a[e+6]&&(Pr.isWhiteHorizontal(a,e-4,e)||Pr.isWhiteHorizontal(a,e+7,e+11))&&t++,s+6<i&&1===r[s][e]&&0===r[s+1][e]&&1===r[s+2][e]&&1===r[s+3][e]&&1===r[s+4][e]&&0===r[s+5][e]&&1===r[s+6][e]&&(Pr.isWhiteVertical(r,e,s-4,s)||Pr.isWhiteVertical(r,e,s+7,s+11))&&t++}return t*Pr.N3}static isWhiteHorizontal(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(let n=t;n<r;n++)if(1===e[n])return!1;return!0}static isWhiteVertical(e,t,r,n){r=Math.max(r,0),n=Math.min(n,e.length);for(let i=r;i<n;i++)if(1===e[i][t])return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let a=0;a<i;a++){const e=r[a];for(let r=0;r<n;r++)1===e[r]&&t++}const s=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-s)/s)*Pr.N4}static getDataMaskBit(e,t,r){let n,i;switch(e){case 0:n=r+t&1;break;case 1:n=1&r;break;case 2:n=t%3;break;case 3:n=(r+t)%3;break;case 4:n=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:i=r*t,n=(1&i)+i%3;break;case 6:i=r*t,n=(1&i)+i%3&1;break;case 7:i=r*t,n=i%3+(r+t&1)&1;break;default:throw new u("Invalid mask pattern: "+e)}return 0===n}static applyMaskPenaltyRule1Internal(e,t){let r=0;const n=t?e.getHeight():e.getWidth(),i=t?e.getWidth():e.getHeight(),s=e.getArray();for(let a=0;a<n;a++){let e=0,n=-1;for(let o=0;o<i;o++){const i=t?s[a][o]:s[o][a];i===n?e++:(e>=5&&(r+=Pr.N1+(e-5)),e=1,n=i)}e>=5&&(r+=Pr.N1+(e-5))}return r}}Pr.N1=3,Pr.N2=3,Pr.N3=40,Pr.N4=10;class Or{constructor(e,t){this.width=e,this.height=t;const r=new Array(t);for(let n=0;n!==t;n++)r[n]=new Uint8Array(e);this.bytes=r}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,r){this.bytes[t][e]=r}setBoolean(e,t,r){this.bytes[t][e]=r?1:0}clear(e){for(const t of this.bytes)y.fill(t,e)}equals(e){if(!(e instanceof Or))return!1;const t=e;if(this.width!==t.width)return!1;if(this.height!==t.height)return!1;for(let r=0,n=this.height;r<n;++r){const e=this.bytes[r],n=t.bytes[r];for(let t=0,r=this.width;t<r;++t)if(e[t]!==n[t])return!1}return!0}toString(){const e=new T;for(let t=0,r=this.height;t<r;++t){const r=this.bytes[t];for(let t=0,n=this.width;t<n;++t)switch(r[t]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()}}class kr{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new T;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<kr.NUM_MASK_PATTERNS}}kr.NUM_MASK_PATTERNS=8;class Mr extends c{}Mr.kind="WriterException";class Fr{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,r,n,i){Fr.clearMatrix(i),Fr.embedBasicPatterns(r,i),Fr.embedTypeInfo(t,n,i),Fr.maybeEmbedVersionInfo(r,i),Fr.embedDataBits(e,n,i)}static embedBasicPatterns(e,t){Fr.embedPositionDetectionPatternsAndSeparators(t),Fr.embedDarkDotAtLeftBottomCorner(t),Fr.maybeEmbedPositionAdjustmentPatterns(e,t),Fr.embedTimingPatterns(t)}static embedTypeInfo(e,t,r){const n=new b;Fr.makeTypeInfoBits(e,t,n);for(let i=0,s=n.getSize();i<s;++i){const e=n.get(n.getSize()-1-i),t=Fr.TYPE_INFO_COORDINATES[i],s=t[0],a=t[1];if(r.setBoolean(s,a,e),i<8){const t=r.getWidth()-i-1,n=8;r.setBoolean(t,n,e)}else{const t=8,n=r.getHeight()-7+(i-8);r.setBoolean(t,n,e)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const r=new b;Fr.makeVersionInfoBits(e,r);let n=17;for(let i=0;i<6;++i)for(let e=0;e<3;++e){const s=r.get(n);n--,t.setBoolean(i,t.getHeight()-11+e,s),t.setBoolean(t.getHeight()-11+e,i,s)}}static embedDataBits(e,t,r){let n=0,i=-1,s=r.getWidth()-1,a=r.getHeight()-1;for(;s>0;){for(6===s&&(s-=1);a>=0&&a<r.getHeight();){for(let i=0;i<2;++i){const o=s-i;if(!Fr.isEmpty(r.get(o,a)))continue;let l;n<e.getSize()?(l=e.get(n),++n):l=!1,255!==t&&Pr.getDataMaskBit(t,o,a)&&(l=!l),r.setBoolean(o,a,l)}a+=i}i=-i,a+=i,s-=2}if(n!==e.getSize())throw new Mr("Not all bits consumed: "+n+"/"+e.getSize())}static findMSBSet(e){return 32-w.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(0===t)throw new u("0 polynomial");const r=Fr.findMSBSet(t);for(e<<=r-1;Fr.findMSBSet(e)>=r;)e^=t<<Fr.findMSBSet(e)-r;return e}static makeTypeInfoBits(e,t,r){if(!kr.isValidMaskPattern(t))throw new Mr("Invalid mask pattern");const n=e.getBits()<<3|t;r.appendBits(n,5);const i=Fr.calculateBCHCode(n,Fr.TYPE_INFO_POLY);r.appendBits(i,10);const s=new b;if(s.appendBits(Fr.TYPE_INFO_MASK_PATTERN,15),r.xor(s),15!==r.getSize())throw new Mr("should not happen but we got: "+r.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const r=Fr.calculateBCHCode(e.getVersionNumber(),Fr.VERSION_INFO_POLY);if(t.appendBits(r,12),18!==t.getSize())throw new Mr("should not happen but we got: "+t.getSize())}static isEmpty(e){return 255===e}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const r=(t+1)%2;Fr.isEmpty(e.get(t,6))&&e.setNumber(t,6,r),Fr.isEmpty(e.get(6,t))&&e.setNumber(6,t,r)}}static embedDarkDotAtLeftBottomCorner(e){if(0===e.get(8,e.getHeight()-8))throw new Mr;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,r){for(let n=0;n<8;++n){if(!Fr.isEmpty(r.get(e+n,t)))throw new Mr;r.setNumber(e+n,t,0)}}static embedVerticalSeparationPattern(e,t,r){for(let n=0;n<7;++n){if(!Fr.isEmpty(r.get(e,t+n)))throw new Mr;r.setNumber(e,t+n,0)}}static embedPositionAdjustmentPattern(e,t,r){for(let n=0;n<5;++n){const i=Fr.POSITION_ADJUSTMENT_PATTERN[n];for(let s=0;s<5;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPattern(e,t,r){for(let n=0;n<7;++n){const i=Fr.POSITION_DETECTION_PATTERN[n];for(let s=0;s<7;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPatternsAndSeparators(e){const t=Fr.POSITION_DETECTION_PATTERN[0].length;Fr.embedPositionDetectionPattern(0,0,e),Fr.embedPositionDetectionPattern(e.getWidth()-t,0,e),Fr.embedPositionDetectionPattern(0,e.getWidth()-t,e);const r=8;Fr.embedHorizontalSeparationPattern(0,r-1,e),Fr.embedHorizontalSeparationPattern(e.getWidth()-r,r-1,e),Fr.embedHorizontalSeparationPattern(0,e.getWidth()-r,e);const n=7;Fr.embedVerticalSeparationPattern(n,0,e),Fr.embedVerticalSeparationPattern(e.getHeight()-n-1,0,e),Fr.embedVerticalSeparationPattern(n,e.getHeight()-n,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const r=e.getVersionNumber()-1,n=Fr.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[r];for(let i=0,s=n.length;i!==s;i++){const e=n[i];if(e>=0)for(let r=0;r!==s;r++){const i=n[r];i>=0&&Fr.isEmpty(t.get(i,e))&&Fr.embedPositionAdjustmentPattern(i-2,e-2,t)}}}}Fr.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Fr.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Fr.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Fr.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Fr.VERSION_INFO_POLY=7973,Fr.TYPE_INFO_POLY=1335,Fr.TYPE_INFO_MASK_PATTERN=21522;class Br{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Lr{constructor(){}static calculateMaskPenalty(e){return Pr.applyMaskPenaltyRule1(e)+Pr.applyMaskPenaltyRule2(e)+Pr.applyMaskPenaltyRule3(e)+Pr.applyMaskPenaltyRule4(e)}static encode(e,t,r=null){let n=Lr.DEFAULT_BYTE_MODE_ENCODING;const i=null!==r&&void 0!==r.get(Rr.CHARACTER_SET);i&&(n=r.get(Rr.CHARACTER_SET).toString());const s=this.chooseMode(e,n),a=new b;if(s===Bt.BYTE&&(i||Lr.DEFAULT_BYTE_MODE_ENCODING!==n)){const e=E.getCharacterSetECIByName(n);void 0!==e&&this.appendECI(e,a)}this.appendModeInfo(s,a);const o=new b;let l;if(this.appendBytes(e,s,o,n),null!==r&&void 0!==r.get(Rr.QR_VERSION)){const e=Number.parseInt(r.get(Rr.QR_VERSION).toString(),10);l=Pt.getVersionForNumber(e);const n=this.calculateBitsNeeded(s,a,o,l);if(!this.willFit(n,l,t))throw new Mr("Data too big for requested version")}else l=this.recommendVersion(t,s,a,o);const c=new b;c.appendBitArray(a);const d=s===Bt.BYTE?o.getSizeInBytes():e.length;this.appendLengthInfo(d,l,s,c),c.appendBitArray(o);const u=l.getECBlocksForLevel(t),h=l.getTotalCodewords()-u.getTotalECCodewords();this.terminateBits(h,c);const p=this.interleaveWithECBytes(c,l.getTotalCodewords(),h,u.getNumBlocks()),m=new kr;m.setECLevel(t),m.setMode(s),m.setVersion(l);const f=l.getDimensionForVersion(),g=new Or(f,f),x=this.chooseMaskPattern(p,t,l,g);return m.setMaskPattern(x),Fr.buildMatrix(p,t,l,x,g),m.setMatrix(g),m}static recommendVersion(e,t,r,n){const i=this.calculateBitsNeeded(t,r,n,Pt.getVersionForNumber(1)),s=this.chooseVersion(i,e),a=this.calculateBitsNeeded(t,r,n,s);return this.chooseVersion(a,e)}static calculateBitsNeeded(e,t,r,n){return t.getSize()+e.getCharacterCountBits(n)+r.getSize()}static getAlphanumericCode(e){return e<Lr.ALPHANUMERIC_TABLE.length?Lr.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(E.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return Bt.KANJI;let r=!1,n=!1;for(let i=0,s=e.length;i<s;++i){const t=e.charAt(i);if(Lr.isDigit(t))r=!0;else{if(-1===this.getAlphanumericCode(t.charCodeAt(0)))return Bt.BYTE;n=!0}}return n?Bt.ALPHANUMERIC:r?Bt.NUMERIC:Bt.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=I.encode(e,E.SJIS)}catch(n){return!1}const r=t.length;if(r%2!=0)return!1;for(let i=0;i<r;i+=2){const e=255&t[i];if((e<129||e>159)&&(e<224||e>235))return!1}return!0}static chooseMaskPattern(e,t,r,n){let i=Number.MAX_SAFE_INTEGER,s=-1;for(let a=0;a<kr.NUM_MASK_PATTERNS;a++){Fr.buildMatrix(e,t,r,a,n);let o=this.calculateMaskPenalty(n);o<i&&(i=o,s=a)}return s}static chooseVersion(e,t){for(let r=1;r<=40;r++){const n=Pt.getVersionForNumber(r);if(Lr.willFit(e,n,t))return n}throw new Mr("Data too big")}static willFit(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8}static terminateBits(e,t){const r=8*e;if(t.getSize()>r)throw new Mr("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(let s=0;s<4&&t.getSize()<r;++s)t.appendBit(!1);const n=7&t.getSize();if(n>0)for(let s=n;s<8;s++)t.appendBit(!1);const i=e-t.getSizeInBytes();for(let s=0;s<i;++s)t.appendBits(1&s?17:236,8);if(t.getSize()!==r)throw new Mr("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,r,n,i,s){if(n>=r)throw new Mr("Block ID too large");const a=e%r,o=r-a,l=Math.floor(e/r),c=l+1,d=Math.floor(t/r),u=d+1,h=l-d,p=c-u;if(h!==p)throw new Mr("EC bytes mismatch");if(r!==o+a)throw new Mr("RS blocks mismatch");if(e!==(d+h)*o+(u+p)*a)throw new Mr("Total bytes mismatch");n<o?(i[0]=d,s[0]=h):(i[0]=u,s[0]=p)}static interleaveWithECBytes(e,t,r,n){if(e.getSizeInBytes()!==r)throw new Mr("Number of bits and data bytes does not match");let i=0,s=0,a=0;const o=new Array;for(let c=0;c<n;++c){const l=new Int32Array(1),d=new Int32Array(1);Lr.getNumDataBytesAndNumECBytesForBlockID(t,r,n,c,l,d);const u=l[0],h=new Uint8Array(u);e.toBytes(8*i,h,0,u);const p=Lr.generateECBytes(h,d[0]);o.push(new Br(h,p)),s=Math.max(s,u),a=Math.max(a,p.length),i+=l[0]}if(r!==i)throw new Mr("Data bytes does not match offset");const l=new b;for(let c=0;c<s;++c)for(const e of o){const t=e.getDataBytes();c<t.length&&l.appendBits(t[c],8)}for(let c=0;c<a;++c)for(const e of o){const t=e.getErrorCorrectionBytes();c<t.length&&l.appendBits(t[c],8)}if(t!==l.getSizeInBytes())throw new Mr("Interleaving error: "+t+" and "+l.getSizeInBytes()+" differ.");return l}static generateECBytes(e,t){const r=e.length,n=new Int32Array(r+t);for(let s=0;s<r;s++)n[s]=255&e[s];new Nr(le.QR_CODE_FIELD_256).encode(n,t);const i=new Uint8Array(t);for(let s=0;s<t;s++)i[s]=n[r+s];return i}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,r,n){const i=r.getCharacterCountBits(t);if(e>=1<<i)throw new Mr(e+" is bigger than "+((1<<i)-1));n.appendBits(e,i)}static appendBytes(e,t,r,n){switch(t){case Bt.NUMERIC:Lr.appendNumericBytes(e,r);break;case Bt.ALPHANUMERIC:Lr.appendAlphanumericBytes(e,r);break;case Bt.BYTE:Lr.append8BitBytes(e,r,n);break;case Bt.KANJI:Lr.appendKanjiBytes(e,r);break;default:throw new Mr("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=Lr.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const r=e.length;let n=0;for(;n<r;){const i=Lr.getDigit(e.charAt(n));if(n+2<r){const r=Lr.getDigit(e.charAt(n+1)),s=Lr.getDigit(e.charAt(n+2));t.appendBits(100*i+10*r+s,10),n+=3}else if(n+1<r){const r=Lr.getDigit(e.charAt(n+1));t.appendBits(10*i+r,7),n+=2}else t.appendBits(i,4),n++}}static appendAlphanumericBytes(e,t){const r=e.length;let n=0;for(;n<r;){const i=Lr.getAlphanumericCode(e.charCodeAt(n));if(-1===i)throw new Mr;if(n+1<r){const r=Lr.getAlphanumericCode(e.charCodeAt(n+1));if(-1===r)throw new Mr;t.appendBits(45*i+r,11),n+=2}else t.appendBits(i,6),n++}}static append8BitBytes(e,t,r){let n;try{n=I.encode(e,r)}catch(i){throw new Mr(i)}for(let s=0,a=n.length;s!==a;s++){const e=n[s];t.appendBits(e,8)}}static appendKanjiBytes(e,t){let r;try{r=I.encode(e,E.SJIS)}catch(i){throw new Mr(i)}const n=r.length;for(let s=0;s<n;s+=2){const e=(255&r[s])<<8&4294967295|255&r[s+1];let n=-1;if(e>=33088&&e<=40956?n=e-33088:e>=57408&&e<=60351&&(n=e-49472),-1===n)throw new Mr("Invalid byte sequence");const i=192*(n>>8)+(255&n);t.appendBits(i,13)}}static appendECI(e,t){t.appendBits(Bt.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}Lr.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Lr.DEFAULT_BYTE_MODE_ENCODING=E.UTF8.getName();class zr{write(e,t,r,n=null){if(0===e.length)throw new u("Found empty contents");if(t<0||r<0)throw new u("Requested dimensions are too small: "+t+"x"+r);let i=Tt.L,s=zr.QUIET_ZONE_SIZE;null!==n&&(void 0!==n.get(Rr.ERROR_CORRECTION)&&(i=Tt.fromString(n.get(Rr.ERROR_CORRECTION).toString())),void 0!==n.get(Rr.MARGIN)&&(s=Number.parseInt(n.get(Rr.MARGIN).toString(),10)));const a=Lr.encode(e,i,n);return this.renderResult(a,t,r,s)}writeToDom(e,t,r,n,i=null){"string"==typeof e&&(e=document.querySelector(e));const s=this.write(t,r,n,i);e&&e.appendChild(s)}renderResult(e,t,r,n){const i=e.getMatrix();if(null===i)throw new de;const s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,c=Math.max(t,o),d=Math.max(r,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-s*u)/2),p=Math.floor((d-a*u)/2),m=this.createSVGElement(c,d);for(let f=0,g=p;f<a;f++,g+=u)for(let e=0,t=h;e<s;e++,t+=u)if(1===i.get(e,f)){const e=this.createSvgRectElement(t,g,u,u);m.appendChild(e)}return m}createSVGElement(e,t){const r=document.createElementNS(zr.SVG_NS,"svg");return r.setAttributeNS(null,"height",e.toString()),r.setAttributeNS(null,"width",t.toString()),r}createSvgRectElement(e,t,r,n){const i=document.createElementNS(zr.SVG_NS,"rect");return i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y",t.toString()),i.setAttributeNS(null,"height",r.toString()),i.setAttributeNS(null,"width",n.toString()),i.setAttributeNS(null,"fill","#000000"),i}}zr.QUIET_ZONE_SIZE=4,zr.SVG_NS="http://www.w3.org/2000/svg";class Ur{encode(e,t,r,n,i){if(0===e.length)throw new u("Found empty contents");if(t!==G.QR_CODE)throw new u("Can only encode QR_CODE, but got "+t);if(r<0||n<0)throw new u(`Requested dimensions are too small: ${r}x${n}`);let s=Tt.L,a=Ur.QUIET_ZONE_SIZE;null!==i&&(void 0!==i.get(Rr.ERROR_CORRECTION)&&(s=Tt.fromString(i.get(Rr.ERROR_CORRECTION).toString())),void 0!==i.get(Rr.MARGIN)&&(a=Number.parseInt(i.get(Rr.MARGIN).toString(),10)));const o=Lr.encode(e,s,i);return Ur.renderResult(o,r,n,a)}static renderResult(e,t,r,n){const i=e.getMatrix();if(null===i)throw new de;const s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,c=Math.max(t,o),d=Math.max(r,l),u=Math.min(Math.floor(c/o),Math.floor(d/l)),h=Math.floor((c-s*u)/2),p=Math.floor((d-a*u)/2),m=new D(c,d);for(let f=0,g=p;f<a;f++,g+=u)for(let e=0,t=h;e<s;e++,t+=u)1===i.get(e,f)&&m.setRegion(t,g,u,u);return m}}Ur.QUIET_ZONE_SIZE=4;class Wr{encode(e,t,r,n,i){let s;if(t!==G.QR_CODE)throw new u("No encoder available for format "+t);return s=new Ur,s.encode(e,t,r,n,i)}}class Vr extends O{constructor(e,t,r,n,i,s,a,o){if(super(s,a),this.yuvData=e,this.dataWidth=t,this.dataHeight=r,this.left=n,this.top=i,n+s>t||i+a>r)throw new u("Crop rectangle does not fit within image data.");o&&this.reverseHorizontal(s,a)}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));const n=(e+this.top)*this.dataWidth+this.left;return f.arraycopy(this.yuvData,n,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const r=e*t,n=new Uint8ClampedArray(r);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return f.arraycopy(this.yuvData,i,n,0,r),n;for(let s=0;s<t;s++){const t=s*e;f.arraycopy(this.yuvData,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new Vr(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,r,n,!1)}renderThumbnail(){const e=this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR,r=new Int32Array(e*t),n=this.yuvData;let i=this.top*this.dataWidth+this.left;for(let s=0;s<t;s++){const t=s*e;for(let s=0;s<e;s++){const e=255&n[i+s*Vr.THUMBNAIL_SCALE_FACTOR];r[t+s]=4278190080|65793*e}i+=this.dataWidth*Vr.THUMBNAIL_SCALE_FACTOR}return r}getThumbnailWidth(){return this.getWidth()/Vr.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Vr.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const r=this.yuvData;for(let n=0,i=this.top*this.dataWidth+this.left;n<t;n++,i+=this.dataWidth){const t=i+e/2;for(let n=i,s=i+e-1;n<t;n++,s--){const e=r[n];r[n]=r[s],r[s]=e}}}invert(){return new k(this)}}Vr.THUMBNAIL_SCALE_FACTOR=2;class Hr extends O{constructor(e,t,r,n,i,s,a){if(super(t,r),this.dataWidth=n,this.dataHeight=i,this.left=s,this.top=a,4===e.BYTES_PER_ELEMENT){const n=t*r,i=new Uint8ClampedArray(n);for(let t=0;t<n;t++){const r=e[t],n=r>>16&255,s=r>>7&510,a=255&r;i[t]=(n+s+a)/4&255}this.luminances=i}else this.luminances=e;if(void 0===n&&(this.dataWidth=t),void 0===i&&(this.dataHeight=r),void 0===s&&(this.left=0),void 0===a&&(this.top=0),this.left+t>this.dataWidth||this.top+r>this.dataHeight)throw new u("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new u("Requested row is outside the image: "+e);const r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));const n=(e+this.top)*this.dataWidth+this.left;return f.arraycopy(this.luminances,n,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const r=e*t,n=new Uint8ClampedArray(r);let i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return f.arraycopy(this.luminances,i,n,0,r),n;for(let s=0;s<t;s++){const t=s*e;f.arraycopy(this.luminances,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new Hr(this.luminances,r,n,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new k(this)}}class Gr extends E{static forName(e){return this.getCharacterSetECIByName(e)}}class qr{}qr.ISO_8859_1=E.ISO8859_1;class Xr{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class $r{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class Zr{constructor(e){this.previous=e}getPrevious(){return this.previous}}class Yr extends Zr{constructor(e,t,r){super(e),this.value=t,this.bitCount=r}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new Yr(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Yr(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+w.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class Qr extends Yr{constructor(e,t,r){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=r}appendTo(e,t){for(let r=0;r<this.binaryShiftByteCount;r++)(0===r||31===r&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===r?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+r],8)}addBinaryShift(e,t){return new Qr(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Kr(e,t,r){return new Qr(e,t,r)}function Jr(e,t,r){return new Yr(e,t,r)}const en=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],tn=0,rn=1,nn=2,sn=3,an=4,on=new Yr(null,0,0),ln=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];function cn(e){for(let t of e)y.fill(t,-1);return e[tn][an]=0,e[rn][an]=0,e[rn][tn]=28,e[sn][an]=0,e[nn][an]=0,e[nn][tn]=15,e}const dn=cn(y.createInt32Array(6,6));class un{constructor(e,t,r,n){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=n}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let r=this.bitCount,n=this.token;if(e!==this.mode){let t=ln[this.mode][e];n=Jr(n,65535&t,t>>16),r+=t>>16}let i=e===nn?4:5;return n=Jr(n,t,i),new un(n,e,0,r+i)}shiftAndAppend(e,t){let r=this.token,n=this.mode===nn?4:5;return r=Jr(r,dn[this.mode][e],n),r=Jr(r,t,5),new un(r,this.mode,0,this.bitCount+n+5)}addBinaryShiftChar(e){let t=this.token,r=this.mode,n=this.bitCount;if(this.mode===an||this.mode===nn){let e=ln[r][tn];t=Jr(t,65535&e,e>>16),n+=e>>16,r=tn}let i=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,s=new un(t,r,this.binaryShiftByteCount+1,n+i);return 2078===s.binaryShiftByteCount&&(s=s.endBinaryShift(e+1)),s}endBinaryShift(e){if(0===this.binaryShiftByteCount)return this;let t=this.token;return t=Kr(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new un(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(ln[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=un.calculateBinaryShiftCost(e)-un.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let n=this.endBinaryShift(e.length).token;null!==n;n=n.getPrevious())t.unshift(n);let r=new b;for(const n of t)n.appendTo(r,e);return r}toString(){return j.format("%s bits=%d bytes=%d",en[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}function hn(e){const t=j.getCharCode(" "),r=j.getCharCode("."),n=j.getCharCode(",");e[tn][t]=1;const i=j.getCharCode("Z"),s=j.getCharCode("A");for(let h=s;h<=i;h++)e[tn][h]=h-s+2;e[rn][t]=1;const a=j.getCharCode("z"),o=j.getCharCode("a");for(let h=o;h<=a;h++)e[rn][h]=h-o+2;e[nn][t]=1;const l=j.getCharCode("9"),c=j.getCharCode("0");for(let h=c;h<=l;h++)e[nn][h]=h-c+2;e[nn][n]=12,e[nn][r]=13;const d=["\0"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~",""];for(let h=0;h<d.length;h++)e[sn][j.getCharCode(d[h])]=h;const u=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let h=0;h<u.length;h++)j.getCharCode(u[h])>0&&(e[an][j.getCharCode(u[h])]=h);return e}un.INITIAL_STATE=new un(on,tn,0,0);const pn=hn(y.createInt32Array(5,256));class mn{constructor(e){this.text=e}encode(){const e=j.getCharCode(" "),t=j.getCharCode("\n");let r=$r.singletonList(un.INITIAL_STATE);for(let n=0;n<this.text.length;n++){let i,s=n+1<this.text.length?this.text[n+1]:0;switch(this.text[n]){case j.getCharCode("\r"):i=s===t?2:0;break;case j.getCharCode("."):i=s===e?3:0;break;case j.getCharCode(","):i=s===e?4:0;break;case j.getCharCode(":"):i=s===e?5:0;break;default:i=0}i>0?(r=mn.updateStateListForPair(r,n,i),n++):r=this.updateStateListForChar(r,n)}return $r.min(r,((e,t)=>e.getBitCount()-t.getBitCount())).toBitArray(this.text)}updateStateListForChar(e,t){const r=[];for(let n of e)this.updateStateForChar(n,t,r);return mn.simplifyStates(r)}updateStateForChar(e,t,r){let n=255&this.text[t],i=pn[e.getMode()][n]>0,s=null;for(let a=0;a<=an;a++){let o=pn[a][n];if(o>0){if(null==s&&(s=e.endBinaryShift(t)),!i||a===e.getMode()||a===nn){const e=s.latchAndAppend(a,o);r.push(e)}if(!i&&dn[e.getMode()][a]>=0){const e=s.shiftAndAppend(a,o);r.push(e)}}}if(e.getBinaryShiftByteCount()>0||0===pn[e.getMode()][n]){let n=e.addBinaryShiftChar(t);r.push(n)}}static updateStateListForPair(e,t,r){const n=[];for(let i of e)this.updateStateForPair(i,t,r,n);return this.simplifyStates(n)}static updateStateForPair(e,t,r,n){let i=e.endBinaryShift(t);if(n.push(i.latchAndAppend(an,r)),e.getMode()!==an&&n.push(i.shiftAndAppend(an,r)),3===r||4===r){let e=i.latchAndAppend(nn,16-r).latchAndAppend(nn,1);n.push(e)}if(e.getBinaryShiftByteCount()>0){let r=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);n.push(r)}}static simplifyStates(e){let t=[];for(const r of e){let e=!0;for(const n of t){if(n.isBetterThanOrEqualTo(r)){e=!1;break}r.isBetterThanOrEqualTo(n)&&(t=t.filter((e=>e!==n)))}e&&t.push(r)}return t}}class fn{constructor(){}static encodeBytes(e){return fn.encode(e,fn.DEFAULT_EC_PERCENT,fn.DEFAULT_AZTEC_LAYERS)}static encode(e,t,r){let n,i,s,a,o,l=new mn(e).encode(),c=w.truncDivision(l.getSize()*t,100)+11,d=l.getSize()+c;if(r!==fn.DEFAULT_AZTEC_LAYERS){if(n=r<0,i=Math.abs(r),i>(n?fn.MAX_NB_BITS_COMPACT:fn.MAX_NB_BITS))throw new u(j.format("Illegal value %s for layers",r));s=fn.totalBitsInLayer(i,n),a=fn.WORD_SIZE[i];let e=s-s%a;if(o=fn.stuffBits(l,a),o.getSize()+c>e)throw new u("Data to large for user specified layer");if(n&&o.getSize()>64*a)throw new u("Data to large for user specified layer")}else{a=0,o=null;for(let e=0;;e++){if(e>fn.MAX_NB_BITS)throw new u("Data too large for an Aztec code");if(n=e<=3,i=n?e+1:e,s=fn.totalBitsInLayer(i,n),d>s)continue;null!=o&&a===fn.WORD_SIZE[i]||(a=fn.WORD_SIZE[i],o=fn.stuffBits(l,a));let t=s-s%a;if(!(n&&o.getSize()>64*a)&&o.getSize()+c<=t)break}}let h,p=fn.generateCheckWords(o,s,a),m=o.getSize()/a,f=fn.generateModeMessage(n,i,m),g=(n?11:14)+4*i,x=new Int32Array(g);if(n){h=g;for(let e=0;e<x.length;e++)x[e]=e}else{h=g+1+2*w.truncDivision(w.truncDivision(g,2)-1,15);let e=w.truncDivision(g,2),t=w.truncDivision(h,2);for(let r=0;r<e;r++){let n=r+w.truncDivision(r,15);x[e-r-1]=t-n-1,x[e+r]=t+n+1}}let y=new D(h);for(let u=0,w=0;u<i;u++){let e=4*(i-u)+(n?9:12);for(let t=0;t<e;t++){let r=2*t;for(let n=0;n<2;n++)p.get(w+r+n)&&y.set(x[2*u+n],x[2*u+t]),p.get(w+2*e+r+n)&&y.set(x[2*u+t],x[g-1-2*u-n]),p.get(w+4*e+r+n)&&y.set(x[g-1-2*u-n],x[g-1-2*u-t]),p.get(w+6*e+r+n)&&y.set(x[g-1-2*u-t],x[2*u+n])}w+=8*e}if(fn.drawModeMessage(y,n,h,f),n)fn.drawBullsEye(y,w.truncDivision(h,2),5);else{fn.drawBullsEye(y,w.truncDivision(h,2),7);for(let e=0,t=0;e<w.truncDivision(g,2)-1;e+=15,t+=16)for(let r=1&w.truncDivision(h,2);r<h;r+=2)y.set(w.truncDivision(h,2)-t,r),y.set(w.truncDivision(h,2)+t,r),y.set(r,w.truncDivision(h,2)-t),y.set(r,w.truncDivision(h,2)+t)}let b=new Xr;return b.setCompact(n),b.setSize(h),b.setLayers(i),b.setCodeWords(m),b.setMatrix(y),b}static drawBullsEye(e,t,r){for(let n=0;n<r;n+=2)for(let r=t-n;r<=t+n;r++)e.set(r,t-n),e.set(r,t+n),e.set(t-n,r),e.set(t+n,r);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)}static generateModeMessage(e,t,r){let n=new b;return e?(n.appendBits(t-1,2),n.appendBits(r-1,6),n=fn.generateCheckWords(n,28,4)):(n.appendBits(t-1,5),n.appendBits(r-1,11),n=fn.generateCheckWords(n,40,4)),n}static drawModeMessage(e,t,r,n){let i=w.truncDivision(r,2);if(t)for(let s=0;s<7;s++){let t=i-3+s;n.get(s)&&e.set(t,i-5),n.get(s+7)&&e.set(i+5,t),n.get(20-s)&&e.set(t,i+5),n.get(27-s)&&e.set(i-5,t)}else for(let s=0;s<10;s++){let t=i-5+s+w.truncDivision(s,5);n.get(s)&&e.set(t,i-7),n.get(s+10)&&e.set(i+7,t),n.get(29-s)&&e.set(t,i+7),n.get(39-s)&&e.set(i-7,t)}}static generateCheckWords(e,t,r){let n=e.getSize()/r,i=new Nr(fn.getGF(r)),s=w.truncDivision(t,r),a=fn.bitsToWords(e,r,s);i.encode(a,s-n);let o=t%r,l=new b;l.appendBits(0,o);for(const c of Array.from(a))l.appendBits(c,r);return l}static bitsToWords(e,t,r){let n,i,s=new Int32Array(r);for(n=0,i=e.getSize()/t;n<i;n++){let r=0;for(let i=0;i<t;i++)r|=e.get(n*t+i)?1<<t-i-1:0;s[n]=r}return s}static getGF(e){switch(e){case 4:return le.AZTEC_PARAM;case 6:return le.AZTEC_DATA_6;case 8:return le.AZTEC_DATA_8;case 10:return le.AZTEC_DATA_10;case 12:return le.AZTEC_DATA_12;default:throw new u("Unsupported word size "+e)}}static stuffBits(e,t){let r=new b,n=e.getSize(),i=(1<<t)-2;for(let s=0;s<n;s+=t){let a=0;for(let r=0;r<t;r++)(s+r>=n||e.get(s+r))&&(a|=1<<t-1-r);(a&i)===i?(r.appendBits(a&i,t),s--):0===(a&i)?(r.appendBits(1|a,t),s--):r.appendBits(a,t)}return r}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}fn.DEFAULT_EC_PERCENT=33,fn.DEFAULT_AZTEC_LAYERS=0,fn.MAX_NB_BITS=32,fn.MAX_NB_BITS_COMPACT=4,fn.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class gn{encode(e,t,r,n){return this.encodeWithHints(e,t,r,n,null)}encodeWithHints(e,t,r,n,i){let s=qr.ISO_8859_1,a=fn.DEFAULT_EC_PERCENT,o=fn.DEFAULT_AZTEC_LAYERS;return null!=i&&(i.has(Rr.CHARACTER_SET)&&(s=Gr.forName(i.get(Rr.CHARACTER_SET).toString())),i.has(Rr.ERROR_CORRECTION)&&(a=w.parseInt(i.get(Rr.ERROR_CORRECTION).toString())),i.has(Rr.AZTEC_LAYERS)&&(o=w.parseInt(i.get(Rr.AZTEC_LAYERS).toString()))),gn.encodeLayers(e,t,r,n,s,a,o)}static encodeLayers(e,t,r,n,i,s,a){if(t!==G.AZTEC)throw new u("Can only encode AZTEC, but got "+t);let o=fn.encode(j.getBytes(e,i),s,a);return gn.renderResult(o,r,n)}static renderResult(e,t,r){let n=e.getMatrix();if(null==n)throw new de;let i=n.getWidth(),s=n.getHeight(),a=Math.max(t,i),o=Math.max(r,s),l=Math.min(a/i,o/s),c=(a-i*l)/2,d=(o-s*l)/2,u=new D(a,o);for(let h=0,p=d;h<s;h++,p+=l)for(let e=0,t=c;e<i;e++,t+=l)n.get(e,h)&&u.setRegion(t,p,l,l);return u}}e.AbstractExpandedDecoder=Je,e.ArgumentException=d,e.ArithmeticException=oe,e.AztecCode=Xr,e.AztecCodeReader=Ee,e.AztecCodeWriter=gn,e.AztecDecoder=he,e.AztecDetector=Se,e.AztecDetectorResult=xe,e.AztecEncoder=fn,e.AztecHighLevelEncoder=mn,e.AztecPoint=_e,e.BarcodeFormat=G,e.Binarizer=m,e.BinaryBitmap=h,e.BitArray=b,e.BitMatrix=D,e.BitSource=_t,e.BrowserAztecCodeReader=Ae,e.BrowserBarcodeReader=xt,e.BrowserCodeReader=U,e.BrowserDatamatrixCodeReader=jt,e.BrowserMultiFormatReader=Ar,e.BrowserPDF417Reader=Ir,e.BrowserQRCodeReader=jr,e.BrowserQRCodeSvgWriter=zr,e.CharacterSetECI=E,e.ChecksumException=p,e.Code128Reader=je,e.Code39Reader=Te,e.DataMatrixDecodedBitStreamParser=St,e.DataMatrixReader=It,e.DecodeHintType=_,e.DecoderResult=ie,e.DefaultGridSampler=ve,e.DetectorResult=ge,e.EAN13Reader=Me,e.EncodeHintType=Rr,e.Exception=c,e.FormatException=S,e.GenericGF=le,e.GenericGFPoly=ae,e.GlobalHistogramBinarizer=N,e.GridSampler=we,e.GridSamplerInstance=Ce,e.HTMLCanvasElementLuminanceSource=M,e.HybridBinarizer=P,e.ITFReader=De,e.IllegalArgumentException=u,e.IllegalStateException=de,e.InvertedLuminanceSource=k,e.LuminanceSource=O,e.MathUtils=pe,e.MultiFormatOneDReader=gt,e.MultiFormatReader=Er,e.MultiFormatWriter=Wr,e.NotFoundException=R,e.OneDReader=Ie,e.PDF417DecodedBitStreamParser=vr,e.PDF417DecoderErrorCorrection=tr,e.PDF417Reader=_r,e.PDF417ResultMetadata=ur,e.PerspectiveTransform=be,e.PlanarYUVLuminanceSource=Vr,e.QRCodeByteMatrix=Or,e.QRCodeDataMask=Ot,e.QRCodeDecodedBitStreamParser=Lt,e.QRCodeDecoderErrorCorrectionLevel=Tt,e.QRCodeDecoderFormatInformation=Dt,e.QRCodeEncoder=Lr,e.QRCodeEncoderQRCode=kr,e.QRCodeMaskUtil=Pr,e.QRCodeMatrixUtil=Fr,e.QRCodeMode=Bt,e.QRCodeReader=$t,e.QRCodeVersion=Pt,e.QRCodeWriter=Ur,e.RGBLuminanceSource=Hr,e.RSS14Reader=ft,e.RSSExpandedReader=pt,e.ReaderException=Sr,e.ReedSolomonDecoder=ue,e.ReedSolomonEncoder=Nr,e.ReedSolomonException=ce,e.Result=W,e.ResultMetadataType=ne,e.ResultPoint=fe,e.StringUtils=j,e.UnsupportedOperationException=A,e.VideoInputDevice=F,e.WhiteRectangleDetector=ye,e.WriterException=Mr,e.ZXingArrays=y,e.ZXingCharset=Gr,e.ZXingInteger=w,e.ZXingStandardCharsets=qr,e.ZXingStringBuilder=T,e.ZXingStringEncoding=I,e.ZXingSystem=f,e.createAbstractExpandedDecoder=dt,Object.defineProperty(e,"__esModule",{value:!0})}(Bc.exports);var Lc=Bc.exports;const zc=nr({__proto__:null,default:Mt(Lc)},[Lc]);var Uc,Wc,Vc=function(){function e(e,t,r){if(this.formatMap=new Map([[bc.QR_CODE,Lc.BarcodeFormat.QR_CODE],[bc.AZTEC,Lc.BarcodeFormat.AZTEC],[bc.CODABAR,Lc.BarcodeFormat.CODABAR],[bc.CODE_39,Lc.BarcodeFormat.CODE_39],[bc.CODE_93,Lc.BarcodeFormat.CODE_93],[bc.CODE_128,Lc.BarcodeFormat.CODE_128],[bc.DATA_MATRIX,Lc.BarcodeFormat.DATA_MATRIX],[bc.MAXICODE,Lc.BarcodeFormat.MAXICODE],[bc.ITF,Lc.BarcodeFormat.ITF],[bc.EAN_13,Lc.BarcodeFormat.EAN_13],[bc.EAN_8,Lc.BarcodeFormat.EAN_8],[bc.PDF_417,Lc.BarcodeFormat.PDF_417],[bc.RSS_14,Lc.BarcodeFormat.RSS_14],[bc.RSS_EXPANDED,Lc.BarcodeFormat.RSS_EXPANDED],[bc.UPC_A,Lc.BarcodeFormat.UPC_A],[bc.UPC_E,Lc.BarcodeFormat.UPC_E],[bc.UPC_EAN_EXTENSION,Lc.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!zc)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=r;var n=this.createZXingFormats(e),i=new Map;i.set(Lc.DecodeHintType.POSSIBLE_FORMATS,n),i.set(Lc.DecodeHintType.TRY_HARDER,!1),this.hints=i}return e.prototype.decodeAsync=function(e){var t=this;return new Promise((function(r,n){try{r(t.decode(e))}catch(i){n(i)}}))},e.prototype.decode=function(e){var t=new Lc.MultiFormatReader(this.verbose,this.hints),r=new Lc.HTMLCanvasElementLuminanceSource(e),n=new Lc.BinaryBitmap(new Lc.HybridBinarizer(r)),i=t.decode(n);return{text:i.text,format:Rc.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,r,n){e.set(t,r)})),e},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createZXingFormats=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this.formatMap.has(i)?t.push(this.formatMap.get(i)):this.logger.logError("".concat(i," is not supported by")+"ZXingHtml5QrcodeShim")}return t},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),Hc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Gc=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},qc=function(){function e(t,r,n){if(this.formatMap=new Map([[bc.QR_CODE,"qr_code"],[bc.AZTEC,"aztec"],[bc.CODABAR,"codabar"],[bc.CODE_39,"code_39"],[bc.CODE_93,"code_93"],[bc.CODE_128,"code_128"],[bc.DATA_MATRIX,"data_matrix"],[bc.ITF,"itf"],[bc.EAN_13,"ean_13"],[bc.EAN_8,"ean_8"],[bc.PDF_417,"pdf417"],[bc.UPC_A,"upc_a"],[bc.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=n;var i=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){return"BarcodeDetector"in window&&void 0!==new BarcodeDetector({formats:["qr_code"]})},e.prototype.decodeAsync=function(e){return Hc(this,void 0,void 0,(function(){var t,r;return Gc(this,(function(n){switch(n.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=n.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(r=this.selectLargestBarcode(t)).rawValue,format:Rc.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}]}}))}))},e.prototype.selectLargestBarcode=function(e){for(var t=null,r=0,n=0,i=e;n<i.length;n++){var s=i[n],a=s.boundingBox.width*s.boundingBox.height;a>r&&(r=a,t=s)}if(!t)throw"No largest barcode found";return t},e.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];this.formatMap.has(i)?t.push(this.formatMap.get(i)):this.logger.warn("".concat(i," is not supported by")+"BarcodeDetectorDelegate")}return{formats:t}},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,r,n){e.set(t,r)})),e},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),Xc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},$c=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Zc=function(){function e(e,t,r,n){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=r,t&&qc.isSupported()?(this.primaryDecoder=new qc(e,r,n),this.secondaryDecoder=new Vc(e,r,n)):this.primaryDecoder=new Vc(e,r,n)}return e.prototype.decodeAsync=function(e){return Xc(this,void 0,void 0,(function(){var t;return $c(this,(function(r){switch(r.label){case 0:t=performance.now(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,r.sent()];case 3:return this.possiblyLogPerformance(t),[7];case 4:return[2]}}))}))},e.prototype.decodeRobustlyAsync=function(e){return Xc(this,void 0,void 0,(function(){var t,r;return $c(this,(function(n){switch(n.label){case 0:t=performance.now(),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,n.sent()];case 3:if(r=n.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw r;case 4:return this.possiblyLogPerformance(t),[7];case 5:return[2]}}))}))},e.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(e){if(this.verbose){var t=performance.now()-e;this.executionResults.push(t),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,r=this.executionResults;t<r.length;t++){e+=r[t]}var n=e/this.executionResults.length;console.log("".concat(n," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},e}(),Yc=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qc=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},Kc=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},Jc=function(){function e(e,t){this.name=e,this.track=t}return e.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},e.prototype.apply=function(e){var t={};t[this.name]=e;var r={advanced:[t]};return this.track.applyConstraints(r)},e.prototype.value=function(){var e=this.track.getSettings();return this.name in e?e[this.name]:null},e}(),ed=function(e){function t(t){return e.call(this,"zoom",t)||this}return Yc(t,e),t}(function(e){function t(t,r){return e.call(this,t,r)||this}return Yc(t,e),t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var t={};t[this.name]=e;var r={advanced:[t]};return this.track.applyConstraints(r)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities()[this.name];return{min:e.min,max:e.max,step:e.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(Jc)),td=function(e){function t(t){return e.call(this,"torch",t)||this}return Yc(t,e),t}(Jc),rd=function(){function e(e){this.track=e}return e.prototype.zoomFeature=function(){return new ed(this.track)},e.prototype.torchFeature=function(){return new td(this.track)},e}(),nd=function(){function e(e,t,r){this.isClosed=!1,this.parentElement=e,this.mediaStream=t,this.callbacks=r,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return e.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width="".concat(e,"px"),t.style.display="block",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},e.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var t=function(){var r=e.surface.clientWidth,n=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(r,n),e.surface.removeEventListener("playing",t)};this.surface.addEventListener("playing",t),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(t,r,n,i){return Qc(this,void 0,void 0,(function(){var s,a;return Kc(this,(function(o){switch(o.label){case 0:return s=new e(t,r,i),n.aspectRatio?(a={aspectRatio:n.aspectRatio},[4,s.getFirstTrackOrFail().applyConstraints(a)]):[3,2];case 1:o.sent(),o.label=2;case 2:return s.setupSurface(),[2,s]}}))}))},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(e){this.failIfClosed();var t=this,r=function(){setTimeout(e,200),t.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(e){return Qc(this,void 0,void 0,(function(){return Kc(this,(function(t){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]}))}))},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise((function(t,r){var n=e.mediaStream.getVideoTracks().length,i=0;e.mediaStream.getVideoTracks().forEach((function(r){e.mediaStream.removeTrack(r),r.stop(),++i>=n&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),t())}))}))},e.prototype.getCapabilities=function(){return new rd(this.getFirstTrackOrFail())},e}(),id=function(){function e(e){this.mediaStream=e}return e.prototype.render=function(e,t,r){return Qc(this,void 0,void 0,(function(){return Kc(this,(function(n){return[2,nd.create(e,this.mediaStream,t,r)]}))}))},e.create=function(t){return Qc(this,void 0,void 0,(function(){var r;return Kc(this,(function(n){switch(n.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return[2,new e(n.sent())]}}))}))},e}(),sd=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},ad=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},od=function(){function e(){}return e.failIfNotSupported=function(){return sd(this,void 0,void 0,(function(){return ad(this,(function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]}))}))},e.prototype.create=function(e){return sd(this,void 0,void 0,(function(){return ad(this,(function(t){return[2,id.create(e)]}))}))},e}(),ld=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},cd=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},dd=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var t=Mc.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(t=Mc.insecureContextCameraQueryError()),Promise.reject(t)},e.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var e=location.host.split(":")[0];return"127.0.0.1"===e||"localhost"===e},e.getCamerasFromMediaDevices=function(){return ld(this,void 0,void 0,(function(){var e,t,r,n,i,s,a;return cd(this,(function(o){switch(o.label){case 0:return e=function(e){for(var t=0,r=e.getVideoTracks();t<r.length;t++){var n=r[t];n.enabled=!1,n.stop(),e.removeTrack(n)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return t=o.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(r=o.sent(),n=[],i=0,s=r;i<s.length;i++)"videoinput"===(a=s[i]).kind&&n.push({id:a.deviceId,label:a.label});return e(t),[2,n]}}))}))},e.getCamerasFromMediaStreamTrack=function(){return new Promise((function(e,t){MediaStreamTrack.getSources((function(t){for(var r=[],n=0,i=t;n<i.length;n++){var s=i[n];"video"===s.kind&&r.push({id:s.id,label:s.label})}e(r)}))}))},e}();(Wc=Uc||(Uc={}))[Wc.UNKNOWN=0]="UNKNOWN",Wc[Wc.NOT_STARTED=1]="NOT_STARTED",Wc[Wc.SCANNING=2]="SCANNING",Wc[Wc.PAUSED=3]="PAUSED";var ud,hd,pd=function(){function e(){this.state=Uc.NOT_STARTED,this.onGoingTransactionNewState=Uc.UNKNOWN}return e.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},e.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===Uc.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Uc.UNKNOWN,this.directTransition(e)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===Uc.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Uc.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Uc.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(e){switch(this.state){case Uc.UNKNOWN:throw"Transition from unknown is not allowed";case Uc.NOT_STARTED:this.failIfNewStateIs(e,[Uc.PAUSED]);case Uc.SCANNING:case Uc.PAUSED:}},e.prototype.failIfNewStateIs=function(e,t){for(var r=0,n=t;r<n.length;r++){if(e===n[r])throw"Cannot transition from ".concat(this.state," to ").concat(e)}},e}(),md=function(){function e(e){this.stateManager=e}return e.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},e.prototype.directTransition=function(e){this.stateManager.directTransition(e)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===Uc.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==Uc.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Uc.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===Uc.PAUSED},e}(),fd=function(){function e(){}return e.create=function(){return new md(new pd)},e}(),gd=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gd(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(Dc),yd=function(){function e(e,t){this.logger=t,this.fps=xd.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=xd.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Fc.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!kc(this.qrbox)},e.create=function(t,r){return new e(t,r)},e}(),wd=function(){function e(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");var r;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(r=t,this.verbose=!0===r.verbose,r.experimentalFeatures),this.logger=new Oc(this.verbose),this.qrcode=new Zc(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=fd.create()}return e.prototype.start=function(e,t,r,n){var i,s=this;if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i=n||(this.verbose?this.logger.log:function(){});var a=yd.create(t,this.logger);this.clearElement();var o=!1;a.videoConstraints&&(a.isMediaStreamConstraintsValid()?o=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var l=o,c=document.getElementById(this.elementId);c.clientWidth?c.clientWidth:xd.DEFAULT_WIDTH,c.style.position="relative",this.shouldScan=!0,this.element=c;var d=this,u=this.stateManagerProxy.startTransition(Uc.SCANNING);return new Promise((function(t,n){var o=l?a.videoConstraints:d.createVideoConstraints(e);if(!o)return u.cancel(),void n("videoConstraints should be defined");var c={};l&&!a.aspectRatio||(c.aspectRatio=a.aspectRatio);var h={onRenderSurfaceReady:function(e,t){d.setupUi(e,t,a),d.isScanning=!0,d.foreverScan(a,r,i)}};od.failIfNotSupported().then((function(e){e.create(o).then((function(e){return e.render(s.element,c,h).then((function(e){d.renderedCamera=e,u.execute(),t(null)})).catch((function(e){u.cancel(),n(e)}))})).catch((function(e){u.cancel(),n(Mc.errorGettingUserMedia(e))}))})).catch((function(e){u.cancel(),n(Mc.cameraStreamingNotSupported())}))}))},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Uc.PAUSED),this.showPausedState(),(kc(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(Uc.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((function(){t()})):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(Uc.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=this;return this.renderedCamera.close().then((function(){return r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),function(){if(e.element){var t=document.getElementById(xd.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}}(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),t.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve()}))},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then((function(e){return e.decodedText}))},e.prototype.scanFileV2=function(e,t){var r=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(kc(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise((function(n,i){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var s=new Image;s.onload=function(){var e=s.width,a=s.height,o=document.getElementById(r.elementId),l=o.clientWidth?o.clientWidth:xd.DEFAULT_WIDTH,c=Math.max(o.clientHeight?o.clientHeight:a,xd.FILE_SCAN_MIN_HEIGHT),d=r.computeCanvasDrawConfig(e,a,l,c);if(t){var u=r.createCanvasElement(l,c,"qr-canvas-visible");u.style.display="inline-block",o.appendChild(u);var h=u.getContext("2d");if(!h)throw"Unable to get 2d context from canvas";h.canvas.width=l,h.canvas.height=c,h.drawImage(s,0,0,e,a,d.x,d.y,d.width,d.height)}var p=xd.FILE_SCAN_HIDDEN_CANVAS_PADDING,m=Math.max(s.width,d.width),f=Math.max(s.height,d.height),g=m+2*p,x=f+2*p,y=r.createCanvasElement(g,x);o.appendChild(y);var w=y.getContext("2d");if(!w)throw"Unable to get 2d context from canvas";w.canvas.width=g,w.canvas.height=x,w.drawImage(s,0,0,e,a,p,p,m,f);try{r.qrcode.decodeRobustlyAsync(y).then((function(e){n(Nc.createFromQrcodeResult(e))})).catch(i)}catch(b){i("QR code parse error, error = ".concat(b))}},s.onerror=i,s.onabort=i,s.onstalled=i,s.onsuspend=i,s.src=URL.createObjectURL(e)}))},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return dd.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(!e)throw"videoConstaints is required argument.";if(!Fc.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[bc.QR_CODE,bc.AZTEC,bc.CODABAR,bc.CODE_39,bc.CODE_93,bc.CODE_128,bc.DATA_MATRIX,bc.MAXICODE,bc.ITF,bc.EAN_13,bc.EAN_8,bc.PDF_417,bc.RSS_14,bc.RSS_EXPANDED,bc.UPC_A,bc.UPC_E,bc.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],n=0,i=e.formatsToSupport;n<i.length;n++){var s=i[n];Ic(s)?r.push(s):this.logger.warn("Invalid format: ".concat(s," passed in config, ignoring."))}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(kc(e))return!0;if(!kc(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(kc(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!kc(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,r){var n=this,i=r.qrbox;this.validateQrboxConfig(i);var s,a=this.toQrdimensions(e,t,i),o=function(e){if(e<xd.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(xd.MIN_QR_BOX_SIZE,"px.")};o(a.width),o(a.height),a.width=((s=a.width)>e&&(n.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),s=e),s)},e.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,r){if("number"==typeof r)return{width:r,height:r};if("function"==typeof r)try{return r(e,t)}catch(n){throw new Error("qrbox config was passed as a function but it failed with unknown error"+n)}return r},e.prototype.setupUi=function(e,t,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,r);var n=kc(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(n);var i=this.toQrdimensions(e,t,n);i.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=r.isShadedBoxEnabled()&&i.height<=t,a={x:0,y:0,width:e,height:t},o=s?this.getShadedRegionBounds(e,t,i):a,l=this.createCanvasElement(o.width,o.height),c=l.getContext("2d",{willReadFrequently:!0});c.canvas.width=o.width,c.canvas.height=o.height,this.element.append(l),s&&this.possiblyInsertShadingElement(this.element,e,t,i),this.createScannerPausedUiElement(this.element),this.qrRegion=o,this.context=c,this.canvasElement=l},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText=Mc.scannerPaused(),t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="rgba(9, 9, 9, 0.46)",t.style.color="#FFECEC",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((function(t){return e(t.text,Nc.createFromQrcodeResult(t)),r.possiblyUpdateShaders(!0),!0})).catch((function(e){r.possiblyUpdateShaders(!1);var n=Mc.codeParseError(e);return t(n,Pc.createFrom(n)),!1}))},e.prototype.foreverScan=function(e,t,r){var n=this;if(this.shouldScan&&this.renderedCamera){var i=this.renderedCamera.getSurface(),s=i.videoWidth/i.clientWidth,a=i.videoHeight/i.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var o=this.qrRegion.width*s,l=this.qrRegion.height*a,c=this.qrRegion.x*s,d=this.qrRegion.y*a;this.context.drawImage(i,c,d,o,l,0,0,this.qrRegion.width,this.qrRegion.height);var u=function(){n.foreverScanTimeout=setTimeout((function(){n.foreverScan(e,t,r)}),n.getTimeoutFps(e.fps))};this.scanContext(t,r).then((function(i){i||!0===e.disableFlip?u():(n.context.translate(n.context.canvas.width,0),n.context.scale(-1,1),n.scanContext(t,r).finally((function(){u()})))})).catch((function(e){n.logger.logError("Error happend while scanning context",e),u()}))}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",n={user:!0,environment:!0},i="exact",s=function(e){if(e in n)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(e,"'")},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(a.length," keys");var o=Object.keys(e)[0];if(o!==t&&o!==r)throw"Only '".concat(t,"' and '").concat(r,"' ")+" are supported for 'cameraIdOrConfig'";if(o!==t){var l=e.deviceId;if("string"==typeof l)return{deviceId:l};if("object"==typeof l){if(i in l)return{deviceId:{exact:l["".concat(i)]}};throw"'deviceId' should be string or object with"+" ".concat(i," as key.")}throw"Invalid type of 'deviceId' = ".concat(typeof l)}var c=e.facingMode;if("string"==typeof c){if(s(c))return{facingMode:c}}else{if("object"!=typeof c)throw"Invalid type of 'facingMode' = ".concat(typeof c);if(!(i in c))throw"'facingMode' should be string or object with"+" ".concat(i," as key.");if(s(c["".concat(i)]))return{facingMode:{exact:c["".concat(i)]}}}}throw"Invalid type of 'cameraIdOrConfig' = ".concat(typeof e)},e.prototype.computeCanvasDrawConfig=function(e,t,r,n){if(e<=r&&t<=n)return{x:(r-e)/2,y:(n-t)/2,width:e,height:t};var i=e,s=t;return e>r&&(t*=r/e,e=r),t>n&&(e*=n/t,t=n),this.logger.log("Image downsampled from "+"".concat(i,"X").concat(s)+" to ".concat(e,"X").concat(t,".")),this.computeCanvasDrawConfig(e,t,r,n)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(t){t.style.backgroundColor=e?xd.BORDER_SHADER_MATCH_COLOR:xd.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,r){var n=e,i=t,s=document.createElement("canvas");return s.style.width="".concat(n,"px"),s.style.height="".concat(i,"px"),s.style.display="none",s.id=kc(r)?"qr-canvas":r,s},e.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},e.prototype.possiblyInsertShadingElement=function(e,t,r,n){if(!(t-n.width<1||r-n.height<1)){var i=document.createElement("div");i.style.position="absolute";var s=(t-n.width)/2,a=(r-n.height)/2;if(i.style.borderLeft="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderRight="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderTop="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderBottom="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.boxSizing="border-box",i.style.top="0px",i.style.bottom="0px",i.style.left="0px",i.style.right="0px",i.id="".concat(xd.SHADED_REGION_ELEMENT_ID),t-n.width<11||r-n.height<11)this.hasBorderShaders=!1;else{var o=40;this.insertShaderBorders(i,o,5,-5,null,0,!0),this.insertShaderBorders(i,o,5,-5,null,0,!1),this.insertShaderBorders(i,o,5,null,-5,0,!0),this.insertShaderBorders(i,o,5,null,-5,0,!1),this.insertShaderBorders(i,5,45,-5,null,-5,!0),this.insertShaderBorders(i,5,45,null,-5,-5,!0),this.insertShaderBorders(i,5,45,-5,null,-5,!1),this.insertShaderBorders(i,5,45,null,-5,-5,!1),this.hasBorderShaders=!0}e.append(i)}},e.prototype.insertShaderBorders=function(e,t,r,n,i,s,a){var o=document.createElement("div");o.style.position="absolute",o.style.backgroundColor=xd.BORDER_SHADER_DEFAULT_COLOR,o.style.width="".concat(t,"px"),o.style.height="".concat(r,"px"),null!==n&&(o.style.top="".concat(n,"px")),null!==i&&(o.style.bottom="".concat(i,"px")),a?o.style.left="".concat(s,"px"):o.style.right="".concat(s,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(o),e.appendChild(o)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}();(hd=ud||(ud={}))[hd.STATUS_DEFAULT=0]="STATUS_DEFAULT",hd[hd.STATUS_SUCCESS=1]="STATUS_SUCCESS",hd[hd.STATUS_WARNING=2]="STATUS_WARNING",hd[hd.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION";const bd=(e,t)=>{const[r,n]=jt.useState({isOpen:!1,isScanning:!1,scannedProduct:null,scannedQuantity:1,error:null,permissionDenied:!1,permissionStatus:"unknown"}),[i,s]=jt.useState(null),a=jt.useCallback((async e=>{if(e)try{await e.stop()}catch(t){}}),[]);jt.useEffect((()=>()=>{a(i)}),[i,a]);const o=jt.useCallback((()=>{n((e=>({...e,isOpen:!0,scannedProduct:null,scannedQuantity:1,error:null,permissionDenied:!1,permissionStatus:"unknown"})))}),[]),l=jt.useCallback((async()=>{await a(i),n((e=>({...e,isOpen:!1,isScanning:!1,scannedProduct:null,scannedQuantity:1,error:null,permissionDenied:!1})))}),[i,a]),c=jt.useCallback((async(t,r)=>{await a(r);const i=e.find((e=>e.reference===t));if(i){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination),t.frequency.value=800,t.type="sine",r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),t.start(e.currentTime),t.stop(e.currentTime+.2)}catch(s){console.debug("Could not play success sound:",s)}n((e=>({...e,isScanning:!1,scannedProduct:i,error:null})))}else n((e=>({...e,isScanning:!1,scannedProduct:null,error:`Aucun produit trouvÃ© avec le code-barres: ${t}`})))}),[e,a]),d=jt.useCallback((async e=>{var t,r,o,l,d,u,h;try{await a(i);const t=new wd(e);s(t);const r=await wd.getCameras();if(!(r&&r.length>0))throw new Error("No cameras found");await t.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},(e=>{c(e,t)}),(e=>{console.debug("QR scan error:",e)})),n((e=>({...e,isScanning:!0,error:null,permissionStatus:"granted",permissionDenied:!1})))}catch(p){console.error("Error starting scanner:",p);const e=p;let i="Impossible de dÃ©marrer la camÃ©ra.";(null==(t=e.message)?void 0:t.includes("NotAllowedError"))||(null==(r=e.message)?void 0:r.includes("Permission"))?(i="AccÃ¨s Ã  la camÃ©ra refusÃ©. Veuillez autoriser l'accÃ¨s dans votre navigateur.",n((e=>({...e,permissionDenied:!0,permissionStatus:"denied"})))):(null==(o=e.message)?void 0:o.includes("NotFoundError"))||(null==(l=e.message)?void 0:l.includes("No cameras"))?i="Aucune camÃ©ra dÃ©tectÃ©e. Vous pouvez scanner un fichier QR code Ã  la place.":(null==(d=e.message)?void 0:d.includes("NotReadableError"))?i="La camÃ©ra est dÃ©jÃ  utilisÃ©e par une autre application.":((null==(u=e.message)?void 0:u.includes("not supported"))||(null==(h=e.message)?void 0:h.includes("HTTPS")))&&(i="Le streaming camÃ©ra nÃ©cessite HTTPS. Utilisez localhost ou un serveur HTTPS."),n((e=>({...e,error:i,isScanning:!1})))}}),[c,i,a]),u=jt.useCallback((async()=>{await a(i),n((e=>({...e,isScanning:!1})))}),[i,a]),h=jt.useCallback((e=>{n((t=>({...t,scannedQuantity:e})))}),[]),p=jt.useCallback((()=>{r.scannedProduct&&(t(r.scannedProduct,r.scannedQuantity),n((e=>({...e,scannedProduct:null,scannedQuantity:1}))))}),[r.scannedProduct,r.scannedQuantity,t]),m=jt.useCallback((()=>{n((e=>({...e,error:null})))}),[]);return{qrState:r,openScanner:o,closeScanner:l,setScannedQuantity:h,addScannedProduct:p,clearError:m,startScanning:d,stopScanning:u}},vd=({open:e,mode:r,sale:n,clients:i,zones:s,productsWithStock:a,availableStock:o,saleDialog:l,onClose:u,updateSaleDialog:h,onSuccess:p,onError:m,refreshData:g})=>{var x,y;const w=l.selectedClient,b=l.selectedZone,v=l.selectedProducts,C=l.currentProduct,_=l.currentQuantity,[S,E]=jt.useState(""),[A,I]=jt.useState(null),j=A||n,T=bd(a||[],((e,t)=>{const r=N(e,t);h(r?{currentProduct:null,currentQuantity:1}:{currentProduct:e,currentQuantity:t})}));jt.useEffect((()=>{(async()=>{if(e&&n&&"edit"===r){if((null==A?void 0:A.id)===n.id)return void console.log("Sale already loaded, skipping fetch");try{console.log("Fetching sale details for sale ID:",n.id);const e=await(async e=>(await rs.get(`/sales/sales/${e}/`)).data)(n.id);if(console.log("Fetched sale details:",e),I(e),e.client&&i){const t=i.find((t=>t.id===e.client));console.log("Found client:",t),t&&h({selectedClient:t})}if(e.zone&&(console.log("Setting zone:",e.zone),h({selectedZone:e.zone})),e.items&&e.items.length>0){console.log("Setting products from items:",e.items);const t=e.items.map((e=>({product:{id:e.product,name:e.product_name||"N/A",reference:"",description:"",category:0,unit:0,min_stock_level:0,purchase_price:0,selling_price:e.unit_price,is_raw_material:!1,is_active:!0},quantity:e.quantity})));h({selectedProducts:t}),console.log("Products set:",t)}else console.log("No items found in sale details")}catch(t){console.error("Error fetching sale details:",t),m("Erreur lors de la rÃ©cupÃ©ration des dÃ©tails de la vente")}}else e||(console.log("Dialog closed, resetting state"),I(null),h({selectedClient:null,selectedZone:null,selectedProducts:[],currentProduct:null,currentQuantity:1}),E(""))})()}),[e,null==n?void 0:n.id,r]);const D=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),R=()=>v.reduce(((e,t)=>e+(t.product.selling_price||0)*t.quantity),0),N=(e,t)=>{if(!e||t<=0)return!1;if(!b)return E("Veuillez sÃ©lectionner une zone avant d'ajouter des produits"),!1;const r=v.findIndex((t=>t.product.id===e.id)),n=o[e.id]||0,i=r>=0?v[r].quantity:0,s=i+t;if(s>n)return E(`Stock insuffisant pour ${e.name}. Stock disponible: ${n}, dÃ©jÃ  dans le panier: ${i}`),!1;if(E(""),r>=0){const e=[...v];e[r]={...e[r],quantity:s},h({selectedProducts:e})}else h({selectedProducts:[...v,{product:e,quantity:t}]});return!0};return t.jsxs(t.Fragment,{children:[t.jsxs(xe,{open:e,onClose:u,maxWidth:"md",fullWidth:!0,children:[t.jsx(ye,{children:"edit"===r?"Modifier la vente":"Nouvelle vente"}),t.jsxs(we,{children:["edit"===r&&j&&t.jsx(c,{sx:{mb:3},children:t.jsx(xl,{status:j.status,reference:j.reference||"",allowedTransitions:(e=>{switch(e){case"draft":return["pending","cancelled"];case"pending":return["confirmed","cancelled"];case"confirmed":return["payment_pending","paid","cancelled"];case"payment_pending":case"partially_paid":return["paid","cancelled"];case"paid":return["shipped","cancelled"];case"shipped":return["delivered","cancelled"];case"delivered":return["completed","cancelled"];default:return[]}})(j.status),onStatusChange:async e=>{try{await So(j.id,{status:e}),p(`Statut de la vente mis Ã  jour: ${e}`),g&&await g(),u()}catch(t){m("Erreur lors de la mise Ã  jour du statut")}}})}),"edit"===r&&j&&t.jsxs(oe,{container:!0,spacing:2,children:[t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"RÃ©fÃ©rence",value:j.reference||"",disabled:!0,fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date",value:j.date||"",disabled:!0,fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Client",value:(null==w?void 0:w.name)||j.client_name||"Chargement...",disabled:!0,fullWidth:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Zone",value:b?null==(x=null==s?void 0:s.find((e=>e.id===b)))?void 0:x.name:j.zone_name||"Chargement...",disabled:!0,fullWidth:!0})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Articles"}),j.items&&j.items.length>0?t.jsx(We,{component:U,variant:"outlined",children:t.jsxs(Ve,{size:"small",children:[t.jsx(He,{children:t.jsxs(Ge,{children:[t.jsx(qe,{children:"Produit"}),t.jsx(qe,{align:"right",children:"Prix unitaire"}),t.jsx(qe,{align:"right",children:"QuantitÃ©"}),t.jsx(qe,{align:"right",children:"Total"})]})}),t.jsx(Xe,{children:null==(y=j.items)?void 0:y.map(((e,r)=>t.jsxs(Ge,{children:[t.jsx(qe,{children:e.product_name||"N/A"}),t.jsx(qe,{align:"right",children:D(e.unit_price)}),t.jsx(qe,{align:"right",children:e.quantity}),t.jsx(qe,{align:"right",children:D(e.total)})]},r)))})]})}):t.jsx(c,{sx:{p:3,textAlign:"center"},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Chargement des articles..."})})]})]}),"edit"!==r&&t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:i||[],getOptionLabel:e=>e.name,value:w,onChange:(e,t)=>{h({selectedClient:t})},renderInput:e=>t.jsx(V,{...e,label:"Client",variant:"outlined",fullWidth:!0,required:!0}),renderOption:(e,t)=>jt.createElement("li",{...e,key:`client-${t.id}`},t.name)})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"Zone"}),t.jsxs(K,{value:b,onChange:e=>h({selectedZone:e.target.value}),label:"Zone",children:[t.jsx(B,{value:"",children:"SÃ©lectionner une zone"}),(s||[]).map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Ajouter des produits"}),t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[t.jsx(Ue,{options:a||[],getOptionLabel:e=>`${e.name} (Stock: ${o[e.id]||0})`,value:C,onChange:(e,t)=>{h({currentProduct:t,currentQuantity:1})},renderInput:e=>t.jsx(V,{...e,label:"Produit",variant:"outlined",fullWidth:!0}),renderOption:(e,t)=>jt.createElement("li",{...e,key:`product-${t.id}`},t.name," - Stock disponible: ",o[t.id]||0),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"number",value:_,onChange:e=>h({currentQuantity:Math.max(1,parseInt(e.target.value)||1)}),sx:{width:100},inputProps:{min:1}}),t.jsx(f,{color:"primary",onClick:T.openScanner,title:"Scanner QR",sx:{height:"fit-content"},children:t.jsx($e,{})}),t.jsx(k,{variant:"contained",onClick:()=>{if(!C)return;N(C,_)&&h({currentProduct:null,currentQuantity:1})},disabled:!C||_<=0,sx:{height:"fit-content"},children:"Ajouter"})]}),S&&t.jsx(W,{severity:"warning",sx:{mt:1,mb:2},children:S})]}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsxs(d,{variant:"subtitle1",gutterBottom:!0,children:["Panier (",v.length," produit",1!==v.length?"s":"",")"]}),v.length>0?t.jsx(We,{component:U,variant:"outlined",children:t.jsxs(Ve,{size:"small",children:[t.jsx(He,{children:t.jsxs(Ge,{children:[t.jsx(qe,{children:"Produit"}),t.jsx(qe,{align:"right",children:"Prix unitaire"}),t.jsx(qe,{align:"right",children:"QuantitÃ©"}),t.jsx(qe,{align:"right",children:"Total"}),t.jsx(qe,{align:"right",children:"Actions"})]})}),t.jsxs(Xe,{children:[v.map(((e,r)=>t.jsxs(Ge,{children:[t.jsx(qe,{children:e.product.name}),t.jsx(qe,{align:"right",children:D(e.product.selling_price)}),t.jsx(qe,{align:"right",children:e.quantity}),t.jsx(qe,{align:"right",children:D(e.product.selling_price*e.quantity)}),t.jsx(qe,{align:"right",children:t.jsx(f,{size:"small",color:"error",onClick:()=>(e=>{h({selectedProducts:v.filter(((t,r)=>r!==e))})})(r),children:t.jsx(Ze,{fontSize:"small"})})})]},r))),t.jsxs(Ge,{children:[t.jsx(qe,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total"}),t.jsx(qe,{align:"right",sx:{fontWeight:"bold"},children:D(R())}),t.jsx(qe,{})]})]})]})}):t.jsx(U,{variant:"outlined",sx:{p:3,textAlign:"center"},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucun produit sÃ©lectionnÃ©"})})]})]})]}),t.jsxs(be,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(k,{onClick:u,children:"Annuler"}),"edit"!==r&&t.jsx(k,{variant:"contained",onClick:async()=>{var e,t;try{if(!w||0===v.length)return void m("Veuillez sÃ©lectionner un client et ajouter des produits");if(!b)return void m("Veuillez sÃ©lectionner une zone");const e=Number(R().toFixed(2)),t=Number((0*e).toFixed(2)),i=Number((e+t).toFixed(2)),s=i,a=0,o={client:w.id,zone:b,date:(new Date).toISOString().split("T")[0],status:(null==n?void 0:n.status)||"pending",subtotal:e,tax_amount:t,total_amount:i,remaining_amount:s,paid_amount:a,items:v.map((e=>({product:e.product.id,quantity:e.quantity,unit_price:e.product.selling_price||0,discount_percentage:0,total_price:(e.product.selling_price||0)*e.quantity})))};"edit"===r&&(null==n?void 0:n.id)?(await So(n.id,o),p(`Vente ${n.reference||n.id} modifiÃ©e avec succÃ¨s`)):(await _o(o),p("Vente crÃ©Ã©e avec succÃ¨s")),g&&await g(),u(),h({selectedClient:null,selectedZone:1,selectedProducts:[],currentProduct:null,currentQuantity:1}),E("")}catch(i){console.error("Error saving sale:",i);const r=i&&"object"==typeof i&&"response"in i&&(null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.error)?String(i.response.data.error):"Erreur lors de l'enregistrement de la vente";m(r)}},disabled:!w||0===v.length,startIcon:t.jsx(Oe,{}),children:"CrÃ©er la vente"})]})]}),t.jsx(hc,{scanner:T,stockError:S})]})},Cd=({open:e,mode:r,invoice:n,invoiceDialog:i,sales:s,clients:a,onClose:o,updateInvoiceDialog:l,onSuccess:u,onError:h,refreshData:p})=>{var m;const[f,g]=jt.useState({}),x=i.selectedSale;jt.useEffect((()=>{(async()=>{if(e&&n&&"edit"===r)try{const e=await(async e=>(await rs.get(`/sales/invoices/${e}/`)).data)(n.id);console.log("Invoice details fetched:",e);const t=["draft","sent","paid","overdue","cancelled"].includes(e.status)?e.status:"draft";if(g({date:e.date||"",due_date:e.due_date||"",notes:e.notes||"",status:t}),e.sale&&s){const t=s.find((t=>t.id===e.sale));t&&l({selectedSale:t})}}catch(t){console.error("Error fetching invoice details:",t),h("Erreur lors de la rÃ©cupÃ©ration des dÃ©tails de la facture")}else e||g({})})()}),[e,null==n?void 0:n.id,r,n,h,s,l]);const y=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(e);return t.jsxs(xe,{open:e,onClose:o,maxWidth:"md",fullWidth:!0,children:[t.jsx(ye,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Ie,{sx:{mr:1,color:"primary.main"}}),"edit"===r?"Modifier la facture":"Nouvelle facture"]})}),t.jsx(we,{children:t.jsxs(oe,{container:!0,spacing:3,sx:{mt:1},children:["edit"!==r&&t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:(s||[]).filter((e=>"payment_pending"===e.status||"confirmed"===e.status||"completed"===e.status)),getOptionLabel:e=>{const t=(a||[]).find((t=>t.id===e.client));return`${e.reference} - ${(null==t?void 0:t.name)||"N/A"} (${y(e.total_amount)})`},value:x,onChange:(e,t)=>{l({selectedSale:t})},renderInput:e=>t.jsx(V,{...e,label:"Vente associÃ©e *",variant:"outlined",fullWidth:!0,helperText:"SÃ©lectionnez une vente confirmÃ©e ou livrÃ©e sans facture existante"}),renderOption:(e,r)=>{var n;return jt.createElement("li",{...e,key:`sale-${r.id}`},t.jsxs(c,{children:[t.jsxs(d,{variant:"body1",children:[r.reference," - ",(null==(n=(a||[]).find((e=>e.id===r.client)))?void 0:n.name)||"N/A"]}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Montant: ",y(r.total_amount)," â€¢ Date: ",new Date(r.date).toLocaleDateString()]})]}))},noOptionsText:"Aucune vente Ã©ligible pour facturation"})}),x&&t.jsxs(t.Fragment,{children:[t.jsx(oe,{item:!0,xs:12,children:t.jsxs(U,{sx:{p:2,bgcolor:"background.default"},children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"DÃ©tails de la vente"}),t.jsxs(oe,{container:!0,spacing:2,children:[t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Client:"}),t.jsx(d,{variant:"body1",children:(null==(m=(a||[]).find((e=>e.id===x.client)))?void 0:m.name)||"N/A"})]}),t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Date de vente:"}),t.jsx(d,{variant:"body1",children:new Date(x.date).toLocaleDateString()})]}),t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total:"}),t.jsx(d,{variant:"h6",color:"primary",children:y(x.total_amount)})]}),t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Statut:"}),t.jsx(pl,{status:x.status,size:"small"})]})]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©mission",type:"date",fullWidth:!0,value:"edit"===r?f.date||(null==n?void 0:n.date):i.date,onChange:e=>{"edit"===r?g({...f,date:e.target.value}):l({date:e.target.value})},InputLabelProps:{shrink:!0},required:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'Ã©chÃ©ance",type:"date",fullWidth:!0,value:"edit"===r?f.due_date||(null==n?void 0:n.due_date):i.due_date,onChange:e=>{"edit"===r?g({...f,due_date:e.target.value}):l({due_date:e.target.value})},InputLabelProps:{shrink:!0},required:!0})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:3,fullWidth:!0,value:"edit"===r?f.notes||(null==n?void 0:n.notes)||"":i.notes,onChange:e=>{"edit"===r?g({...f,notes:e.target.value}):l({notes:e.target.value})},placeholder:"Notes additionnelles pour la facture..."})})]})]})}),t.jsxs(be,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(k,{onClick:o,children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e,t;try{if(!x&&"edit"!==r)return void h("Veuillez sÃ©lectionner une vente");if("edit"===r&&(null==n?void 0:n.id)){const e=await Io(n.id,{date:f.date||n.date,due_date:f.due_date||n.due_date,notes:f.notes||n.notes});u(`Facture ${e.reference} modifiÃ©e avec succÃ¨s`)}else if(x){const e=`INV-${(new Date).getFullYear()}-${Date.now().toString().slice(-6)}`,t=await Ao({reference:e,sale:x.id,date:i.date,due_date:i.due_date,amount:x.total_amount,balance:x.total_amount-(x.paid_amount||0),notes:i.notes});u(`Facture ${t.reference} crÃ©Ã©e avec succÃ¨s`)}p&&await p(),o(),g({})}catch(s){console.error("Error saving invoice:",s);const r=s instanceof Error&&"response"in s?String(null==(t=null==(e=null==s?void 0:s.response)?void 0:e.data)?void 0:t.error):"Erreur lors de l'enregistrement de la facture";h(r)}},disabled:!x,startIcon:t.jsx(Oe,{}),children:"edit"===r?"Enregistrer":"CrÃ©er la facture"})]})]})},_d=({open:e,mode:r,quote:n,quoteDialog:i,clients:s,products:a,onClose:o,updateQuoteDialog:l,addProductToQuote:u,removeProductFromQuote:h,onSuccess:p,onError:m,refreshData:g})=>{const[x,y]=jt.useState({status:"draft"}),[w,b]=jt.useState(""),v=i.selectedClient,C=i.selectedProducts,_=i.currentProduct,S=i.currentQuantity;jt.useEffect((()=>{(async()=>{var t;if(e&&n&&"edit"===r)try{const e=await(async e=>(await rs.get(`/sales/quotes/${e}/`)).data)(n.id);if(console.log("Quote details fetched:",e),e.client&&s){const t=s.find((t=>t.id===e.client));t&&l({selectedClient:t})}if(y({status:e.status||"draft",date:e.date||"",expiry_date:e.expiry_date||"",notes:e.notes||""}),l({date:e.date||"",expiry_date:e.expiry_date||"",notes:e.notes||""}),e.items&&e.items.length>0){console.log("Quote items found:",e.items),console.log("All products available:",null==a?void 0:a.length);const t=e.items.map((e=>{const t=null==a?void 0:a.find((t=>t.id===e.product));return t?console.log("Found full product for item:",t.name):console.log("Using fallback product data for item:",e.product_name),{product:t||{id:e.product,name:e.product_name,reference:"",description:"",category:0,unit:0,min_stock_level:0,purchase_price:0,selling_price:e.unit_price,is_raw_material:!1,is_active:!0},quantity:e.quantity}}));console.log("Setting products to dialog:",t),l({selectedProducts:t})}else console.log("No items found in quote details"),console.log("Items array:",e.items),console.log("Items length:",null==(t=e.items)?void 0:t.length)}catch(i){console.error("Error fetching quote details:",i),m("Erreur lors de la rÃ©cupÃ©ration des dÃ©tails du devis")}else e||(console.log("Quote dialog closed, resetting state"),y({status:"draft"}),b(""),l({selectedClient:null,selectedProducts:[],currentProduct:null,currentQuantity:1,date:"",expiry_date:"",notes:""}))})()}),[e,null==n?void 0:n.id,r]);const E=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(e),A=()=>C.reduce(((e,t)=>e+(t.product.selling_price||0)*t.quantity),0);return t.jsxs(xe,{open:e,onClose:o,maxWidth:"md",fullWidth:!0,children:[t.jsx(ye,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider"},children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Ie,{sx:{mr:1,color:"primary.main"}}),"edit"===r?"Modifier le devis":"Nouveau devis"]})}),t.jsx(we,{children:t.jsxs(oe,{container:!0,spacing:3,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:s||[],getOptionLabel:e=>e.name,value:v,onChange:(e,t)=>{l({selectedClient:t})},renderInput:e=>t.jsx(V,{...e,label:"Client",variant:"outlined",fullWidth:!0,required:!0}),renderOption:(e,t)=>jt.createElement("li",{...e,key:`client-${t.id}`},t.name)})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date du devis",type:"date",fullWidth:!0,value:i.date,onChange:e=>l({date:e.target.value}),InputLabelProps:{shrink:!0},required:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Date d'expiration",type:"date",fullWidth:!0,value:i.expiry_date,onChange:e=>l({expiry_date:e.target.value}),InputLabelProps:{shrink:!0},helperText:"Date limite de validitÃ© du devis",required:!0})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:x.status||"draft",onChange:e=>y({...x,status:e.target.value}),label:"Statut",children:[t.jsx(B,{value:"draft",children:"Brouillon"}),t.jsx(B,{value:"sent",children:"EnvoyÃ©"}),t.jsx(B,{value:"accepted",children:"AcceptÃ©"}),t.jsx(B,{value:"rejected",children:"RejetÃ©"}),t.jsx(B,{value:"expired",children:"ExpirÃ©"})]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"ValiditÃ© du devis",value:i.expiry_date?`${Math.max(0,Math.ceil((new Date(i.expiry_date).getTime()-(new Date).getTime())/864e5))} jours`:"30 jours",fullWidth:!0,disabled:!0,helperText:"Jours restants de validitÃ©"})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(d,{variant:"subtitle1",gutterBottom:!0,children:"Produits du devis"}),t.jsxs(c,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[t.jsx(Ue,{options:a||[],getOptionLabel:e=>`${e.name} (Prix: ${E(e.selling_price)})`,value:_,onChange:(e,t)=>{l({currentProduct:t,currentQuantity:1})},renderInput:e=>t.jsx(V,{...e,label:"SÃ©lectionner un produit",variant:"outlined",fullWidth:!0}),renderOption:(e,r)=>jt.createElement("li",{...e,key:`product-${r.id}`},t.jsxs(c,{sx:{width:"100%"},children:[t.jsx(d,{variant:"body1",children:r.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Prix: ",E(r.selling_price)," â€¢ RÃ©f: ",r.reference]})]})),sx:{flexGrow:1}}),t.jsx(V,{label:"QuantitÃ©",type:"number",value:S,onChange:e=>l({currentQuantity:Math.max(1,parseInt(e.target.value)||1)}),sx:{width:120},inputProps:{min:1}}),t.jsx(k,{variant:"contained",onClick:()=>{const e=u();b(e?"":"Veuillez sÃ©lectionner un produit et une quantitÃ© valide")},disabled:!_||S<=0,sx:{height:"fit-content",px:3},children:"Ajouter"})]}),w&&t.jsx(W,{severity:"warning",sx:{mt:1,mb:2},children:w})]}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsxs(d,{variant:"subtitle1",gutterBottom:!0,children:["Produits (",C.length,")"]}),C.length>0?t.jsx(We,{component:U,variant:"outlined",children:t.jsxs(Ve,{size:"small",children:[t.jsx(He,{children:t.jsxs(Ge,{children:[t.jsx(qe,{children:"Produit"}),t.jsx(qe,{align:"right",children:"Prix unitaire"}),t.jsx(qe,{align:"right",children:"QuantitÃ©"}),t.jsx(qe,{align:"right",children:"Total"}),t.jsx(qe,{align:"right",children:"Actions"})]})}),t.jsxs(Xe,{children:[C.map(((e,r)=>t.jsxs(Ge,{children:[t.jsx(qe,{children:t.jsxs(c,{children:[t.jsx(d,{variant:"body2",children:e.product.name}),t.jsxs(d,{variant:"caption",color:"text.secondary",children:["RÃ©f: ",e.product.reference]})]})}),t.jsx(qe,{align:"right",children:E(e.product.selling_price)}),t.jsx(qe,{align:"right",children:e.quantity}),t.jsx(qe,{align:"right",children:E(e.product.selling_price*e.quantity)}),t.jsx(qe,{align:"right",children:t.jsx(f,{size:"small",color:"error",onClick:()=>h(r),children:t.jsx(Ze,{fontSize:"small"})})})]},r))),t.jsxs(Ge,{children:[t.jsx(qe,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total"}),t.jsx(qe,{align:"right",sx:{fontWeight:"bold"},children:E(A())}),t.jsx(qe,{})]})]})]})}):t.jsx(U,{variant:"outlined",sx:{p:3,textAlign:"center"},children:t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucun produit sÃ©lectionnÃ©"})})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Notes",multiline:!0,rows:3,fullWidth:!0,placeholder:"Notes additionnelles pour le devis...",value:x.notes||"",onChange:e=>y({...x,notes:e.target.value})})})]})}),t.jsxs(be,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:[t.jsx(k,{onClick:o,children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e,t;try{if(!v||0===C.length)return void m("Veuillez sÃ©lectionner un client et ajouter des produits");const e=Number(A().toFixed(2)),t=Number((0*e).toFixed(2)),s=Number((e+t).toFixed(2)),a={client:v.id,date:i.date,expiry_date:i.expiry_date,status:x.status||"draft",subtotal:e,tax_amount:t,total_amount:s,notes:x.notes||i.notes,items:C.map((e=>({product:e.product.id,quantity:e.quantity,unit_price:e.product.selling_price||0,discount_percentage:0,total_price:(e.product.selling_price||0)*e.quantity})))};"edit"===r&&(null==n?void 0:n.id)?(await Do(n.id,a),p(`Devis ${n.reference} modifiÃ© avec succÃ¨s`)):(await To(a),p("Devis crÃ©Ã© avec succÃ¨s")),g&&await g(),o(),y({status:"draft"}),b("")}catch(s){console.error("Error saving quote:",s);const r=s&&"object"==typeof s&&"response"in s&&(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.error)?String(s.response.data.error):"Erreur lors de l'enregistrement du devis";m(r)}},disabled:!v||0===C.length,startIcon:t.jsx(Oe,{}),children:"edit"===r?"Enregistrer":"CrÃ©er le devis"})]})]})},Sd=({open:e,quote:r,zones:n,onClose:i,onSuccess:s,onError:a,refreshData:o})=>{var l;const[c,u]=jt.useState((null==(l=null==n?void 0:n[0])?void 0:l.id)||1);return t.jsxs(xe,{open:e,onClose:i,maxWidth:"sm",fullWidth:!0,children:[t.jsx(ye,{children:"Convertir un devis en vente"}),t.jsx(we,{children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsxs(oe,{item:!0,xs:12,children:[t.jsxs(d,{variant:"subtitle1",children:["Convertir le devis ",null==r?void 0:r.reference," en vente."]}),(null==r?void 0:r.is_converted)&&t.jsx(W,{severity:"warning",sx:{mt:2},children:"Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente."})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,required:!0,disabled:null==r?void 0:r.is_converted,children:[t.jsx(Q,{children:"Zone"}),t.jsx(K,{value:c,onChange:e=>u(Number(e.target.value)),label:"Zone",children:(n||[]).map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})})]})}),t.jsxs(be,{children:[t.jsx(k,{onClick:i,children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e,t,l;try{if(!r)return void a("Aucun devis sÃ©lectionnÃ©");if(r.is_converted)return void a("Ce devis a dÃ©jÃ  Ã©tÃ© converti en vente");if(!c)return void a("Veuillez sÃ©lectionner une zone");const t=await No(r.id,c);o&&await o(),s(`Devis ${r.reference} converti en vente avec succÃ¨s! RÃ©fÃ©rence: ${t.reference}`),i(),u((null==(e=null==n?void 0:n[0])?void 0:e.id)||1)}catch(d){console.error("Error converting quote to sale:",d);const e=d&&"object"==typeof d&&"response"in d&&(null==(l=null==(t=d.response)?void 0:t.data)?void 0:l.error)?String(d.response.data.error):"Erreur lors de la conversion du devis en vente";a(e)}},disabled:!r||(null==r?void 0:r.is_converted)||!c,children:"Convertir"})]})]})},Ed=({dialogs:e,data:r,onSuccess:n,onError:i})=>{const{saleDialog:s,invoiceDialog:a,quoteDialog:o,quoteConversionDialog:l,deleteDialog:c,closeSaleDialog:d,closeInvoiceDialog:u,closeQuoteDialog:h,closeQuoteConversionDialog:p,closeDeleteDialog:m,updateSaleDialog:f,updateInvoiceDialog:g,updateQuoteDialog:x,addProductToQuote:y,removeProductFromQuote:w}=e,{clients:b,zones:v,sales:C,products:_,productsWithStock:S,availableStock:E,refreshAllData:A}=r;return t.jsxs(t.Fragment,{children:[t.jsx(vd,{open:(null==s?void 0:s.open)||!1,mode:(null==s?void 0:s.mode)||"add",sale:null==s?void 0:s.sale,clients:b,zones:v,productsWithStock:S,availableStock:E,saleDialog:s,onClose:d,updateSaleDialog:f,onSuccess:n,onError:i,refreshData:A}),t.jsx(Cd,{open:(null==a?void 0:a.open)||!1,mode:(null==a?void 0:a.mode)||"add",invoice:null==a?void 0:a.invoice,invoiceDialog:a,sales:C,clients:b,onClose:u,updateInvoiceDialog:g,onSuccess:n,onError:i,refreshData:A}),t.jsx(_d,{open:(null==o?void 0:o.open)||!1,mode:(null==o?void 0:o.mode)||"add",quote:null==o?void 0:o.quote,quoteDialog:o,clients:b,zones:v,products:_,onClose:h,updateQuoteDialog:x,addProductToQuote:y,removeProductFromQuote:w,onSuccess:n,onError:i,refreshData:A}),t.jsx(Sd,{open:(null==l?void 0:l.open)||!1,quote:null==l?void 0:l.quote,zones:v,onClose:p,onSuccess:n,onError:i,refreshData:A}),t.jsx(dl,{open:(null==c?void 0:c.open)||!1,onClose:m,onConfirm:async()=>{var e,t;try{if(!(null==c?void 0:c.item))return;const e=c.item.id,t=c.type;if("sale"===t)await Eo(e),n(`Vente ${c.item.reference||e} supprimÃ©e avec succÃ¨s`);else if("invoice"===t)await jo(e),n(`Facture ${c.item.reference||e} supprimÃ©e avec succÃ¨s`);else{if("quote"!==t)return void i("Type d'Ã©lÃ©ment non reconnu");await Ro(e),n(`Devis ${c.item.reference||e} supprimÃ© avec succÃ¨s`)}A&&await A(),m()}catch(r){console.error("Error deleting item:",r);const n=r&&"object"==typeof r&&"response"in r&&(null==(t=null==(e=r.response)?void 0:e.data)?void 0:t.error)?String(r.response.data.error):"Erreur lors de la suppression";i(n)}},type:null==c?void 0:c.type,item:null==c?void 0:c.item,confirmationInfo:null==c?void 0:c.confirmationInfo})]})},Ad=({requiredPermission:e,fallbackPath:r,children:n})=>{const{hasPermission:i,loading:s,isAdmin:a}=Di();return s?null:a||i(e)?t.jsx(t.Fragment,{children:n}):t.jsx(Ft,{to:r,replace:!0})},Id=()=>{const e=h(),[r,n]=jt.useState(0),[i,s]=jt.useState({open:!1,message:"",severity:"success"}),a=ko(),o=(({sales:e,invoices:t,quotes:r,clients:n})=>{const[i,s]=jt.useState(""),[a,o]=jt.useState(""),[l,c]=jt.useState(""),[d,u]=jt.useState(""),[h,p]=jt.useState(""),[m,f]=jt.useState(""),[g,x]=jt.useState(""),[y,w]=jt.useState(""),b=(e,t)=>{if(!t)return!0;const r=new Date(e),n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate());switch(t){case"today":return r>=i;case"week":{const e=new Date(i);return e.setDate(e.getDate()-7),r>=e}case"month":{const e=new Date(i);return e.setMonth(e.getMonth()-1),r>=e}case"quarter":{const e=new Date(i);return e.setMonth(e.getMonth()-3),r>=e}case"year":{const e=new Date(i);return e.setFullYear(e.getFullYear()-1),r>=e}default:return!0}};return{filteredSales:jt.useMemo((()=>e.filter((e=>{var t;const r=Number(e.client),s=n.find((e=>e.id===r)),o=e.reference.toLowerCase().includes(i.toLowerCase())||(null==(t=null==s?void 0:s.name)?void 0:t.toLowerCase().includes(i.toLowerCase()))||!1,l=""===a||e.status===a;return o&&l}))),[e,n,i,a]),filteredInvoices:jt.useMemo((()=>t.filter((e=>{var t,r;const n=e.reference.toLowerCase().includes(l.toLowerCase())||(null==(t=e.client_name)?void 0:t.toLowerCase().includes(l.toLowerCase()))||(null==(r=e.sale_reference)?void 0:r.toLowerCase().includes(l.toLowerCase()))||!1,i=""===d||e.status===d,s=b(e.date,h);return n&&i&&s}))),[t,l,d,h]),filteredQuotes:jt.useMemo((()=>r.filter((e=>{var t;const r=Number(e.client),i=n.find((e=>e.id===r)),s=e.reference.toLowerCase().includes(m.toLowerCase())||(null==(t=null==i?void 0:i.name)?void 0:t.toLowerCase().includes(m.toLowerCase()))||!1,a=""===g||e.status===g,o=b(e.date,y);return s&&a&&o}))),[r,n,m,g,y]),salesFilters:{searchTerm:i,setSearchTerm:s,statusFilter:a,setStatusFilter:o,resetSalesFilters:()=>{s(""),o("")}},invoiceFilters:{invoiceSearchTerm:l,setInvoiceSearchTerm:c,invoiceStatusFilter:d,setInvoiceStatusFilter:u,invoiceDateFilter:h,setInvoiceDateFilter:p,resetInvoiceFilters:()=>{c(""),u(""),p("")}},quoteFilters:{quoteSearchTerm:m,setQuoteSearchTerm:f,quoteStatusFilter:g,setQuoteStatusFilter:x,quoteDateFilter:y,setQuoteDateFilter:w,resetQuoteFilters:()=>{f(""),x(""),w("")}}}})({sales:a.sales,invoices:a.invoices,quotes:a.quotes,clients:a.clients}),l=(()=>{const[e,t]=jt.useState({open:!1,mode:"add",sale:null,saleItems:[],selectedClient:null,selectedZone:1,selectedProducts:[],currentProduct:null,currentQuantity:1}),r=jt.useCallback(((e,r)=>{t({open:!0,mode:e,sale:r||null,saleItems:[],selectedClient:null,selectedZone:1,selectedProducts:[],currentProduct:null,currentQuantity:1})}),[]),n=jt.useCallback((()=>{t((e=>({...e,open:!1})))}),[]),i=jt.useCallback((e=>{t((t=>({...t,...e})))}),[]),s=jt.useCallback((()=>{const{currentProduct:r,currentQuantity:n,selectedProducts:i}=e;if(!r||n<=0)return!1;const s=i.findIndex((e=>e.product.id===r.id));if(-1!==s){const e=[...i];e[s].quantity+=n,t((t=>({...t,selectedProducts:e,currentProduct:null,currentQuantity:1})))}else t((e=>({...e,selectedProducts:[...e.selectedProducts,{product:r,quantity:n}],currentProduct:null,currentQuantity:1})));return!0}),[e]),a=jt.useCallback((e=>{t((t=>({...t,selectedProducts:t.selectedProducts.filter(((t,r)=>r!==e))})))}),[]),[o,l]=jt.useState({open:!1,mode:"add",invoice:null,selectedSale:null,date:(new Date).toISOString().split("T")[0],due_date:"",notes:""}),c=jt.useCallback(((e,t,r)=>{const n=(new Date).toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()+30),l({open:!0,mode:e,invoice:t||null,selectedSale:r||null,date:(null==t?void 0:t.date)||n,due_date:(null==t?void 0:t.due_date)||i.toISOString().split("T")[0],notes:(null==t?void 0:t.notes)||""})}),[]),d=jt.useCallback((()=>{l((e=>({...e,open:!1})))}),[]),u=jt.useCallback((e=>{l((t=>({...t,...e})))}),[]),[h,p]=jt.useState({open:!1,mode:"add",quote:null,selectedClient:null,selectedZone:1,selectedProducts:[],currentProduct:null,currentQuantity:1,date:(new Date).toISOString().split("T")[0],expiry_date:"",notes:""}),m=jt.useCallback(((e,t)=>{const r=(new Date).toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()+30),p({open:!0,mode:e,quote:t||null,selectedClient:null,selectedZone:1,selectedProducts:[],currentProduct:null,currentQuantity:1,date:(null==t?void 0:t.date)||r,expiry_date:(null==t?void 0:t.expiry_date)||n.toISOString().split("T")[0],notes:(null==t?void 0:t.notes)||""})}),[]),f=jt.useCallback((()=>{p((e=>({...e,open:!1})))}),[]),g=jt.useCallback((e=>{p((t=>({...t,...e})))}),[]),x=jt.useCallback((()=>{const{currentProduct:e,currentQuantity:t,selectedProducts:r}=h;if(!e||t<=0)return!1;const n=r.findIndex((t=>t.product.id===e.id));if(-1!==n){const e=[...r];e[n].quantity+=t,p((t=>({...t,selectedProducts:e,currentProduct:null,currentQuantity:1})))}else p((r=>({...r,selectedProducts:[...r.selectedProducts,{product:e,quantity:t}],currentProduct:null,currentQuantity:1})));return!0}),[h]),y=jt.useCallback((e=>{p((t=>({...t,selectedProducts:t.selectedProducts.filter(((t,r)=>r!==e))})))}),[]),[w,b]=jt.useState({open:!1,quote:null}),v=jt.useCallback((e=>{b({open:!0,quote:e})}),[]),C=jt.useCallback((()=>{b({open:!1,quote:null})}),[]),[_,S]=jt.useState({open:!1,type:null,item:null,confirmationInfo:null}),E=jt.useCallback(((e,t,r)=>{S({open:!0,type:e,item:t,confirmationInfo:r||null})}),[]),A=jt.useCallback((()=>{S({open:!1,type:null,item:null,confirmationInfo:null})}),[]);return{saleDialog:e,openSaleDialog:r,closeSaleDialog:n,updateSaleDialog:i,addProductToSale:s,removeProductFromSale:a,invoiceDialog:o,openInvoiceDialog:c,closeInvoiceDialog:d,updateInvoiceDialog:u,quoteDialog:h,openQuoteDialog:m,closeQuoteDialog:f,updateQuoteDialog:g,addProductToQuote:x,removeProductFromQuote:y,quoteConversionDialog:w,openQuoteConversionDialog:v,closeQuoteConversionDialog:C,deleteDialog:_,openDeleteDialog:E,closeDeleteDialog:A}})();jt.useEffect((()=>{a.refreshAllData()}),[]),jt.useEffect((()=>{l.saleDialog.selectedZone&&a.fetchProductsWithStock(l.saleDialog.selectedZone)}),[l.saleDialog.selectedZone]);const u=e=>{s({open:!0,message:e,severity:"success"})},p=e=>{s({open:!0,message:e,severity:"error"})},m=()=>{s({...i,open:!1})};return t.jsx(Ad,{requiredPermission:"view_sale",fallbackPath:"/dashboard",children:t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(c,{sx:{mb:4},children:[t.jsxs(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:e.palette.primary.main,borderBottom:`2px solid ${e.palette.primary.light}`,pb:1,width:"fit-content",display:"flex",alignItems:"center",gap:1},children:[t.jsx(b,{}),"Gestion des Ventes"]}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez les ventes, factures et devis"})]}),t.jsxs(U,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(he,{value:r,onChange:(e,t)=>n(t),indicatorColor:"primary",variant:"fullWidth",sx:{px:3,pt:2,"& .MuiTab-root":{fontWeight:"medium",py:2}},children:[t.jsx(pe,{label:"Ventes"}),t.jsx(pe,{label:"Factures"}),t.jsx(pe,{label:"Devis"})]})}),t.jsxs(c,{sx:{p:3},children:[0===r&&t.jsx(Sl,{sales:o.filteredSales,loading:a.loading,clients:a.clients,zones:a.zones,searchTerm:o.salesFilters.searchTerm,setSearchTerm:o.salesFilters.setSearchTerm,statusFilter:o.salesFilters.statusFilter,setStatusFilter:o.salesFilters.setStatusFilter,dateFilter:"",setDateFilter:()=>{},onAdd:()=>l.openSaleDialog("add"),onEdit:e=>l.openSaleDialog("edit",e),onDelete:e=>l.openDeleteDialog("sale",e)}),1===r&&t.jsx(El,{invoices:o.filteredInvoices,loading:a.invoiceLoading,clients:a.clients,searchTerm:o.invoiceFilters.invoiceSearchTerm,setSearchTerm:o.invoiceFilters.setInvoiceSearchTerm,statusFilter:o.invoiceFilters.invoiceStatusFilter,setStatusFilter:o.invoiceFilters.setInvoiceStatusFilter,dateFilter:o.invoiceFilters.invoiceDateFilter,setDateFilter:o.invoiceFilters.setInvoiceDateFilter,onAdd:()=>l.openInvoiceDialog("add"),onEdit:e=>l.openInvoiceDialog("edit",e),onDelete:e=>l.openDeleteDialog("invoice",e),onPrint:e=>{try{const t=a.sales.find((t=>t.id===e.sale)),r=a.clients.find((e=>e.id===(null==t?void 0:t.client)));(e=>{const t=$l(e.amount),r=$l(e.paid_amount),n=$l(e.balance),i=e.status||e.statut||"draft";let s="status-draft";0===n||"paid"===i?s="status-paid":r>0&&n>0?s="status-partial":n>0&&(s="status-unpaid");const a=`\n    <div class="watermark">FACTURE</div>\n    \n    <div class="header">\n      <div class="brand">\n        <div class="logo">G</div>\n        <div class="company">\n          <div class="company-name">Gestion</div>\n          <div class="muted">123 Rue Exemple</div>\n          <div class="muted">+33 1 23 45 67 89</div>\n          <div class="muted">contact@gestion.com</div>\n        </div>\n      </div>\n      <div class="meta">\n        <h1>FACTURE</h1>\n        <div class="meta-item"><span class="meta-label">NÂ°:</span> <strong>${e.reference??e.id}</strong></div>\n        <div class="meta-item"><span class="meta-label">Date:</span> ${Yl(e.date)}</div>\n        ${e.due_date?`<div class="meta-item"><span class="meta-label">Ã‰chÃ©ance:</span> ${Yl(e.due_date)}</div>`:""}\n        ${e.sale_reference?`<div class="meta-item"><span class="meta-label">Vente:</span> ${e.sale_reference}</div>`:""}\n      </div>\n    </div>\n\n    ${e.client_name?`\n    <div class="client-info">\n      <h3>Informations Client</h3>\n      <p><strong>${e.client_name}</strong></p>\n      ${e.client_phone?`<p>ðŸ“ž ${e.client_phone}</p>`:""}\n      ${e.client_email?`<p>âœ‰ï¸ ${e.client_email}</p>`:""}\n    </div>\n    `:""}\n\n    ${e.items&&e.items.length>0?`\n    <div class="section">\n      <h3 class="section-title">DÃ©tails de la facture</h3>\n      <table class="line-items">\n        <thead>\n          <tr>\n            <th>Article</th>\n            <th class="quantity">QuantitÃ©</th>\n            <th class="price">Prix unitaire</th>\n            <th class="price">Sous-total</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.items.map((e=>`\n            <tr>\n              <td>${e.product_name||"Article"}</td>\n              <td class="quantity">${e.quantity||0}</td>\n              <td class="price">${Zl(e.unit_price)}</td>\n              <td class="price">${Zl(e.subtotal)}</td>\n            </tr>\n          `)).join("")}\n        </tbody>\n      </table>\n    </div>\n    `:""}\n\n    <div class="totals-section">\n      <table class="totals-table totals">\n        <tr>\n          <td class="label-cell">Montant total</td>\n          <td class="amount-cell">${Zl(t)}</td>\n        </tr>\n        <tr>\n          <td class="label-cell">Montant payÃ©</td>\n          <td class="amount-cell paid-status">${Zl(r)}</td>\n        </tr>\n        <tr class="total-row">\n          <td class="label-cell">Solde restant</td>\n          <td class="amount-cell total-value ${n>0?"balance-due":"paid-status"}">${Zl(n)}</td>\n        </tr>\n        <tr>\n          <td colspan="2" style="text-align: right; padding-top: 16px;">\n            <span class="status-badge ${s}">${{paid:"PayÃ©e",partial:"Partiellement payÃ©e",unpaid:"Non payÃ©e",draft:"Brouillon",overdue:"En retard"}[i]||i}</span>\n          </td>\n        </tr>\n      </table>\n    </div>\n\n    ${e.notes?`\n    <div class="notes-section">\n      <h4>Notes</h4>\n      <p>${e.notes}</p>\n    </div>\n    `:""}\n\n    <div class="footer">\n      <p><strong>Merci de votre confiance !</strong></p>\n      <p class="muted">Document gÃ©nÃ©rÃ© automatiquement le ${(new Date).toLocaleString("fr-FR")}</p>\n      <p class="muted">En cas de question, contactez-nous : contact@gestion.com</p>\n    </div>\n  `;Ql(a,`Facture ${e.reference??e.id}`)})({id:e.id,reference:e.reference,date:e.date,due_date:e.due_date,client_name:(null==r?void 0:r.name)||e.client_name||"N/A",client_phone:null==r?void 0:r.phone,client_email:null==r?void 0:r.email,sale_reference:e.sale_reference,amount:e.amount,paid_amount:e.paid_amount,balance:e.balance,status:e.status,notes:e.notes,items:[]}),u("Impression de la facture en cours...")}catch(t){console.error("Error printing invoice:",t),p("Erreur lors de l'impression de la facture")}}}),2===r&&t.jsx(Al,{quotes:o.filteredQuotes,loading:a.quoteLoading,clients:a.clients,searchTerm:o.quoteFilters.quoteSearchTerm,setSearchTerm:o.quoteFilters.setQuoteSearchTerm,statusFilter:o.quoteFilters.quoteStatusFilter,setStatusFilter:o.quoteFilters.setQuoteStatusFilter,dateFilter:o.quoteFilters.quoteDateFilter,setDateFilter:o.quoteFilters.setQuoteDateFilter,onAdd:()=>l.openQuoteDialog("add"),onEdit:e=>l.openQuoteDialog("edit",e),onDelete:e=>l.openDeleteDialog("quote",e),onPrint:e=>{try{const t=a.clients.find((t=>t.id===e.client));(e=>{const t=$l(e.total_amount),r=e.status||"draft";let n="status-draft";"accepted"===r?n="status-accepted":"sent"===r?n="status-sent":"rejected"===r&&(n="status-rejected");const i=`\n    <div class="watermark">DEVIS</div>\n    \n    <div class="header">\n      <div class="brand">\n        <div class="logo">G</div>\n        <div class="company">\n          <div class="company-name">Gestion</div>\n          <div class="muted">123 Rue Exemple</div>\n          <div class="muted">+33 1 23 45 67 89</div>\n          <div class="muted">contact@gestion.com</div>\n        </div>\n      </div>\n      <div class="meta">\n        <h1>DEVIS</h1>\n        <div class="meta-item"><span class="meta-label">NÂ°:</span> <strong>${e.reference??e.id}</strong></div>\n        <div class="meta-item"><span class="meta-label">Date:</span> ${Yl(e.date)}</div>\n        ${e.expiry_date?`<div class="meta-item"><span class="meta-label">Valable jusqu'au:</span> ${Yl(e.expiry_date)}</div>`:""}\n      </div>\n    </div>\n\n    ${e.client_name||e.client?`\n    <div class="client-info">\n      <h3>Informations Client</h3>\n      <p><strong>${e.client_name||e.client}</strong></p>\n      ${e.client_phone?`<p>ðŸ“ž ${e.client_phone}</p>`:""}\n      ${e.client_email?`<p>âœ‰ï¸ ${e.client_email}</p>`:""}\n    </div>\n    `:""}\n\n    ${e.items&&e.items.length>0?`\n    <div class="section">\n      <h3 class="section-title">DÃ©tails du devis</h3>\n      <table class="line-items">\n        <thead>\n          <tr>\n            <th>DÃ©signation</th>\n            <th class="quantity">QuantitÃ©</th>\n            <th class="price">Prix unitaire</th>\n            <th class="price">Montant</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.items.map((e=>`\n            <tr>\n              <td>\n                <strong>${e.product_name||"Article"}</strong>\n                ${e.description?`<br/><span class="muted">${e.description}</span>`:""}\n              </td>\n              <td class="quantity">${e.quantity||0}</td>\n              <td class="price">${Zl(e.unit_price)}</td>\n              <td class="price">${Zl(e.subtotal)}</td>\n            </tr>\n          `)).join("")}\n        </tbody>\n      </table>\n    </div>\n    `:""}\n\n    <div class="totals-section">\n      <table class="totals-table totals">\n        <tr class="total-row">\n          <td class="label-cell">Montant total estimÃ©</td>\n          <td class="amount-cell total-value">${Zl(t)}</td>\n        </tr>\n        <tr>\n          <td colspan="2" style="text-align: right; padding-top: 16px;">\n            <span class="status-badge ${n}">${{draft:"Brouillon",sent:"EnvoyÃ©",accepted:"AcceptÃ©",rejected:"RejetÃ©",expired:"ExpirÃ©"}[r]||r}</span>\n          </td>\n        </tr>\n      </table>\n    </div>\n\n    ${e.notes?`\n    <div class="notes-section">\n      <h4>Notes et conditions</h4>\n      <p>${e.notes}</p>\n    </div>\n    `:""}\n\n    <div class="footer">\n      <p><strong>Ce devis est valable ${e.expiry_date?"jusqu'au "+Yl(e.expiry_date):"pendant 30 jours"}</strong></p>\n      <p class="muted">Document gÃ©nÃ©rÃ© automatiquement le ${(new Date).toLocaleString("fr-FR")}</p>\n      <p class="muted">Pour toute question, contactez-nous : contact@gestion.com</p>\n    </div>\n  `;Ql(i,`Devis ${e.reference??e.id}`)})({id:e.id,reference:e.reference,date:e.date,expiry_date:e.expiry_date,client_name:(null==t?void 0:t.name)||"N/A",client_phone:null==t?void 0:t.phone,client_email:null==t?void 0:t.email,total_amount:e.total_amount,status:e.status,notes:e.notes,items:e.items||[]}),u("Impression du devis en cours...")}catch(t){console.error("Error printing quote:",t),p("Erreur lors de l'impression du devis")}},onConvert:e=>l.openQuoteConversionDialog(e)})]})]}),t.jsx(Ed,{dialogs:l,data:a,onSuccess:u,onError:p}),t.jsx(Ye,{open:i.open,autoHideDuration:6e3,onClose:m,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(W,{onClose:m,severity:i.severity,sx:{width:"100%"},children:i.message})})]})})},jd=()=>{const{hasPermission:e,isAdmin:t}=Di();return{canPerform:r=>!!t||e(r),canView:r=>!!t||e(r),canEdit:r=>!!t||e(r),canDelete:r=>!!t||e(r)}},Td=()=>{const{canPerform:e}=jd(),r=e("change_client"),n=e("delete_client"),[i,s]=jt.useState([]),[a,o]=jt.useState(!0),[u,h]=jt.useState(""),[p,g]=jt.useState(!1),[x,y]=jt.useState({name:"",contact_person:"",email:"",phone:"",address:"",price_group:1,account:void 0,is_active:!0}),[w,b]=jt.useState(!1),[v,C]=jt.useState(null),[_,S]=jt.useState(null),[E,A]=jt.useState({open:!1,message:"",severity:"success"}),[I,j]=jt.useState([]),[T,D]=jt.useState(!1),[R,N]=jt.useState([]),[P,O]=jt.useState(!1),k=Rt(),[M,F]=jt.useState({page:0,pageSize:10});jt.useEffect((()=>{(async()=>{try{o(!0),S(null);const e=await ps();s(e)}catch(e){console.error("Error loading clients:",e),S("Erreur lors du chargement des clients. Veuillez rÃ©essayer plus tard.")}finally{o(!1)}})()}),[]),jt.useEffect((()=>{(async()=>{try{D(!0);const e=await(async()=>{const e=await rs.get("/settings/price-groups/");return e.data.results||e.data})();j(e)}catch(e){console.error("Error loading price groups:",e),A({open:!0,message:"Erreur lors du chargement des groupes de prix",severity:"error"})}finally{D(!1)}})()}),[]),jt.useEffect((()=>{p&&(async e=>{try{O(!0);const t=await gs("client"),r=i.filter((t=>void 0!==t.account&&t.account!==e)).map((e=>e.account)),n=t.filter((e=>!r.includes(e.id)));N(n)}catch(t){console.error("Error loading available accounts:",t)}finally{O(!1)}})(x.account)}),[p,i,x.account]);const B=i.filter((e=>e.name.toLowerCase().includes(u.toLowerCase())||e.contact_person.toLowerCase().includes(u.toLowerCase())||e.email.toLowerCase().includes(u.toLowerCase())||e.phone.includes(u))),L=e=>{e?(y({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address,price_group:e.price_group,account:e.account,is_active:e.is_active}),b(!0),C(e.id)):(y({name:"",contact_person:"",email:"",phone:"",address:"",price_group:1,account:void 0,is_active:!0}),b(!1),C(null)),g(!0)},z=()=>{g(!1)},V=()=>{A({...E,open:!1})},G=async e=>{try{if(S(null),!window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le client "${e.name}" ?`))return;await(async e=>{await rs.delete(`/partners/clients/${e}/`)})(e.id),s(i.filter((t=>t.id!==e.id))),A({open:!0,message:"Client supprimÃ© avec succÃ¨s",severity:"success"})}catch(t){console.error("Error deleting client:",t);let e="Erreur lors de la suppression du client.";if(t&&"object"==typeof t&&"response"in t&&t.response&&"object"==typeof t.response&&"data"in t.response&&t.response.data){const r=t.response.data;"object"==typeof r&&"error"in r&&(e=String(r.error),"detail"in r&&r.detail&&(e+=" "+String(r.detail)))}A({open:!0,message:e,severity:"error"})}},q=[{field:"name",headerName:Jo("company"),flex:1.2,renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name})},{field:"contact_person",headerName:Jo("contactPerson"),flex:1,renderCell:e=>t.jsx(d,{variant:"body2",children:e.row.contact_person})},{field:"phone",headerName:Jo("phone"),flex:1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Qe,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.phone})]})},{field:"email",headerName:Jo("email"),flex:1.2,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Ke,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.email})]})},{field:"address",headerName:Jo("address"),flex:1.3,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[t.jsx(Je,{fontSize:"small",color:"action",sx:{mt:.25}}),t.jsx(d,{variant:"body2",children:e.row.address})]})},{field:"price_group",headerName:Jo("priceGroup"),flex:.8,valueGetter:(e,t)=>(e=>{if(!e)return"Aucun";const t=I.find((t=>t.id===e));return t?t.name:"Inconnu"})(t.price_group)},{field:"is_active",headerName:Jo("status"),flex:.7,renderCell:e=>t.jsx(pl,{status:e.row.is_active?"active":"inactive"})},{field:"actions",headerName:Jo("actions"),flex:.8,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(l,{title:Jo("edit"),children:t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),L(e.row)},disabled:!r,children:t.jsx(et,{fontSize:"small"})})}),t.jsx(l,{title:Jo("delete"),children:t.jsx(f,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),G(e.row)},disabled:!n,children:t.jsx(Ze,{fontSize:"small"})})})]})}];return t.jsx(Ad,{requiredPermission:"view_client",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Clients"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez votre portefeuille clients"})]}),t.jsxs(U,{sx:{p:3,mb:4},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsx(ul,{label:Jo("search"),placeholder:"Nom, contact, email ou tÃ©lÃ©phone",value:u,onChange:e=>h(e.target.value),sx:{maxWidth:{md:400}},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})})}}),t.jsx(Lo,{variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:()=>L(),disabled:!e("add_client"),children:Jo("addClient")})]}),_&&t.jsx(W,{severity:"error",sx:{mb:3},children:_}),a?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:B,columns:q,paginationModel:M,onPaginationModelChange:F,loading:a,getRowId:e=>e.id||Math.random(),onRowClick:e=>{r&&L(e.row)},sx:{minHeight:400,"& .MuiDataGrid-row":{cursor:"pointer"}}})]}),t.jsx(yl,{open:p,editMode:w,contactType:"client",formData:x,availableAccounts:R.map((e=>({id:e.id,name:e.name}))),loadingAccounts:P,priceGroups:I.map((e=>({id:e.id,name:e.name}))),loadingPriceGroups:T,onClose:z,onSubmit:async()=>{try{if(!x.name)return void A({open:!0,message:"Le nom du client est requis",severity:"error"});if(!x.contact_person)return void A({open:!0,message:"Le nom du contact est requis",severity:"error"});if(!x.email)return void A({open:!0,message:"L'email est requis",severity:"error"});if(!x.phone)return void A({open:!0,message:"Le tÃ©lÃ©phone est requis",severity:"error"});if(!x.address)return void A({open:!0,message:"L'adresse est requise",severity:"error"});if(!x.price_group)return void A({open:!0,message:"Le groupe de prix est requis",severity:"error"});if(w&&v){await(async(e,t)=>(await rs.patch(`/partners/clients/${e}/`,t)).data)(v,x);const e=await ps();s(e),A({open:!0,message:"Client mis Ã  jour avec succÃ¨s",severity:"success"})}else{await(async e=>(await rs.post("/partners/clients/",e)).data)(x);const e=await ps();s(e),A({open:!0,message:"Client ajoutÃ© avec succÃ¨s",severity:"success"})}z()}catch(e){let t="Erreur lors de l'enregistrement du client";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):String(t)}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}A({open:!0,message:t,severity:"error"})}},onFormDataChange:e=>{y(e)},onAccountChange:e=>{y((t=>({...t,account:""===e?void 0:e})))},onPriceGroupChange:e=>{y((t=>({...t,price_group:e})))},onCreateAccount:()=>{k("/settings?tab=4")}}),t.jsx(Ye,{open:E.open,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(W,{onClose:V,severity:E.severity,variant:"filled",sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:E.message})})]})})},Dd=()=>{const e=h(),{canPerform:r}=jd(),n=r("change_product"),i=r("delete_product"),[s,a]=jt.useState([]),[o,l]=jt.useState(!0),[u,p]=jt.useState(""),[g,x]=jt.useState(""),[y,w]=jt.useState(!1),[b,v]=jt.useState(!1),[C,_]=jt.useState(null),[S,E]=jt.useState([]),[A,I]=jt.useState([]),[j,T]=jt.useState(!1),[D,R]=jt.useState(!1),[N,P]=jt.useState({name:"",reference:"",description:"",category:0,unit:0,purchase_price:0,selling_price:0,min_stock_level:0,is_raw_material:!1,is_active:!0}),[O,M]=jt.useState(null),[F,L]=jt.useState(!1),[z,G]=jt.useState(null),[q,X]=jt.useState(!1),[$,Z]=jt.useState({page:0,pageSize:10});jt.useEffect((()=>{Z((e=>({...e,page:0})))}),[u,g]),jt.useEffect((()=>{(async()=>{try{l(!0),_(null);const e=await La();a(e),T(!0);const t=await(async()=>{const e=await rs.get("/settings/product-categories/");return e.data.results||e.data})();E(t),T(!1),R(!0);const r=await(async()=>{const e=await rs.get("/settings/units-of-measure/");return e.data.results||e.data})();I(r),R(!1)}catch(e){console.error("Error loading data:",e),_("Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer plus tard.")}finally{l(!1)}})()}),[]);const J=e=>{const t=S.find((t=>t.id===e));return t?t.name:"Inconnu"},ee=[...new Set(s.map((e=>e.category)))],te=s.filter((e=>{const t=e.name.toLowerCase().includes(u.toLowerCase())||e.reference.toLowerCase().includes(u.toLowerCase()),r=""===g||e.category===Number(g);return t&&r})),re=async e=>{M(e),v(!0)},ne=()=>{L(!1),G(null)};return t.jsx(Ad,{requiredPermission:"view_product",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsx(c,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(c,{children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Produits"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez votre catalogue de produits"})]})}),t.jsxs(U,{sx:{p:3,mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom ou rÃ©fÃ©rence",variant:"outlined",size:"small",fullWidth:!0,value:u,onChange:e=>p(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})}),sx:{borderRadius:2}}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{id:"category-filter-label",children:"CatÃ©gorie"}),t.jsxs(K,{labelId:"category-filter-label",id:"category-filter",value:g,onChange:e=>x(e.target.value),label:"CatÃ©gorie",sx:{borderRadius:2},children:[t.jsx(B,{value:"",children:"Toutes les catÃ©gories"}),j?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}})," Chargement..."]}):ee.map((e=>t.jsx(B,{value:e,children:J(e)},e)))]})]})]}),t.jsx(zo,{variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:()=>w(!0),requiredPermission:"add_product",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Ajouter un produit"})]}),C&&t.jsx(W,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 2px 10px rgba(0,0,0,0.08)"},children:C}),o?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:te,columns:[{field:"name",headerName:"Produit",flex:1},{field:"reference",headerName:"RÃ©fÃ©rence",flex:1},{field:"category",headerName:"CatÃ©gorie",flex:1,valueGetter:(e,t)=>t?J(t.category):"N/A"},{field:"unit",headerName:"UnitÃ©",flex:1,valueGetter:(e,t)=>t?(e=>{const t=A.find((t=>t.id===e));return t?t.name:"Inconnu"})(t.unit):"N/A"},{field:"purchase_price",headerName:"Prix d'achat",flex:1,valueGetter:(e,t)=>t&&void 0!==t.purchase_price?`${t.purchase_price.toLocaleString()} GNF`:""},{field:"selling_price",headerName:"Prix de vente",flex:1,valueGetter:(e,t)=>t&&void 0!==t.selling_price?`${t.selling_price.toLocaleString()} GNF`:""},{field:"min_stock_level",headerName:"Stock Min.",flex:1,valueGetter:(e,t)=>t&&void 0!==t.min_stock_level?t.min_stock_level.toString():"0"},{field:"is_raw_material",headerName:"Type",flex:1,renderCell:e=>t.jsx(pl,{status:e.value?"raw_material":"finished_product",size:"small"})},{field:"is_active",headerName:"Statut",flex:1,renderCell:e=>t.jsx(pl,{status:e.value?"active":"inactive",size:"small"})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),re(e.row)},disabled:!n,children:t.jsx(et,{fontSize:"small"})}),t.jsx(f,{color:"secondary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),Va(e.row.id).then((t=>{const r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`qr-code-product-${e.row.id}-${e.row.name.replace(/\s+/g,"-").toLowerCase()}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)})).catch((e=>{console.error("Error downloading QR code:",e),alert("Impossible de tÃ©lÃ©charger le code QR. VÃ©rifiez votre connexion.")}))},children:t.jsx(tt,{fontSize:"small"})}),t.jsx(f,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),(async e=>{try{if(_(null),console.log("Deleting product:",e),!e.id)return void _("ID du produit manquant");G(e),L(!0)}catch(t){console.error("Error deleting product:",t),_("Erreur lors de la suppression du produit. Veuillez rÃ©essayer plus tard.")}})(e.row)},disabled:!i,children:t.jsx(Ze,{fontSize:"small"})})]})}],paginationModel:$,onPaginationModelChange:Z,onRowClick:e=>{re(e.row)},loading:o,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]}),t.jsxs(xe,{open:y,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ye,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold"},children:"Ajouter un produit"}),t.jsx(we,{sx:{p:3,mt:1},children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:N.name,onChange:e=>P({...N,name:e.target.value}),required:!0})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:N.description,onChange:e=>P({...N,description:e.target.value})})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"CatÃ©gorie"}),t.jsx(K,{value:N.category||"",onChange:e=>P({...N,category:Number(e.target.value)}),label:"CatÃ©gorie",children:j?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}})," Chargement..."]}):S.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"UnitÃ©"}),t.jsx(K,{value:N.unit||"",onChange:e=>P({...N,unit:Number(e.target.value)}),label:"UnitÃ©",children:D?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}})," Chargement..."]}):A.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix d'achat",fullWidth:!0,type:"text",value:vl(N.purchase_price),onChange:e=>{const t=bl(e.target.value,N.purchase_price);P({...N,purchase_price:t})},error:N.purchase_price<0,helperText:Cl(N.purchase_price,"price")})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix de vente",fullWidth:!0,type:"text",value:vl(N.selling_price),onChange:e=>{const t=bl(e.target.value,N.selling_price);P({...N,selling_price:t})},error:N.selling_price<0,helperText:Cl(N.selling_price,"price")})}),t.jsxs(oe,{item:!0,xs:12,sm:6,children:[" ",t.jsx(V,{label:"Niveau Stock Min.",fullWidth:!0,type:"text",value:vl(N.min_stock_level),onChange:e=>{const t=wl(e.target.value,N.min_stock_level);P({...N,min_stock_level:t})},error:N.min_stock_level<0,helperText:Cl(N.min_stock_level,"stock")})]}),t.jsx(oe,{item:!0,xs:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Type"}),t.jsxs(K,{value:N.is_raw_material?1:0,onChange:e=>P({...N,is_raw_material:1===Number(e.target.value)}),label:"Type",children:[t.jsx(B,{value:0,children:"Produit fini"}),t.jsx(B,{value:1,children:"MatiÃ¨re premiÃ¨re"})]})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(d,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Note: Un code QR sera automatiquement gÃ©nÃ©rÃ© lors de la crÃ©ation du produit."})})]})}),t.jsxs(be,{sx:{p:2,pt:0},children:[t.jsx(k,{onClick:()=>w(!1),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{try{if(_(null),!N.name)return void _("Le nom du produit est requis");if(!N.category)return void _("La catÃ©gorie du produit est requise");if(!N.unit)return void _("L'unitÃ© du produit est requise");const e={...N,purchase_price:Number(N.purchase_price),selling_price:Number(N.selling_price),min_stock_level:Number(N.min_stock_level)};delete e.reference,console.log("Creating product:",e);const t=await za(e);console.log("Product created:",t),console.log(`New product reference: ${t.reference}`),a([...s,t]),w(!1),P({name:"",reference:"",description:"",category:0,unit:0,purchase_price:0,selling_price:0,min_stock_level:0,is_raw_material:!1,is_active:!0})}catch(e){console.error("Error creating product:",e);let t="Erreur lors de la crÃ©ation du produit. Veuillez rÃ©essayer plus tard.";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}_(t)}},sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Ajouter"})]})]}),t.jsxs(xe,{open:b,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ye,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold"},children:"Modifier un produit"}),t.jsx(we,{sx:{p:3,mt:1},children:O&&t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:O.name,onChange:e=>M({...O,name:e.target.value}),required:!0})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"RÃ©fÃ©rence",fullWidth:!0,value:O.reference,onChange:e=>M({...O,reference:e.target.value}),required:!0,helperText:"La rÃ©fÃ©rence doit Ãªtre unique"})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:O.description,onChange:e=>M({...O,description:e.target.value})})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"CatÃ©gorie"}),t.jsx(K,{value:O.category||"",onChange:e=>M({...O,category:Number(e.target.value)}),label:"CatÃ©gorie",children:j?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}})," Chargement..."]}):S.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"UnitÃ©"}),t.jsx(K,{value:O.unit||"",onChange:e=>M({...O,unit:Number(e.target.value)}),label:"UnitÃ©",children:D?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}})," Chargement..."]}):A.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix d'achat",fullWidth:!0,type:"text",value:vl(O.purchase_price),onChange:e=>{const t=bl(e.target.value,O.purchase_price);M({...O,purchase_price:t})},error:(O.purchase_price??0)<0,helperText:Cl(O.purchase_price,"price")})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Prix de vente",fullWidth:!0,type:"text",value:vl(O.selling_price),onChange:e=>{const t=bl(e.target.value,O.selling_price);M({...O,selling_price:t})},error:(O.selling_price??0)<0,helperText:Cl(O.selling_price,"price")})}),t.jsxs(oe,{item:!0,xs:12,sm:6,children:[" ",t.jsx(V,{label:"Niveau Stock Min.",fullWidth:!0,type:"text",value:vl(O.min_stock_level),onChange:e=>{const t=bl(e.target.value,O.min_stock_level);M({...O,min_stock_level:t})},error:(O.min_stock_level??0)<0,helperText:Cl(O.min_stock_level,"stock")})]}),t.jsx(oe,{item:!0,xs:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Type"}),t.jsxs(K,{value:O.is_raw_material?1:0,onChange:e=>M({...O,is_raw_material:1===Number(e.target.value)}),label:"Type",children:[t.jsx(B,{value:0,children:"Produit fini"}),t.jsx(B,{value:1,children:"MatiÃ¨re premiÃ¨re"})]})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(c,{sx:{mt:2,textAlign:"center"},children:[t.jsx(d,{variant:"subtitle1",sx:{mb:1,fontWeight:"bold"},children:"Code QR du produit"}),t.jsxs(c,{className:"qr-code-container",children:[t.jsx(_l,{productId:O.id,productName:O.name,width:"150px",height:"150px",downloadable:!0}),t.jsx(d,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:"Le code QR contient les informations du produit et peut Ãªtre scannÃ© pour identification rapide."})]})]})})]})}),t.jsxs(be,{sx:{p:2,pt:0},children:[t.jsx(k,{onClick:()=>v(!1),sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{try{if(_(null),!O)return void _("Produit Ã  Ã©diter manquant");if(!O.id)return void _("ID du produit manquant");if(!O.name)return void _("Le nom du produit est requis");if(!O.reference)return void _("La rÃ©fÃ©rence du produit est requise");if(!O.category)return void _("La catÃ©gorie du produit est requise");if(!O.unit)return void _("L'unitÃ© du produit est requise");const e={...O,purchase_price:Number(O.purchase_price),selling_price:Number(O.selling_price),min_stock_level:Number(O.min_stock_level)};console.log("Updating product:",e);const t=await Ua(O.id,e);console.log("Product updated:",t),a(s.map((e=>e.id===O.id?t:e))),v(!1),M(null)}catch(e){console.error("Error updating product:",e);let t="Erreur lors de la mise Ã  jour du produit. Veuillez rÃ©essayer plus tard.";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}_(t)}},sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Enregistrer"})]})]}),t.jsxs(xe,{open:F,onClose:ne,PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:"background.paper"}},children:[t.jsx(ye,{sx:{backgroundColor:"error.main",color:"#fff",fontWeight:"bold"},children:"Confirmation de suppression"}),t.jsxs(we,{sx:{p:3,mt:2,backgroundColor:"background.paper"},children:[t.jsxs(rt,{color:"text.primary",sx:{mb:2},children:["ÃŠtes-vous sÃ»r de vouloir supprimer le produit ",t.jsx("strong",{children:null==z?void 0:z.name})," ?"]}),t.jsx(W,{severity:"warning",sx:{mb:2},children:"âš ï¸ Cette action supprimera dÃ©finitivement le produit et ses donnÃ©es associÃ©es."}),t.jsx(W,{severity:"error",children:"Cette action est irrÃ©versible."})]}),t.jsxs(be,{sx:{p:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(k,{onClick:ne,disabled:q,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(k,{variant:"contained",color:"error",onClick:async()=>{if(null==z?void 0:z.id)try{_(null),X(!0),console.log("Deleting product:",z),await Wa(z.id),console.log("Product deleted"),a(s.filter((e=>e.id!==z.id))),L(!1),G(null)}catch(e){console.error("Error deleting product:",e),_("Erreur lors de la suppression du produit. Veuillez rÃ©essayer plus tard.")}finally{X(!1)}else _("Aucun produit sÃ©lectionnÃ© pour suppression")},disabled:q,startIcon:q?t.jsx(m,{size:20,color:"inherit"}):t.jsx(Ze,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:q?"Suppression...":"Supprimer"})]})]})]})})},Rd={name:"",contact_person:"",email:"",phone:"",address:"",is_active:!0,account:void 0},Nd=()=>{const{canPerform:e}=jd(),r=Rt(),n=e("change_supplier"),i=e("delete_supplier"),[s,a]=jt.useState([]),[o,l]=jt.useState(!0),[u,h]=jt.useState(!1),[p,g]=jt.useState(Rd),[x,y]=jt.useState(!1),[w,b]=jt.useState(null),[v,C]=jt.useState(""),[_,S]=jt.useState({open:!1,message:"",severity:"success"}),[E,A]=jt.useState([]),[I,j]=jt.useState(!1),[T,D]=jt.useState({page:0,pageSize:10}),R=[{field:"name",headerName:Jo("company"),flex:1.2,renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name})},{field:"contact_person",headerName:Jo("contactPerson"),flex:1,renderCell:e=>t.jsx(d,{variant:"body2",children:e.row.contact_person})},{field:"phone",headerName:Jo("phone"),flex:1,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Qe,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.phone})]})},{field:"email",headerName:Jo("email"),flex:1.2,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Ke,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",children:e.row.email})]})},{field:"address",headerName:Jo("address"),flex:1.3,renderCell:e=>t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[t.jsx(Je,{fontSize:"small",color:"action",sx:{mt:.25}}),t.jsx(d,{variant:"body2",children:e.row.address})]})},{field:"is_active",headerName:Jo("status"),flex:.7,renderCell:e=>t.jsx(pl,{status:e.row.is_active?"active":"inactive"})},{field:"actions",headerName:Jo("actions"),flex:.8,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),N(e.row)},disabled:!n,children:t.jsx(et,{fontSize:"small"})}),t.jsx(f,{color:"error",size:"small",onClick:t=>{t.stopPropagation(),O(e.row.id)},disabled:!i,children:t.jsx(Ze,{fontSize:"small"})})]})}];jt.useEffect((()=>{(async()=>{try{l(!0);const e=await ms();a(e)}catch(e){console.error("Error loading suppliers:",e)}finally{l(!1)}})()}),[]),jt.useEffect((()=>{u&&(async e=>{try{j(!0);const t=await gs("supplier"),r=s.filter((t=>void 0!==t.account&&t.account!==e)).map((e=>e.account)),n=t.filter((e=>!r.includes(e.id)));A(n.map((e=>({id:e.id??0,name:e.name??""}))))}catch(t){console.error("Error loading available accounts:",t)}finally{j(!1)}})(p.account)}),[u,s,p.account]);const N=e=>{e?(g({name:e.name,contact_person:e.contact_person,email:e.email,phone:e.phone,address:e.address,is_active:e.is_active,account:e.account}),y(!0),b(e.id)):(g(Rd),y(!1),b(null)),h(!0)},P=()=>{h(!1)},O=async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce fournisseur?"))try{a((t=>t.filter((t=>t.id!==e)))),S({open:!0,message:"Fournisseur supprimÃ© avec succÃ¨s",severity:"success"})}catch(t){console.error("Error deleting supplier:",t),S({open:!0,message:"Erreur lors de la suppression du fournisseur",severity:"error"})}},k=()=>{S((e=>({...e,open:!1})))},M=s.filter((e=>e.name.toLowerCase().includes(v.toLowerCase())||e.contact_person.toLowerCase().includes(v.toLowerCase())||e.email.toLowerCase().includes(v.toLowerCase())));return t.jsx(Ad,{requiredPermission:"view_supplier",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des Fournisseurs"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez vos relations avec les fournisseurs"})]}),t.jsxs(U,{sx:{p:3,mb:4},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[t.jsx(ul,{label:Jo("search"),value:v,onChange:e=>C(e.target.value),sx:{width:"300px"},InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})})}}),t.jsx(Lo,{variant:"contained",startIcon:t.jsx(Oe,{}),onClick:()=>N(),disabled:!e("add_supplier"),children:Jo("addSupplier")})]}),o?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(m,{})}):t.jsx(el,{rows:M,columns:R,paginationModel:T,onPaginationModelChange:D,loading:o,getRowId:e=>e.id||Math.random(),onRowClick:e=>{n&&N(e.row)},sx:{minHeight:400,"& .MuiDataGrid-row":{cursor:"pointer"}}})]}),t.jsx(yl,{open:u,editMode:x,contactType:"supplier",formData:p,availableAccounts:E,loadingAccounts:I,onClose:P,onSubmit:async()=>{try{if(!p.account)return void S({open:!0,message:"Le compte fournisseur est requis",severity:"error"});if(x&&w){await(async(e,t)=>(await rs.patch(`/partners/suppliers/${e}/`,t)).data)(w,p);const e=await ms();a(e),S({open:!0,message:"Fournisseur mis Ã  jour avec succÃ¨s",severity:"success"})}else{await(async e=>(await rs.post("/partners/suppliers/",e)).data)(p);const e=await ms();a(e),S({open:!0,message:"Fournisseur ajoutÃ© avec succÃ¨s",severity:"success"})}P()}catch(e){let t="Erreur lors de l'enregistrement du fournisseur";if(e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data){const r=e.response.data;if("object"==typeof r){const e=Object.entries(r).map((([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):String(t)}`)).join("\n");e&&(t=`Erreurs: ${e}`)}}S({open:!0,message:t,severity:"error"})}},onFormDataChange:e=>{g(e)},onAccountChange:e=>{g((t=>({...t,account:""===e?void 0:e})))},onCreateAccount:()=>{r("/settings?tab=4")}}),t.jsx(Ye,{open:_.open,autoHideDuration:6e3,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(W,{onClose:k,severity:_.severity,variant:"filled",sx:{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:_.message})})]})})},Pd={product:0,quantity:0,zone:Number("1")||1,date:(new Date).toISOString().split("T")[0],notes:""},Od=()=>{const e=h(),{canPerform:r}=jd(),n=r("change_production"),i=r("delete_production"),[s,a]=jt.useState([]),[o,l]=jt.useState([]),[u,p]=jt.useState([]),[g,x]=jt.useState(!0),[y,w]=jt.useState(""),[b,v]=jt.useState(""),[C,_]=jt.useState(""),[S,E]=jt.useState(!1),[A,I]=jt.useState(Pd),[j,T]=jt.useState(!1),[D,R]=jt.useState(null),[N,P]=jt.useState(!1),[O,M]=jt.useState(null),[F,L]=jt.useState(!1),[z,G]=jt.useState(null),[q,X]=jt.useState({page:0,pageSize:10});jt.useEffect((()=>{X((e=>({...e,page:0})))}),[y,b,C]),jt.useEffect((()=>{$()}),[]);const $=async()=>{try{x(!0),G(null);const e=await(async()=>{const e=await rs.get("/production/productions/");return e.data.results||e.data})();a(e);const t=await La();l(t);const r=await ka();p(r)}catch(e){console.error("Error loading data:",e),G("Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer.")}finally{x(!1)}},Z=e=>{const t=o.find((t=>t.id===e));return t?t.name:"Produit inconnu"},J=e=>{const t=u.find((t=>t.id===e));return t?t.name:"Zone inconnue"},ee=s.filter((e=>{const t=Z(e.product).toLowerCase().includes(y.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(y.toLowerCase()),r=""===b||e.zone===Number(b),n=""===C||e.product===Number(C);return t&&r&&n})),te=[...new Set(s.map((e=>e.zone)))],re=[...new Set(s.map((e=>e.product)))],ne=e=>{e?(I({product:e.product,quantity:e.quantity,zone:e.zone,date:e.date,notes:e.notes||""}),T(!0),R(e.id||null)):(I(Pd),T(!1),R(null)),E(!0)},ie=()=>{E(!1),G(null)},se=e=>{const{name:t,value:r}=e.target;I((e=>({...e,[t]:r})))},ae=e=>{const{name:t,value:r}=e.target;I((e=>({...e,[t]:r})))},le=()=>{P(!1),M(null)};return t.jsx(Ad,{requiredPermission:"view_production",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsx(c,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(c,{children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion de la Production"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"Suivez et gÃ©rez toutes les opÃ©rations de production"})]})}),t.jsxs(U,{sx:{p:3,mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",md:"flex-end"},mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,width:{xs:"100%",md:"auto"},flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Produit ou notes",variant:"outlined",size:"small",fullWidth:!0,value:y,onChange:e=>w(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{})}),sx:{borderRadius:2}}}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:150},children:[t.jsx(Q,{id:"zone-filter-label",children:"Zone"}),t.jsxs(K,{labelId:"zone-filter-label",id:"zone-filter",value:b,onChange:e=>v(e.target.value),label:"Zone",sx:{borderRadius:2},children:[t.jsx(B,{value:"",children:"Toutes les zones"}),te.map((e=>t.jsx(B,{value:e,children:J(e)},e)))]})]}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{id:"product-filter-label",children:"Produit"}),t.jsxs(K,{labelId:"product-filter-label",id:"product-filter",value:C,onChange:e=>_(e.target.value),label:"Produit",sx:{borderRadius:2},children:[t.jsx(B,{value:"",children:"Tous les produits"}),re.map((e=>t.jsx(B,{value:e,children:Z(e)},e)))]})]})]}),t.jsx(zo,{variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:()=>ne(),requiredPermission:"add_production",sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Nouvelle Production"})]}),z&&t.jsx(W,{severity:"error",sx:{mb:3,borderRadius:2,boxShadow:"0 2px 10px rgba(0,0,0,0.08)"},children:z}),g?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(el,{rows:ee,columns:[{field:"product",headerName:"Produit",flex:1.5,valueGetter:(e,t)=>t?Z(t.product):"N/A"},{field:"quantity",headerName:"QuantitÃ©",flex:1,valueGetter:(e,t)=>t&&void 0!==t.quantity?t.quantity.toLocaleString():"0"},{field:"zone",headerName:"Zone",flex:1,valueGetter:(e,t)=>t?J(t.zone):"N/A"},{field:"date",headerName:"Date",flex:1,valueGetter:(e,t)=>t&&t.date?new Date(t.date).toLocaleDateString("fr-FR"):""},{field:"notes",headerName:"Notes",flex:1.5,valueGetter:(e,t)=>t&&t.notes||""},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>t.jsxs(c,{children:[t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:t=>{t.stopPropagation(),ne(e.row)},disabled:!n,children:t.jsx(et,{fontSize:"small"})}),t.jsx(f,{color:"error",size:"small",onClick:t=>{var r;t.stopPropagation(),r=e.row,M(r),P(!0)},disabled:!i,children:t.jsx(Ze,{fontSize:"small"})})]})}],paginationModel:q,onPaginationModelChange:X,onRowClick:e=>{ne(e.row)},loading:g,getRowId:e=>e&&void 0!==e.id?e.id:Math.random()})]}),t.jsxs(xe,{open:S,onClose:ie,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ye,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold"},children:j?"Modifier la Production":"Nouvelle Production"}),t.jsx(we,{sx:{p:3,mt:1},children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"Produit"}),t.jsxs(K,{name:"product",value:String(A.product),onChange:ae,label:"Produit",children:[t.jsx(B,{value:"0",children:"SÃ©lectionnez un produit"}),o.map((e=>t.jsx(B,{value:String(e.id),children:e.name},e.id)))]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{name:"quantity",label:"QuantitÃ©",type:"number",fullWidth:!0,required:!0,value:A.quantity,onChange:se,inputProps:{min:0}})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"Zone"}),t.jsx(K,{name:"zone",value:String(A.zone),onChange:ae,label:"Zone",children:u.map((e=>t.jsx(B,{value:String(e.id),children:e.name},e.id)))})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{name:"date",label:"Date",type:"date",fullWidth:!0,required:!0,value:A.date,onChange:se,InputLabelProps:{shrink:!0}})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{name:"notes",label:"Notes",multiline:!0,rows:3,fullWidth:!0,value:A.notes,onChange:se})})]})}),t.jsxs(be,{sx:{p:2},children:[t.jsx(k,{onClick:ie,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e;try{G(null);const t={...A,product:Number(A.product),quantity:Number(A.quantity),zone:Number(A.zone),reference:j&&D&&(null==(e=s.find((e=>e.id===D)))?void 0:e.reference)||`PROD-${Date.now()}`};if(j&&D){const e=await(async(e,t)=>(await rs.patch(`/production/productions/${e}/`,t)).data)(D,t);a((t=>t.map((t=>t.id===D?e:t))))}else{const e=await(async e=>(await rs.post("/production/productions/",e)).data)(t);a((t=>[...t,e]))}ie(),await $()}catch(t){console.error("Error saving production:",t),G("Erreur lors de l'enregistrement de la production")}},disabled:!A.product||A.quantity<=0||!A.zone||!A.date,sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:j?"Mettre Ã  jour":"Ajouter"})]})]}),t.jsxs(xe,{open:N,onClose:le,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 30px rgba(0,0,0,0.12)"}},children:[t.jsx(ye,{sx:{backgroundColor:e.palette.error.main,color:"white",fontWeight:"bold"},children:"Confirmer la suppression"}),t.jsx(we,{sx:{p:3,mt:2},children:t.jsxs(rt,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer cette production ?",O&&t.jsxs(c,{component:"span",sx:{display:"block",mt:2,fontWeight:"bold"},children:["Produit : ",Z(O.product),t.jsx("br",{}),"QuantitÃ© : ",O.quantity,t.jsx("br",{}),"Date : ",new Date(O.date).toLocaleDateString("fr-FR")]})]})}),t.jsxs(be,{sx:{p:2},children:[t.jsx(k,{onClick:le,disabled:F,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:2.5,py:1,border:"1.5px solid",borderColor:"primary.main","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.lightest"},transition:"all 0.2s ease-in-out"},children:"Annuler"}),t.jsx(k,{variant:"contained",color:"error",onClick:async()=>{if(O&&O.id){L(!0);try{await(async e=>{await rs.delete(`/production/productions/${e}/`)})(O.id),a((e=>e.filter((e=>e.id!==O.id)))),P(!1),M(null)}catch(e){console.error("Error deleting production:",e),G("Erreur lors de la suppression de la production")}finally{L(!1)}}},disabled:F,startIcon:F?t.jsx(m,{size:20}):t.jsx(Ze,{}),sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,py:1,boxShadow:1,"&:hover":{boxShadow:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:F?"Suppression...":"Supprimer"})]})]})]})})};function kd(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=kd(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function Md(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=kd(e))&&(n&&(n+=" "),n+=t);return n}let Fd={data:""},Bd=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Ld=/\/\*[^]*?\*\/|  +/g,zd=/\n+/g,Ud=(e,t)=>{let r="",n="",i="";for(let s in e){let a=e[s];"@"==s[0]?"i"==s[1]?r=s+" "+a+";":n+="f"==s[1]?Ud(a,s):s+"{"+Ud(a,"k"==s[1]?"":t)+"}":"object"==typeof a?n+=Ud(a,t?t.replace(/([^,])+/g,(e=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):s):null!=a&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=Ud.p?Ud.p(s,a):s+":"+a+";")}return r+(t&&i?t+"{"+i+"}":i)+n},Wd={},Vd=e=>{if("object"==typeof e){let t="";for(let r in e)t+=r+Vd(e[r]);return t}return e};function Hd(e){let t=this||{},r=e.call?e(t.p):e;return((e,t,r,n,i)=>{let s=Vd(e),a=Wd[s]||(Wd[s]=(e=>{let t=0,r=11;for(;t<e.length;)r=101*r+e.charCodeAt(t++)>>>0;return"go"+r})(s));if(!Wd[a]){let t=s!==e?e:(e=>{let t,r,n=[{}];for(;t=Bd.exec(e.replace(Ld,""));)t[4]?n.shift():t[3]?(r=t[3].replace(zd," ").trim(),n.unshift(n[0][r]=n[0][r]||{})):n[0][t[1]]=t[2].replace(zd," ").trim();return n[0]})(e);Wd[a]=Ud(i?{["@keyframes "+a]:t}:t,r?"":"."+a)}let o=r&&Wd.g?Wd.g:null;return r&&(Wd.g=Wd[a]),l=Wd[a],c=t,d=n,(u=o)?c.data=c.data.replace(u,l):-1===c.data.indexOf(l)&&(c.data=d?l+c.data:c.data+l),a;var l,c,d,u})(r.unshift?r.raw?((e,t,r)=>e.reduce(((e,n,i)=>{let s=t[i];if(s&&s.call){let e=s(r),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":Ud(e,""):!1===e?"":e}return e+n+(null==s?"":s)}),""))(r,[].slice.call(arguments,1),t.p):r.reduce(((e,r)=>Object.assign(e,r&&r.call?r(t.p):r)),{}):r,(n=t.target,"object"==typeof window?((n?n.querySelector("#_goober"):window._goober)||Object.assign((n||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:n||Fd),t.g,t.o,t.k);var n}function Gd(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}function qd(){return qd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qd.apply(this,arguments)}function Xd(e,t){if(null==e)return{};var r,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}Hd.bind({g:1}),Hd.bind({k:1});var $d=function(){return""},Zd=Pt.createContext({enqueueSnackbar:$d,closeSnackbar:$d}),Yd="@media (max-width:599.95px)",Qd="@media (min-width:600px)",Kd="unmounted",Jd="exited",eu="entering",tu="entered",ru="exiting",nu=function(e){var t,r;function n(t){var r;r=e.call(this,t)||this;var n,i=t.appear;return r.appearStatus=null,t.in?i?(n=Jd,r.appearStatus=eu):n=tu:n=t.unmountOnExit||t.mountOnEnter?Kd:Jd,r.state={status:n},r.nextCallback=null,r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Kd?{status:Jd}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var r=this.state.status;this.props.in?r!==eu&&r!==tu&&(t=eu):r!==eu&&r!==tu||(t=ru)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e=this.props.timeout,t=e,r=e;return null!=e&&"number"!=typeof e&&"string"!=typeof e&&(r=e.exit,t=e.enter),{exit:r,enter:t}},i.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===eu?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===Jd&&this.setState({status:Kd})},i.performEnter=function(e){var t=this,r=this.props.enter,n=e,i=this.getTimeouts();e||r?(this.props.onEnter&&this.props.onEnter(this.node,n),this.safeSetState({status:eu},(function(){t.props.onEntering&&t.props.onEntering(t.node,n),t.onTransitionEnd(i.enter,(function(){t.safeSetState({status:tu},(function(){t.props.onEntered&&t.props.onEntered(t.node,n)}))}))}))):this.safeSetState({status:tu},(function(){t.props.onEntered&&t.props.onEntered(t.node,n)}))},i.performExit=function(){var e=this,t=this.props.exit,r=this.getTimeouts();t?(this.props.onExit&&this.props.onExit(this.node),this.safeSetState({status:ru},(function(){e.props.onExiting&&e.props.onExiting(e.node),e.onTransitionEnd(r.exit,(function(){e.safeSetState({status:Jd},(function(){e.props.onExited&&e.props.onExited(e.node)}))}))}))):this.safeSetState({status:Jd},(function(){e.props.onExited&&e.props.onExited(e.node)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&this.nextCallback.cancel&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,r=!0;return this.nextCallback=function(){r&&(r=!1,t.nextCallback=null,e())},this.nextCallback.cancel=function(){r=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var r=null==e&&!this.props.addEndListener;this.node&&!r?(this.props.addEndListener&&this.props.addEndListener(this.node,this.nextCallback),null!=e&&setTimeout(this.nextCallback,e)):setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===Kd)return null;var t=this.props;return(0,t.children)(e,Xd(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]))},Gd(n,[{key:"node",get:function(){var e,t=null===(e=this.props.nodeRef)||void 0===e?void 0:e.current;if(!t)throw new Error("notistack - Custom snackbar is not refForwarding");return t}}]),n}(Pt.Component);function iu(){}function su(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function au(e,t){return jt.useMemo((function(){return null==e&&null==t?null:function(r){su(e,r),su(t,r)}}),[e,t])}function ou(e){var t=e.timeout,r=e.style,n=void 0===r?{}:r,i=e.mode;return{duration:"object"==typeof t?t[i]||0:t,easing:n.transitionTimingFunction,delay:n.transitionDelay}}nu.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:iu,onEntering:iu,onEntered:iu,onExit:iu,onExiting:iu,onExited:iu};var lu="cubic-bezier(0.4, 0, 0.2, 1)",cu="cubic-bezier(0.0, 0, 0.2, 1)",du="cubic-bezier(0.4, 0, 0.6, 1)",uu=function(e){e.scrollTop=e.scrollTop},hu=function(e){return Math.round(e)+"ms"};function pu(e,t){void 0===e&&(e=["all"]);var r=t||{},n=r.duration,i=void 0===n?300:n,s=r.easing,a=void 0===s?lu:s,o=r.delay,l=void 0===o?0:o;return(Array.isArray(e)?e:[e]).map((function(e){var t="string"==typeof i?i:hu(i),r="string"==typeof l?l:hu(l);return e+" "+t+" "+a+" "+r})).join(",")}function mu(e){var t=function(e){return e&&e.ownerDocument||document}(e);return t.defaultView||window}function fu(e,t){if(t){var r=function(e,t){var r,n=t.getBoundingClientRect(),i=mu(t);if(t.fakeTransform)r=t.fakeTransform;else{var s=i.getComputedStyle(t);r=s.getPropertyValue("-webkit-transform")||s.getPropertyValue("transform")}var a=0,o=0;if(r&&"none"!==r&&"string"==typeof r){var l=r.split("(")[1].split(")")[0].split(",");a=parseInt(l[4],10),o=parseInt(l[5],10)}switch(e){case"left":return"translateX("+(i.innerWidth+a-n.left)+"px)";case"right":return"translateX(-"+(n.left+n.width-a)+"px)";case"up":return"translateY("+(i.innerHeight+o-n.top)+"px)";default:return"translateY(-"+(n.top+n.height-o)+"px)"}}(e,t);r&&(t.style.webkitTransform=r,t.style.transform=r)}}var gu=jt.forwardRef((function(e,t){var r=e.children,n=e.direction,i=void 0===n?"down":n,s=e.in,a=e.style,o=e.timeout,l=void 0===o?0:o,c=e.onEnter,d=e.onEntered,u=e.onExit,h=e.onExited,p=Xd(e,["children","direction","in","style","timeout","onEnter","onEntered","onExit","onExited"]),m=jt.useRef(null),f=au(r.ref,m),g=au(f,t),x=jt.useCallback((function(){m.current&&fu(i,m.current)}),[i]);return jt.useEffect((function(){if(!s&&"down"!==i&&"right"!==i){var e=function(e,t){var r;function n(){for(var n=this,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];clearTimeout(r),r=setTimeout((function(){e.apply(n,s)}),t)}return void 0===t&&(t=166),n.clear=function(){clearTimeout(r)},n}((function(){m.current&&fu(i,m.current)})),t=mu(m.current);return t.addEventListener("resize",e),function(){e.clear(),t.removeEventListener("resize",e)}}}),[i,s]),jt.useEffect((function(){s||x()}),[s,x]),jt.createElement(nu,Object.assign({appear:!0,nodeRef:m,onEnter:function(e,t){fu(i,e),uu(e),c&&c(e,t)},onEntered:d,onEntering:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||cu,r=ou({timeout:l,mode:"enter",style:qd({},a,{transitionTimingFunction:t})});e.style.webkitTransition=pu("-webkit-transform",r),e.style.transition=pu("transform",r),e.style.webkitTransform="none",e.style.transform="none"},onExit:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||du,r=ou({timeout:l,mode:"exit",style:qd({},a,{transitionTimingFunction:t})});e.style.webkitTransition=pu("-webkit-transform",r),e.style.transition=pu("transform",r),fu(i,e),u&&u(e)},onExited:function(e){e.style.webkitTransition="",e.style.transition="",h&&h(e)},in:s,timeout:l},p),(function(e,t){return jt.cloneElement(r,qd({ref:g,style:qd({visibility:"exited"!==e||s?void 0:"hidden"},a,{},r.props.style)},t))}))}));function xu(e){return Object.entries(e).reduce((function(e,t){var r,n=t[0],i=t[1];return qd({},e,((r={})[n]=Hd(i),r))}),{})}gu.displayName="Slide";var yu="notistack-Snackbar",wu="notistack-CollapseWrapper",bu="notistack-MuiContent",vu=function(e){return"notistack-MuiContent-"+e},Cu=xu({root:{height:0},entered:{height:"auto"}}),_u="0px";jt.forwardRef((function(e,t){var r=e.children,n=e.in,i=e.onExited,s=jt.useRef(null),a=jt.useRef(null),o=au(t,a),l=function(){return s.current?s.current.clientHeight:0};return jt.createElement(nu,{in:n,unmountOnExit:!0,onEnter:function(e){e.style.height=_u},onEntered:function(e){e.style.height="auto"},onEntering:function(e){var t=l(),r=ou({timeout:175,mode:"enter"}),n=r.duration,i=r.easing;e.style.transitionDuration="string"==typeof n?n:n+"ms",e.style.height=t+"px",e.style.transitionTimingFunction=i||""},onExit:function(e){e.style.height=l()+"px"},onExited:i,onExiting:function(e){uu(e);var t=ou({timeout:175,mode:"exit"}),r=t.duration,n=t.easing;e.style.transitionDuration="string"==typeof r?r:r+"ms",e.style.height=_u,e.style.transitionTimingFunction=n||""},nodeRef:a,timeout:175},(function(e,t){return jt.createElement("div",Object.assign({ref:o,className:Md(Cu.root,"entered"===e&&Cu.entered),style:qd({pointerEvents:"all",overflow:"hidden",minHeight:_u,transition:pu("height")},"entered"===e&&{overflow:"visible"},{},"exited"===e&&!n&&{visibility:"hidden"})},t),jt.createElement("div",{ref:s,className:wu,style:{display:"flex",width:"100%"}},r))}))})).displayName="Collapse";var Su,Eu="undefined"!=typeof window?jt.useLayoutEffect:jt.useEffect;function Au(e){var t=jt.useRef(e);return Eu((function(){t.current=e})),jt.useCallback((function(){return t.current.apply(void 0,arguments)}),[])}jt.forwardRef((function(e,t){var r=e.children,n=e.className,i=e.autoHideDuration,s=e.disableWindowBlurListener,a=void 0!==s&&s,o=e.onClose,l=e.id,c=e.open,d=e.SnackbarProps,u=void 0===d?{}:d,h=jt.useRef(),p=Au((function(){o&&o.apply(void 0,arguments)})),m=Au((function(e){o&&null!=e&&(h.current&&clearTimeout(h.current),h.current=setTimeout((function(){p(null,"timeout",l)}),e))}));jt.useEffect((function(){return c&&m(i),function(){h.current&&clearTimeout(h.current)}}),[c,i,m]);var f=function(){h.current&&clearTimeout(h.current)},g=jt.useCallback((function(){null!=i&&m(.5*i)}),[i,m]);return jt.useEffect((function(){if(!a&&c)return window.addEventListener("focus",g),window.addEventListener("blur",f),function(){window.removeEventListener("focus",g),window.removeEventListener("blur",f)}}),[a,g,c]),jt.createElement("div",Object.assign({ref:t},u,{className:Md(yu,n),onMouseEnter:function(e){u.onMouseEnter&&u.onMouseEnter(e),f()},onMouseLeave:function(e){u.onMouseLeave&&u.onMouseLeave(e),g()}}),r)})).displayName="Snackbar";var Iu=xu({root:(Su={display:"flex",flexWrap:"wrap",flexGrow:1},Su[Qd]={flexGrow:"initial",minWidth:"288px"},Su)}),ju=jt.forwardRef((function(e,t){var r=e.className,n=Xd(e,["className"]);return Pt.createElement("div",Object.assign({ref:t,className:Md(Iu.root,r)},n))}));ju.displayName="SnackbarContent";var Tu,Du,Ru,Nu=xu({root:{backgroundColor:"#313131",fontSize:"0.875rem",lineHeight:1.43,letterSpacing:"0.01071em",color:"#fff",alignItems:"center",padding:"6px 16px",borderRadius:"4px",boxShadow:"0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12)"},lessPadding:{paddingLeft:"20px"},default:{backgroundColor:"#313131"},success:{backgroundColor:"#43a047"},error:{backgroundColor:"#d32f2f"},warning:{backgroundColor:"#ff9800"},info:{backgroundColor:"#2196f3"},message:{display:"flex",alignItems:"center",padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:"16px",marginRight:"-8px"}}),Pu="notistack-snackbar";jt.forwardRef((function(e,t){var r=e.id,n=e.message,i=e.action,s=e.iconVariant,a=e.variant,o=e.hideIconVariant,l=e.style,c=e.className,d=s[a],u=i;return"function"==typeof u&&(u=u(r)),Pt.createElement(ju,{ref:t,role:"alert","aria-describedby":Pu,style:l,className:Md(bu,vu(a),Nu.root,Nu[a],c,!o&&d&&Nu.lessPadding)},Pt.createElement("div",{id:Pu,className:Nu.message},o?null:d,n),u&&Pt.createElement("div",{className:Nu.action},u))})).displayName="MaterialDesignContent";var Ou={default:20},ku={default:6,dense:2},Mu="."+wu;(Tu={boxSizing:"border-box",display:"flex",maxHeight:"100%",position:"fixed",zIndex:1400,height:"auto",width:"auto",transition:pu(["top","right","bottom","left","max-width"],{duration:300,easing:"ease"}),pointerEvents:"none"})[Mu]={padding:ku.default+"px 0px",transition:"padding 300ms ease 0ms"},Tu.maxWidth="calc(100% - "+2*Ou.default+"px)",Tu[Yd]={width:"100%",maxWidth:"calc(100% - 32px)"},ku.dense,Ou.default,ku.default,Ou.default,ku.default,(Du={left:Ou.default+"px"})[Qd]={alignItems:"flex-start"},Du[Yd]={left:"16px"},(Ru={right:Ou.default+"px"})[Qd]={alignItems:"flex-end"},Ru[Yd]={right:"16px"};const Fu=()=>{const[e,t]=jt.useState([]),[r,n]=jt.useState([]),[i,s]=jt.useState([]),[a,o]=jt.useState([]),[l,c]=jt.useState([]),[d,u]=jt.useState(null),[h,p]=jt.useState(null),[m,f]=jt.useState(null),[g,x]=jt.useState(null),[y,w]=jt.useState([]),[b,v]=jt.useState([]),[C,_]=jt.useState([]),[S,E]=jt.useState(null),[A,I]=jt.useState(!1),[j,T]=jt.useState(!1),[D,R]=jt.useState(!1),[N,P]=jt.useState(!1),[O,k]=jt.useState(!1),[M,F]=jt.useState(null),B=jt.useCallback((async()=>{try{const e=await ps();t(e)}catch(e){throw console.error("Error fetching clients:",e),F("Erreur lors du chargement des clients"),e}}),[]),L=jt.useCallback((async()=>{try{const e=await ms();n(e)}catch(e){throw console.error("Error fetching suppliers:",e),F("Erreur lors du chargement des fournisseurs"),e}}),[]),z=jt.useCallback((async()=>{try{const e=await fs();s(e)}catch(e){throw console.error("Error fetching accounts:",e),F("Erreur lors du chargement des comptes"),e}}),[]),U=jt.useCallback((async()=>{try{const e=await fs();o(e)}catch(e){throw console.error("Error fetching all accounts:",e),F("Erreur lors du chargement des comptes"),e}}),[]),W=jt.useCallback((async()=>{try{k(!0);const[e,t]=await Promise.all([fs(),Ma()]);s(e),c(t)}catch(e){throw console.error("Error fetching resources:",e),F("Erreur lors du chargement des ressources"),e}finally{k(!1)}}),[]),V=jt.useCallback((async(e,t,r,n)=>{try{P(!0),F(null);let t=[];t=e?await xs(e):await xs(),_(t)}catch(i){throw console.error("Error fetching account movements:",i),F("Erreur lors du chargement des mouvements de compte"),_([]),i}finally{P(!1)}}),[]),H=jt.useCallback((async()=>{try{I(!0),F(null),await Promise.all([B(),L(),z(),W()])}catch(e){throw console.error("Error refreshing data:",e),F("Erreur lors du rafraÃ®chissement des donnÃ©es"),e}finally{I(!1)}}),[B,L,z,W]),G=jt.useCallback((async e=>{try{T(!0);const t=await(async e=>(await rs.get(`/partners/clients/${e}/`)).data)(e);if(!t.account)throw new Error("Ce client n'a pas de compte associÃ©");const r=await ys(t.account,"client");return console.log("âœ… Client balance data:",r),console.log("âœ… Outstanding sales:",r.outstanding_sales),f(r),r}catch(t){throw console.error("Error fetching client balance:",t),F("Erreur lors du chargement du solde client"),t}finally{T(!1)}}),[]),q=jt.useCallback((async e=>{var t;try{const r={client:e.client,account:e.account,amount:e.amount,allocated_amount:e.amount,payment_method:(null==(t=e.payment_method)?void 0:t.id)||null,date:e.date,description:e.description||"DÃ©pÃ´t sur compte client"};await(async e=>(await rs.post("/treasury/cash-receipts/",e)).data)(r),d&&await G(d.id)}catch(r){throw console.error("Error creating client deposit:",r),F("Erreur lors de la crÃ©ation du dÃ©pÃ´t"),r}}),[d,G]),X=jt.useCallback((async(e,t,r,n)=>{try{await(async(e,t)=>{var r;const n=await rs.post(`/sales/sales/${e}/pay_from_account/`,t);if("paid"===(null==(r=n.data.sale)?void 0:r.payment_status)){const t=await rs.get(`/sales/sales/${e}/`);"payment_pending"!==t.data.status&&"confirmed"!==t.data.status||(await rs.patch(`/sales/sales/${e}/`,{status:"paid"}),n.data.sale.status="paid")}return n.data})(e,{amount:t,company_account:r,description:n}),d&&await G(d.id)}catch(i){throw console.error("Error creating client payment:",i),F("Erreur lors du paiement"),i}}),[d,G]),$=jt.useCallback((async()=>{try{T(!0);const e=await rs.get("/treasury/account-statements/"),t=(Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[]).filter((e=>e.account&&("sale"===e.transaction_type||"client_payment"===e.transaction_type)));w(t)}catch(e){throw console.error("Error fetching all client transactions:",e),F("Erreur lors du chargement des transactions clients"),e}finally{T(!1)}}),[]),Z=jt.useCallback((async e=>{try{R(!0);const t=await(async e=>(await rs.get(`/partners/suppliers/${e}/`)).data)(e);if(!t.account)throw new Error("Ce fournisseur n'a pas de compte associÃ©");const r=await ys(t.account,"supplier");return console.log("âœ… Supplier balance data:",r),console.log("âœ… Outstanding supplies:",r.outstanding_supplies),x(r),r}catch(t){throw console.error("Error fetching supplier balance:",t),F("Erreur lors du chargement du solde fournisseur"),t}finally{R(!1)}}),[]),Y=jt.useCallback((async(e,t,r,n)=>{try{await rs.post(`/inventory/stock-supplies/${e}/pay_from_account/`,{amount:t,company_account:r,description:n}),h&&await Z(h.id)}catch(i){throw console.error("Error creating supplier payment:",i),F("Erreur lors du paiement fournisseur"),i}}),[h,Z]),Q=jt.useCallback((async()=>{try{R(!0);const e=await rs.get("/treasury/account-statements/"),t=(Array.isArray(e.data)?e.data:e.data&&e.data.results?e.data.results:[]).filter((e=>e.account&&("supply"===e.transaction_type||"supplier_payment"===e.transaction_type)));v(t)}catch(e){throw console.error("Error fetching all supplier transactions:",e),F("Erreur lors du chargement des transactions fournisseurs"),e}finally{R(!1)}}),[]);return{clients:e,suppliers:r,accounts:i,allAccounts:a,paymentMethods:l,selectedClient:d,selectedSupplier:h,clientBalanceData:m,supplierBalanceData:g,allClientTransactions:y,allSupplierTransactions:b,accountMovements:C,selectedAccount:S,loading:A,loadingClientData:j,loadingSupplierData:D,loadingMovements:N,loadingResources:O,error:M,fetchClients:B,fetchSuppliers:L,fetchAccounts:z,fetchAllAccounts:U,fetchResources:W,fetchAccountMovements:V,refreshAllData:H,getClientBalance:G,getAllClientTransactions:$,createClientDeposit:q,createClientPayment:X,getSupplierBalance:Z,getAllSupplierTransactions:Q,createSupplierPayment:Y,setSelectedClient:u,setSelectedSupplier:p,setSelectedAccount:E,setError:F,setLoading:I}},Bu=e=>new Intl.NumberFormat("fr-GN",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),Lu=e=>{try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}},zu=e=>{switch(e){case"unpaid":case"payment_pending":return"error";case"partially_paid":return"warning";case"paid":return"success";default:return"default"}},Uu=e=>{switch(console.log("Getting label for status:",e),e){case"unpaid":case"received":case"payment_pending":return"Non payÃ©";case"partially_paid":return"Partiellement payÃ©";case"paid":return"PayÃ©";case"overpaid":return"SurpayÃ©";default:return e}},Wu=e=>{const t=(e||"").toLowerCase();return{bgcolor:t.includes("dÃ©pÃ´t")?"rgba(46, 125, 50, 0.1)":t.includes("paiement")?"rgba(25, 118, 210, 0.1)":"rgba(156, 39, 176, 0.1)",color:t.includes("dÃ©pÃ´t")?"success.main":t.includes("paiement")?"primary.main":"secondary.main",borderRadius:"4px",fontWeight:500}},Vu=()=>{const[e,t]=jt.useState({open:!1,sale:null,amount:"0",account:null,description:"",processing:!1}),r=jt.useCallback((e=>{const r=e.remaining_amount||e.balance||0;t({open:!0,sale:e,amount:String(r),account:null,description:`Paiement vente ${e.reference}`,processing:!1,sale_reference:e.reference,sale_total:e.total_amount,sale_balance:r,date:new Date,payment_method:"",reference:"",notes:""})}),[]),n=jt.useCallback((()=>{t((e=>({...e,open:!1})))}),[]),i=jt.useCallback((e=>{t((t=>({...t,...e})))}),[]),s=jt.useCallback((e=>{t((t=>({...t,processing:e})))}),[]),[a,o]=jt.useState({open:!1,supply:null,amount:"0",account:null,description:"",processing:!1}),l=jt.useCallback((e=>{o({open:!0,supply:e,amount:String(e.remaining_amount),account:null,description:`Paiement approvisionnement ${e.reference}`,processing:!1,supply_reference:e.reference,supply_total:e.total_amount,supply_balance:e.remaining_amount,date:new Date,payment_method:"",reference:"",notes:""})}),[]),c=jt.useCallback((()=>{o((e=>({...e,open:!1})))}),[]),d=jt.useCallback((e=>{o((t=>({...t,...e})))}),[]),u=jt.useCallback((e=>{o((t=>({...t,processing:e})))}),[]),[h,p]=jt.useState({open:!1,client:null,amount:"0",account:null,payment_method:null,date:(new Date).toISOString().split("T")[0],description:"DÃ©pÃ´t sur compte",processing:!1}),m=jt.useCallback((e=>{p({open:!0,client:e,amount:"0",account:null,payment_method:null,date:(new Date).toISOString().split("T")[0],description:"DÃ©pÃ´t sur compte",processing:!1})}),[]),f=jt.useCallback((()=>{p((e=>({...e,open:!1})))}),[]),g=jt.useCallback((e=>{p((t=>({...t,...e})))}),[]),x=jt.useCallback((e=>{p((t=>({...t,processing:e})))}),[]),y=jt.useCallback((()=>{if(!e.sale||!e.account)return!1;var t;return((t={sale_id:e.sale.id,amount:e.amount,account:e.account.id}).sale_id?!t.amount||Number(t.amount)<=0?{valid:!1,error:"Le montant doit Ãªtre supÃ©rieur Ã  0"}:t.account?{valid:!0,error:null}:{valid:!1,error:"Veuillez sÃ©lectionner un compte"}:{valid:!1,error:"Veuillez sÃ©lectionner une vente"}).valid}),[e]),w=jt.useCallback((()=>{if(!a.supply||!a.account)return!1;var e;return((e={supply_id:a.supply.id,amount:a.amount,account:a.account.id}).supply_id?!e.amount||Number(e.amount)<=0?{valid:!1,error:"Le montant doit Ãªtre supÃ©rieur Ã  0"}:e.account?{valid:!0,error:null}:{valid:!1,error:"Veuillez sÃ©lectionner un compte"}:{valid:!1,error:"Veuillez sÃ©lectionner un approvisionnement"}).valid}),[a]),b=jt.useCallback((()=>{if(!h.client||!h.account||!h.payment_method)return!1;var e;return null===(e={client:h.client.id,account:h.account.id,amount:parseFloat(h.amount),payment_method:h.payment_method,date:h.date,description:h.description},console.log("Deposit validation:",e),e.client?e.account?e.payment_method?e.amount<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":null:"Veuillez sÃ©lectionner une mÃ©thode de paiement":"Veuillez sÃ©lectionner un compte pour le dÃ©pÃ´t":"Veuillez sÃ©lectionner un client")}),[h]);return{paymentDialog:e,openPaymentDialog:r,closePaymentDialog:n,updatePaymentDialog:i,setPaymentProcessing:s,supplierPaymentDialog:a,openSupplierPaymentDialog:l,closeSupplierPaymentDialog:c,updateSupplierPaymentDialog:d,setSupplierPaymentProcessing:u,depositDialog:h,openDepositDialog:m,closeDepositDialog:f,updateDepositDialog:g,setDepositProcessing:x,validatePayment:y,validateSupplierPayment:w,validateDeposit:b}},Hu=({client:e,balanceData:r,onDepositClick:n,previousBalance:i=null,balanceChangeHighlight:s=!1})=>{const a=r.balance||0,o=r.total_sales||0,l=r.total_account_credits||0;return t.jsx(nt,{in:!0,children:t.jsx(ie,{elevation:0,sx:{mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",transition:"all 0.3s ease","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}},children:t.jsxs(se,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[t.jsx(ae,{sx:{bgcolor:"primary.light",color:"primary.dark",width:48,height:48,mr:2},children:t.jsx(M,{})}),t.jsxs(c,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"text.primary"},children:e.name}),t.jsx(d,{variant:"body2",color:"text.secondary",children:e.contact_person||"Aucun contact"})]}),t.jsx(ue,{size:"small",label:"Client",sx:{bgcolor:"primary.50",color:"primary.main",fontWeight:500,fontSize:"0.75rem"}})]}),t.jsx(x,{sx:{mb:3}}),t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,md:8,children:t.jsxs(oe,{container:!0,spacing:2,children:[t.jsx(oe,{item:!0,xs:12,sm:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:a>=0?"success.50":"error.50",border:"1px solid",borderColor:a>=0?"success.200":"error.200",height:"100%"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Solde Compte"}),t.jsx(d,{variant:"h5",sx:{fontWeight:700,color:a>=0?"success.dark":"error.dark"},children:Bu(a)}),null!==i&&a!==i&&s&&t.jsx(it,{direction:"up",in:s,mountOnEnter:!0,unmountOnExit:!0,children:t.jsxs(d,{variant:"caption",sx:{display:"block",mt:1,fontWeight:600,color:a>i?"success.main":"error.main"},children:[a>i?"â†‘":"â†“",Bu(Math.abs(a-i))]})})]})}),t.jsx(oe,{item:!0,xs:12,sm:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Total Ventes"}),t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(st,{sx:{mr:1,fontSize:20,color:"primary.main"}}),t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:Bu(o)})]})]})}),t.jsx(oe,{item:!0,xs:12,sm:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",height:"100%"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Total Paiements"}),t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(at,{sx:{mr:1,fontSize:20,color:"primary.main"}}),t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:Bu(l)})]})]})})]})}),t.jsx(oe,{item:!0,xs:12,md:4,children:t.jsx(Pe,{spacing:1,justifyContent:"center",sx:{height:"100%"},children:t.jsx(k,{variant:"contained",color:"primary",startIcon:t.jsx(ot,{}),onClick:n,fullWidth:!0,sx:{py:1.5,fontWeight:600,boxShadow:"0 2px 8px rgba(25, 118, 210, 0.24)","&:hover":{boxShadow:"0 4px 12px rgba(25, 118, 210, 0.32)"}},children:"Nouveau dÃ©pÃ´t"})})})]})]})})})},Gu=({supplier:e,balanceData:r,previousBalance:n,balanceChangeHighlight:i})=>{const s=r.balance||0,a=r.total_purchases||0,o=r.total_account_credits||0;return t.jsx(nt,{in:!0,children:t.jsx(ie,{elevation:0,sx:{mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",transition:"all 0.3s ease","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}},children:t.jsxs(se,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[t.jsx(ae,{sx:{bgcolor:"secondary.light",color:"secondary.dark",width:48,height:48,mr:2},children:t.jsx(lt,{})}),t.jsxs(c,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"text.primary"},children:e.name}),t.jsx(d,{variant:"body2",color:"text.secondary",children:e.contact_person||"Aucun contact"})]}),t.jsx(ue,{size:"small",label:"Fournisseur",sx:{bgcolor:"secondary.50",color:"secondary.main",fontWeight:500,fontSize:"0.75rem"}})]}),t.jsx(x,{sx:{mb:3}}),t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,md:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:s<=0?"success.50":"error.50",border:"1px solid",borderColor:s<=0?"success.200":"error.200"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Solde Compte"}),t.jsx(d,{variant:"h5",sx:{fontWeight:700,color:s<=0?"success.dark":"error.dark"},children:Bu(s)}),null!=n&&s!==n&&i&&t.jsx(it,{direction:"up",in:i,children:t.jsxs(d,{variant:"body2",sx:{mt:.5,fontWeight:600,color:s<n?"success.main":"error.main"},children:[s<n?"â†“":"â†‘"," ",Bu(Math.abs(s-n))]})})]})}),t.jsx(oe,{item:!0,xs:12,md:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Total Achats"}),t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(st,{sx:{mr:1,fontSize:20,color:"primary.main"}}),t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:Bu(a)})]})]})}),t.jsx(oe,{item:!0,xs:12,md:4,children:t.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontSize:"0.75rem",fontWeight:500},children:"Total Paiements"}),t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(at,{sx:{mr:1,fontSize:20,color:"primary.main"}}),t.jsx(d,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:Bu(o)})]})]})})]})]})})})},qu=({sales:e,onPaymentClick:r,loading:n=!1})=>{const i=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1,minWidth:140,renderCell:e=>t.jsx(l,{title:e.value,placement:"top",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,overflow:"hidden"},children:[t.jsx(ct,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.value})]})})},{field:"date",headerName:"Date",width:120,valueFormatter:e=>Lu(e)},{field:"total_amount",headerName:"Montant Total",width:140,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:Bu(e.value)})},{field:"paid_amount",headerName:"PayÃ©",width:120,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",color:"success.main",sx:{fontWeight:500},children:Bu(e.value)})},{field:"balance",headerName:"Reste Ã  payer",width:140,align:"right",headerAlign:"right",valueGetter:(e,t)=>t.remaining_amount||t.balance||0,renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"bold",color:e.value>0?"error.main":"text.secondary"},children:Bu(e.value)})},{field:"payment_status",headerName:"Statut",width:130,valueGetter:(e,t)=>t.status,renderCell:e=>t.jsx(ue,{label:Uu(e.value),color:zu(e.value),size:"small",variant:"outlined"})},{field:"actions",headerName:"Actions",width:140,sortable:!1,align:"center",headerAlign:"center",renderCell:e=>{const n=e.row,i="paid"===n.status;return t.jsx(k,{variant:"contained",color:"primary",size:"small",startIcon:t.jsx(ht,{}),onClick:()=>r(n),disabled:i,sx:{textTransform:"none",fontWeight:600,px:2,minWidth:100},children:"Payer"})}}],s=e.reduce(((e,t)=>e+(t.remaining_amount||t.balance||0)),0),a=e.filter((e=>"paid"!==e.status)).length;return t.jsx(ie,{elevation:2,sx:{mb:3,borderRadius:2},children:t.jsxs(se,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(ct,{color:"primary"}),t.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Ventes en attente de paiement"})]}),a>0&&t.jsx(ue,{icon:t.jsx(dt,{}),label:`${a} vente${a>1?"s":""} non payÃ©e${a>1?"s":""}`,color:"warning",size:"small"})]}),s>0&&t.jsxs(c,{sx:{bgcolor:"warning.light",p:2,borderRadius:1,mb:2,display:"flex",alignItems:"center",gap:1},children:[t.jsx(ut,{color:"warning"}),t.jsxs(c,{children:[t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:"Montant total Ã  recevoir"}),t.jsx(d,{variant:"h6",color:"warning.dark",sx:{fontWeight:700},children:Bu(s)})]})]}),t.jsx(x,{sx:{mb:2}}),0===e.length?t.jsxs(c,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[t.jsx(ct,{sx:{fontSize:48,mb:1,opacity:.5}}),t.jsx(d,{variant:"body1",children:"Aucune vente en attente de paiement"})]}):t.jsx(c,{sx:{height:450,width:"100%"},children:t.jsx(de,{rows:e,columns:i,loading:n,initialState:{pagination:{paginationModel:{pageSize:5,page:0}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},pageSizeOptions:[5,10,25],density:"comfortable",disableRowSelectionOnClick:!0,sx:{border:"none","& .MuiDataGrid-cell":{fontSize:"0.875rem",py:1.5,display:"flex",alignItems:"center"},"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-row":{"&:hover":{bgcolor:"action.hover"}},"& .MuiDataGrid-columnHeaders":{bgcolor:"grey.50",fontWeight:600}}})})]})})},Xu=({supplies:e,onPaymentClick:r,loading:n=!1})=>{const i=[{field:"reference",headerName:"RÃ©fÃ©rence",flex:1,minWidth:140,renderCell:e=>t.jsx(l,{title:e.value,placement:"top",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,overflow:"hidden"},children:[t.jsx(C,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.value})]})})},{field:"date",headerName:"Date",width:120,valueFormatter:e=>Lu(e)},{field:"total_amount",headerName:"Montant Total",width:140,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:Bu(e.value)})},{field:"paid_amount",headerName:"PayÃ©",width:120,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",color:"success.main",sx:{fontWeight:500},children:Bu(e.value)})},{field:"remaining_amount",headerName:"Reste Ã  payer",width:140,align:"right",headerAlign:"right",renderCell:e=>t.jsx(d,{variant:"body2",sx:{fontWeight:"bold",color:e.value>0?"error.main":"text.secondary"},children:Bu(e.value)})},{field:"payment_status",headerName:"Statut",width:130,valueGetter:(e,t)=>t.status,renderCell:e=>t.jsx(ue,{label:Uu(e.value),color:zu(e.value),size:"small",variant:"outlined"})},{field:"actions",headerName:"Actions",width:140,sortable:!1,align:"center",headerAlign:"center",renderCell:e=>{const n=e.row,i="paid"===n.payment_status;return t.jsx(k,{variant:"contained",color:"primary",size:"small",startIcon:t.jsx(ht,{}),onClick:()=>r(n),disabled:i,sx:{textTransform:"none",fontWeight:600,px:2,minWidth:100},children:"Payer"})}}],s=e.reduce(((e,t)=>e+t.remaining_amount),0),a=e.filter((e=>"paid"!==e.payment_status)).length;return t.jsx(ie,{elevation:2,sx:{mb:3,borderRadius:2},children:t.jsxs(se,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(C,{color:"primary"}),t.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Achats en attente de paiement"})]}),a>0&&t.jsx(ue,{icon:t.jsx(dt,{}),label:`${a} achat${a>1?"s":""} non payÃ©${a>1?"s":""}`,color:"warning",size:"small"})]}),s>0&&t.jsxs(c,{sx:{bgcolor:"error.light",p:2,borderRadius:1,mb:2,display:"flex",alignItems:"center",gap:1},children:[t.jsx(ut,{color:"error"}),t.jsxs(c,{children:[t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:"Montant total Ã  payer"}),t.jsx(d,{variant:"h6",color:"error.dark",sx:{fontWeight:700},children:Bu(s)})]})]}),t.jsx(x,{sx:{mb:2}}),0===e.length?t.jsxs(c,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[t.jsx(C,{sx:{fontSize:48,mb:1,opacity:.5}}),t.jsx(d,{variant:"body1",children:"Aucun achat en attente de paiement"})]}):t.jsx(c,{sx:{height:450,width:"100%"},children:t.jsx(de,{rows:e,columns:i,loading:n,initialState:{pagination:{paginationModel:{pageSize:5,page:0}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},pageSizeOptions:[5,10,25],density:"comfortable",disableRowSelectionOnClick:!0,sx:{border:"none","& .MuiDataGrid-cell":{fontSize:"0.875rem",py:1.5,display:"flex",alignItems:"center"},"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-row":{"&:hover":{bgcolor:"action.hover"}},"& .MuiDataGrid-columnHeaders":{bgcolor:"grey.50",fontWeight:600}}})})]})})};var $u={},Zu=ge;Object.defineProperty($u,"__esModule",{value:!0});var Yu=$u.default=void 0,Qu=Zu(sl()),Ku=t;Yu=$u.default=(0,Qu.default)((0,Ku.jsx)("path",{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27M5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27z"}),"MoneyOff");const Ju=({statements:e,mode:r,showJournalCaisse:n=!0,allAccounts:i=[],loading:s=!1})=>{const[a,o]=jt.useState(0),u=jt.useCallback((e=>{switch(r){case"client":case"account":return"sale"===e.transaction_type?"Vente de marchandises":"Paiement";case"supplier":return"supply"===e.transaction_type?"Approvisionnement":"Paiement fournisseur";default:return e.description||"Transaction"}}),[r]),h=jt.useCallback((e=>{switch(r){case"client":case"account":return"sale"===e.transaction_type?parseFloat(e.debit):0;case"supplier":return"supplier_cash_payment"===e.transaction_type?parseFloat(e.debit):0;default:return parseFloat(e.debit)||0}}),[r]),p=jt.useCallback((e=>{switch(r){case"client":case"account":return"cash_receipt"===e.transaction_type?parseFloat(e.credit):0;case"supplier":return"supply"===e.transaction_type?parseFloat(e.credit):0;default:return parseFloat(e.credit)||0}}),[r]),g=jt.useMemo((()=>e.map(((e,t)=>({id:t,date:e.date,libelle:u(e),debit:h(e),credit:p(e),solde:parseFloat(e.balance)})))),[e,u,h,p]),x=jt.useMemo((()=>(e=>e.map((e=>({id:e.id,date:Lu(e.date),rawDate:e.date,reference:e.reference,type:e.transaction_type_display||e.transaction_type||"Type non dÃ©fini",description:e.description,debit:e.debit,credit:e.credit,balance:e.balance,transaction_type:e.transaction_type,_original:e}))))(e)),[e]),y=jt.useMemo((()=>[{field:"date",headerName:"Date",width:120},{field:"libelle",headerName:"LibellÃ©",flex:1,minWidth:200},{field:"debit",headerName:"DÃ©bit",width:150,align:"right",headerAlign:"right",renderCell:e=>e.value>0?Bu(e.value):""},{field:"credit",headerName:"CrÃ©dit",width:150,align:"right",headerAlign:"right",renderCell:e=>e.value>0?Bu(e.value):""},{field:"solde",headerName:"Solde",width:160,align:"right",headerAlign:"right",renderCell:e=>Bu(e.value)}]),[]),w=jt.useMemo((()=>{const e=[{field:"date",headerName:"Date",width:120},{field:"reference",headerName:"RÃ©fÃ©rence",width:140},{field:"type",headerName:"Type",width:180,renderCell:e=>{const r=e.value||"";return t.jsx(ue,{label:r,size:"small",sx:Wu(r)})}},{field:"description",headerName:"Description",flex:1,minWidth:200},{field:"debit",headerName:"DÃ©bit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?Bu(e.value):""},{field:"credit",headerName:"CrÃ©dit",width:130,align:"right",headerAlign:"right",renderCell:e=>e.value>0?Bu(e.value):""},{field:"balance",headerName:"Solde",width:140,align:"right",headerAlign:"right",renderCell:e=>e.value>0?Bu(e.value):""},{field:"actions",headerName:"Actions",width:100,sortable:!1,renderCell:e=>{const r=e.row.transaction_type;if(!r)return null;return"cash_receipt"===r||"supplier_cash_payment"===r||"client_deposit"===r?t.jsx(l,{title:"Imprimer le reÃ§u",children:t.jsx(f,{size:"small",color:"primary",onClick:t=>{t.stopPropagation();(e=>{const t=$l(e.amount),r=e.type||"cash_receipt",n=`\n    <div class="watermark">REÃ‡U</div>\n    \n    <div class="header">\n      <div class="brand">\n        <div class="logo">G</div>\n        <div class="company">\n          <div class="company-name">Gestion</div>\n          <div class="muted">123 Rue Exemple</div>\n          <div class="muted">+33 1 23 45 67 89</div>\n          <div class="muted">contact@gestion.com</div>\n        </div>\n      </div>\n      <div class="meta">\n        <h1>REÃ‡U</h1>\n        <div class="meta-item"><span class="meta-label">NÂ°:</span> <strong>${e.reference||e.id}</strong></div>\n        <div class="meta-item"><span class="meta-label">Date:</span> ${Yl(e.date)}</div>\n      </div>\n    </div>\n\n    ${e.client_name?`\n    <div class="client-info">\n      <h3>${r.includes("supplier")?"Fournisseur":"Client"}</h3>\n      <p><strong>${e.client_name}</strong></p>\n    </div>\n    `:""}\n\n    <div class="section">\n      <h3 class="section-title">DÃ©tails du paiement</h3>\n      <table>\n        <tr>\n          <th style="width: 40%;">Type de transaction</th>\n          <td>\n            <span class="status-badge status-paid">${{cash_receipt:"Paiement reÃ§u",client_deposit:"DÃ©pÃ´t client",supplier_payment:"Paiement fournisseur",payment:"Paiement"}[r]||"Paiement"}</span>\n          </td>\n        </tr>\n        <tr>\n          <th>Montant</th>\n          <td style="font-size: 20px; font-weight: 700; color: #059669;">\n            ${Zl(t)}\n          </td>\n        </tr>\n        <tr>\n          <th>MÃ©thode de paiement</th>\n          <td>${{cash:"EspÃ¨ces",card:"Carte bancaire",check:"ChÃ¨que",transfer:"Virement",mobile:"Paiement mobile"}[e.method]}</td>\n        </tr>\n        ${e.description?`\n        <tr>\n          <th>Description</th>\n          <td>${e.description}</td>\n        </tr>\n        `:""}\n      </table>\n    </div>\n\n    <div style="margin-top: 48px; padding: 24px; background: #f0fdf4; border: 2px dashed #22c55e; border-radius: 8px; text-align: center;">\n      <p style="margin: 0; font-size: 18px; font-weight: 700; color: #15803d;">\n        âœ“ Paiement confirmÃ©\n      </p>\n      <p style="margin: 8px 0 0 0; font-size: 14px; color: #166534;">\n        Montant reÃ§u : ${Zl(t)}\n      </p>\n    </div>\n\n    <div class="footer">\n      <p><strong>Merci pour votre paiement !</strong></p>\n      <p class="muted">ReÃ§u gÃ©nÃ©rÃ© automatiquement le ${(new Date).toLocaleString("fr-FR")}</p>\n      <p class="muted">Conservez ce reÃ§u pour vos archives</p>\n      <p class="muted" style="margin-top: 16px;">Contact : contact@gestion.com | +33 1 23 45 67 89</p>\n    </div>\n  `;Ql(n,`ReÃ§u de paiement ${e.reference||e.id}`)})({id:e.row.id,date:e.row.rawDate||e.row.date,amount:"cash_receipt"===r||"client_deposit"===r?e.row.credit:e.row.debit,method:"cash",description:e.row.description,reference:e.row.reference,type:r})},children:t.jsx(Gl,{fontSize:"small"})})}):null}}];return"account"===r&&i.length>0&&e.splice(1,0,{field:"account_name",headerName:"Compte",width:150}),e}),[r,i]),b=jt.useCallback((t=>{if(0===t&&n){return`Journal Caisse ${"client"===r?"Client":"supplier"===r?"Fournisseur":"Client"} (${e.length})`}return`Historique des transactions (${e.length})`}),[r,n,e.length]);return s?t.jsx(U,{sx:{mb:3,overflow:"hidden"},elevation:2,children:t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:t.jsx(m,{})})}):0===e.length?t.jsx(U,{sx:{mb:3,overflow:"hidden"},elevation:2,children:t.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:400,gap:2},children:[t.jsx(Yu,{sx:{fontSize:60,color:"text.secondary"}}),t.jsx(d,{variant:"h6",color:"text.secondary",children:"Aucune transaction trouvÃ©e"})]})}):t.jsxs(U,{sx:{mb:3,overflow:"hidden"},elevation:2,children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"primary.light"},children:t.jsxs(he,{value:a,onChange:(e,t)=>o(t),textColor:"inherit",indicatorColor:"secondary",children:[n&&t.jsx(pe,{label:b(0),sx:{color:"primary.contrastText"}}),t.jsx(pe,{label:b(n?1:0),sx:{color:"primary.contrastText"}})]})}),t.jsx(c,{sx:{height:Math.min(Math.max(350,55*e.length+180),400),width:"100%"},children:0===a&&n?t.jsx(de,{rows:g,columns:y,getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"date",sort:"desc"}]}},density:"compact",disableRowSelectionOnClick:!0,slots:{toolbar:me},slotProps:{toolbar:{showQuickFilter:!0,quickFilterProps:{debounceMs:300}}},sx:{border:"none","& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:0}},pageSizeOptions:[5,10,25,50]}):t.jsx(de,{rows:x,columns:w,getRowClassName:e=>e.indexRelativeToCurrentPage%2==0?"":"even-row",initialState:{pagination:{paginationModel:{pageSize:10,page:0}},sorting:{sortModel:[{field:"rawDate",sort:"desc"}]}},density:"compact",disableRowSelectionOnClick:!0,slots:{toolbar:me},slotProps:{toolbar:{showQuickFilter:!0,quickFilterProps:{debounceMs:300}}},sx:{border:"none","& .MuiDataGrid-cell:focus":{outline:"none"},"& .even-row":{bgcolor:"rgba(0, 0, 0, 0.02)"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"rgba(0, 0, 0, 0.03)",borderRadius:0}},pageSizeOptions:[5,10,25,50]})})]})};var eh={},th=ge;Object.defineProperty(eh,"__esModule",{value:!0});var rh=eh.default=void 0,nh=th(sl()),ih=t;rh=eh.default=(0,nh.default)((0,ih.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const sh=({clients:e,selectedClient:r,onClientChange:n,onPaymentClick:i,onDepositClick:s,clientBalance:a,outstandingSales:o,transactions:l,loading:d=!1,clientBalanceData:u,previousBalance:h=null,balanceChangeHighlight:p=!1})=>{const[m,f]=jt.useState(""),g=e.filter((e=>e.name.toLowerCase().includes(m.toLowerCase())));return t.jsxs(c,{sx:{p:3},children:[t.jsxs(oe,{container:!0,spacing:2,sx:{mb:3},children:[t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsx(V,{fullWidth:!0,label:"Rechercher un client",value:m,onChange:e=>f(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(rh,{})})}})}),t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Client"}),t.jsxs(K,{value:(null==r?void 0:r.id)||0,onChange:e=>{const t=e.target.value;n(0===t?null:Number(t))},label:"Client",children:[t.jsx(B,{value:0,children:"Tous les clients"}),g.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})})]}),r&&a&&u&&t.jsx(Hu,{client:r,balanceData:u,onDepositClick:()=>null==s?void 0:s(r),previousBalance:h,balanceChangeHighlight:p}),r&&t.jsx(qu,{sales:o,onPaymentClick:i,loading:d}),t.jsx(Ju,{statements:l,mode:"client",loading:d})]})},ah=({suppliers:e,selectedSupplier:r,onSupplierChange:n,onPaymentClick:i,supplierBalance:s,outstandingSupplies:a,transactions:o,loading:l=!1,supplierBalanceData:d,previousBalance:u,balanceChangeHighlight:h})=>{const[p,m]=jt.useState(""),f=e.filter((e=>e.name.toLowerCase().includes(p.toLowerCase())));return t.jsxs(c,{sx:{p:3},children:[t.jsxs(oe,{container:!0,spacing:2,sx:{mb:3},children:[t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsx(V,{fullWidth:!0,label:"Rechercher un fournisseur",value:p,onChange:e=>m(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(rh,{})})}})}),t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Fournisseur"}),t.jsxs(K,{value:(null==r?void 0:r.id)||0,onChange:e=>{const t=e.target.value;n(0===t?null:Number(t))},label:"Fournisseur",children:[t.jsx(B,{value:0,children:"Tous les fournisseurs"}),f.map((e=>t.jsx(B,{value:e.id,children:e.name},e.id)))]})]})})]}),r&&s&&d&&t.jsx(Gu,{supplier:r,balanceData:d,previousBalance:u,balanceChangeHighlight:h}),r&&t.jsx(Xu,{supplies:a,onPaymentClick:i,loading:l}),t.jsx(Ju,{statements:o,mode:"supplier",loading:l})]})},oh=({accounts:e,onAccountClick:r,onAddClick:n,loading:i=!1})=>{const[s,a]=jt.useState(1),o=e.reduce(((e,t)=>e+(parseFloat(String(t.current_balance))||0)),0),l=Math.ceil(e.length/6),u=6*(s-1),h=u+6,p=e.slice(u,h);return t.jsxs(c,{sx:{p:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsxs(c,{children:[t.jsx(d,{variant:"h5",sx:{fontWeight:600,mb:1},children:"Comptes bancaires"}),t.jsxs(d,{variant:"body2",color:"text.secondary",children:["Solde total : ",Bu(o)]})]}),n&&t.jsx(k,{variant:"contained",startIcon:t.jsx(Oe,{}),onClick:n,children:"Nouveau compte"})]}),i?t.jsx(c,{sx:{textAlign:"center",py:4},children:t.jsx(d,{color:"text.secondary",children:"Chargement..."})}):0===e.length?t.jsxs(c,{sx:{textAlign:"center",py:4},children:[t.jsx(E,{sx:{fontSize:64,color:"text.secondary",opacity:.5,mb:2}}),t.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aucun compte bancaire"}),t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Ajoutez votre premier compte pour commencer"}),n&&t.jsx(k,{variant:"outlined",startIcon:t.jsx(Oe,{}),onClick:n,children:"Ajouter un compte"})]}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{container:!0,spacing:3,children:p.map((e=>{const n=parseFloat(String(e.current_balance))||0,i=n>=0;return t.jsx(oe,{item:!0,xs:12,sm:6,md:4,children:t.jsx(ie,{elevation:2,sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6}},onClick:()=>r(e),children:t.jsxs(se,{children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(E,{color:"primary",sx:{mr:1}}),t.jsx(d,{variant:"h6",sx:{fontWeight:600},children:e.name})]}),e.account_number&&t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.account_number}),t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[t.jsx(d,{variant:"caption",color:"text.secondary",children:"Solde actuel"}),i?t.jsx(st,{color:"success",fontSize:"small"}):t.jsx(at,{color:"error",fontSize:"small"})]}),t.jsx(d,{variant:"h5",sx:{fontWeight:700,color:i?"success.main":"error.main"},children:Bu(n)}),e.account_type&&t.jsx(c,{sx:{mt:2},children:t.jsx(ue,{label:e.account_type,size:"small",variant:"outlined"})})]})})},e.id)}))}),l>1&&t.jsx(c,{sx:{display:"flex",justifyContent:"center",mt:4},children:t.jsx(pt,{count:l,page:s,onChange:(e,t)=>{a(t)},color:"primary",size:"large",showFirstButton:!0,showLastButton:!0})})]})]})},lh=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),ch=e=>{if(""===e||null==e)return"";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"":t.toString()},dh=({data:e,onClose:r,onChange:n,onSubmit:i,loading:s=!1})=>{var a,o,l,u;const[h,p]=jt.useState([]),[f,g]=jt.useState(!1),[y,w]=jt.useState(0),b=e.account;jt.useEffect((()=>{if(e.open){(async()=>{try{g(!0);const t=(await Po.getAll()).filter((e=>"client"!==e.account_type&&"supplier"!==e.account_type));p(t),t.length>0&&!e.account&&n({account:t[0]})}catch(t){console.error("Error loading company accounts:",t)}finally{g(!1)}})();const t="string"==typeof e.amount?parseFloat(e.amount):e.amount||0;w(t)}}),[e.open,e.amount,e.account,n]);const v=e=>{const t=((e,t)=>{if(""===e||null===e)return 0;const r=e.replace(/[^\d.]/g,""),n=r.split(".");if(n.length>2)return t;if(n[1]&&n[1].length>2)return t;const i=parseFloat(r);return isNaN(i)?0:i})(e,y);w(t),n({amount:t.toString()})},C=(null==(a=e.sale)?void 0:a.remaining_amount)||0,_=e.sale_total||(null==(o=e.sale)?void 0:o.total_amount)||0,S="paid"===(null==(l=e.sale)?void 0:l.status)||0===C,E=y>0&&y<C,A=y>0&&y>C;return console.log("ðŸ’° Payment Dialog Data:",{sale:e.sale,sale_balance:null==(u=e.sale)?void 0:u.remaining_amount,sale_total:e.sale_total,saleBalance:C,saleTotal:_,amount:y,isPaid:S,isPartialPayment:E,isOverpayment:A}),t.jsx(xe,{open:e.open,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),console.log("ðŸ”´ PaymentDialog handleSubmit called"),console.log("ðŸ”´ Calling onSubmit prop..."),i()},children:[t.jsxs(ye,{sx:{borderBottom:1,borderColor:"divider",pb:2,display:"flex",alignItems:"center"},children:[t.jsx(ht,{sx:{mr:1,color:"primary.main"}}),t.jsx(d,{variant:"h6",component:"div",children:"Paiement de vente"})]}),t.jsx(we,{children:t.jsxs(c,{sx:{py:2},children:[S&&t.jsxs(W,{severity:"info",sx:{mb:3},children:[t.jsx(mt,{children:"Vente dÃ©jÃ  payÃ©e"}),"Cette vente a dÃ©jÃ  Ã©tÃ© entiÃ¨rement payÃ©e."]}),e.sale&&t.jsxs(U,{variant:"outlined",sx:{p:2,mb:3,borderRadius:1,borderColor:"divider",backgroundColor:"background.paper"},children:[t.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,sx:{mb:2,fontWeight:"medium",borderBottom:1,pb:1,borderColor:"divider"},children:"Informations de la vente"}),t.jsxs(oe,{container:!0,spacing:2,children:[t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"RÃ©fÃ©rence"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:e.sale_reference})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(x,{sx:{my:1}})}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:lh(_)})]}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"DÃ©jÃ  payÃ©"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:"success.main",children:lh(_-C)})]}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant restant"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:C>0?"error.main":"success.main",children:lh(C)})]})]})]}),t.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,sx:{mt:3,mb:2,fontWeight:"medium"},children:"DÃ©tails du paiement"}),t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,children:f?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:2},children:t.jsx(m,{size:24})}):t.jsx(Ue,{options:h,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:b,onChange:(e,t)=>{n({account:t})},renderInput:e=>t.jsx(V,{...e,label:"Compte de l'entreprise Ã  crÃ©diter",variant:"outlined",fullWidth:!0,required:!0})})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(V,{label:"Montant du paiement",type:"text",fullWidth:!0,required:!0,value:ch(y),onChange:e=>v(e.target.value),error:y<=0||A,helperText:y<=0?"Le montant doit Ãªtre supÃ©rieur Ã  0":A?"Le montant dÃ©passe le solde restant":"",InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(ft,{color:y>0?"primary":"action"})})}}),y>0&&!A&&t.jsx(c,{sx:{mt:2},children:t.jsx(U,{variant:"outlined",sx:{p:2,borderRadius:1,borderColor:E?"info.main":"success.main",borderWidth:2,backgroundColor:E?"rgba(3, 169, 244, 0.08)":"rgba(46, 125, 50, 0.08)",boxShadow:1},children:t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(c,{sx:{mr:2,mt:.5},children:t.jsx(ht,{fontSize:"large",color:E?"info":"success"})}),t.jsxs(c,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:E?"Paiement partiel":"Paiement total"}),t.jsx(d,{variant:"body2",children:E?t.jsxs(t.Fragment,{children:["Vous effectuez un paiement partiel de ",lh(y),". Un montant de ",lh(C-y),' restera Ã  payer. Le statut de la vente sera mis Ã  jour en "Partiellement payÃ©".']}):t.jsxs(t.Fragment,{children:["Vous effectuez le paiement total de cette vente d'un montant de ",lh(y),'. Le statut de la vente sera mis Ã  jour en "PayÃ©".']})})]})]})})})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:2,value:e.description,onChange:e=>n({description:e.target.value}),placeholder:"Description du paiement",InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(ct,{color:"action"})})},helperText:"Ajoutez une description facultative pour ce paiement"})})]})]})}),t.jsx(x,{}),t.jsxs(be,{sx:{px:3,py:2,justifyContent:"space-between"},children:[t.jsx(k,{onClick:r,variant:"outlined",startIcon:t.jsx(gt,{}),disabled:s,children:"Annuler"}),t.jsx(k,{type:"submit",variant:"contained",color:E?"info":"primary",disabled:s||!b||y<=0||A||S,startIcon:s?t.jsx(m,{size:20}):t.jsx(ht,{}),sx:{fontWeight:"medium",minWidth:"200px",px:3},children:s?"Traitement...":S?"Vente dÃ©jÃ  payÃ©e":E?"Effectuer un paiement partiel":"Effectuer le paiement total"})]})]})})},uh=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(e),hh=e=>{if(""===e||null==e)return"";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"":t.toString()},ph=e=>"number"==typeof e?e:parseFloat(e)||0,mh=({data:e,onClose:r,onChange:n,onSubmit:i,loading:s=!1})=>{var a,o;const[l,u]=jt.useState([]),h=e.account,[p,f]=jt.useState(!1),[g,y]=jt.useState(0),w=jt.useCallback((async()=>{try{f(!0);const t=(await Po.getAll()).filter((e=>"client"!==e.account_type&&"supplier"!==e.account_type));u(t),t.length>0&&!e.account&&n({account:t[0]})}catch(t){console.error("Error loading company accounts:",t)}finally{f(!1)}}),[e.account,n]);jt.useEffect((()=>{if(e.open){w();const t="string"==typeof e.amount?parseFloat(e.amount):e.amount||0;y(t)}}),[e.open,e.amount,w]);const b=e=>{const t=((e,t)=>{if(""===e||null===e)return 0;const r=e.replace(/[^\d.]/g,""),n=r.split(".");if(n.length>2)return t;if(n[1]&&n[1].length>2)return t;const i=parseFloat(r);return isNaN(i)?0:i})(e,g);y(t),n({amount:t.toString()})};console.log("ðŸ’° Supplier Payment Dialog Render:",{data:e,amount:g});const v=e.supply_balance||(null==(a=e.supply)?void 0:a.remaining_amount)||0,C=e.supply_total||(null==(o=e.supply)?void 0:o.total_amount)||0,_=e.supply&&0===v,S=g>0&&g<v,E=g>0&&g>v,A=h?ph(h.current_balance):0,I=h&&A<g;return console.log("ðŸ’° Supplier Payment Dialog Data:",{supply:e.supply,supply_balance:e.supply_balance,supply_total:e.supply_total,supplyBalance:v,supplyTotal:C,amount:g,isPaid:_,isOverpayment:E}),t.jsx(xe,{open:e.open,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),console.log("ðŸŸ  SupplierPaymentDialog handleSubmit called"),console.log("ðŸŸ  Calling onSubmit prop..."),i()},children:[t.jsxs(ye,{sx:{borderBottom:1,borderColor:"divider",pb:2,display:"flex",alignItems:"center"},children:[t.jsx(ht,{sx:{mr:1,color:"warning.main"}}),t.jsx(d,{variant:"h6",component:"div",children:"Paiement fournisseur"})]}),t.jsx(we,{children:t.jsxs(c,{sx:{py:2},children:[_&&t.jsxs(W,{severity:"info",sx:{mb:3},children:[t.jsx(mt,{children:"Approvisionnement dÃ©jÃ  payÃ©"}),"Cet approvisionnement a dÃ©jÃ  Ã©tÃ© entiÃ¨rement payÃ©."]}),e.supply&&t.jsxs(U,{variant:"outlined",sx:{p:2,mb:3,borderRadius:1,borderColor:"divider",backgroundColor:"background.paper"},children:[t.jsx(d,{variant:"h6",color:"warning.main",gutterBottom:!0,sx:{mb:2,fontWeight:"medium",borderBottom:1,pb:1,borderColor:"divider"},children:"Informations de l'approvisionnement"}),t.jsxs(oe,{container:!0,spacing:2,children:[t.jsxs(oe,{item:!0,xs:6,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"RÃ©fÃ©rence"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:e.supply_reference})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(x,{sx:{my:1}})}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant total"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",children:uh(C)})]}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Montant payÃ©"}),t.jsx(d,{variant:"subtitle1",fontWeight:"medium",color:"success.main",children:uh(C-v)})]}),t.jsxs(oe,{item:!0,xs:4,children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"Restant Ã  payer"}),t.jsx(d,{variant:"subtitle1",fontWeight:"bold",color:"error.main",children:uh(v)})]})]})]}),t.jsxs(oe,{container:!0,spacing:2,children:[t.jsx(oe,{item:!0,xs:12,children:p?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:2},children:t.jsx(m,{size:24})}):t.jsx(Ue,{options:l,getOptionLabel:e=>`${e.name} - Solde: ${uh(ph(e.current_balance))}`,value:h,onChange:(e,t)=>{n({account:t})},renderInput:e=>t.jsx(V,{...e,label:"Compte de l'entreprise",variant:"outlined",fullWidth:!0,required:!0,helperText:I?`âš ï¸ Attention: Ce paiement crÃ©era un solde nÃ©gatif (${uh(A-g)})`:"SÃ©lectionnez le compte de l'entreprise pour effectuer le paiement",InputLabelProps:{sx:I?{color:"warning.main"}:void 0}}),renderOption:(e,r)=>t.jsx("li",{...e,children:t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[t.jsx(d,{children:r.name}),t.jsx(ue,{label:uh(ph(r.current_balance)),size:"small",color:ph(r.current_balance)>=g?"success":"warning",icon:ph(r.current_balance)<g?t.jsx(dt,{fontSize:"small"}):void 0,sx:{fontWeight:"bold"}})]})})})}),t.jsxs(oe,{item:!0,xs:12,children:[t.jsx(V,{label:"Montant du paiement",type:"text",fullWidth:!0,required:!0,value:hh(g),onChange:e=>b(e.target.value),error:g<=0||E,helperText:g<=0?"Le montant doit Ãªtre supÃ©rieur Ã  zÃ©ro":E?"Le montant ne peut pas dÃ©passer le solde restant":I?`âš ï¸ Attention: Solde insuffisant (${uh(A)} disponible) - Le compte sera nÃ©gatif`:`Solde restant: ${uh(v)}`,InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(ot,{fontSize:"small"})})}}),g>0&&!E&&t.jsx(c,{sx:{mt:2},children:t.jsx(U,{variant:"outlined",sx:{p:2,borderRadius:1,borderColor:S?"info.main":"success.main",borderWidth:2,backgroundColor:S?"rgba(3, 169, 244, 0.08)":"rgba(46, 125, 50, 0.08)",boxShadow:1},children:t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(c,{sx:{mr:2,mt:.5},children:t.jsx(ht,{fontSize:"large",color:S?"info":"success"})}),t.jsxs(c,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:S?"Paiement partiel":"Paiement total"}),t.jsx(d,{variant:"body2",children:S?t.jsxs(t.Fragment,{children:["Vous effectuez un paiement partiel de ",uh(g),". Un montant de ",uh(v-g),' restera Ã  payer. Le statut de l\'approvisionnement sera mis Ã  jour en "Partiellement payÃ©".']}):t.jsxs(t.Fragment,{children:["Vous effectuez le paiement total de cet approvisionnement d'un montant de ",uh(g),'. Le statut de l\'approvisionnement sera mis Ã  jour en "PayÃ©".']})})]})]})})})]}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Description",fullWidth:!0,multiline:!0,rows:2,value:e.description,onChange:e=>n({description:e.target.value}),placeholder:"Description du paiement"})})]})]})}),t.jsxs(be,{sx:{px:3,py:2},children:[t.jsx(k,{onClick:r,variant:"outlined",startIcon:t.jsx(gt,{}),disabled:s,children:"Annuler"}),t.jsx(k,{type:"submit",variant:"contained",color:"warning",disabled:s||!h||g<=0||E||_,startIcon:s?t.jsx(m,{size:20}):t.jsx(ht,{}),sx:{fontWeight:"medium",minWidth:"200px",px:3},children:s?"Traitement...":_?"Approvisionnement dÃ©jÃ  payÃ©":S?"Effectuer un paiement partiel":"Effectuer le paiement total"})]})]})})};var fh={},gh=ge;Object.defineProperty(fh,"__esModule",{value:!0});var xh=fh.default=void 0,yh=gh(sl()),wh=t;xh=fh.default=(0,yh.default)((0,wh.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoney");const bh=({data:e,clients:r,accounts:n,paymentMethods:i,onClose:s,onChange:a,onSubmit:o,loading:l=!1,error:d=null,selectedClient:u=null})=>{jt.useEffect((()=>{if(e.open&&e.client&&!e.account&&n.length>0)if(console.log("Auto-selecting account for client:",{clientId:e.client.id,clientName:e.client.name,clientAccountId:e.client.account,availableAccounts:n.length}),e.client.account){const t=n.find((t=>t.id===e.client.account));t?(console.log("Found and selecting client account:",t),a("account",t)):console.log("Client account ID not found in accounts list")}else console.log("Client has no account field")}),[e.open,e.client,e.account,n,a]);const h=null!==e.client&&null!==e.account&&null!==e.payment_method&&""!==e.amount&&parseFloat(e.amount)>0&&""!==e.date;return console.log("Deposit Form Validation:",{client:null!==e.client,account:null!==e.account,payment_method:null!==e.payment_method,amount_not_empty:""!==e.amount,amount_valid:parseFloat(e.amount)>0,date:""!==e.date,isFormValid:h}),t.jsxs(xe,{open:e.open,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[t.jsxs(ye,{sx:{borderBottom:1,borderColor:"divider",pb:2,display:"flex",alignItems:"center"},children:[t.jsx(xh,{sx:{mr:1,color:"primary.main"}}),t.jsx(c,{component:"span",children:"Nouveau dÃ©pÃ´t client"})]}),t.jsx(x,{}),t.jsx(we,{children:l?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsxs(oe,{container:!0,spacing:2,sx:{mt:.5},children:[d&&t.jsx(oe,{item:!0,xs:12,children:t.jsx(W,{severity:"error",children:d})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:r,getOptionLabel:e=>e.name,value:e.client,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{if(a("client",t),t){const e=n.find((e=>e.id===t.account));a("account",e||null)}else a("account",null)},renderInput:e=>t.jsx(V,{...e,label:"Client",variant:"outlined",fullWidth:!0,required:!0}),disabled:!!u})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:n,getOptionLabel:e=>`${e.name} (${e.account_type})`,value:e.account,isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{a("account",t)},renderInput:e=>t.jsx(V,{...e,label:"Compte du client",variant:"outlined",fullWidth:!0,required:!0}),disabled:!!u})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(Ue,{options:i,getOptionLabel:e=>e.name,value:e.payment_method,onChange:(e,t)=>{a("payment_method",t)},renderInput:e=>t.jsx(V,{...e,label:"MÃ©thode de paiement",variant:"outlined",fullWidth:!0,required:!0})})}),t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Montant",type:"number",value:e.amount,onChange:e=>a("amount",e.target.value),fullWidth:!0,required:!0,error:parseFloat(e.amount)<=0&&""!==e.amount,helperText:parseFloat(e.amount)<=0&&""!==e.amount?"Le montant doit Ãªtre supÃ©rieur Ã  0":"",inputProps:{min:0,step:.01}})}),t.jsx(oe,{item:!0,xs:12,md:6,children:t.jsx(V,{label:"Date",type:"date",value:e.date,onChange:e=>a("date",e.target.value),fullWidth:!0,required:!0,InputLabelProps:{shrink:!0}})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Description",value:e.description,onChange:e=>a("description",e.target.value),fullWidth:!0,multiline:!0,rows:2})})]})}),t.jsx(x,{}),t.jsxs(be,{sx:{px:3,py:2},children:[t.jsx(k,{onClick:s,variant:"outlined",children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:e=>{e.preventDefault(),o()},disabled:l||!h,startIcon:t.jsx(xh,{}),children:"CrÃ©er le dÃ©pÃ´t"})]})]})},vh=({paymentDialog:e,onPaymentDialogClose:r,onPaymentDialogChange:n,onPaymentSubmit:i,supplierPaymentDialog:s,onSupplierPaymentDialogClose:a,onSupplierPaymentDialogChange:o,onSupplierPaymentSubmit:l,depositDialog:c,onDepositDialogClose:d,onDepositDialogChange:u,onDepositSubmit:h,clients:p=[],accounts:m=[],paymentMethods:f=[],error:g=null,loading:x=!1})=>{const y={open:c.open,client:c.client,account:c.account,amount:c.amount,date:c.date,payment_method:c.payment_method,description:c.description};return t.jsxs(t.Fragment,{children:[t.jsx(dh,{data:e,onClose:r,onChange:n,onSubmit:i,loading:x}),t.jsx(mh,{data:s,onClose:a,onChange:o,onSubmit:l,loading:x}),t.jsx(bh,{data:y,clients:p,accounts:m,paymentMethods:f,onClose:d,onChange:(e,t)=>{u({[e]:t})},onSubmit:h,loading:x,error:g,selectedClient:c.client})]})};function Ch(e){const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`treasury-tabpanel-${i}`,"aria-labelledby":`treasury-tab-${i}`,...s,children:n===i&&t.jsx(c,{children:r})})}const _h=()=>{const{enqueueSnackbar:e}=jt.useContext(Zd),r=h(),[n,i]=jt.useState(0),[s,a]=jt.useState(null),[o,l]=jt.useState(!1),{clients:u,suppliers:p,accounts:m,paymentMethods:f,clientBalanceData:g,supplierBalanceData:x,allClientTransactions:y,allSupplierTransactions:w,loading:b,selectedClient:v,setSelectedClient:C,selectedSupplier:_,setSelectedSupplier:S,getClientBalance:A,getAllClientTransactions:I,getSupplierBalance:j,getAllSupplierTransactions:T,createClientDeposit:D,createClientPayment:R,createSupplierPayment:N,refreshAllData:P}=Fu(),{paymentDialog:O,openPaymentDialog:k,closePaymentDialog:M,updatePaymentDialog:F,supplierPaymentDialog:B,openSupplierPaymentDialog:L,closeSupplierPaymentDialog:z,updateSupplierPaymentDialog:W,depositDialog:V,openDepositDialog:H,closeDepositDialog:G,updateDepositDialog:q,validatePayment:X,validateSupplierPayment:$,validateDeposit:Z}=Vu(),Y=g?{total_sales:g.total_sales,total_account_credits:g.total_account_credits,balance:g.balance}:null,Q=(null==g?void 0:g.outstanding_sales)||[],K=v?(null==g?void 0:g.statements)||[]:y,J=x?{total_purchases:x.total_purchases,total_account_credits:x.total_account_credits,balance:x.balance}:null,ee=(null==x?void 0:x.outstanding_supplies)||[],te=_?(null==x?void 0:x.statements)||[]:w;jt.useEffect((()=>{P()}),[]),jt.useEffect((()=>{console.log("Treasury Data Loaded:",{clientsCount:u.length,suppliersCount:p.length,accountsCount:m.length,loading:b})}),[u,p,m,b]),jt.useEffect((()=>{(null==v?void 0:v.id)?A(v.id):I()}),[null==v?void 0:v.id]),jt.useEffect((()=>{(null==_?void 0:_.id)?j(_.id):T()}),[null==_?void 0:_.id]);return t.jsx(Ad,{requiredPermission:"view_cashreceipt",fallbackPath:"/dashboard",children:t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(c,{sx:{mb:4},children:[t.jsxs(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:r.palette.primary.main,borderBottom:`2px solid ${r.palette.primary.light}`,pb:1,width:"fit-content",display:"flex",alignItems:"center",gap:1},children:[t.jsx(E,{}),"TrÃ©sorerie"]}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez les paiements clients, fournisseurs et comptes bancaires"})]}),t.jsxs(U,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(he,{value:n,onChange:(e,t)=>{i(t)},"aria-label":"treasury tabs",indicatorColor:"primary",variant:"fullWidth",sx:{px:3,pt:2,"& .MuiTab-root":{fontWeight:"medium",py:2}},children:[t.jsx(pe,{label:"Clients"}),t.jsx(pe,{label:"Fournisseurs"}),t.jsx(pe,{label:"Comptes bancaires"})]})}),t.jsxs(c,{sx:{p:3},children:[t.jsx(Ch,{value:n,index:0,children:t.jsx(sh,{clients:u,selectedClient:v,onClientChange:e=>{if(!e)return void C(null);const t=u.find((t=>t.id===e));C(t||null)},onPaymentClick:e=>{k(e)},onDepositClick:H,clientBalance:Y,outstandingSales:Q,transactions:K,loading:b,clientBalanceData:g||void 0,previousBalance:s,balanceChangeHighlight:o})}),t.jsx(Ch,{value:n,index:1,children:t.jsx(ah,{suppliers:p,selectedSupplier:_,onSupplierChange:e=>{if(!e)return void S(null);const t=p.find((t=>t.id===e));S(t||null)},onPaymentClick:e=>{L(e)},supplierBalance:J,outstandingSupplies:ee,transactions:te,loading:b,supplierBalanceData:x||void 0,previousBalance:s,balanceChangeHighlight:o})}),t.jsx(Ch,{value:n,index:2,children:t.jsx(oh,{accounts:m,onAccountClick:t=>{e(`Compte sÃ©lectionnÃ©: ${t.name}`,{variant:"info"})},loading:b})})]})]}),t.jsx(vh,{paymentDialog:O,onPaymentDialogClose:M,onPaymentDialogChange:F,onPaymentSubmit:async()=>{if(console.log("ðŸ”µ Payment Submit Called"),console.log("ðŸ”µ Payment Dialog:",O),console.log("ðŸ”µ Validate Payment:",X()),!X())return e("Veuillez remplir tous les champs requis",{variant:"error"}),void console.error("âŒ Validation failed");try{if(console.log("âœ… Validation passed, processing payment..."),!O.sale)return void e("Vente non sÃ©lectionnÃ©e",{variant:"error"});const t=O.account||m[0];if(!t||!t.id)return void e("Aucun compte disponible",{variant:"error"});console.log("ðŸ“¤ Sending payment:",{saleId:O.sale.id,amount:parseFloat(O.amount),accountId:t.id,description:O.description});const r=(null==g?void 0:g.balance)||0;a(r),await R(O.sale.id,parseFloat(O.amount),t.id,O.description),e("Paiement enregistrÃ© avec succÃ¨s",{variant:"success"}),M(),l(!0),setTimeout((()=>l(!1)),3e3),(null==v?void 0:v.id)&&await A(v.id)}catch(t){console.error("Error processing payment:",t),e("Erreur lors du traitement du paiement",{variant:"error"})}},supplierPaymentDialog:B,onSupplierPaymentDialogClose:z,onSupplierPaymentDialogChange:W,onSupplierPaymentSubmit:async()=>{if(console.log("ðŸŸ¡ Supplier Payment Submit Called"),console.log("ðŸŸ¡ Supplier Payment Dialog:",B),console.log("ðŸŸ¡ Validate Supplier Payment:",$()),!$())return e("Veuillez remplir tous les champs requis",{variant:"error"}),void console.error("âŒ Supplier validation failed");try{if(console.log("âœ… Supplier validation passed, processing payment..."),!B.supply)return void e("Approvisionnement non sÃ©lectionnÃ©",{variant:"error"});const t=B.account||m[0];if(!t||!t.id)return void e("Aucun compte disponible",{variant:"error"});console.log("ðŸ“¤ Sending supplier payment:",{supplyId:B.supply.id,amount:parseFloat(B.amount),accountId:t.id,description:B.description});const r=(null==x?void 0:x.balance)||0;a(r),await N(B.supply.id,parseFloat(B.amount),t.id,B.description),e("Paiement fournisseur enregistrÃ© avec succÃ¨s",{variant:"success"}),z(),l(!0),setTimeout((()=>l(!1)),3e3),(null==_?void 0:_.id)&&await j(_.id)}catch(t){console.error("Error processing supplier payment:",t),e("Erreur lors du traitement du paiement",{variant:"error"})}},depositDialog:V,onDepositDialogClose:G,onDepositDialogChange:q,onDepositSubmit:async()=>{if(Z())try{if(!V.client||!V.account||!V.payment_method)return;const t=(null==g?void 0:g.balance)||0;a(t),await D({client:V.client.id,account:V.account.id,amount:parseFloat(V.amount),payment_method:V.payment_method,date:V.date,description:V.description}),e("DÃ©pÃ´t enregistrÃ© avec succÃ¨s",{variant:"success"}),G(),l(!0),setTimeout((()=>l(!1)),3e3),(null==v?void 0:v.id)&&await A(v.id)}catch(t){console.error("Error processing deposit:",t),e("Erreur lors du traitement du dÃ©pÃ´t",{variant:"error"})}else e("Veuillez remplir tous les champs requis",{variant:"error"})},clients:u,accounts:m,paymentMethods:f,loading:b})]})})},Sh=()=>{const[e,t]=jt.useState([]),[r,n]=jt.useState([]),[i,s]=jt.useState([]),[a,o]=jt.useState([]),[l,c]=jt.useState({}),[d,u]=jt.useState({}),[h,p]=jt.useState(!0),[m,f]=jt.useState(null),g=jt.useCallback((e=>{const t=r.find((t=>t.id===e));return t?t.name:"Groupe inconnu"}),[r]),x=jt.useCallback((async()=>{try{p(!0);const e=await(async()=>{const e=await rs.get("/core/users/");return e.data.results||e.data})(),r=(Array.isArray(e)?e:e.results||e).map((e=>{var t;const r=(null==(t=e.profile_data)?void 0:t.role)||"";let n=[];Array.isArray(e.groups)&&(n=e.groups.map((e=>"number"==typeof e?e:e.id||0)));return{id:e.id,username:e.username,email:e.email,first_name:e.first_name||"",last_name:e.last_name||"",is_active:e.is_active,is_staff:e.is_staff,date_joined:e.date_joined,profile_data:e.profile_data?{role:e.profile_data.role,is_active:e.is_active,zone:null}:void 0,groups:n,role:r,zone:null,permissions:e.permissions||[]}}));t(r),f(null)}catch(e){throw console.error("Error loading users:",e),f("Une erreur est survenue lors du chargement des utilisateurs"),e}finally{p(!1)}}),[]),y=jt.useCallback((async e=>{var t;try{const r=await(async e=>(await rs.get(`/core/users/${e}/`)).data)(e),n=(null==(t=r.profile_data)?void 0:t.role)||"";let i=[];Array.isArray(r.groups)&&(i=r.groups.map((e=>"number"==typeof e?e:e.id||0)));return{id:r.id,username:r.username,email:r.email,first_name:r.first_name||"",last_name:r.last_name||"",is_active:r.is_active,is_staff:r.is_staff,date_joined:r.date_joined,profile_data:r.profile_data?{role:r.profile_data.role,is_active:r.is_active,zone:null}:void 0,groups:i,role:n,zone:null,permissions:r.permissions||[]}}catch(r){return console.error(`Error fetching user ${e}:`,r),null}}),[]),w=jt.useCallback((async()=>{try{p(!0);const e=(await(async()=>{const e=await rs.get("/core/groups/");return e.data.results||e.data})()).map((e=>({id:e.id,name:e.name,permissions:e.permissions.map((e=>e.id)),description:void 0,is_active:!0})));n(e),f(null)}catch(e){throw console.error("Error loading groups:",e),f("Une erreur est survenue lors du chargement des groupes"),e}finally{p(!1)}}),[]),b=jt.useCallback((async()=>{try{const e=(await ka()).map((e=>({...e,id:e.id||0,name:e.name||"Zone sans nom"})));s(e)}catch(e){console.error("Error loading zones:",e),f("Une erreur est survenue lors du chargement des zones")}}),[]),v=jt.useCallback((async()=>{try{o([]);const e=await(async()=>(await rs.get("/core/permissions/categorized/")).data)();console.log("Raw permissions response from API:",e);let t=[];if(e&&"object"==typeof e&&!Array.isArray(e)){const r=[];Object.entries(e).forEach((([e,t])=>{t&&"object"==typeof t&&Object.entries(t).forEach((([t,n])=>{Array.isArray(n)&&n.length>0&&r.push({name:`${e} - ${t}`,app:e,model:t,permissions:n.map((t=>{const r=t;return{id:r.id,name:r.name,codename:r.codename,content_type:{app_label:e},full_codename:`${e}.${r.codename}`}}))})}))})),t=r}else Array.isArray(e)?t=e:e&&"results"in e?t=e.results:e&&"data"in e&&(t=e.data);if(console.log("Transformed permissions array:",t),!t||0===t.length)return void f("Aucune permission n'est disponible. Veuillez contacter l'administrateur.");const r={},n={},i=t.map((e=>(e.permissions.forEach((e=>{const t="object"==typeof e.content_type?e.content_type:null,i=e.full_codename||((null==t?void 0:t.app_label)&&e.codename?`${t.app_label}.${e.codename}`:e.codename);e.id&&(r[e.id]=i,n[i]=e.id)})),{...e,permissions:e.permissions.map((e=>{const t="object"==typeof e.content_type?e.content_type:null;return{...e,full_codename:e.full_codename||((null==t?void 0:t.app_label)&&e.codename?`${t.app_label}.${e.codename}`:e.codename)}}))})));console.log("Final processed permissions:",i),console.log("Permission mappings - idToCode:",r),console.log("Permission mappings - codeToId:",n),c(n),u(r),o(i),f(null)}catch(e){console.error("Error loading permissions:",e),f("Une erreur est survenue lors du chargement des permissions"),o([])}}),[]),C=jt.useCallback((async()=>{p(!0);try{await Promise.all([x(),w(),b(),v()])}catch(e){console.error("Error refreshing data:",e)}finally{p(!1)}}),[x,w,b,v]),_=jt.useCallback((async e=>{var r;try{const n=await(async e=>(await rs.post("/core/users/",e)).data)(e),i=(null==(r=n.profile_data)?void 0:r.role)||"";let s=[];Array.isArray(n.groups)&&(s=n.groups.map((e=>"number"==typeof e?e:e.id||0)));const a={id:n.id,username:n.username,email:n.email,first_name:n.first_name||"",last_name:n.last_name||"",is_active:n.is_active,is_staff:n.is_staff,date_joined:n.date_joined,profile_data:n.profile_data?{role:n.profile_data.role,is_active:n.is_active,zone:null}:void 0,groups:s,role:i,zone:null,permissions:n.permissions||[]};return t((e=>[...e,a])),f(null),a}catch(n){throw console.error("Error creating user:",n),n}}),[]),S=jt.useCallback((async(e,r)=>{var n;try{const i=await(async(e,t)=>(await rs.patch(`/core/users/${e}/`,t)).data)(e,r);await x();const s=(null==(n=i.profile_data)?void 0:n.role)||"";let a=[];Array.isArray(i.groups)&&(a=i.groups.map((e=>"number"==typeof e?e:e.id||0)));const o={id:i.id,username:i.username,email:i.email,first_name:i.first_name||"",last_name:i.last_name||"",is_active:i.is_active,is_staff:i.is_staff,date_joined:i.date_joined,profile_data:i.profile_data?{role:i.profile_data.role,is_active:i.is_active,zone:null}:void 0,groups:a,role:s,zone:null,permissions:i.permissions||[]};return t((t=>t.map((t=>t.id===e?o:t)))),f(null),o}catch(i){throw console.error("Error updating user:",i),i}}),[x]),E=jt.useCallback((async e=>{try{await(async e=>{await rs.delete(`/core/users/${e}/`)})(e),t((t=>t.filter((t=>t.id!==e)))),f(null)}catch(r){throw console.error("Error deleting user:",r),f("Une erreur est survenue lors de la suppression de l'utilisateur"),r}}),[]),A=jt.useCallback((async e=>{try{const t=await(async e=>(await rs.post("/core/groups/",e)).data)(e),r={id:t.id,name:t.name,permissions:t.permissions.map((e=>e.id)),description:void 0,is_active:!0};return n((e=>[...e,r])),f(null),r}catch(t){throw console.error("Error creating group:",t),t}}),[]),I=jt.useCallback((async(e,t)=>{try{const r=await(async(e,t)=>(await rs.patch(`/core/groups/${e}/`,t)).data)(e,t),i={id:r.id,name:r.name,permissions:r.permissions.map((e=>e.id)),description:void 0,is_active:!0};return n((t=>t.map((t=>t.id===e?i:t)))),f(null),i}catch(r){throw console.error("Error updating group:",r),r}}),[]),j=jt.useCallback((async e=>{try{await(async e=>{await rs.delete(`/core/groups/${e}/`)})(e),n((t=>t.filter((t=>t.id!==e)))),f(null)}catch(t){throw console.error("Error deleting group:",t),t}}),[]);return{users:e,groups:r,zones:i,availablePermissions:a,permissionIdMapping:l,permissionCodeMapping:d,loading:h,error:m,fetchUsers:x,fetchGroups:w,fetchZones:b,fetchAvailablePermissions:v,refreshAllData:C,createUser:_,updateUser:S,deleteUser:E,fetchUserById:y,createGroup:A,updateGroup:I,deleteGroup:j,setError:f,getGroupName:g}},Eh=e=>{switch(e){case"admin":return"error";case"consultant":return"info";case"supervisor":return"warning";case"commercial":return"success";case"cashier":return"secondary";default:return"default"}},Ah=e=>{switch(e){case"admin":return"Administrateur";case"consultant":return"Consultant";case"supervisor":return"Superviseur";case"commercial":return"Commercial";case"cashier":return"Chef de Caisse";default:return e}},Ih=e=>{var t,r,n;if(console.error("Error saving group:",e),e&&"object"==typeof e&&"response"in e){const i=e,s=null==(t=i.response)?void 0:t.data;if(console.error("Backend response:",s),s&&"object"==typeof s){const e=s;if("string"==typeof e)return String(e);if(e.detail)return String(e.detail);if(e.name&&Array.isArray(e.name))return`Erreur: ${e.name[0]}`;if(e.permissions){if(Array.isArray(e.permissions)){return e.permissions.filter((e=>{if(e&&"object"==typeof e){const t=e;return t.non_field_errors&&Array.isArray(t.non_field_errors)&&t.non_field_errors[0]&&String(t.non_field_errors[0]).includes("ensemble unique")}return!1})).length>0?"Erreur: Des permissions en double ont Ã©tÃ© dÃ©tectÃ©es. Veuillez rÃ©essayer.":`Erreur de permissions: ${JSON.stringify(e.permissions)}`}return`Erreur de permissions: ${String(e.permissions)}`}return`Erreur ${null==(r=i.response)?void 0:r.status}: ${null==(n=i.response)?void 0:n.statusText}`}if("string"==typeof s)return s}else if(e&&"object"==typeof e&&"message"in e)return`Erreur: ${String(e.message)}`;return"Une erreur inattendue est survenue lors de la sauvegarde du groupe"};function jh(e){const{children:r,value:n,index:i,...s}=e;return t.jsx("div",{role:"tabpanel",hidden:n!==i,id:`access-tabpanel-${i}`,"aria-labelledby":`access-tab-${i}`,...s,children:n===i&&t.jsx(c,{sx:{py:3},children:r})})}const Th=()=>{var e,r,n,i,s,o,l,u,p,g,x,y,w,b,v,C,_,S,E,I,j,T,D,R,N,P,O,F,L,z;const H=h(),[G,$]=jt.useState(0),{hasPermission:Z}=Di(),J=Sh(),ee=(({users:e,groups:t})=>{const[r,n]=jt.useState(""),[i,s]=jt.useState(""),[a,o]=jt.useState({pageSize:10,page:0}),[l,c]=jt.useState(""),[d,u]=jt.useState(""),[h,p]=jt.useState({pageSize:10,page:0});return jt.useEffect((()=>{o((e=>({...e,page:0})))}),[r,i]),jt.useEffect((()=>{p((e=>({...e,page:0})))}),[l,d]),{filteredUsers:jt.useMemo((()=>e.filter((e=>{var t,n,s;const a=e.username.toLowerCase().includes(r.toLowerCase())||(null==(t=e.email)?void 0:t.toLowerCase().includes(r.toLowerCase()))||(null==(n=e.first_name)?void 0:n.toLowerCase().includes(r.toLowerCase()))||(null==(s=e.last_name)?void 0:s.toLowerCase().includes(r.toLowerCase()))||!1,o=""===i||"active"===i&&e.is_active||"inactive"===i&&!e.is_active;return a&&o}))),[e,r,i]),filteredGroups:jt.useMemo((()=>t.filter((e=>{const t=e.name.toLowerCase().includes(l.toLowerCase()),r=""===d||"active"===d&&e.is_active||"inactive"===d&&!e.is_active;return t&&r}))),[t,l,d]),userFilters:{searchTerm:r,statusFilter:i,onSearchChange:n,onStatusChange:s},groupFilters:{searchTerm:l,statusFilter:d,onSearchChange:c,onStatusChange:u},userPaginationModel:a,setUserPaginationModel:o,groupPaginationModel:h,setGroupPaginationModel:p,resetUserFilters:()=>{n(""),s(""),o({pageSize:10,page:0})},resetGroupFilters:()=>{c(""),u(""),p({pageSize:10,page:0})}}})({users:J.users,groups:J.groups}),te=(()=>{const[e,t]=jt.useState(!1),[r,n]=jt.useState(null),[i,s]=jt.useState(!1),a=jt.useCallback((()=>{n({username:"",email:"",first_name:"",last_name:"",is_active:!0,role:"",group_ids:[],zone:void 0,groups:[],permissions:[],user:{username:"",email:"",password:"",first_name:"",last_name:"",is_active:!0}}),s(!0),t(!0)}),[]),o=jt.useCallback((e=>{var t,r,n,i,s;return{...e,role:(null==(t=e.profile_data)?void 0:t.role)||(null==(r=e.profile)?void 0:r.role)||e.role||"",zone:void 0!==(null==(n=e.profile_data)?void 0:n.zone)?e.profile_data.zone:void 0!==(null==(i=e.profile)?void 0:i.zone)?null==(s=e.profile)?void 0:s.zone:e.zone,is_active:e.is_active,user:{username:e.username||"",email:e.email||"",password:"",first_name:e.first_name||"",last_name:e.last_name||"",is_active:e.is_active},group_ids:Array.isArray(e.groups)?e.groups.map((e=>"object"==typeof e&&e&&"id"in e?e.id:Number(e))).filter((e=>void 0!==e)):[]}}),[]),l=jt.useCallback((e=>{const r=o(e);n(r),s(!1),t(!0)}),[o]),c=jt.useCallback((()=>{t(!1),n(null)}),[]),d=jt.useCallback((()=>{s((e=>!e))}),[]),u=jt.useCallback((e=>{var t;if(!e.role)throw new Error("Veuillez sÃ©lectionner un rÃ´le pour l'utilisateur");if(!(null==(t=e.user)?void 0:t.password))throw new Error("Le mot de passe est requis pour un nouvel utilisateur");return{username:e.user.username,email:e.user.email,password:e.user.password,first_name:e.user.first_name||"",last_name:e.user.last_name||"",is_active:e.user.is_active,role:e.role,zone:void 0!==e.zone&&null!==e.zone?e.zone:void 0,is_profile_active:e.is_active,groups:e.group_ids||[]}}),[]),h=jt.useCallback((e=>{var t,r,n,i,s;const a=e.group_ids&&Array.isArray(e.group_ids)?e.group_ids.map((e=>Number(e))):[],o={username:e.username||(null==(t=e.user)?void 0:t.username)||"",email:e.email||(null==(r=e.user)?void 0:r.email)||"",first_name:e.first_name||(null==(n=e.user)?void 0:n.first_name)||"",last_name:e.last_name||(null==(i=e.user)?void 0:i.last_name)||"",is_active:e.is_active,is_staff:void 0!==e.is_staff?e.is_staff:"admin"===e.role,role:e.role||"",zone:e.zone,is_profile_active:e.is_active,groups:a};return(null==(s=e.user)?void 0:s.password)&&""!==e.user.password.trim()&&(o.password=e.user.password),o}),[]);return{showDialog:e,selectedUser:r,showPassword:i,openAddDialog:a,openEditDialog:l,closeDialog:c,setSelectedUser:n,setShowPassword:s,togglePasswordVisibility:d,prepareUserForEdit:o,prepareUserDataForCreate:u,prepareUserDataForUpdate:h}})(),re=(()=>{const[e,t]=jt.useState(!1),[r,n]=jt.useState(null),i=jt.useCallback(((e,t)=>e&&Array.isArray(e)?e.map((e=>{if("number"==typeof e)return e;if("string"==typeof e)return t[e]||-1;if(e&&"object"==typeof e){const r=e;if("number"==typeof r.id)return r.id;const n=r.full_codename||r.codename||r.code;if("string"==typeof n)return t[n]||-1}return-1})).filter((e=>-1!==e)):[]),[]),s=jt.useCallback((()=>{n({name:"",permissions:[]}),t(!0)}),[]),a=jt.useCallback(((e,t)=>({...e,permissions:Array.isArray(e.permissions)?i(e.permissions,t):[]})),[i]),o=jt.useCallback(((e,r)=>{const i=a(e,r);n(i),t(!0)}),[a]),l=jt.useCallback((()=>{t(!1),n(null)}),[]),c=jt.useCallback(((e,t)=>{if(!(null==r?void 0:r.permissions)||!Array.isArray(r.permissions))return!1;const n=t[e];return!!n&&r.permissions.includes(n)}),[r]),d=jt.useCallback(((e,t)=>{if(!r)return;const i=t[e];i?n((e=>{if(!e)return null;const t=Array.isArray(e.permissions)?[...e.permissions]:[];return t.includes(i)?{...e,permissions:t.filter((e=>e!==i))}:{...e,permissions:[...t,i]}})):console.warn(`No ID found for permission code: ${e}`)}),[r]),u=jt.useCallback((()=>{if(!r)return null;if(!r.name)throw new Error("Le nom du groupe est requis");let e=[];return e=r.permissions&&Array.isArray(r.permissions)?[...r.permissions]:[],{name:r.name,permissions:e}}),[r]);return{showDialog:e,selectedGroup:r,openAddDialog:s,openEditDialog:o,closeDialog:l,setSelectedGroup:n,isPermissionSelected:c,togglePermission:d,prepareGroupForEdit:a,prepareGroupDataForSave:u}})(),[ne,ie]=jt.useState(null),se=Z("change_user"),ae=Z("add_user"),le=Z("delete_user");jt.useEffect((()=>{J.refreshAllData()}),[]);const ce=jt.useCallback((()=>{te.openAddDialog()}),[te]),me=jt.useCallback((async e=>{try{const t=await J.fetchUserById(e.id);te.openEditDialog(t||e)}catch(t){console.error("Error preparing user for edit:",t),J.setError("Une erreur est survenue lors de la rÃ©cupÃ©ration des donnÃ©es de l'utilisateur")}}),[J,te]),fe=jt.useCallback((async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet utilisateur ?"))try{await J.deleteUser(e.id),ie("Utilisateur supprimÃ© avec succÃ¨s")}catch(t){console.error("Error deleting user:",t),J.setError("Une erreur est survenue lors de la suppression de l'utilisateur")}}),[J]),ge=jt.useCallback((()=>{re.openAddDialog()}),[re]),ve=jt.useCallback((e=>{re.openEditDialog(e,J.permissionIdMapping)}),[re,J.permissionIdMapping]),Ce=jt.useCallback((async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce groupe ?"))try{await J.deleteGroup(e.id),ie("Groupe supprimÃ© avec succÃ¨s")}catch(t){console.error("Error deleting group:",t);const e=Ih(t);J.setError(e)}}),[J]),_e=jt.useCallback((e=>e&&e.permissions&&Array.isArray(e.permissions)&&0!==e.permissions.length?t.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[(e.permissions||[]).slice(0,3).map(((r,n)=>{let i="";"number"==typeof r&&(i=J.permissionCodeMapping[r]||`ID: ${r}`);let s=i;for(const e of J.availablePermissions){const t=e.permissions.find((e=>e.id===r));if(t){s=`${e.name}: ${t.name}`;break}}return t.jsx(ue,{label:s,size:"small",color:"primary",variant:"outlined"},`${e.id||"new"}-perm-${n}-${i}`)})),(e.permissions||[]).length>3&&t.jsx(ue,{label:`+${e.permissions.length-3} more`,size:"small",color:"default",variant:"outlined"})]}):t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucune"})),[J.permissionCodeMapping,J.availablePermissions]),Se=jt.useMemo((()=>[{field:"username",headerName:"Utilisateur",flex:1,renderCell:e=>e&&e.row?t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(M,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.username})]}):t.jsx(t.Fragment,{})},{field:"email",headerName:"Email",flex:1,valueGetter:e=>e||""},{field:"role",headerName:"RÃ´le",flex:1,renderCell:e=>e&&e.row?t.jsx(ue,{icon:t.jsx(xt,{}),label:Ah(e.row.role||""),color:Eh(e.row.role||""),size:"small"}):t.jsx(t.Fragment,{})},{field:"zone",headerName:"Zone",flex:1,valueGetter:(e,t)=>{var r;if(!t)return"Aucune zone";const n=t.zone||(null==(r=t.profile_data)?void 0:r.zone),i=((e,t)=>{var r;if(e)return null==(r=t.find((t=>t.id===e)))?void 0:r.name})(n,J.zones);return((e,t)=>e?t||`Zone ${e}`:"Aucune zone")(n,i)}},{field:"groups",headerName:"Groupes",flex:1,valueGetter:(e,t)=>{return t&&t.groups?(r=t.groups)&&Array.isArray(r)&&0!==r.length?r.map((e=>"object"==typeof e&&null!==e&&"name"in e&&e.name||"Groupe inconnu")).join(", "):"Aucun groupe":"Aucun groupe";var r}},{field:"is_active",headerName:"Statut",flex:1,renderCell:e=>e&&e.row?t.jsx(ue,{label:e.row.is_active?"Actif":"Inactif",color:e.row.is_active?"success":"error",size:"small",variant:"outlined"}):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e&&e.row?t.jsxs(c,{children:[t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:()=>me(e.row),disabled:!se,children:t.jsx(et,{fontSize:"small"})}),t.jsx(f,{color:"error",size:"small",onClick:()=>fe(e.row),disabled:!le,children:t.jsx(Ze,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}]),[J.zones,se,le,me,fe]),Ee=jt.useMemo((()=>[{field:"name",headerName:"Nom du groupe",flex:1,renderCell:e=>e&&e.row?t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(A,{fontSize:"small",color:"action"}),t.jsx(d,{variant:"body2",sx:{fontWeight:"medium"},children:e.row.name||""})]}):t.jsx(t.Fragment,{})},{field:"permissions",headerName:"Permissions",flex:1.5,renderCell:e=>e&&e.row?_e(e.row):t.jsx(t.Fragment,{})},{field:"actions",headerName:"Actions",flex:1,sortable:!1,renderCell:e=>e&&e.row?t.jsxs(c,{sx:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(f,{color:"primary",size:"small",sx:{mr:1},onClick:()=>ve(e.row),children:t.jsx(et,{fontSize:"small"})}),t.jsx(f,{color:"error",size:"small",onClick:()=>Ce(e.row),children:t.jsx(Ze,{fontSize:"small"})})]}):t.jsx(t.Fragment,{})}]),[_e,ve,Ce]);return t.jsx(Ad,{requiredPermission:"view_user",fallbackPath:"/",children:t.jsxs(c,{children:[t.jsxs(c,{sx:{mb:4},children:[t.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:H.palette.primary.main,borderBottom:`2px solid ${H.palette.primary.light}`,pb:1,width:"fit-content"},children:"Gestion des AccÃ¨s"}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez les profils, les permissions et les groupes d'utilisateurs"})]}),t.jsxs(U,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(he,{value:G,onChange:(e,t)=>$(t),sx:{px:3,pt:2},children:[t.jsx(pe,{icon:t.jsx(M,{}),iconPosition:"start",label:"Utilisateurs"}),t.jsx(pe,{icon:t.jsx(A,{}),iconPosition:"start",label:"Groupes"})]})}),t.jsx(jh,{value:G,index:0,children:t.jsxs(c,{sx:{px:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",gap:2,flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom d'utilisateur ou email",variant:"outlined",size:"small",fullWidth:!0,value:ee.userFilters.searchTerm,onChange:e=>ee.userFilters.onSearchChange(e.target.value)}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:ee.userFilters.statusFilter,onChange:e=>ee.userFilters.onStatusChange(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"active",children:"Actifs"}),t.jsx(B,{value:"inactive",children:"Inactifs"})]})]})]}),t.jsx(k,{variant:"contained",startIcon:t.jsx(Oe,{}),onClick:ce,disabled:!ae,children:"Nouvel utilisateur"})]}),J.error&&t.jsx(W,{severity:"error",sx:{mb:3},children:J.error}),ne&&t.jsx(W,{severity:"success",sx:{mb:3},onClose:()=>ie(null),children:ne}),J.loading?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(c,{sx:{height:500,width:"100%"},children:t.jsx(de,{rows:ee.filteredUsers,columns:Se,paginationModel:ee.userPaginationModel,onPaginationModelChange:ee.setUserPaginationModel,pageSizeOptions:[5,10,25]})})]})}),t.jsx(jh,{value:G,index:1,children:t.jsxs(c,{sx:{px:3},children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:3,gap:2},children:[t.jsxs(c,{sx:{display:"flex",gap:2,flexGrow:1},children:[t.jsx(V,{label:"Rechercher",placeholder:"Nom du groupe",variant:"outlined",size:"small",fullWidth:!0,value:ee.groupFilters.searchTerm,onChange:e=>ee.groupFilters.onSearchChange(e.target.value)}),t.jsxs(Y,{variant:"outlined",size:"small",sx:{minWidth:200},children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:ee.groupFilters.statusFilter,onChange:e=>ee.groupFilters.onStatusChange(e.target.value),label:"Statut",children:[t.jsx(B,{value:"",children:"Tous"}),t.jsx(B,{value:"active",children:"Actifs"}),t.jsx(B,{value:"inactive",children:"Inactifs"})]})]})]}),t.jsx(k,{variant:"contained",startIcon:t.jsx(Oe,{}),onClick:ge,children:"Nouveau groupe"})]}),J.error&&t.jsx(W,{severity:"error",sx:{mb:3},children:J.error}),ne&&t.jsx(W,{severity:"success",sx:{mb:3},onClose:()=>ie(null),children:ne}),J.loading?t.jsx(c,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(m,{})}):t.jsx(c,{sx:{height:500,width:"100%"},children:t.jsx(de,{rows:ee.filteredGroups,columns:Ee,paginationModel:ee.groupPaginationModel,onPaginationModelChange:ee.setGroupPaginationModel,pageSizeOptions:[5,10,25]})})]})})]}),t.jsxs(xe,{open:te.showDialog,onClose:te.closeDialog,maxWidth:"md",fullWidth:!0,children:[t.jsx(ye,{children:(null==(e=te.selectedUser)?void 0:e.id)?"Modifier l'utilisateur":"Nouvel utilisateur"}),t.jsx(we,{children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Nom d'utilisateur",fullWidth:!0,required:!0,value:(null==(n=null==(r=te.selectedUser)?void 0:r.user)?void 0:n.username)||"",onChange:e=>te.setSelectedUser((t=>t?{...t,user:{...t.user,username:e.target.value}}:null)),InputProps:{readOnly:!!(null==(i=te.selectedUser)?void 0:i.id)}})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Email",type:"email",fullWidth:!0,required:!0,value:(null==(o=null==(s=te.selectedUser)?void 0:s.user)?void 0:o.email)||"",onChange:e=>te.setSelectedUser((t=>t?{...t,user:{...t.user,email:e.target.value}}:null))})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"PrÃ©nom",fullWidth:!0,value:(null==(u=null==(l=te.selectedUser)?void 0:l.user)?void 0:u.first_name)||"",onChange:e=>te.setSelectedUser((t=>t?{...t,user:{...t.user,first_name:e.target.value}}:null))})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsx(V,{label:"Nom",fullWidth:!0,value:(null==(g=null==(p=te.selectedUser)?void 0:p.user)?void 0:g.last_name)||"",onChange:e=>te.setSelectedUser((t=>t?{...t,user:{...t.user,last_name:e.target.value}}:null))})}),t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Mot de passe",type:te.showPassword?"text":"password",fullWidth:!0,required:!(null==(x=te.selectedUser)?void 0:x.id),value:(null==(w=null==(y=te.selectedUser)?void 0:y.user)?void 0:w.password)||"",onChange:e=>te.setSelectedUser((t=>t?{...t,user:{...t.user,password:e.target.value}}:null)),InputProps:{endAdornment:t.jsx(f,{onClick:te.togglePasswordVisibility,edge:"end",children:te.showPassword?t.jsx(q,{}):t.jsx(X,{})})}})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,required:!0,children:[t.jsx(Q,{children:"RÃ´le"}),t.jsxs(K,{value:(null==(b=te.selectedUser)?void 0:b.role)||"",label:"RÃ´le",onChange:e=>te.setSelectedUser((t=>t?{...t,role:e.target.value}:null)),children:[t.jsx(B,{value:"admin",children:"Administrateur"}),t.jsx(B,{value:"consultant",children:"Consultant"}),t.jsx(B,{value:"supervisor",children:"Superviseur"}),t.jsx(B,{value:"commercial",children:"Commercial"}),t.jsx(B,{value:"cashier",children:"Chef de Caisse"})]})]})}),t.jsx(oe,{item:!0,xs:12,sm:6,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Zone"}),t.jsxs(K,{value:(null==(v=te.selectedUser)?void 0:v.zone)||"",label:"Zone",onChange:e=>te.setSelectedUser((t=>t?{...t,zone:e.target.value?Number(e.target.value):void 0}:null)),children:[t.jsx(B,{value:"",children:"Aucune zone"}),J.loading?t.jsxs(B,{disabled:!0,children:[t.jsx(m,{size:20,sx:{mr:1}}),"Chargement des zones..."]}):0===J.zones.length?t.jsx(B,{disabled:!0,children:"Aucune zone disponible"}):J.zones.map((e=>t.jsx(B,{value:e.id,children:t.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(Je,{sx:{mr:1,color:"text.secondary",fontSize:"1rem"}}),e.name]})},e.id)))]})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Groupes"}),t.jsx(K,{multiple:!0,value:(null==(C=te.selectedUser)?void 0:C.group_ids)||[],label:"Groupes",onChange:e=>te.setSelectedUser((t=>t?{...t,group_ids:"string"==typeof e.target.value?[Number(e.target.value)]:e.target.value}:null)),renderValue:e=>t.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>t.jsx(ue,{label:J.getGroupName(e),size:"small"},e)))}),children:J.groups.map((e=>{var r,n;return t.jsxs(B,{value:e.id,children:[t.jsx(yt,{checked:null==(n=null==(r=te.selectedUser)?void 0:r.group_ids)?void 0:n.includes(e.id)}),t.jsx(a,{primary:e.name})]},e.id)}))})]})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Statut"}),t.jsxs(K,{value:(null==(_=te.selectedUser)?void 0:_.is_active)?"1":"0",label:"Statut",onChange:e=>te.setSelectedUser((t=>t?{...t,is_active:"1"===e.target.value,user:{...t.user,is_active:"1"===e.target.value}}:null)),children:[t.jsx(B,{value:"1",children:"Actif"}),t.jsx(B,{value:"0",children:"Inactif"})]})]})})]})}),t.jsxs(be,{children:[t.jsx(k,{onClick:te.closeDialog,children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e;if(te.selectedUser)try{if(te.selectedUser.id){const e=te.prepareUserDataForUpdate(te.selectedUser);await J.updateUser(te.selectedUser.id,e),ie("Utilisateur modifiÃ© avec succÃ¨s")}else{const e=te.prepareUserDataForCreate(te.selectedUser);await J.createUser(e),ie("Utilisateur crÃ©Ã© avec succÃ¨s")}te.closeDialog()}catch(t){console.error("Error saving user:",t);const r=t;if(null==(e=r.response)?void 0:e.data){const e=(e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){const t=e;if(t.detail)return String(t.detail);if(t.message)return String(t.message);if(t.user&&"object"==typeof t.user){const e=t.user;if(e.username&&Array.isArray(e.username))return`Erreur de nom d'utilisateur: ${e.username[0]}`;const r=Object.entries(e).filter((([,e])=>Array.isArray(e)&&e.length>0)).map((([e,t])=>`${e}: ${t[0]}`));if(r.length>0)return`Erreurs de validation: ${r.join(", ")}`}}return null})(r.response.data);J.setError(e||"Une erreur est survenue lors de la sauvegarde de l'utilisateur")}else J.setError("Une erreur est survenue lors de la sauvegarde de l'utilisateur")}},disabled:!(null==(E=null==(S=te.selectedUser)?void 0:S.user)?void 0:E.username)||!(null==(j=null==(I=te.selectedUser)?void 0:I.user)?void 0:j.email)||!(null==(T=te.selectedUser)?void 0:T.role)||!(null==(D=te.selectedUser)?void 0:D.id)&&!(null==(N=null==(R=te.selectedUser)?void 0:R.user)?void 0:N.password),children:(null==(P=te.selectedUser)?void 0:P.id)?"Modifier":"Ajouter"})]})]}),t.jsxs(xe,{open:re.showDialog,onClose:re.closeDialog,maxWidth:"sm",fullWidth:!0,children:[t.jsx(ye,{children:(null==(O=re.selectedGroup)?void 0:O.id)?"Modifier le groupe":"Nouveau groupe"}),t.jsx(we,{children:t.jsxs(oe,{container:!0,spacing:2,sx:{mt:1},children:[t.jsx(oe,{item:!0,xs:12,children:t.jsx(V,{label:"Nom du groupe",fullWidth:!0,required:!0,value:(null==(F=re.selectedGroup)?void 0:F.name)||"",onChange:e=>re.setSelectedGroup((t=>t?{...t,name:e.target.value}:null))})}),t.jsx(oe,{item:!0,xs:12,children:t.jsxs(Y,{fullWidth:!0,children:[t.jsx(Q,{children:"Permissions"}),t.jsx(K,{multiple:!0,value:(null==(Ae=re.selectedGroup)?void 0:Ae.permissions)||[],label:"Permissions",renderValue:e=>t.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.length>0?e.map((e=>{let r=J.permissionCodeMapping[e]||"",n="";for(const t of J.availablePermissions){const i=t.permissions.find((t=>t.id===e));if(i){r=i.name,n=t.name;break}}return t.jsx(ue,{label:`${n}: ${r}`,size:"small",onDelete:()=>{const t=J.permissionCodeMapping[e];t&&re.togglePermission(t,J.permissionIdMapping)},sx:{m:.1}},e)})):t.jsx(d,{variant:"body2",color:"text.secondary",children:"Aucune permission sÃ©lectionnÃ©e"})}),onChange:()=>{},MenuProps:{PaperProps:{style:{maxHeight:400,width:400}}},children:J.availablePermissions.length>0?J.availablePermissions.map((e=>[t.jsx(wt,{sx:{backgroundColor:H.palette.primary.light,color:H.palette.primary.contrastText,fontWeight:"bold"},children:e.name},`header-${e.app}.${e.model}`),...e.permissions.map((e=>{const r=e.full_codename,n=re.isPermissionSelected(r,J.permissionIdMapping);return t.jsxs(B,{value:e.id,onClick:e=>{e.preventDefault(),re.togglePermission(r,J.permissionIdMapping)},sx:{padding:"8px 16px",borderLeft:n?`4px solid ${H.palette.primary.main}`:"none",backgroundColor:n?"rgba(0, 0, 0, 0.04)":"transparent"},children:[t.jsx(yt,{checked:n,color:"primary",sx:{padding:"4px"}}),t.jsx(a,{primary:e.name,secondary:r})]},r)}))])):t.jsx(B,{disabled:!0,children:"Chargement des permissions..."})})]})})]})}),t.jsxs(be,{children:[t.jsx(k,{onClick:re.closeDialog,children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:async()=>{var e;try{const t=re.prepareGroupDataForSave();if(!t)return;(null==(e=re.selectedGroup)?void 0:e.id)?(await J.updateGroup(re.selectedGroup.id,t),ie("Groupe modifiÃ© avec succÃ¨s")):(await J.createGroup(t),ie("Groupe crÃ©Ã© avec succÃ¨s")),re.closeDialog()}catch(t){const e=Ih(t);J.setError(e)}},disabled:!(null==(L=re.selectedGroup)?void 0:L.name),children:(null==(z=re.selectedGroup)?void 0:z.id)?"Modifier":"Ajouter"})]})]})]})});var Ae};var Dh={},Rh=ge;Object.defineProperty(Dh,"__esModule",{value:!0});var Nh=Dh.default=void 0,Ph=Rh(sl()),Oh=t;Nh=Dh.default=(0,Ph.default)((0,Oh.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const kh=()=>{const e=h(),[r]=Bt(),[n,i]=jt.useState(0),[s,a]=jt.useState(""),[o,u]=jt.useState(1);jt.useEffect((()=>{const e=r.get("tab");if(e){const t=parseInt(e,10);!isNaN(t)&&t>=0&&t<Z.length&&i(t)}}),[r]);const[p,g]=jt.useState(!1),[y,w]=jt.useState(!1),[b,C]=jt.useState(!1),[_,S]=jt.useState(null),[A,I]=jt.useState(""),j=e=>({"expense-categories":t.jsx(ct,{}),"units-of-measure":t.jsx(Et,{}),currencies:t.jsx(ot,{}),"payment-methods":t.jsx(E,{}),accounts:t.jsx(E,{}),"price-groups":t.jsx(ot,{}),"product-categories":t.jsx(_t,{}),"charge-types":t.jsx(ct,{}),"client-groups":t.jsx(v,{}),zones:t.jsx(Je,{})}[e]||t.jsx(_t,{})),[T,D]=jt.useState({name:"",description:"",code:"",symbol:"",discount_percentage:0,is_active:!0,is_base:!1,address:"",account_type:"",account_number:"",currency:"",initial_balance:0}),[R,N]=jt.useState(!1),[P,O]=jt.useState(!1),[M,F]=jt.useState({open:!1,message:"",severity:"success"}),[L,z]=jt.useState([]),[G,q]=jt.useState(!1),[X,$]=jt.useState([]),Z=jt.useMemo((()=>[{id:"zones",label:"Zones",endpoint:"zones"},{id:"price-groups",label:"Groupes de prix",endpoint:"price-groups"},{id:"accounts",label:"Comptes",endpoint:"accounts"},{id:"units",label:"UnitÃ©s de mesure",endpoint:"units-of-measure"},{id:"expense-categories",label:"CatÃ©gories de dÃ©penses",endpoint:"expense-categories"},{id:"currencies",label:"Devises",endpoint:"currencies"},{id:"payment-methods",label:"MÃ©thodes de paiement",endpoint:"payment-methods"},{id:"product-categories",label:"CatÃ©gories de produits",endpoint:"product-categories"},{id:"charge-types",label:"Types de charges",endpoint:"charge-types"},{id:"client-groups",label:"Groupes de clients",endpoint:"client-groups"}]),[]),J=jt.useCallback((async()=>{const e=Z[n];if(e){q(!0);try{const t=await Ba(e.endpoint);z(Array.isArray(t)?t:[])}catch(t){console.error(`Error fetching ${e.endpoint}:`,t),F({open:!0,message:`Erreur lors du chargement des donnÃ©es: ${t.message}`,severity:"error"}),z([])}finally{q(!1)}}}),[n,Z]),ee=jt.useCallback((async()=>{var e;if("accounts"===(null==(e=Z[n])?void 0:e.endpoint))try{const e=await Ba("currencies");$(Array.isArray(e)?e:[])}catch(t){console.error("Error fetching currencies:",t)}}),[n,Z]);jt.useEffect((()=>{var e;J(),"accounts"===(null==(e=Z[n])?void 0:e.endpoint)&&ee()}),[n,J,ee,Z]);const te=()=>{var e;return(null==(e=Z[n])?void 0:e.label)||""},re=()=>{var e;return(null==(e=Z[n])?void 0:e.endpoint)||""},ne=jt.useMemo((()=>{if(!s.trim())return L;const e=s.toLowerCase();return L.filter((t=>{var r,n,i,s;return(null==(r=t.name)?void 0:r.toLowerCase().includes(e))||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))||(null==(i=t.code)?void 0:i.toLowerCase().includes(e))||(null==(s=t.symbol)?void 0:s.toLowerCase().includes(e))}))}),[L,s]),ae=jt.useMemo((()=>{const e=9*(o-1),t=e+9;return ne.slice(e,t)}),[ne,o,9]),le=Math.ceil(ne.length/9);jt.useEffect((()=>{u(1)}),[s]);const ce=()=>{D({name:"",description:"",code:"",symbol:"",discount_percentage:0,is_active:!0,is_base:!1,address:"",account_type:"",account_number:"",currency:"",initial_balance:0}),I(te()),"accounts"===re()&&ee(),g(!0)},de=()=>{g(!1),w(!1),C(!1)},me=e=>{D({...T,[e.target.name]:e.target.value})},fe=async()=>{N(!0);try{const e=re();if(!e)throw new Error("No endpoint specified");p?(await(async(e,t)=>{const r=`/${Fa(e)}/${e}/`;return(await rs.post(r,t)).data})(e,T),F({open:!0,message:`${A} ajoutÃ© avec succÃ¨s`,severity:"success"})):(await(async(e,t,r)=>{const n=`/${Fa(e)}/${e}/${t}/`;return(await rs.put(n,r)).data})(e,_.id,T),F({open:!0,message:`${A} modifiÃ© avec succÃ¨s`,severity:"success"})),J()}catch(e){console.error("Error during save operation:",e),F({open:!0,message:`Erreur: ${e.message}`,severity:"error"})}finally{N(!1),de()}},ge=()=>{F({...M,open:!1})},ve=()=>{const e=re(),r=t.jsx(V,{name:"name",label:"Nom",value:T.name,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",required:!0});switch(e){case"currencies":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"code",label:"Code (ex: USD, EUR)",value:T.code,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",required:!0,inputProps:{maxLength:3},helperText:"Code Ã  3 caractÃ¨res (ex: USD, EUR)"}),t.jsx(V,{name:"symbol",label:"Symbole (ex: $, â‚¬)",value:T.symbol,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",required:!0,inputProps:{maxLength:5},helperText:"Symbole monÃ©taire (ex: $, â‚¬)"})]});case"price-groups":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"discount_percentage",label:"Pourcentage de remise",value:vl(T.discount_percentage),onChange:e=>{const t=bl(e.target.value,T.discount_percentage);D({...T,discount_percentage:t})},type:"text",fullWidth:!0,margin:"normal",variant:"outlined",error:T.discount_percentage<0||T.discount_percentage>100,helperText:T.discount_percentage<0?"Le pourcentage doit Ãªtre positif":T.discount_percentage>100?"Le pourcentage ne peut pas dÃ©passer 100":""}),t.jsx(V,{name:"description",label:"Description",value:T.description,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3}),t.jsx(St,{control:t.jsx(yt,{checked:T.is_base||!1,onChange:e=>D({...T,is_base:e.target.checked}),name:"is_base"}),label:"Groupe de prix de base"})]});case"units-of-measure":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"symbol",label:"Symbole de l'unitÃ© de mesure",value:T.symbol,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",required:!0})]});case"zones":return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"address",label:"Adresse",value:T.address||"",onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:2}),t.jsx(V,{name:"description",label:"Description",value:T.description,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3})]});case"accounts":return t.jsxs(t.Fragment,{children:[r,t.jsxs(Y,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(Q,{id:"account-type-label",children:"Type de compte"}),t.jsxs(K,{labelId:"account-type-label",name:"account_type",value:T.account_type,onChange:me,label:"Type de compte",children:[t.jsx(B,{value:"internal",children:"Compte Interne"}),t.jsx(B,{value:"bank",children:"Compte Bancaire"}),t.jsx(B,{value:"cash",children:"Caisse"}),t.jsx(B,{value:"client",children:"Compte Client"}),t.jsx(B,{value:"supplier",children:"Compte Fournisseur"})]})]}),t.jsxs(Y,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(Q,{id:"currency-label",children:"Devise"}),t.jsx(K,{labelId:"currency-label",name:"currency",value:T.currency,onChange:me,label:"Devise",children:X.map((e=>t.jsxs(B,{value:e.id,children:[e.name," (",e.symbol,")"]},e.id)))})]}),t.jsx(V,{name:"initial_balance",label:"Solde initial",value:vl(T.initial_balance||0),onChange:e=>{const t=bl(e.target.value,T.initial_balance||0);D({...T,initial_balance:t})},type:"text",fullWidth:!0,margin:"normal",variant:"outlined",error:(T.initial_balance||0)<0,helperText:Cl(T.initial_balance||0,"price")}),t.jsx(V,{name:"description",label:"Description",value:T.description,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3}),t.jsx(St,{control:t.jsx(yt,{checked:T.is_active,onChange:e=>D({...T,is_active:e.target.checked}),name:"is_active"}),label:"Actif"})]});default:return t.jsxs(t.Fragment,{children:[r,t.jsx(V,{name:"description",label:"Description",value:T.description,onChange:me,fullWidth:!0,margin:"normal",variant:"outlined",multiline:!0,rows:3})]})}};return t.jsx(Ad,{requiredPermission:"change_user",fallbackPath:"/",children:t.jsxs(c,{sx:{backgroundColor:e.palette.background.default,minHeight:"100vh",p:3},children:[t.jsx(d,{variant:"h4",sx:{mb:3,fontWeight:"bold",color:e.palette.text.primary},children:"ParamÃ¨tres du systÃ¨me"}),t.jsx(U,{elevation:2,sx:{mb:3,p:1},children:t.jsx(he,{value:n,onChange:(e,t)=>{i(t),I(te()),a(""),u(1)},indicatorColor:"primary",variant:"scrollable",scrollButtons:"auto",children:Z.map((e=>t.jsx(pe,{label:e.label},e.id)))})}),t.jsxs(ie,{elevation:3,sx:{mb:3},children:[t.jsx(bt,{title:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[j(re()),t.jsx(d,{variant:"h6",component:"span",children:te()})]}),action:t.jsx(k,{variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:ce,sx:{borderRadius:"8px"},children:"Ajouter"}),sx:{pb:2}}),t.jsx(x,{}),t.jsxs(se,{sx:{pt:3},children:[t.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center",mb:3},children:[t.jsx(V,{fullWidth:!0,placeholder:"Rechercher...",value:s,onChange:e=>a(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(Fe,{color:"action"})})},size:"small"}),ne.length>0&&t.jsx(ue,{label:`${ne.length} Ã©lÃ©ment${ne.length>1?"s":""}`,color:"primary",variant:"outlined",sx:{minWidth:80}})]}),G?t.jsx(c,{sx:{display:"flex",justifyContent:"center",p:5},children:t.jsx(m,{})}):0===ne.length?t.jsx(c,{sx:{textAlign:"center",py:8,px:3},children:s?t.jsxs(t.Fragment,{children:[t.jsx(Fe,{sx:{fontSize:60,color:"text.secondary",opacity:.3,mb:2}}),t.jsx(d,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"Aucun rÃ©sultat trouvÃ©"}),t.jsx(d,{variant:"body2",color:"textSecondary",children:"Essayez avec d'autres mots-clÃ©s"})]}):t.jsxs(t.Fragment,{children:[j(re())&&t.jsx(c,{sx:{display:"inline-flex",p:3,borderRadius:"50%",backgroundColor:e.palette.action.hover,mb:2},children:Pt.cloneElement(j(re()),{sx:{fontSize:48,color:"text.secondary",opacity:.5}})}),t.jsx(d,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"Aucun Ã©lÃ©ment trouvÃ©"}),t.jsx(d,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Commencez par ajouter votre premier Ã©lÃ©ment"}),t.jsxs(k,{variant:"contained",color:"primary",startIcon:t.jsx(Oe,{}),onClick:ce,sx:{borderRadius:"8px"},children:["Ajouter ",te()]})]})}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{container:!0,spacing:2,children:ae.map((r=>t.jsx(oe,{item:!0,xs:12,sm:6,md:4,children:t.jsxs(ie,{elevation:1,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s","&:hover":{elevation:4,transform:"translateY(-2px)",boxShadow:"dark"===e.palette.mode?"0 4px 20px rgba(0,0,0,0.4)":"0 4px 20px rgba(0,0,0,0.1)"}},children:[t.jsxs(se,{sx:{flexGrow:1,pb:1},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[t.jsx(d,{variant:"h6",component:"div",sx:{fontWeight:600,fontSize:"1rem"},children:r.name}),void 0!==r.is_active&&t.jsx(ue,{label:r.is_active?"Actif":"Inactif",color:r.is_active?"success":"default",size:"small",sx:{height:20,fontSize:"0.7rem"}}),r.is_base&&t.jsx(ue,{label:"Base",color:"primary",size:"small",sx:{height:20,fontSize:"0.7rem"}})]}),r.description&&t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:1.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:r.description}),t.jsxs(Pe,{direction:"row",spacing:1,flexWrap:"wrap",sx:{gap:.5},children:[r.code&&t.jsx(ue,{label:`Code: ${r.code}`,size:"small",variant:"outlined",sx:{height:24}}),r.symbol&&t.jsx(ue,{label:r.symbol,size:"small",variant:"outlined",sx:{height:24}}),void 0!==r.discount_percentage&&r.discount_percentage>0&&t.jsx(ue,{label:`-${r.discount_percentage}%`,size:"small",color:"secondary",sx:{height:24}})]})]}),t.jsx(x,{}),t.jsxs(vt,{sx:{justifyContent:"flex-end",px:2,py:1},children:[t.jsx(l,{title:"Modifier",children:t.jsx(f,{size:"small",color:"primary",onClick:()=>(e=>{S(e),D({name:e.name||"",description:e.description||"",code:e.code||"",symbol:e.symbol||"",discount_percentage:e.discount_percentage||0,is_active:void 0===e.is_active||e.is_active,is_base:void 0!==e.is_base&&e.is_base,address:e.address||"",account_type:e.account_type||"",account_number:e.account_number||"",currency:e.currency||"",initial_balance:e.initial_balance||0}),I(te()),"accounts"===re()&&ee(),w(!0)})(r),sx:{"&:hover":{backgroundColor:e.palette.primary.main+"15"}},children:t.jsx(et,{fontSize:"small"})})}),t.jsx(l,{title:"Supprimer",children:t.jsx(f,{size:"small",color:"error",onClick:()=>(e=>{S(e),I(te()),C(!0)})(r),sx:{"&:hover":{backgroundColor:e.palette.error.main+"15"}},children:t.jsx(Ze,{fontSize:"small"})})})]})]})},r.id)))}),ne.length>9&&t.jsx(c,{sx:{display:"flex",justifyContent:"center",mt:4},children:t.jsx(pt,{count:le,page:o,onChange:(e,t)=>{u(t),window.scrollTo({top:0,behavior:"smooth"})},color:"primary",size:"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{fontSize:"1rem"}}})})]})]})]}),t.jsxs(xe,{open:p,onClose:de,maxWidth:"sm",fullWidth:!0,TransitionComponent:ze,keepMounted:!1,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsxs(ye,{sx:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,fontWeight:"bold"},children:["Ajouter ",A]}),t.jsx(we,{dividers:!0,sx:{p:3,backgroundColor:e.palette.background.paper,borderTop:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`},children:t.jsx(c,{sx:{pt:1},children:ve()})}),t.jsxs(be,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(k,{onClick:de,disabled:R,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:fe,disabled:R||!T.name||"currencies"===re()&&(!T.code||!T.symbol)||"units-of-measure"===re()&&!T.symbol||"accounts"===re()&&(!T.account_type||!T.currency),startIcon:R?t.jsx(m,{size:20}):t.jsx(Nh,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:R?"Sauvegarde...":"Sauvegarder"})]})]}),t.jsxs(xe,{open:y,onClose:de,maxWidth:"sm",fullWidth:!0,TransitionComponent:ze,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsxs(ye,{sx:{backgroundColor:e.palette.info.main,color:"#fff",fontWeight:"bold"},children:["Modifier ",A]}),t.jsx(we,{dividers:!0,sx:{p:3,backgroundColor:e.palette.background.paper,borderTop:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`},children:t.jsx(c,{sx:{pt:1},children:ve()})}),t.jsxs(be,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(k,{onClick:de,disabled:R,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(k,{variant:"contained",onClick:fe,disabled:R||!T.name||"currencies"===re()&&(!T.code||!T.symbol)||"units-of-measure"===re()&&!T.symbol||"accounts"===re()&&(!T.account_type||!T.currency),startIcon:R?t.jsx(m,{size:20}):t.jsx(Nh,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:R?"Sauvegarde...":"Sauvegarder"})]})]}),t.jsxs(xe,{open:b,onClose:de,TransitionComponent:ze,PaperProps:{sx:{borderRadius:2,boxShadow:"dark"===e.palette.mode?"0 8px 30px rgba(0,0,0,0.3)":"0 8px 30px rgba(0,0,0,0.12)",backgroundColor:e.palette.background.paper}},children:[t.jsx(ye,{sx:{backgroundColor:e.palette.error.main,color:"#fff",fontWeight:"bold"},children:"Confirmation de suppression"}),t.jsxs(we,{sx:{p:3,mt:2,backgroundColor:e.palette.background.paper},children:[t.jsxs(rt,{color:"text.primary",sx:{mb:2},children:["ÃŠtes-vous sÃ»r de vouloir supprimer ",t.jsx("strong",{children:null==_?void 0:_.name})," ?"]}),t.jsx(W,{severity:"error",children:"Cette action est irrÃ©versible."})]}),t.jsxs(be,{sx:{p:2,backgroundColor:"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"},children:[t.jsx(k,{onClick:de,disabled:P,variant:"outlined",sx:{borderRadius:"20px"},children:"Annuler"}),t.jsx(k,{variant:"contained",color:"error",onClick:async()=>{O(!0);try{const e=re();if(!e)throw new Error("No endpoint specified");await(async(e,t)=>{const r=`/${Fa(e)}/${e}/${t}/`;return await rs.delete(r),!0})(e,_.id),F({open:!0,message:`${A} supprimÃ© avec succÃ¨s`,severity:"success"}),J()}catch(e){console.error("Error during delete operation:",e),F({open:!0,message:`Erreur: ${e.message}`,severity:"error"})}finally{O(!1),de()}},disabled:P,startIcon:P?t.jsx(m,{size:20}):t.jsx(Ze,{}),sx:{borderRadius:"20px",boxShadow:"dark"===e.palette.mode?"0 2px 5px rgba(0,0,0,0.2)":"0 2px 5px rgba(0,0,0,0.05)","&:hover":{boxShadow:"dark"===e.palette.mode?"0 4px 10px rgba(0,0,0,0.3)":"0 4px 10px rgba(0,0,0,0.1)"}},children:P?"Suppression...":"Supprimer"})]})]}),t.jsx(Ye,{open:M.open,autoHideDuration:6e3,onClose:ge,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(W,{onClose:ge,severity:M.severity,sx:{width:"100%",boxShadow:"dark"===e.palette.mode?"0 4px 20px rgba(0,0,0,0.3)":"0 4px 20px rgba(0,0,0,0.1)",borderRadius:2},variant:"filled",children:M.message})}),t.jsx(Ct,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,backgroundColor:"dark"===e.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0.6)"},open:R,children:t.jsx(m,{color:"inherit"})})]})})},Mh=()=>{const e=Tt(),[r,n]=jt.useState(!0),[i,s]=jt.useState(!1);return jt.useEffect((()=>{(async()=>{if(!localStorage.getItem("access_token"))return s(!1),void n(!1);try{const e=await(async()=>{var e,t,r,n;try{const r=localStorage.getItem("access_token");if(console.log("Current token:",r?`${r.substring(0,15)}...`:"No token"),!r)return{authenticated:!1,reason:"No token found"};const n=new AbortController,a=setTimeout((()=>n.abort()),3e3),o="/core/users/me/",l="/users/me/";try{let r;ns.logRequest(o,"GET");try{r=await rs.get(o,{signal:n.signal})}catch(i){if(!ui.isAxiosError(i)||404!==(null==(e=i.response)?void 0:e.status))throw i;ns.logError(o,i),ns.logRequest(l,"GET"),r=await rs.get(l,{signal:n.signal})}clearTimeout(a),ns.logResponse(o,r);const s=r.data,c=(null==(t=s.profile_data)?void 0:t.role)||null,d="admin"===c;return console.log(`User role detected: ${c}, isAdmin: ${d}`),s.permissions&&localStorage.setItem("user_permissions",JSON.stringify(s.permissions)),c&&localStorage.setItem("user_role",c),localStorage.setItem("is_admin",d?"true":"false"),{authenticated:!0,user:r.data,role:c,isAdmin:d}}catch(s){throw clearTimeout(a),s}}catch(s){if(ns.logError("/core/users/me/",s),ui.isCancel(s))return{authenticated:!1,reason:"Request timeout",error:new Error("Authentication check timed out")};const e=s;return 401===(null==(r=e.response)?void 0:r.status)&&(console.warn("Authentication token invalid, clearing tokens"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin")),{authenticated:!1,reason:401===(null==(n=e.response)?void 0:n.status)?"Invalid token":"Request failed",error:s}}})();e.authenticated?s(!0):(console.log("Authentication failed:",e.reason),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiration"),localStorage.removeItem("user_permissions"),localStorage.removeItem("user_role"),localStorage.removeItem("is_admin"),s(!1))}catch(e){console.error("Auth validation error:",e),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_expiration"),s(!1)}finally{n(!1)}})()}),[e.pathname]),r?t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100vw"},children:t.jsx(m,{})}):i?t.jsx(Nt,{}):t.jsx(Ft,{to:"/login",state:{from:e},replace:!0})},Fh=()=>{const e=h(),[r,n]=jt.useState(0),[i,s]=jt.useState({open:!1,message:"",severity:"success"}),a=(()=>{const[e,t]=jt.useState([]),[r,n]=jt.useState([]),[i,s]=jt.useState([]),[a,o]=jt.useState([]),[l,c]=jt.useState([]),[d,u]=jt.useState([]),[h,p]=jt.useState([]),[m,f]=jt.useState([]),[g,x]=jt.useState(!0),[y,w]=jt.useState(null),b=jt.useCallback((async()=>{try{const e=await uo();t(e)}catch(e){throw console.error("Error fetching stocks:",e),w("Erreur lors du chargement des stocks"),e}}),[]),v=jt.useCallback((async()=>{try{const e=await fo();n(e)}catch(e){throw console.error("Error fetching supplies:",e),w("Erreur lors du chargement des approvisionnements"),e}}),[]),C=jt.useCallback((async()=>{try{const e=await xo();s(e)}catch(e){throw console.error("Error fetching transfers:",e),w("Erreur lors du chargement des transferts"),e}}),[]),_=jt.useCallback((async()=>{try{const e=await wo();o(e)}catch(e){throw console.error("Error fetching inventories:",e),w("Erreur lors du chargement des inventaires"),e}}),[]),S=jt.useCallback((async()=>{try{const e=await po();c(e)}catch(e){throw console.error("Error fetching stock cards:",e),w("Erreur lors du chargement des fiches de stock"),e}}),[]),E=jt.useCallback((async()=>{try{const e=await ka();u(e)}catch(e){throw console.error("Error fetching zones:",e),w("Erreur lors du chargement des emplacements"),e}}),[]),A=jt.useCallback((async()=>{try{const e=await La();p(e)}catch(e){throw console.error("Error fetching products:",e),w("Erreur lors du chargement des produits"),e}}),[]),I=jt.useCallback((async()=>{try{const e=await ms();f(e)}catch(e){throw console.error("Error fetching suppliers:",e),w("Erreur lors du chargement des fournisseurs"),e}}),[]),j=jt.useCallback((async()=>{x(!0),w(null);try{await Promise.all([b(),v(),C(),_(),S(),E(),A(),I()])}catch(e){console.error("Error refreshing data:",e),w("Erreur lors du rafraÃ®chissement des donnÃ©es")}finally{x(!1)}}),[b,v,C,_,S,E,A,I]),T=jt.useCallback((async e=>{try{const t=Il(e),r=await Ya(t);return await Promise.all([v(),b(),S()]),r}catch(t){throw console.error("Error creating supply:",t),w("Erreur lors de la crÃ©ation de l'approvisionnement"),t}}),[v,b,S]),D=jt.useCallback((async(e,t)=>{try{const r=Il(t),n=await Qa(e,r);return await Promise.all([v(),b(),S()]),n}catch(r){throw console.error("Error updating supply:",r),w("Erreur lors de la modification de l'approvisionnement"),r}}),[v,b,S]),R=jt.useCallback((async e=>{try{console.warn(`deleteStockSupply API not available yet for id ${e}`),await Promise.all([v(),b(),S()])}catch(t){throw console.error("Error deleting supply:",t),w("Erreur lors de la suppression de l'approvisionnement"),t}}),[v,b,S]),N=jt.useCallback((async e=>{try{const t=jl(e),r=await to(t);return await Promise.all([C(),b(),S()]),r}catch(t){throw console.error("Error creating transfer:",t),w("Erreur lors de la crÃ©ation du transfert"),t}}),[C,b,S]),P=jt.useCallback((async(e,t)=>{try{const r=jl(t),n=await ro(e,r);return await Promise.all([C(),b(),S()]),n}catch(r){throw console.error("Error updating transfer:",r),w("Erreur lors de la modification du transfert"),r}}),[C,b,S]),O=jt.useCallback((async e=>{try{await no(e),await Promise.all([C(),b(),S()])}catch(t){throw console.error("Error deleting transfer:",t),w("Erreur lors de la suppression du transfert"),t}}),[C,b,S]),k=jt.useCallback((async e=>{try{const t=Tl(e),r=await ao(t);return await Promise.all([_(),b(),S()]),r}catch(t){throw console.error("Error creating inventory:",t),w("Erreur lors de la crÃ©ation de l'inventaire"),t}}),[_,b,S]),M=jt.useCallback((async(e,t)=>{try{const r=Tl(t),n=await oo(e,r);return await Promise.all([_(),b(),S()]),n}catch(r){throw console.error("Error updating inventory:",r),w("Erreur lors de la modification de l'inventaire"),r}}),[_,b,S]),F=jt.useCallback((async e=>{try{await lo(e),await Promise.all([_(),b(),S()])}catch(t){throw console.error("Error deleting inventory:",t),w("Erreur lors de la suppression de l'inventaire"),t}}),[_,b,S]);return{stocks:e,supplies:r,transfers:i,inventories:a,stockCards:l,zones:d,products:h,suppliers:m,loading:g,error:y,fetchStocks:b,fetchSupplies:v,fetchTransfers:C,fetchInventories:_,fetchStockCards:S,fetchZones:E,fetchProducts:A,fetchSuppliers:I,refreshAllData:j,createSupply:T,updateSupply:D,deleteSupply:R,createTransfer:N,updateTransfer:P,deleteTransfer:O,createInventory:k,updateInventory:M,deleteInventory:F,setError:w,setLoading:x}})(),o=(({stocks:e,supplies:t,transfers:r,inventories:n,stockCards:i,zones:s,products:a,suppliers:o})=>{const[l,c]=jt.useState(""),[d,u]=jt.useState(""),[h,p]=jt.useState(""),[m,f]=jt.useState(""),g=jt.useMemo((()=>((e,t,r,n,i,s,a)=>e.filter((e=>{if(t){const r=s.find((t=>t.id===e.product)),n=a.find((t=>t.id===e.zone)),i=t.toLowerCase();if(!(null==r?void 0:r.name.toLowerCase().includes(i))&&!(null==n?void 0:n.name.toLowerCase().includes(i)))return!1}if(r&&e.product!==r)return!1;if(n&&e.zone!==n)return!1;if(i){if("rupture"===i&&e.quantity>0)return!1;if("faible"===i&&(e.quantity<=0||e.quantity>10))return!1;if("normal"===i&&e.quantity<=10)return!1}return!0})))(e,l,d,h,m,a,s)),[e,l,d,h,m,a,s]),x=jt.useCallback((()=>{c(""),u(""),p(""),f("")}),[]),[y,w]=jt.useState(""),[b,v]=jt.useState(""),[C,_]=jt.useState(""),[S,E]=jt.useState(""),A=jt.useMemo((()=>((e,t,r,n,i,s,a)=>e.filter((e=>{var o;if(t){const r=s.find((t=>t.id===e.zone)),n=a.find((t=>t.id===e.supplier)),i=t.toLowerCase();if(!((null==(o=e.reference)?void 0:o.toLowerCase().includes(i))||(null==r?void 0:r.name.toLowerCase().includes(i))||(null==n?void 0:n.name.toLowerCase().includes(i))))return!1}return!(r&&e.status!==r||n&&e.zone!==n||i&&e.supplier!==i)})))(t,y,b,C,S,s,o)),[t,y,b,C,S,s,o]),I=jt.useCallback((()=>{w(""),v(""),_(""),E("")}),[]),[j,T]=jt.useState(""),[D,R]=jt.useState(""),[N,P]=jt.useState(""),[O,k]=jt.useState(""),M=jt.useMemo((()=>((e,t,r,n,i,s)=>e.filter((e=>{var a;if(t){const r=s.find((t=>t.id===e.from_zone)),n=s.find((t=>t.id===e.to_zone)),i=t.toLowerCase();if(!((null==(a=e.reference)?void 0:a.toLowerCase().includes(i))||(null==r?void 0:r.name.toLowerCase().includes(i))||(null==n?void 0:n.name.toLowerCase().includes(i))))return!1}return!(r&&e.status!==r||n&&e.from_zone!==n||i&&e.to_zone!==i)})))(r,j,D,N,O,s)),[r,j,D,N,O,s]),F=jt.useCallback((()=>{T(""),R(""),P(""),k("")}),[]),[B,L]=jt.useState(""),[z,U]=jt.useState(""),[W,V]=jt.useState(""),H=jt.useMemo((()=>((e,t,r,n,i)=>e.filter((e=>{var s;if(t){const r=i.find((t=>t.id===e.zone)),n=t.toLowerCase();if(!(null==(s=e.reference)?void 0:s.toLowerCase().includes(n))&&!(null==r?void 0:r.name.toLowerCase().includes(n)))return!1}return!(r&&e.status!==r||n&&e.zone!==n)})))(n,B,z,W,s)),[n,B,z,W,s]),G=jt.useCallback((()=>{L(""),U(""),V("")}),[]),[q,X]=jt.useState(""),[$,Z]=jt.useState(""),[Y,Q]=jt.useState(""),K=jt.useMemo((()=>((e,t,r,n,i)=>e.filter((e=>{var s,a;if(t){const r=i.find((t=>t.id===e.product)),n=t.toLowerCase();if(!((null==r?void 0:r.name.toLowerCase().includes(n))||(null==(s=e.reference)?void 0:s.toLowerCase().includes(n))||(null==(a=e.notes)?void 0:a.toLowerCase().includes(n))))return!1}return!(r&&e.zone!==r||n&&e.transaction_type!==n)})))(i,q,$,Y,a)),[i,q,$,Y,a,s]),J=jt.useCallback((()=>{X(""),Z(""),Q("")}),[]),ee=jt.useCallback((()=>{x(),I(),F(),G(),J()}),[x,I,F,G,J]);return{filteredStocks:g,filteredSupplies:A,filteredTransfers:M,filteredInventories:H,filteredStockCards:K,stockFilters:{searchTerm:l,productFilter:d,zoneFilter:h,statusFilter:m,onSearchChange:c,onProductFilterChange:u,onZoneFilterChange:p,onStatusFilterChange:f},supplyFilters:{searchTerm:y,statusFilter:b,zoneFilter:C,supplierFilter:S,onSearchChange:w,onStatusFilterChange:v,onZoneFilterChange:_,onSupplierFilterChange:E},transferFilters:{searchTerm:j,statusFilter:D,fromZoneFilter:N,toZoneFilter:O,onSearchChange:T,onStatusFilterChange:R,onFromZoneFilterChange:P,onToZoneFilterChange:k},inventoryFilters:{searchTerm:B,statusFilter:z,zoneFilter:W,onSearchChange:L,onStatusFilterChange:U,onZoneFilterChange:V},stockCardFilters:{searchTerm:q,zoneFilter:$,typeFilter:Y,onSearchChange:X,onZoneFilterChange:Z,onTypeFilterChange:Q},resetStockFilters:x,resetSupplyFilters:I,resetTransferFilters:F,resetInventoryFilters:G,resetStockCardFilters:J,resetAllFilters:ee}})({stocks:a.stocks,supplies:a.supplies,transfers:a.transfers,inventories:a.inventories,stockCards:a.stockCards,zones:a.zones,products:a.products,suppliers:a.suppliers}),l=(({products:e,onSuccess:t,onError:r})=>{const[n,i]=jt.useState(!1),[s,a]=jt.useState("supply"),[o,l]=jt.useState(!1),[c,d]=jt.useState(null),[u,h]=jt.useState("pending"),[p,m]=jt.useState(""),[f,g]=jt.useState(""),[x,y]=jt.useState({items:[],status:"pending",supplier:"",zone:"",sourceZone:"",targetZone:"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0}),w=jt.useCallback(((t,r)=>{var n,s,o;if(a(t),l(!!r),d(r||null),h("pending"),m(""),g(""),r){if("supply"===t&&"supplier"in r){const t=r;y({items:(null==(n=t.items)?void 0:n.map((t=>{const r=e.find((e=>e.id===t.product));return{...t,product_name:(null==r?void 0:r.name)||"",product_obj:r}})))||[],status:t.status,supplier:t.supplier||"",zone:t.zone||"",sourceZone:t.zone||"",targetZone:"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0})}else if("transfer"===t&&"from_zone"in r){const t=r;y({items:(null==(s=t.items)?void 0:s.map((t=>{const r=e.find((e=>e.id===t.product));return{product:t.product,quantity:t.quantity,product_name:(null==r?void 0:r.name)||"",product_obj:r,unit_price:0,total_price:0}})))||[],status:t.status,supplier:"",zone:"",sourceZone:t.from_zone||"",targetZone:t.to_zone||"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0})}else if("inventory"===t&&"zone"in r){const t=r;y({items:(null==(o=t.items)?void 0:o.map((t=>{const r=e.find((e=>e.id===t.product));return{product:t.product,quantity:t.actual_quantity,expected_quantity:t.expected_quantity,product_name:(null==r?void 0:r.name)||"",product_obj:r,unit_price:0,total_price:0}})))||[],status:t.status,supplier:"",zone:t.zone||"",sourceZone:"",targetZone:"",inventoryZone:t.zone||"",currentProduct:null,currentQuantity:1,currentUnitPrice:0})}}else y({items:[],status:"inventory"===t?"draft":"pending",supplier:"",zone:"",sourceZone:"",targetZone:"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0});i(!0)}),[e]),b=jt.useCallback((()=>{i(!1),l(!1),d(null),h("pending"),m(""),g(""),y({items:[],status:"pending",supplier:"",zone:"",sourceZone:"",targetZone:"",inventoryZone:"",currentProduct:null,currentQuantity:1,currentUnitPrice:0})}),[]),v=jt.useCallback((e=>{y((t=>({...t,...e})))}),[]),C=jt.useCallback((async(e,n)=>{m(""),g("");const i=e||x.currentProduct,a=void 0!==n?n:Number(x.currentQuantity??0);if(!i)return null==r||r("Veuillez sÃ©lectionner un produit"),!1;if(a<=0)return m("La quantitÃ© doit Ãªtre supÃ©rieure Ã  0"),!1;if("transfer"===s&&!x.sourceZone)return null==r||r("Veuillez d'abord sÃ©lectionner la zone source"),!1;let o=Number(x.currentUnitPrice??0);if(e&&"supply"===s&&o<=0&&(o=Number(i.purchase_price??0)),"supply"===s&&o<=0)return g("Le prix unitaire doit Ãªtre supÃ©rieur Ã  0"),!1;let l=o,c=a*o;if("transfer"===s&&x.sourceZone)try{const e=(await co(Number(x.sourceZone))).find((e=>e.product===i.id));if(!e||e.quantity<=0)return null==r||r("Ce produit n'est pas disponible dans la zone source"),!1;if(a>e.quantity)return m(`QuantitÃ© disponible: ${e.quantity}`),!1;l=i.purchase_price||0,c=a*l}catch(u){return console.error("Error fetching stock data:",u),null==r||r("Erreur lors de la vÃ©rification du stock"),!1}const d=x.items.findIndex((e=>e.product===i.id));if(d>=0){const e=[...x.items],t=e[d],r=Number(t.quantity??0);if("transfer"===s&&x.sourceZone)try{const e=(await co(Number(x.sourceZone))).find((e=>e.product===i.id));if(e&&r+a>e.quantity)return m(`QuantitÃ© disponible: ${e.quantity}`),!1}catch(u){console.error("Error fetching stock data:",u)}e[d]={...t,quantity:r+a,unit_price:"supply"===s?o:"transfer"===s?l:t.unit_price,total_price:"supply"===s?(r+a)*o:"transfer"===s?(r+a)*l:t.total_price},y((t=>({...t,items:e,currentProduct:null,currentQuantity:1,currentUnitPrice:0})))}else{const e={product:i.id,product_name:i.name,product_obj:i,quantity:a,unit_price:"supply"===s?o:"transfer"===s?l:void 0,total_price:"supply"===s?a*o:"transfer"===s?c:void 0};y((t=>({...t,items:[...t.items,e],currentProduct:null,currentQuantity:1,currentUnitPrice:0})))}return null==t||t("Produit ajoutÃ©"),!0}),[x,s,t,r]),_=jt.useCallback((e=>{y((t=>({...t,items:t.items.filter(((t,r)=>r!==e))})))}),[]),S=jt.useCallback((()=>{let e;return e="supply"===s?(e=>{if(!e.supplier)return{isValid:!1,message:"Veuillez sÃ©lectionner un fournisseur"};if(0===e.items.length)return{isValid:!1,message:"Veuillez ajouter au moins un produit"};for(const t of e.items)if(!t.product||t.quantity<=0)return{isValid:!1,message:"Tous les produits doivent avoir une quantitÃ© valide"};return{isValid:!0}})({supplier:x.supplier?Number(x.supplier):null,zone:x.zone?Number(x.zone):null,items:x.items.map((e=>({product:e.product,quantity:Number(e.quantity),unit_price:e.unit_price?Number(e.unit_price):void 0})))}):"transfer"===s?(e=>{if(!e.sourceZone)return{isValid:!1,message:"Veuillez sÃ©lectionner un emplacement source"};if(!e.targetZone)return{isValid:!1,message:"Veuillez sÃ©lectionner un emplacement cible"};if(e.sourceZone===e.targetZone)return{isValid:!1,message:"Les emplacements source et cible doivent Ãªtre diffÃ©rents"};if(0===e.items.length)return{isValid:!1,message:"Veuillez ajouter au moins un produit"};for(const t of e.items)if(!t.product||t.quantity<=0)return{isValid:!1,message:"Tous les produits doivent avoir une quantitÃ© valide"};return{isValid:!0}})({sourceZone:x.sourceZone?Number(x.sourceZone):null,targetZone:x.targetZone?Number(x.targetZone):null,items:x.items.map((e=>({product:e.product,quantity:Number(e.quantity)})))}):"inventory"===s?(e=>{if(!e.inventoryZone)return{isValid:!1,message:"Veuillez sÃ©lectionner un emplacement"};if(0===e.items.length)return{isValid:!1,message:"Veuillez ajouter au moins un produit"};for(const t of e.items)if(!t.product||t.physical_quantity<0)return{isValid:!1,message:"Tous les produits doivent avoir une quantitÃ© physique valide"};return{isValid:!0}})({inventoryZone:x.inventoryZone?Number(x.inventoryZone):null,items:x.items.map((e=>({product:e.product,physical_quantity:Number(e.quantity)})))}):{isValid:!1,message:"Type d'opÃ©ration invalide"},!e.isValid&&e.message&&(null==r||r(e.message)),e.isValid}),[s,x,r]),E=jt.useCallback((()=>"supply"===s?{supplier:x.supplier?Number(x.supplier):null,zone:x.zone?Number(x.zone):null,status:x.status,items:x.items.map((e=>({product:e.product,quantity:Number(e.quantity),unit_price:e.unit_price?Number(e.unit_price):void 0})))}:"transfer"===s?{sourceZone:x.sourceZone?Number(x.sourceZone):null,targetZone:x.targetZone?Number(x.targetZone):null,status:x.status,items:x.items.map((e=>({product:e.product,quantity:Number(e.quantity)})))}:"inventory"===s?{inventoryZone:x.inventoryZone?Number(x.inventoryZone):null,status:x.status,items:x.items.map((e=>({product:e.product,physical_quantity:Number(e.quantity)})))}:null),[s,x]);return{dialogOpen:n,dialogOperation:s,editMode:o,selectedItem:c,dialogFormData:x,dialogStatus:u,dialogQuantityError:p,dialogPriceError:f,openDialog:w,closeDialog:b,setFormData:v,addItem:C,removeItem:_,validateForm:S,getFormDataForSubmit:E,setDialogQuantityError:m,setDialogPriceError:g}})({products:a.products,onSuccess:e=>s({open:!0,message:e,severity:"success"}),onError:e=>s({open:!0,message:e,severity:"error"})}),u=bd(a.products,((e,t)=>{l.addItem(e,t)}));return jt.useEffect((()=>{a.refreshAllData()}),[]),t.jsx(Ad,{requiredPermission:"view_stock",fallbackPath:"/dashboard",children:t.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsxs(c,{sx:{mb:4},children:[t.jsxs(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:e.palette.primary.main,borderBottom:`2px solid ${e.palette.primary.light}`,pb:1,width:"fit-content",display:"flex",alignItems:"center",gap:1},children:[t.jsx(_,{}),"Gestion de Stock"]}),t.jsx(d,{variant:"body1",color:"text.secondary",children:"GÃ©rez les stocks, rÃ©ceptions, transferts et inventaires"})]}),t.jsxs(U,{sx:{mb:4,borderRadius:3,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[t.jsx(c,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(he,{value:r,onChange:(e,t)=>n(t),indicatorColor:"primary",variant:"fullWidth",sx:{px:3,pt:2,"& .MuiTab-root":{fontWeight:"medium",py:2}},children:[t.jsx(pe,{label:"Stock Actuel"}),t.jsx(pe,{label:"RÃ©ceptions"}),t.jsx(pe,{label:"Transferts"}),t.jsx(pe,{label:"Inventaires"}),t.jsx(pe,{label:"Fiches de Stock"})]})}),t.jsxs(c,{sx:{p:3},children:[0===r&&t.jsx(Nl,{stocks:o.filteredStocks,loading:a.loading,zones:a.zones,...o.stockFilters}),1===r&&t.jsx(Kl,{supplies:o.filteredSupplies,loading:a.loading,zones:a.zones,suppliers:a.suppliers,...o.supplyFilters,onAdd:()=>l.openDialog("supply"),onEdit:e=>l.openDialog("supply",e),onDelete:e=>a.deleteSupply(e)}),2===r&&t.jsx(Jl,{transfers:o.filteredTransfers,loading:a.loading,zones:a.zones,...o.transferFilters,onAdd:()=>l.openDialog("transfer"),onEdit:e=>l.openDialog("transfer",e),onDelete:e=>a.deleteTransfer(e)}),3===r&&t.jsx(ec,{inventories:o.filteredInventories,loading:a.loading,zones:a.zones,...o.inventoryFilters,onAdd:()=>l.openDialog("inventory"),onEdit:e=>l.openDialog("inventory",e),onDelete:e=>a.deleteInventory(e)}),4===r&&t.jsx(tc,{stockCards:o.filteredStockCards,loading:a.loading,zones:a.zones,...o.stockCardFilters})]})]}),t.jsx(wc,{dialog:l,products:a.products,zones:a.zones,suppliers:a.suppliers,isViewMode:l.editMode&&l.selectedItem&&("received"===l.selectedItem.status||"completed"===l.selectedItem.status),onOpenScanner:u.openScanner,onSubmit:async(e,t,r,n)=>{var i,o;try{"supply"===e?t&&n?(await a.updateSupply(n,r),s({open:!0,message:"RÃ©ception mise Ã  jour avec succÃ¨s",severity:"success"})):(await a.createSupply(r),s({open:!0,message:"RÃ©ception crÃ©Ã©e avec succÃ¨s",severity:"success"})):"transfer"===e?t&&n?(await a.updateTransfer(n,r),s({open:!0,message:"Transfert mis Ã  jour avec succÃ¨s",severity:"success"})):(await a.createTransfer(r),s({open:!0,message:"Transfert crÃ©Ã© avec succÃ¨s",severity:"success"})):"inventory"===e&&(t&&n?(await a.updateInventory(n,r),s({open:!0,message:"Inventaire mis Ã  jour avec succÃ¨s",severity:"success"})):(await a.createInventory(r),s({open:!0,message:"Inventaire crÃ©Ã© avec succÃ¨s",severity:"success"})))}catch(l){const e=l,t=(null==(o=null==(i=null==e?void 0:e.response)?void 0:i.data)?void 0:o.error)||(null==e?void 0:e.message)||"Une erreur est survenue";throw s({open:!0,message:t,severity:"error"}),l}}}),t.jsx(hc,{scanner:u}),t.jsx(Ye,{open:i.open,onClose:()=>s({...i,open:!1}),children:t.jsx(W,{severity:i.severity,children:i.message})})]})})},Bh=()=>{var e,r,n,s;const l=h(),{userPermissions:u,isAdmin:p,userRole:g,userGroups:w,loading:b}=Di(),[v,C]=jt.useState(null),[_,S]=jt.useState(!0),[E,I]=jt.useState(null),[j,T]=jt.useState(!1),[D,R]=jt.useState({old_password:"",new_password:"",confirm_password:""}),[N,P]=jt.useState(!1),[O,F]=jt.useState(!1),[B,L]=jt.useState(!1);jt.useEffect((()=>{z()}),[]);const z=async()=>{try{S(!0),I(null);const e=await ss();C(e)}catch(e){console.error("Error fetching user data:",e),I("Impossible de charger les informations de profil"),Qi.error("Erreur lors du chargement du profil")}finally{S(!1)}},H=e=>({admin:"Administrateur",consultant:"Consultant",supervisor:"Superviseur",commercial:"Commercial",cashier:"Chef de Caisse"}[e]||e),G=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},$=e=>{const t=e.toLowerCase();return t.includes("client")||t.includes("customer")?"client":t.includes("supplier")||t.includes("fournisseur")?"supplier":t.includes("product")?"product":t.includes("sale")||t.includes("vente")?"sale":t.includes("stock")||t.includes("inventory")?"stock":t.includes("production")?"production":t.includes("payment")||t.includes("cash")||t.includes("treasury")?"payment":t.includes("user")||t.includes("utilisateur")?"user":t.includes("group")?"group":e},Z=e=>({sale:"Ventes",client:"Clients",customer:"Clients",product:"Produits",stock:"Stock",inventory:"Inventaire",supplier:"Fournisseurs",fournisseur:"Fournisseurs",user:"Utilisateurs",utilisateur:"Utilisateurs",payment:"Paiements / TrÃ©sorerie",cashreceipt:"Paiements / TrÃ©sorerie",production:"Production",productionorder:"Production",rawmaterial:"Production",group:"Groupes",permission:"Permissions",treasury:"TrÃ©sorerie",expense:"DÃ©penses",income:"Revenus"}[e.toLowerCase()]||e.charAt(0).toUpperCase()+e.slice(1)),Y=e=>{const t=["view","add","change","delete"];return e.sort(((e,r)=>t.indexOf(e.toLowerCase())-t.indexOf(r.toLowerCase())))};if(_||b)return t.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:t.jsx(m,{})});if(E||!v)return t.jsx(c,{p:3,children:t.jsx(W,{severity:"error",children:E||"Erreur lors du chargement du profil"})});const Q=(e=>{const t={};return Object.entries(e).forEach((([e,r])=>{const n=(e=>{const t=e.toLowerCase();return t.includes("sale")||t.includes("vente")?"Ventes":t.includes("client")||t.includes("customer")?"Clients":t.includes("product")||t.includes("produit")?"Produits":t.includes("stock")||t.includes("inventory")?"Stock":t.includes("supplier")||t.includes("fournisseur")?"Fournisseurs":t.includes("production")||t.includes("rawmaterial")?"Production":t.includes("cash")||t.includes("payment")||t.includes("treasury")||t.includes("expense")||t.includes("income")?"TrÃ©sorerie":t.includes("user")||t.includes("group")||t.includes("permission")?"Administration":"Autres"})(e);t[n]||(t[n]=[]),t[n].push({contentType:e,permissions:r})})),t})((()=>{const e={};u.forEach((t=>{const r=t.toLowerCase();let n="";r.includes("view")||r.startsWith("view")?n="view":r.includes("add")||r.startsWith("add")?n="add":r.includes("change")||r.startsWith("change")?n="change":(r.includes("delete")||r.startsWith("delete"))&&(n="delete");let i="";if(r.includes("_")){const e=r.split("_");e.length>=2&&(i=e.slice(1).join("_"))}else i=n?r.replace(n,"").replace("_",""):r;i=i.trim(),i&&(i=$(i),e[i]||(e[i]=new Set),n&&e[i].add(n))}));const t={};return Object.entries(e).forEach((([e,r])=>{t[e]=Array.from(r)})),t})());return t.jsxs(c,{sx:{p:3},children:[t.jsx(d,{variant:"h4",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:"Mon Profil"}),t.jsxs(oe,{container:!0,spacing:3,children:[t.jsx(oe,{item:!0,xs:12,md:4,children:t.jsx(ie,{elevation:2,children:t.jsxs(se,{children:[t.jsxs(c,{display:"flex",flexDirection:"column",alignItems:"center",mb:3,children:[t.jsx(ae,{sx:{width:120,height:120,mb:2,bgcolor:l.palette.primary.main,fontSize:"2.5rem"},children:(J=v.first_name,ee=v.last_name,te=v.username,J&&ee?`${J[0]}${ee[0]}`.toUpperCase():te?te.substring(0,2).toUpperCase():"U")}),t.jsx(d,{variant:"h5",gutterBottom:!0,children:v.first_name&&v.last_name?`${v.first_name} ${v.last_name}`:v.username}),t.jsx(ue,{label:H((null==(e=v.profile_data)?void 0:e.role)||g||"Utilisateur"),color:(K=(null==(r=v.profile_data)?void 0:r.role)||g||"",{admin:"error",consultant:"info",supervisor:"warning",commercial:"success",cashier:"primary"}[K]||"primary"),sx:{mb:1}}),p&&t.jsx(ue,{label:"Administrateur",color:"error",size:"small",icon:t.jsx(xt,{})})]}),t.jsx(x,{sx:{my:2}}),t.jsxs(y,{dense:!0,children:[t.jsxs(o,{children:[t.jsx(i,{children:t.jsx(M,{color:"primary"})}),t.jsx(a,{primary:"Nom d'utilisateur",secondary:v.username})]}),t.jsxs(o,{children:[t.jsx(i,{children:t.jsx(Ke,{color:"primary"})}),t.jsx(a,{primary:"Email",secondary:v.email||"Non renseignÃ©"})]}),t.jsxs(o,{children:[t.jsx(i,{children:t.jsx(At,{color:"primary"})}),t.jsx(a,{primary:"RÃ´le",secondary:H((null==(n=v.profile_data)?void 0:n.role)||g||"Utilisateur")})]}),(null==(s=v.profile_data)?void 0:s.phone)&&t.jsxs(o,{children:[t.jsx(i,{children:t.jsx(M,{color:"primary"})}),t.jsx(a,{primary:"TÃ©lÃ©phone",secondary:v.profile_data.phone})]})]}),t.jsx(x,{sx:{my:2}}),t.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:["Membre depuis: ",G(v.date_joined)]}),v.last_login&&t.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",children:["DerniÃ¨re connexion: ",G(v.last_login)]}),t.jsx(c,{mt:3,children:t.jsx(k,{variant:"outlined",fullWidth:!0,startIcon:t.jsx(et,{}),onClick:()=>T(!0),children:"Changer le mot de passe"})})]})})}),t.jsxs(oe,{item:!0,xs:12,md:8,children:[w.length>0&&t.jsx(ie,{elevation:2,sx:{mb:3},children:t.jsxs(se,{children:[t.jsxs(c,{display:"flex",alignItems:"center",mb:2,children:[t.jsx(A,{color:"primary",sx:{mr:1}}),t.jsx(d,{variant:"h6",children:"Groupes"})]}),t.jsx(c,{display:"flex",flexWrap:"wrap",gap:1,children:w.map(((e,r)=>t.jsx(ue,{label:e,color:"primary",variant:"outlined"},r)))})]})}),t.jsx(ie,{elevation:2,children:t.jsxs(se,{children:[t.jsxs(c,{display:"flex",alignItems:"center",mb:2,children:[t.jsx(xt,{color:"primary",sx:{mr:1}}),t.jsx(d,{variant:"h6",children:"Permissions"})]}),p?t.jsx(W,{severity:"success",icon:t.jsx(xt,{}),sx:{mb:2},children:"En tant qu'administrateur, vous avez accÃ¨s Ã  toutes les fonctionnalitÃ©s du systÃ¨me."}):t.jsx(t.Fragment,{children:0===Object.keys(Q).length?t.jsx(W,{severity:"warning",children:"Aucune permission spÃ©cifique n'est attribuÃ©e. Contactez votre administrateur."}):t.jsx(oe,{container:!0,spacing:2,children:Object.entries(Q).map((([e,r])=>t.jsx(oe,{item:!0,xs:12,children:t.jsxs(U,{variant:"outlined",sx:{p:2},children:[t.jsx(d,{variant:"subtitle1",color:"primary",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:e}),t.jsx(oe,{container:!0,spacing:2,children:r.map((({contentType:e,permissions:r})=>t.jsx(oe,{item:!0,xs:12,sm:6,md:4,children:t.jsxs(c,{sx:{p:1.5,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.default"},children:[t.jsx(d,{variant:"body2",sx:{fontWeight:600,mb:1},children:Z(e)}),t.jsx(d,{variant:"body2",color:"text.secondary",children:Y(r).map((e=>(e=>({view:"Voir",add:"Ajouter",change:"Modifier",delete:"Supprimer"}[e.toLowerCase()]||e))(e))).join(", ")})]})},e)))})]})},e)))})}),!p&&t.jsx(c,{mt:3,children:t.jsxs(d,{variant:"caption",color:"text.secondary",children:["Total des permissions: ",u.length]})})]})})]})]}),t.jsxs(xe,{open:j,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(ye,{children:"Changer le mot de passe"}),t.jsx(we,{children:t.jsxs(c,{sx:{pt:2},children:[t.jsx(V,{fullWidth:!0,label:"Ancien mot de passe",type:N?"text":"password",value:D.old_password,onChange:e=>R({...D,old_password:e.target.value}),margin:"normal",InputProps:{endAdornment:t.jsx(f,{onClick:()=>P(!N),edge:"end",children:N?t.jsx(q,{}):t.jsx(X,{})})}}),t.jsx(V,{fullWidth:!0,label:"Nouveau mot de passe",type:O?"text":"password",value:D.new_password,onChange:e=>R({...D,new_password:e.target.value}),margin:"normal",helperText:"Au moins 8 caractÃ¨res",InputProps:{endAdornment:t.jsx(f,{onClick:()=>F(!O),edge:"end",children:O?t.jsx(q,{}):t.jsx(X,{})})}}),t.jsx(V,{fullWidth:!0,label:"Confirmer le mot de passe",type:B?"text":"password",value:D.confirm_password,onChange:e=>R({...D,confirm_password:e.target.value}),margin:"normal",InputProps:{endAdornment:t.jsx(f,{onClick:()=>L(!B),edge:"end",children:B?t.jsx(q,{}):t.jsx(X,{})})}})]})}),t.jsxs(be,{children:[t.jsx(k,{onClick:()=>{T(!1),R({old_password:"",new_password:"",confirm_password:""})},startIcon:t.jsx(_e,{}),children:"Annuler"}),t.jsx(k,{onClick:async()=>{if(D.new_password===D.confirm_password)if(D.new_password.length<8)Qi.error("Le mot de passe doit contenir au moins 8 caractÃ¨res");else try{Qi.success("Mot de passe changÃ© avec succÃ¨s"),T(!1),R({old_password:"",new_password:"",confirm_password:""})}catch(e){console.error("Error changing password:",e),Qi.error("Erreur lors du changement de mot de passe")}else Qi.error("Les mots de passe ne correspondent pas")},variant:"contained",startIcon:t.jsx(et,{}),disabled:!D.old_password||!D.new_password||!D.confirm_password,children:"Changer"})]})]})]});var K,J,ee,te},Lh=()=>t.jsx(or,{children:t.jsxs(Ti,{children:[t.jsx(D,{}),t.jsx(Lt,{children:t.jsxs(zt,{children:[t.jsx(Ut,{path:"/login",element:t.jsx(us,{})}),t.jsx(Ut,{element:t.jsx(Mh,{}),children:t.jsxs(Ut,{element:t.jsx(ds,{}),children:[t.jsx(Ut,{index:!0,element:t.jsx(Oa,{})}),t.jsx(Ut,{path:"sales",element:t.jsx(Id,{})}),t.jsx(Ut,{path:"clients",element:t.jsx(Td,{})}),t.jsx(Ut,{path:"products",element:t.jsx(Dd,{})}),t.jsx(Ut,{path:"suppliers",element:t.jsx(Nd,{})}),t.jsx(Ut,{path:"production",element:t.jsx(Od,{})}),t.jsx(Ut,{path:"inventory",element:t.jsx(Fh,{})}),t.jsx(Ut,{path:"treasury",element:t.jsx(_h,{})}),t.jsx(Ut,{path:"users",element:t.jsx(Th,{})}),t.jsx(Ut,{path:"settings",element:t.jsx(kh,{})}),t.jsx(Ut,{path:"profile",element:t.jsx(Bh,{})}),t.jsx(Ut,{path:"*",element:t.jsx(Ft,{to:"/",replace:!0})})]})})]})})]})});ir.createRoot(document.getElementById("root")).render(t.jsx(Pt.StrictMode,{children:t.jsx(Lh,{})}));
